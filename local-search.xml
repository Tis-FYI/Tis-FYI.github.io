<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä½¿ç”¨ Redis æˆ– Memcached ä¼˜åŒ– Grafana çƒ­ç‚¹æŸ¥è¯¢ç¼“å­˜</title>
    <link href="/2026/01/11/%E4%BD%BF%E7%94%A8%20Redis%20%E6%88%96%20Memcached%20%E4%BC%98%E5%8C%96%20Grafana%20%E7%83%AD%E7%82%B9%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98/"/>
    <url>/2026/01/11/%E4%BD%BF%E7%94%A8%20Redis%20%E6%88%96%20Memcached%20%E4%BC%98%E5%8C%96%20Grafana%20%E7%83%AD%E7%82%B9%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h2 id="1-ä½¿ç”¨-Redis-ä½œä¸ºç¼“å­˜"><a href="#1-ä½¿ç”¨-Redis-ä½œä¸ºç¼“å­˜" class="headerlink" title="1. ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜"></a>1. ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜</h2><h3 id="1-1-å®‰è£…å’Œé…ç½®-Redis"><a href="#1-1-å®‰è£…å’Œé…ç½®-Redis" class="headerlink" title="1.1 å®‰è£…å’Œé…ç½® Redis"></a>1.1 å®‰è£…å’Œé…ç½® Redis</h3><ul><li><strong>å®‰è£… Redis</strong>ï¼šåœ¨æœåŠ¡å™¨ä¸Šå®‰è£… Redisï¼ˆå¦‚ <code>sudo apt-get install redis-server</code>ï¼‰æˆ–ä½¿ç”¨ Dockerï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --name redis -p 6379:6379 redis<br></code></pre></td></tr></table></figure></li><li><strong>éªŒè¯è¿æ¥</strong>ï¼šç¡®ä¿ Grafana æœåŠ¡å™¨å¯ä»¥è¿æ¥åˆ° Redisï¼ˆæ£€æŸ¥ IPã€ç«¯å£å’Œé˜²ç«å¢™ï¼‰ã€‚</li></ul><h3 id="1-2-ä¿®æ”¹-Grafana-é…ç½®æ–‡ä»¶"><a href="#1-2-ä¿®æ”¹-Grafana-é…ç½®æ–‡ä»¶" class="headerlink" title="1.2 ä¿®æ”¹ Grafana é…ç½®æ–‡ä»¶"></a>1.2 ä¿®æ”¹ Grafana é…ç½®æ–‡ä»¶</h3><ol><li>ç¼–è¾‘ <code>/etc/grafana/grafana.ini</code>ï¼Œé…ç½® <code>[caching]</code> éƒ¨åˆ†ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[caching]</span><br><span class="hljs-attr">enabled</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">type</span> = redis<br><span class="hljs-attr">connection_string</span> = redis://&lt;redis-host&gt;:<span class="hljs-number">6379</span><br></code></pre></td></tr></table></figure><ul><li>å¦‚æœ Redis æœ‰å¯†ç æˆ–ç‰¹å®šæ•°æ®åº“ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">connection_string</span> = redis://:&lt;password&gt;@&lt;redis-host&gt;:<span class="hljs-number">6379</span>/&lt;db-number&gt;<br></code></pre></td></tr></table></figure>ç¤ºä¾‹ï¼š<code>redis://:mypassword@192.168.1.100:6379/0</code></li></ul></li><li>å¯é€‰é…ç½®ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">cache_ttl</span> = <span class="hljs-number">3600</span> <span class="hljs-comment">; ç¼“å­˜ 1 å°æ—¶</span><br><span class="hljs-attr">max_size</span> = <span class="hljs-number">100</span> <span class="hljs-comment">; é™åˆ¶ç¼“å­˜ä¸º 100MB</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="1-3-é‡å¯-Grafana"><a href="#1-3-é‡å¯-Grafana" class="headerlink" title="1.3 é‡å¯ Grafana"></a>1.3 é‡å¯ Grafana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart grafana-server<br></code></pre></td></tr></table></figure><p>æˆ– Dockerï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart &lt;grafana-container-name&gt;<br></code></pre></td></tr></table></figure><h3 id="1-4-éªŒè¯ç¼“å­˜"><a href="#1-4-éªŒè¯ç¼“å­˜" class="headerlink" title="1.4 éªŒè¯ç¼“å­˜"></a>1.4 éªŒè¯ç¼“å­˜</h3><ul><li>æ£€æŸ¥ Grafana æ—¥å¿—ï¼ˆ<code>/var/log/grafana/grafana.log</code>ï¼‰ç¡®è®¤ Redis è¿æ¥ã€‚</li><li>ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ï¼šä½¿ç”¨ Grafana æŒ‡æ ‡ï¼ˆå¦‚ <code>grafana_cache_hits_total</code>ï¼‰ã€‚</li></ul><h3 id="1-5-æ³¨æ„äº‹é¡¹"><a href="#1-5-æ³¨æ„äº‹é¡¹" class="headerlink" title="1.5 æ³¨æ„äº‹é¡¹"></a>1.5 æ³¨æ„äº‹é¡¹</h3><ul><li><strong>ç¼“å­˜èŒƒå›´</strong>ï¼šé€‚ç”¨äºæŸ¥è¯¢ç»“æœã€ä»ªè¡¨æ¿å…ƒæ•°æ®ç­‰ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šç¡®ä¿ Redis æœ‰è¶³å¤Ÿå†…å­˜å’Œé«˜å¯ç”¨æ€§ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šå»ºè®®å¯ç”¨ TLS æˆ–å¯†ç ä¿æŠ¤ã€‚</li></ul><h2 id="2-ä½¿ç”¨-Memcached-ä½œä¸ºç¼“å­˜"><a href="#2-ä½¿ç”¨-Memcached-ä½œä¸ºç¼“å­˜" class="headerlink" title="2. ä½¿ç”¨ Memcached ä½œä¸ºç¼“å­˜"></a>2. ä½¿ç”¨ Memcached ä½œä¸ºç¼“å­˜</h2><h3 id="2-1-å®‰è£…å’Œé…ç½®-Memcached"><a href="#2-1-å®‰è£…å’Œé…ç½®-Memcached" class="headerlink" title="2.1 å®‰è£…å’Œé…ç½® Memcached"></a>2.1 å®‰è£…å’Œé…ç½® Memcached</h3><ul><li><strong>å®‰è£… Memcached</strong>ï¼šåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ï¼ˆå¦‚ <code>sudo apt-get install memcached</code>ï¼‰æˆ–ä½¿ç”¨ Dockerï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --name memcached -p 11211:11211 memcached<br></code></pre></td></tr></table></figure></li><li><strong>éªŒè¯è¿æ¥</strong>ï¼šç¡®ä¿ Grafana å¯è®¿é—® Memcachedï¼ˆé»˜è®¤ç«¯å£ 11211ï¼‰ã€‚</li></ul><h3 id="2-2-ä¿®æ”¹-Grafana-é…ç½®æ–‡ä»¶"><a href="#2-2-ä¿®æ”¹-Grafana-é…ç½®æ–‡ä»¶" class="headerlink" title="2.2 ä¿®æ”¹ Grafana é…ç½®æ–‡ä»¶"></a>2.2 ä¿®æ”¹ Grafana é…ç½®æ–‡ä»¶</h3><ol><li>ç¼–è¾‘ <code>grafana.ini</code>ï¼Œé…ç½® <code>[caching]</code> éƒ¨åˆ†ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[caching]</span><br><span class="hljs-attr">enabled</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">type</span> = memcached<br><span class="hljs-attr">connection_string</span> = &lt;memcached-host&gt;:<span class="hljs-number">11211</span><br></code></pre></td></tr></table></figure><ul><li>å¤šå®ä¾‹ç”¨é€—å·åˆ†éš”ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">connection_string</span> = <span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span>:<span class="hljs-number">11211</span>,<span class="hljs-number">192.168</span>.<span class="hljs-number">1.101</span>:<span class="hljs-number">11211</span><br></code></pre></td></tr></table></figure></li></ul></li><li>å¯é€‰é…ç½®ï¼š<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">cache_ttl</span> = <span class="hljs-number">3600</span> <span class="hljs-comment">; ç¼“å­˜ 1 å°æ—¶</span><br><span class="hljs-attr">max_size</span> = <span class="hljs-number">100</span> <span class="hljs-comment">; é™åˆ¶ç¼“å­˜ä¸º 100MB</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="2-3-é‡å¯-Grafana"><a href="#2-3-é‡å¯-Grafana" class="headerlink" title="2.3 é‡å¯ Grafana"></a>2.3 é‡å¯ Grafana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart grafana-server<br></code></pre></td></tr></table></figure><p>æˆ– Dockerï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart &lt;grafana-container-name&gt;<br></code></pre></td></tr></table></figure><h3 id="2-4-éªŒè¯ç¼“å­˜"><a href="#2-4-éªŒè¯ç¼“å­˜" class="headerlink" title="2.4 éªŒè¯ç¼“å­˜"></a>2.4 éªŒè¯ç¼“å­˜</h3><ul><li>æ£€æŸ¥ Grafana æ—¥å¿—ç¡®è®¤ Memcached è¿æ¥ã€‚</li><li>ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ï¼ˆ<code>grafana_cache_hits_total</code>ï¼‰ã€‚</li></ul><h3 id="2-5-æ³¨æ„äº‹é¡¹"><a href="#2-5-æ³¨æ„äº‹é¡¹" class="headerlink" title="2.5 æ³¨æ„äº‹é¡¹"></a>2.5 æ³¨æ„äº‹é¡¹</h3><ul><li><strong>é™åˆ¶</strong>ï¼šMemcached æ— æŒä¹…åŒ–ï¼Œé‡å¯ä¸¢å¤±æ•°æ®ã€‚</li><li><strong>æ€§èƒ½</strong>ï¼šé€‚åˆè½»é‡çº§ç¼“å­˜ï¼Œå†…å­˜æ•ˆç‡é«˜ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šé€šè¿‡é˜²ç«å¢™é™åˆ¶è®¿é—®ã€‚</li></ul><h2 id="3-ä¼˜åŒ–çƒ­ç‚¹æŸ¥è¯¢ç¼“å­˜"><a href="#3-ä¼˜åŒ–çƒ­ç‚¹æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="3. ä¼˜åŒ–çƒ­ç‚¹æŸ¥è¯¢ç¼“å­˜"></a>3. ä¼˜åŒ–çƒ­ç‚¹æŸ¥è¯¢ç¼“å­˜</h2><ul><li><strong>è¯†åˆ«çƒ­ç‚¹æŸ¥è¯¢</strong>ï¼šé€šè¿‡ Grafana æ—¥å¿—æˆ– Prometheus æŒ‡æ ‡ï¼ˆå¦‚ <code>prometheus_engine_query_duration_seconds</code>ï¼‰è¯†åˆ«é«˜é¢‘æŸ¥è¯¢ã€‚</li><li><strong>è°ƒæ•´ TTL</strong>ï¼šæ ¹æ®æŸ¥è¯¢æ›´æ–°é¢‘ç‡è®¾ç½® TTLï¼ˆå¦‚ 24 å°æ—¶ï¼‰ã€‚</li><li><strong>é¢„è®¡ç®—æŸ¥è¯¢</strong>ï¼šç»“åˆ Prometheus Recording Rules é¢„è®¡ç®—å¤æ‚æŸ¥è¯¢ï¼ˆå¦‚ <code>max_over_time</code>ï¼‰ã€‚</li><li><strong>åˆ†å±‚ç¼“å­˜</strong>ï¼šç»“åˆæ•°æ®æºç¼“å­˜ï¼ˆå¦‚ Thanos Querierï¼‰å½¢æˆå¤šçº§ç¼“å­˜ã€‚</li></ul><h2 id="4-Redis-vs-Memcached"><a href="#4-Redis-vs-Memcached" class="headerlink" title="4. Redis vs. Memcached"></a>4. Redis vs. Memcached</h2><ul><li><strong>Redis</strong>ï¼š<ul><li>ä¼˜ç‚¹ï¼šæ”¯æŒæŒä¹…åŒ–ã€ä¸°å¯Œæ•°æ®ç»“æ„ã€æ”¯æŒé›†ç¾¤ã€‚</li><li>ç¼ºç‚¹ï¼šé…ç½®å¤æ‚ï¼Œèµ„æºå ç”¨è¾ƒé«˜ã€‚</li><li>æ¨èåœºæ™¯ï¼šå¤æ‚æŸ¥è¯¢ã€é•¿æœŸç¼“å­˜ã€‚</li></ul></li><li><strong>Memcached</strong>ï¼š<ul><li>ä¼˜ç‚¹ï¼šç®€å•è½»é‡ï¼Œå†…å­˜æ•ˆç‡é«˜ã€‚</li><li>ç¼ºç‚¹ï¼šæ— æŒä¹…åŒ–ï¼ŒåŠŸèƒ½å•ä¸€ã€‚</li><li>æ¨èåœºæ™¯ï¼šä¸´æ—¶çƒ­ç‚¹æŸ¥è¯¢ç¼“å­˜ã€‚</li></ul></li></ul><h2 id="5-éªŒè¯å’Œç›‘æ§"><a href="#5-éªŒè¯å’Œç›‘æ§" class="headerlink" title="5. éªŒè¯å’Œç›‘æ§"></a>5. éªŒè¯å’Œç›‘æ§</h2><ul><li><strong>éªŒè¯ç¼“å­˜</strong>ï¼š<ul><li>ä½¿ç”¨ Grafana â€œInspectâ€ æ£€æŸ¥æŸ¥è¯¢å“åº”æ—¶é—´ã€‚</li><li>æ£€æŸ¥ Redisï¼ˆ<code>INFO STATS</code>ï¼‰æˆ– Memcachedï¼ˆ<code>stats</code>ï¼‰å‘½ä¸­ç‡ã€‚</li></ul></li><li><strong>ç›‘æ§æ€§èƒ½</strong>ï¼š<ul><li>ä½¿ç”¨ <code>redis_exporter</code> æˆ– <code>memcached_exporter</code> ç›‘æ§ã€‚</li><li>åœ¨ Grafana åˆ›å»ºä»ªè¡¨æ¿ï¼Œç›‘æ§å‘½ä¸­ç‡ã€å†…å­˜å’Œå»¶è¿Ÿã€‚</li></ul></li></ul><h2 id="6-ç¤ºä¾‹ï¼šç¼“å­˜-30-å¤©-CPU-å³°å€¼æŸ¥è¯¢"><a href="#6-ç¤ºä¾‹ï¼šç¼“å­˜-30-å¤©-CPU-å³°å€¼æŸ¥è¯¢" class="headerlink" title="6. ç¤ºä¾‹ï¼šç¼“å­˜ 30 å¤© CPU å³°å€¼æŸ¥è¯¢"></a>6. ç¤ºä¾‹ï¼šç¼“å­˜ 30 å¤© CPU å³°å€¼æŸ¥è¯¢</h2><p>æŸ¥è¯¢ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">max_over_time</span><span class="hljs-params">(rate(node_cpu_seconds_total[<span class="hljs-number">5</span>m])</span></span><span class="hljs-selector-attr">[30d:1h]</span>)<br></code></pre></td></tr></table></figure><p>é…ç½® Redisï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[caching]</span><br><span class="hljs-attr">enabled</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">type</span> = redis<br><span class="hljs-attr">connection_string</span> = redis://<span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span>:<span class="hljs-number">6379</span><br><span class="hljs-attr">cache_ttl</span> = <span class="hljs-number">86400</span> <span class="hljs-comment">; ç¼“å­˜ 24 å°æ—¶</span><br></code></pre></td></tr></table></figure><p>éªŒè¯ï¼šæ£€æŸ¥ Redis ç¼“å­˜é”®ï¼ˆ<code>KEYS *</code>ï¼‰æˆ– Grafana æ—¥å¿—ã€‚</p><h2 id="7-æ³¨æ„äº‹é¡¹"><a href="#7-æ³¨æ„äº‹é¡¹" class="headerlink" title="7. æ³¨æ„äº‹é¡¹"></a>7. æ³¨æ„äº‹é¡¹</h2><ul><li><strong>ç¼“å­˜å¤±æ•ˆ</strong>ï¼šå®šæœŸæ¸…ç†è¿‡æœŸé”®ï¼ŒRedis æ”¯æŒè‡ªåŠ¨è¿‡æœŸï¼ŒMemcached ä¾èµ– LRUã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šçƒ­ç‚¹æŸ¥è¯¢é€‚åˆè¾ƒé•¿ TTLï¼Œå®æ—¶æŸ¥è¯¢éœ€é™ä½ TTLã€‚</li><li><strong>èµ„æºè§„åˆ’</strong>ï¼šåˆ†é…è¶³å¤Ÿå†…å­˜ï¼ˆå»ºè®®ä» 1GB å¼€å§‹ï¼‰ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Containerd-Runcå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2026/01/10/Containerd-Runc%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2026/01/10/Containerd-Runc%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<hr><h2 id="ä¸€ã€containerd-å¸¸ç”¨å·¥å…·è¯´æ˜"><a href="#ä¸€ã€containerd-å¸¸ç”¨å·¥å…·è¯´æ˜" class="headerlink" title="ä¸€ã€containerd å¸¸ç”¨å·¥å…·è¯´æ˜"></a>ä¸€ã€containerd å¸¸ç”¨å·¥å…·è¯´æ˜</h2><ul><li><strong>ctr</strong><br> containerd å®˜æ–¹ CLIï¼ŒåŠŸèƒ½å¼ºä½†ååº•å±‚ï¼Œ<strong>ä¸å¤ªé€‚åˆç”Ÿäº§è„šæœ¬</strong></li><li><strong>crictl</strong><br> éµå¾ª CRI æ¥å£ï¼Œ<strong>Kubernetes åœºæ™¯æ¨è</strong></li><li><strong>nerdctl</strong><br> Docker é£æ ¼ CLIï¼ˆå¦‚æœå·²å®‰è£…ï¼‰</li></ul><hr><h2 id="äºŒã€ctr-å¸¸ç”¨å‘½ä»¤"><a href="#äºŒã€ctr-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="äºŒã€ctr å¸¸ç”¨å‘½ä»¤"></a>äºŒã€<code>ctr</code> å¸¸ç”¨å‘½ä»¤</h2><h3 id="1ï¸âƒ£-é•œåƒç®¡ç†"><a href="#1ï¸âƒ£-é•œåƒç®¡ç†" class="headerlink" title="1ï¸âƒ£ é•œåƒç®¡ç†"></a>1ï¸âƒ£ é•œåƒç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹é•œåƒ</span><br>ctr images <span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># æ‹‰å–é•œåƒ</span><br>ctr images pull docker.io/library/nginx:latest<br><br><span class="hljs-comment"># åˆ é™¤é•œåƒ</span><br>ctr images <span class="hljs-built_in">rm</span> docker.io/library/nginx:latest<br><br><span class="hljs-comment"># æŸ¥çœ‹é•œåƒè¯¦æƒ…</span><br>ctr images info docker.io/library/nginx:latest<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ containerd é»˜è®¤ namespace æ˜¯ <code>default</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ctr -n k8s.io images <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><hr><h3 id="2ï¸âƒ£-å®¹å™¨ä¸ä»»åŠ¡ç®¡ç†"><a href="#2ï¸âƒ£-å®¹å™¨ä¸ä»»åŠ¡ç®¡ç†" class="headerlink" title="2ï¸âƒ£ å®¹å™¨ä¸ä»»åŠ¡ç®¡ç†"></a>2ï¸âƒ£ å®¹å™¨ä¸ä»»åŠ¡ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿è¡Œå®¹å™¨ï¼ˆå‰å°ï¼‰</span><br>ctr run --<span class="hljs-built_in">rm</span> -t docker.io/library/busybox:latest <span class="hljs-built_in">test</span> sh<br><br><span class="hljs-comment"># åˆ›å»ºå®¹å™¨</span><br>ctr container create docker.io/library/nginx:latest nginx-test<br><br><span class="hljs-comment"># å¯åŠ¨å®¹å™¨</span><br>ctr task start nginx-test<br><br><span class="hljs-comment"># æŸ¥çœ‹è¿è¡Œä¸­çš„ task</span><br>ctr tasks <span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</span><br>ctr containers <span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># åœæ­¢ä»»åŠ¡</span><br>ctr task <span class="hljs-built_in">kill</span> nginx-test<br><br><span class="hljs-comment"># åˆ é™¤å®¹å™¨</span><br>ctr container <span class="hljs-built_in">rm</span> nginx-test<br></code></pre></td></tr></table></figure><hr><h3 id="3ï¸âƒ£-æŸ¥çœ‹æ—¥å¿—-è¿›ç¨‹"><a href="#3ï¸âƒ£-æŸ¥çœ‹æ—¥å¿—-è¿›ç¨‹" class="headerlink" title="3ï¸âƒ£ æŸ¥çœ‹æ—¥å¿— &#x2F; è¿›ç¨‹"></a>3ï¸âƒ£ æŸ¥çœ‹æ—¥å¿— &#x2F; è¿›ç¨‹</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># æŸ¥çœ‹ task è¯¦æƒ…</span><br>ctr task info nginx-<span class="hljs-keyword">test</span><br><br><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨è¿›ç¨‹</span><br>ctr task ps nginx-<span class="hljs-keyword">test</span><br></code></pre></td></tr></table></figure><blockquote><p>ctr <strong>æ²¡æœ‰åƒ docker logs ä¸€æ ·çš„å‘½ä»¤</strong>ï¼Œæ—¥å¿—éœ€é€šè¿‡è¿è¡Œæ—¶æˆ– kubelet æŸ¥çœ‹</p></blockquote><hr><h3 id="4ï¸âƒ£-Namespace-æ“ä½œ"><a href="#4ï¸âƒ£-Namespace-æ“ä½œ" class="headerlink" title="4ï¸âƒ£ Namespace æ“ä½œ"></a>4ï¸âƒ£ Namespace æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹ namespace</span><br>ctr namespaces <span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># åˆ›å»º namespace</span><br>ctr namespaces create <span class="hljs-built_in">test</span><br><br><span class="hljs-comment"># åœ¨æŒ‡å®š namespace æ“ä½œ</span><br>ctr -n <span class="hljs-built_in">test</span> containers <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€crictlï¼ˆKubernetes-å¼ºçƒˆæ¨èï¼‰"><a href="#ä¸‰ã€crictlï¼ˆKubernetes-å¼ºçƒˆæ¨èï¼‰" class="headerlink" title="ä¸‰ã€crictlï¼ˆKubernetes å¼ºçƒˆæ¨èï¼‰"></a>ä¸‰ã€<code>crictl</code>ï¼ˆKubernetes å¼ºçƒˆæ¨èï¼‰</h2><h3 id="1ï¸âƒ£-åŸºæœ¬ä¿¡æ¯"><a href="#1ï¸âƒ£-åŸºæœ¬ä¿¡æ¯" class="headerlink" title="1ï¸âƒ£ åŸºæœ¬ä¿¡æ¯"></a>1ï¸âƒ£ åŸºæœ¬ä¿¡æ¯</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">crictl</span> <span class="hljs-literal">info</span><br>crictl version<br></code></pre></td></tr></table></figure><hr><h3 id="2ï¸âƒ£-Pod-å®¹å™¨"><a href="#2ï¸âƒ£-Pod-å®¹å™¨" class="headerlink" title="2ï¸âƒ£ Pod &amp; å®¹å™¨"></a>2ï¸âƒ£ Pod &amp; å®¹å™¨</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># æŸ¥çœ‹ Pod</span><br>crictl pods<br><br><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨</span><br>crictl <span class="hljs-built_in">ps</span><br>crictl <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span><br><br><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨è¯¦æƒ…</span><br>crictl inspect &lt;container_id&gt;<br></code></pre></td></tr></table></figure><hr><h3 id="3ï¸âƒ£-æ—¥å¿—ä¸æ‰§è¡Œå‘½ä»¤ï¼ˆæœ€å¸¸ç”¨ï¼‰"><a href="#3ï¸âƒ£-æ—¥å¿—ä¸æ‰§è¡Œå‘½ä»¤ï¼ˆæœ€å¸¸ç”¨ï¼‰" class="headerlink" title="3ï¸âƒ£ æ—¥å¿—ä¸æ‰§è¡Œå‘½ä»¤ï¼ˆæœ€å¸¸ç”¨ï¼‰"></a>3ï¸âƒ£ æ—¥å¿—ä¸æ‰§è¡Œå‘½ä»¤ï¼ˆæœ€å¸¸ç”¨ï¼‰</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br>crictl logs <span class="hljs-variable">&lt;container_id&gt;</span><br><br><span class="hljs-comment"># è¿›å…¥å®¹å™¨</span><br>crictl exec -it <span class="hljs-variable">&lt;container_id&gt;</span> sh<br></code></pre></td></tr></table></figure><hr><h3 id="4ï¸âƒ£-é•œåƒ"><a href="#4ï¸âƒ£-é•œåƒ" class="headerlink" title="4ï¸âƒ£ é•œåƒ"></a>4ï¸âƒ£ é•œåƒ</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">crictl</span> images<br>crictl pull nginx:latest<br>crictl rmi nginx:latest<br></code></pre></td></tr></table></figure><hr><h2 id="å››ã€nerdctlï¼ˆå¦‚æœå·²å®‰è£…ï¼‰"><a href="#å››ã€nerdctlï¼ˆå¦‚æœå·²å®‰è£…ï¼‰" class="headerlink" title="å››ã€nerdctlï¼ˆå¦‚æœå·²å®‰è£…ï¼‰"></a>å››ã€<code>nerdctl</code>ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰</h2><blockquote><p>å‡ ä¹ç­‰åŒ Docker CLI</p></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">nerdctl ps<br>nerdctl images<br>nerdctl <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> nginx<br>nerdctl logs &lt;container_id&gt;<br></code></pre></td></tr></table></figure><hr><h2 id="äº”ã€å¸¸è§æ’é”™å‘½ä»¤ç»„åˆ"><a href="#äº”ã€å¸¸è§æ’é”™å‘½ä»¤ç»„åˆ" class="headerlink" title="äº”ã€å¸¸è§æ’é”™å‘½ä»¤ç»„åˆ"></a>äº”ã€å¸¸è§æ’é”™å‘½ä»¤ç»„åˆ</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># containerd æ˜¯å¦è¿è¡Œ</span><br>systemctl status containerd<br><br><span class="hljs-comment"># kubelet ä½¿ç”¨çš„ runtime</span><br>ps aux | grep containerd<br><br><span class="hljs-comment"># æŸ¥çœ‹ containerd socket</span><br>ls /<span class="hljs-keyword">run</span><span class="language-bash">/containerd/containerd.sock</span><br><br><span class="hljs-comment"># crictl æŒ‡å®š runtime</span><br>crictl --runtime-endpoint unix:///<span class="hljs-keyword">run</span><span class="language-bash">/containerd/containerd.sock ps</span><br></code></pre></td></tr></table></figure><hr><h2 id="å…­ã€ä½¿ç”¨å»ºè®®"><a href="#å…­ã€ä½¿ç”¨å»ºè®®" class="headerlink" title="å…­ã€ä½¿ç”¨å»ºè®®"></a>å…­ã€ä½¿ç”¨å»ºè®®</h2><table><thead><tr><th>åœºæ™¯</th><th>æ¨èå·¥å…·</th></tr></thead><tbody><tr><td>Kubernetes æ’é”™</td><td><code>crictl</code></td></tr><tr><td>containerd åº•å±‚è°ƒè¯•</td><td><code>ctr</code></td></tr><tr><td>ç±» Docker ä½“éªŒ</td><td><code>nerdctl</code></td></tr></tbody></table><h1 id="å¸¸ç”¨çš„containerdçš„å‘½ä»¤æ€ä¹ˆæ‹‰å–æ¨é€é•œåƒ"><a href="#å¸¸ç”¨çš„containerdçš„å‘½ä»¤æ€ä¹ˆæ‹‰å–æ¨é€é•œåƒ" class="headerlink" title="å¸¸ç”¨çš„containerdçš„å‘½ä»¤æ€ä¹ˆæ‹‰å–æ¨é€é•œåƒ"></a>å¸¸ç”¨çš„containerdçš„å‘½ä»¤æ€ä¹ˆæ‹‰å–æ¨é€é•œåƒ</h1><h2 id="ä¸€ã€ç”¨-ctr-æ‹‰å–-æ¨é€é•œåƒï¼ˆåŸç”Ÿæ–¹å¼ï¼‰"><a href="#ä¸€ã€ç”¨-ctr-æ‹‰å–-æ¨é€é•œåƒï¼ˆåŸç”Ÿæ–¹å¼ï¼‰" class="headerlink" title="ä¸€ã€ç”¨ ctr æ‹‰å– &#x2F; æ¨é€é•œåƒï¼ˆåŸç”Ÿæ–¹å¼ï¼‰"></a>ä¸€ã€ç”¨ <code>ctr</code> æ‹‰å– &#x2F; æ¨é€é•œåƒï¼ˆåŸç”Ÿæ–¹å¼ï¼‰</h2><blockquote><p>âš ï¸ æ³¨æ„ï¼š<code>ctr</code> <strong>é»˜è®¤æ²¡æœ‰ Docker ç™»å½•ä¿¡æ¯</strong>ï¼Œç§æœ‰ä»“åº“è¦å•ç‹¬æŒ‡å®šç”¨æˆ·åå¯†ç </p></blockquote><h3 id="1ï¸âƒ£-æ‹‰å–é•œåƒï¼ˆpullï¼‰"><a href="#1ï¸âƒ£-æ‹‰å–é•œåƒï¼ˆpullï¼‰" class="headerlink" title="1ï¸âƒ£ æ‹‰å–é•œåƒï¼ˆpullï¼‰"></a>1ï¸âƒ£ æ‹‰å–é•œåƒï¼ˆpullï¼‰</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># æ‹‰å– Docker Hub é•œåƒ</span><br>ctr images pull docker.io<span class="hljs-regexp">/library/</span>nginx:latest<br></code></pre></td></tr></table></figure><h3 id="æŒ‡å®šå¹³å°ï¼ˆå¸¸è§é—®é¢˜ï¼‰"><a href="#æŒ‡å®šå¹³å°ï¼ˆå¸¸è§é—®é¢˜ï¼‰" class="headerlink" title="æŒ‡å®šå¹³å°ï¼ˆå¸¸è§é—®é¢˜ï¼‰"></a>æŒ‡å®šå¹³å°ï¼ˆå¸¸è§é—®é¢˜ï¼‰</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ctr</span> images pull <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  --platform linux/amd64 <span class="hljs-punctuation">\</span><br><span class="hljs-punctuation"></span>  docker.io/library/nginx:latest<br></code></pre></td></tr></table></figure><hr><h3 id="2ï¸âƒ£-ç»™é•œåƒæ‰“-tag"><a href="#2ï¸âƒ£-ç»™é•œåƒæ‰“-tag" class="headerlink" title="2ï¸âƒ£ ç»™é•œåƒæ‰“ tag"></a>2ï¸âƒ£ ç»™é•œåƒæ‰“ tag</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">ctr images <span class="hljs-keyword">tag</span> <span class="hljs-title">\</span><br><span class="hljs-title">  docker</span>.io/library/nginx:latest \<br>  harbor.example.com/test/nginx:v1<br></code></pre></td></tr></table></figure><hr><h3 id="3ï¸âƒ£-æ¨é€é•œåƒï¼ˆpushï¼‰"><a href="#3ï¸âƒ£-æ¨é€é•œåƒï¼ˆpushï¼‰" class="headerlink" title="3ï¸âƒ£ æ¨é€é•œåƒï¼ˆpushï¼‰"></a>3ï¸âƒ£ æ¨é€é•œåƒï¼ˆpushï¼‰</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">ctr</span> images <span class="hljs-keyword">push</span> harbor.example.com/test/nginx:<span class="hljs-built_in">v1</span><br></code></pre></td></tr></table></figure><hr><h3 id="4ï¸âƒ£-ç§æœ‰ä»“åº“ï¼ˆç”¨æˆ·åå¯†ç ï¼‰"><a href="#4ï¸âƒ£-ç§æœ‰ä»“åº“ï¼ˆç”¨æˆ·åå¯†ç ï¼‰" class="headerlink" title="4ï¸âƒ£ ç§æœ‰ä»“åº“ï¼ˆç”¨æˆ·åå¯†ç ï¼‰"></a>4ï¸âƒ£ ç§æœ‰ä»“åº“ï¼ˆç”¨æˆ·åå¯†ç ï¼‰</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">ctr images pull \<br>  --<span class="hljs-keyword">user</span> <span class="hljs-title">admin</span>:password \<br>  harbor.example.com/test/nginx:v1<br>ctr images push \<br>  --<span class="hljs-keyword">user</span> <span class="hljs-title">admin</span>:password \<br>  harbor.example.com/test/nginx:v1<br></code></pre></td></tr></table></figure><hr><h3 id="5ï¸âƒ£-Kubernetes-åœºæ™¯ï¼ˆé‡è¦-âš ï¸ï¼‰"><a href="#5ï¸âƒ£-Kubernetes-åœºæ™¯ï¼ˆé‡è¦-âš ï¸ï¼‰" class="headerlink" title="5ï¸âƒ£ Kubernetes åœºæ™¯ï¼ˆé‡è¦ âš ï¸ï¼‰"></a>5ï¸âƒ£ Kubernetes åœºæ™¯ï¼ˆé‡è¦ âš ï¸ï¼‰</h3><p>K8s ä½¿ç”¨çš„æ˜¯ <code>k8s.io</code> namespaceï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ctr -n k8s.io images <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>æ‹‰å–é•œåƒåˆ° K8s namespaceï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">ctr -n k8s.io images pull \<br>  --<span class="hljs-keyword">user</span> <span class="hljs-title">admin</span>:password \<br>  harbor.example.com/test/nginx:v1<br></code></pre></td></tr></table></figure><p>å¦åˆ™ kubelet <strong>çœ‹ä¸åˆ°é•œåƒ</strong></p><hr><h2 id="äºŒã€ç”¨-nerdctlï¼ˆå¼ºçƒˆæ¨è-â­ï¼‰"><a href="#äºŒã€ç”¨-nerdctlï¼ˆå¼ºçƒˆæ¨è-â­ï¼‰" class="headerlink" title="äºŒã€ç”¨ nerdctlï¼ˆå¼ºçƒˆæ¨è â­ï¼‰"></a>äºŒã€ç”¨ <code>nerdctl</code>ï¼ˆå¼ºçƒˆæ¨è â­ï¼‰</h2><blockquote><p>ç±»ä¼¼ Dockerï¼Œç”¨èµ·æ¥æœ€èˆ’æœ</p></blockquote><h3 id="1ï¸âƒ£-ç™»å½•ä»“åº“"><a href="#1ï¸âƒ£-ç™»å½•ä»“åº“" class="headerlink" title="1ï¸âƒ£ ç™»å½•ä»“åº“"></a>1ï¸âƒ£ ç™»å½•ä»“åº“</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">nerdctl login harbor.<span class="hljs-built_in">example</span>.com<br></code></pre></td></tr></table></figure><hr><h3 id="2ï¸âƒ£-æ‹‰å–é•œåƒ"><a href="#2ï¸âƒ£-æ‹‰å–é•œåƒ" class="headerlink" title="2ï¸âƒ£ æ‹‰å–é•œåƒ"></a>2ï¸âƒ£ æ‹‰å–é•œåƒ</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nerdctl</span> pull nginx:latest<br></code></pre></td></tr></table></figure><hr><h3 id="3ï¸âƒ£-æ‰“-tag"><a href="#3ï¸âƒ£-æ‰“-tag" class="headerlink" title="3ï¸âƒ£ æ‰“ tag"></a>3ï¸âƒ£ æ‰“ tag</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">nerdctl <span class="hljs-keyword">tag</span> <span class="hljs-title">nginx</span>:latest harbor.example.com/test/nginx:v1<br></code></pre></td></tr></table></figure><hr><h3 id="4ï¸âƒ£-æ¨é€é•œåƒ"><a href="#4ï¸âƒ£-æ¨é€é•œåƒ" class="headerlink" title="4ï¸âƒ£ æ¨é€é•œåƒ"></a>4ï¸âƒ£ æ¨é€é•œåƒ</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">nerdctl</span> <span class="hljs-keyword">push</span> harbor.example.com/test/nginx:<span class="hljs-built_in">v1</span><br></code></pre></td></tr></table></figure><p>âœ” è‡ªåŠ¨ä½¿ç”¨ç™»å½•å‡­è¯<br> âœ” æ”¯æŒ build &#x2F; compose &#x2F; logs</p><hr><h2 id="ä¸‰ã€crictl-èƒ½ä¸èƒ½æ¨é€é•œåƒï¼Ÿ"><a href="#ä¸‰ã€crictl-èƒ½ä¸èƒ½æ¨é€é•œåƒï¼Ÿ" class="headerlink" title="ä¸‰ã€crictl èƒ½ä¸èƒ½æ¨é€é•œåƒï¼Ÿ"></a>ä¸‰ã€<code>crictl</code> èƒ½ä¸èƒ½æ¨é€é•œåƒï¼Ÿ</h2><p>ğŸ‘‰ <strong>ä¸èƒ½</strong></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">crictl åªèƒ½ pull <span class="hljs-regexp">/ rmi /</span> images<br>ä¸èƒ½ <span class="hljs-keyword">push</span><br>crictl pull nginx:latest<br></code></pre></td></tr></table></figure><blockquote><p>crictl ä¸»è¦æ˜¯ç»™ <strong>kubelet &#x2F; CRI è°ƒè¯•</strong> ç”¨çš„</p></blockquote><hr><h2 id="å››ã€é…ç½®-containerd-ç§æœ‰ä»“åº“ï¼ˆå…è¾“å¯†ç ï¼‰"><a href="#å››ã€é…ç½®-containerd-ç§æœ‰ä»“åº“ï¼ˆå…è¾“å¯†ç ï¼‰" class="headerlink" title="å››ã€é…ç½® containerd ç§æœ‰ä»“åº“ï¼ˆå…è¾“å¯†ç ï¼‰"></a>å››ã€é…ç½® containerd ç§æœ‰ä»“åº“ï¼ˆå…è¾“å¯†ç ï¼‰</h2><h3 id="1ï¸âƒ£-ç¼–è¾‘é…ç½®æ–‡ä»¶"><a href="#1ï¸âƒ£-ç¼–è¾‘é…ç½®æ–‡ä»¶" class="headerlink" title="1ï¸âƒ£ ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>1ï¸âƒ£ ç¼–è¾‘é…ç½®æ–‡ä»¶</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">vim /etc/containerd/config.toml<br></code></pre></td></tr></table></figure><h3 id="2ï¸âƒ£-æ·»åŠ -registry-é…ç½®"><a href="#2ï¸âƒ£-æ·»åŠ -registry-é…ç½®" class="headerlink" title="2ï¸âƒ£ æ·»åŠ  registry é…ç½®"></a>2ï¸âƒ£ æ·»åŠ  registry é…ç½®</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;harbor.example.com&quot;]</span><br>  <span class="hljs-attr">endpoint</span> = [<span class="hljs-string">&quot;https://harbor.example.com&quot;</span>]<br><br><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;harbor.example.com&quot;.auth]</span><br>  <span class="hljs-attr">username</span> = <span class="hljs-string">&quot;admin&quot;</span><br>  <span class="hljs-attr">password</span> = <span class="hljs-string">&quot;password&quot;</span><br></code></pre></td></tr></table></figure><h3 id="3ï¸âƒ£-é‡å¯"><a href="#3ï¸âƒ£-é‡å¯" class="headerlink" title="3ï¸âƒ£ é‡å¯"></a>3ï¸âƒ£ é‡å¯</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl restart containerd</span><br></code></pre></td></tr></table></figure><p>ä¹‹åï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">ctr</span> images pull harbor.example.com/test/nginx:<span class="hljs-built_in">v1</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Containerd</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Containerd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éƒ¨ç½²k8s-1.31ç‰ˆæœ¬è¸©å‘ç‚¹è®°å½•(éå®‰è£…æ­¥éª¤)</title>
    <link href="/2026/01/10/%E9%83%A8%E7%BD%B2k8s-1.31%E7%89%88%E6%9C%AC%E8%B8%A9%E5%9D%91%E7%82%B9%E8%AE%B0%E5%BD%95(%E9%9D%9E%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4)/"/>
    <url>/2026/01/10/%E9%83%A8%E7%BD%B2k8s-1.31%E7%89%88%E6%9C%AC%E8%B8%A9%E5%9D%91%E7%82%B9%E8%AE%B0%E5%BD%95(%E9%9D%9E%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4)/</url>
    
    <content type="html"><![CDATA[<hr><table><thead><tr><th><strong>è¿è¡Œæ—¶</strong></th><th><strong>Unix</strong> <strong>åŸŸå¥—æ¥å­—</strong></th></tr></thead><tbody><tr><td>containerd</td><td>unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;containerd&#x2F;containerd.sock</td></tr><tr><td>CRI-O</td><td>unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;crio&#x2F;crio.sock</td></tr><tr><td>Docker Engineï¼ˆä½¿ç”¨ cri-dockerdï¼‰</td><td>unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;cri-dockerd.sock</td></tr></tbody></table><blockquote><p>æ¥è‡ª <a href="https://v1-31.docs.kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://v1-31.docs.kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a> </p></blockquote><h3 id="å®‰è£…docker-è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨"><a href="#å®‰è£…docker-è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="å®‰è£…docker è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨"></a>å®‰è£…docker è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">ç¦»çº¿å®‰è£…ä¸‹è½½docker <br><br>https:<span class="hljs-regexp">//</span>docs.docker.com<span class="hljs-regexp">/engine/i</span>nstall<span class="hljs-regexp">/centos/</span><span class="hljs-comment">#install-from-a-package</span><br><br>éº’éºŸåŸºäºcentos8ï¼Œä¸‹è½½äºŒè¿›åˆ¶çš„docker<br><br>https:<span class="hljs-regexp">//</span>download.docker.com<span class="hljs-regexp">/linux/</span>centos<span class="hljs-regexp">/8/</span>x86_64<span class="hljs-regexp">/stable/</span>Packages/<br></code></pre></td></tr></table></figure><p><img src="https://img.biibll.com/file/1768116509165_image.png" alt="image.png"></p><h3 id="å®‰è£…cri-docker"><a href="#å®‰è£…cri-docker" class="headerlink" title="å®‰è£…cri-docker"></a>å®‰è£…cri-docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">ä¸æƒ³è‡ªå·±ç¼–è¯‘å°±ä¸‹è½½äºŒè¿›åˆ¶ https://github.com/Mirantis/cri-dockerd<br><br>Git <span class="hljs-built_in">clone</span> https://github.com/Mirantis/cri-dockerd.git <br><br><span class="hljs-comment"># å¤åˆ¶äºŒè¿›åˆ¶åˆ°/usr/local/bin ä¸‹</span><br>install -o root -g root -m 0755 cri-dockerd /usr/local/bin/cri-dockerd<br><span class="hljs-comment"># å¤åˆ¶ä¸‹è½½çš„</span><br>install packaging/systemd/* /etc/systemd/system<br>sed -i -e <span class="hljs-string">&#x27;s,/usr/bin/cri-dockerd,/usr/local/bin/cri-dockerd,&#x27;</span> /etc/systemd/system/cri-docker.service<br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now cri-docker.socket<br><br><span class="hljs-comment"># systemctl status cri-docker.socket # æŸ¥çœ‹çŠ¶æ€ä¹Ÿè¦å†™å…¨cri-docker.socket,ä¸ç„¶ä¼šçœ‹è§çŠ¶æ€æ—¶dead</span><br></code></pre></td></tr></table></figure><blockquote><p>å‚ç…§è¿™ä¸ªç½‘ç«™  <a href="https://mirantis.github.io/cri-dockerd/usage/install-manually/">https://mirantis.github.io/cri-dockerd/usage/install-manually/</a></p></blockquote><p> <img src="https://img.biibll.com/file/1768116662446_image.png" alt="image.png"></p><h3 id="å®‰è£…kubelet-kubeadm-kubectl"><a href="#å®‰è£…kubelet-kubeadm-kubectl" class="headerlink" title="å®‰è£…kubelet kubeadm kubectl"></a>å®‰è£…kubelet kubeadm kubectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æœ€æ–°ç‰ˆæœ¬</span><br><br> curl -LO <span class="hljs-string">&quot;[https://dl.k8s.io/release/**<span class="hljs-subst">$(**curl -L -s https://dl.k8s.io/release/stable.txt**)</span>**/bin/linux/amd64/kubectl](https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https:/dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl)&quot;</span> <br><br><span class="hljs-comment"># æŒ‡å®šç‰ˆæœ¬</span><br><br> curl -LO <span class="hljs-string">&quot;https://dl.k8s.io/release/v1.31.1/bin/linux/amd64/kubectl&quot;</span> <br><br> curl -LO <span class="hljs-string">&quot;https://dl.k8s.io/release/v1.31.1/bin/linux/amd64/kubelet&quot;</span> <br><br> curl -LO <span class="hljs-string">&quot;https://dl.k8s.io/release/v1.31.1/bin/linux/amd64/kubeadm&quot;</span> <br><br><span class="hljs-comment"># å¢åŠ å¯æ‰§è¡Œæƒé™å¤åˆ¶äºŒè¿›åˆ¶åˆ°/usr/binä¸‹,kubelet kubeadm ä¹Ÿæ˜¯ä¸€æ ·çš„</span><br><br><span class="hljs-built_in">chmod</span> +x kubectl<br><br><span class="hljs-built_in">mv</span> kubectl /usr/local/bin/<br></code></pre></td></tr></table></figure><blockquote><p> æ¥è‡ª <a href="https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/">https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/</a> </p></blockquote><h3 id="åˆå§‹åŒ–masterï¼ˆç¦»çº¿éœ€è¦æ³¨æ„é•œåƒæ‰“åŒ…ï¼‰"><a href="#åˆå§‹åŒ–masterï¼ˆç¦»çº¿éœ€è¦æ³¨æ„é•œåƒæ‰“åŒ…ï¼‰" class="headerlink" title="åˆå§‹åŒ–masterï¼ˆç¦»çº¿éœ€è¦æ³¨æ„é•œåƒæ‰“åŒ…ï¼‰"></a>åˆå§‹åŒ–masterï¼ˆç¦»çº¿éœ€è¦æ³¨æ„é•œåƒæ‰“åŒ…ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ‰¾åˆ°éœ€è¦ä¸‹è½½çš„é•œåƒ</span><br><br>[root@VM101 ~]# kubeadm config images list --kubernetes-version v1.31.1<br><br>registry.k8s.io/kube-apiserver:v1.31.1<br><br>registry.k8s.io/kube-controller-manager:v1.31.1<br><br>registry.k8s.io/kube-scheduler:v1.31.1<br><br>registry.k8s.io/kube-proxy:v1.31.1<br><br>registry.k8s.io/coredns/coredns:v1.11.3<br><br>registry.k8s.io/pause:3.10<br><br>registry.k8s.io/etcd:3.5.15-0<br><br> <br><br><span class="hljs-comment"># ä¸‹è½½é•œåƒåˆ°æœ¬åœ°</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(kubeadm config images list --kubernetes-version v1.31.1); <span class="hljs-keyword">do</span><br><br> docker pull <span class="hljs-variable">$i</span><br><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p><img src="https://img.biibll.com/file/1768116741350_image.png" alt="image.png"></p><h3 id="åˆå§‹åŒ–é›†ç¾¤"><a href="#åˆå§‹åŒ–é›†ç¾¤" class="headerlink" title="åˆå§‹åŒ–é›†ç¾¤"></a>åˆå§‹åŒ–é›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm init \<br><br> --apiserver-advertise-address=172.16.1.101 \<br><br> --kubernetes-version=v1.31.1 \<br><br> --service-cidr=10.96.0.0/12 \<br><br> --pod-network-cidr=10.244.0.0/16 \<br><br> --cri-socket=unix:///var/run/cri-dockerd.sock<br></code></pre></td></tr></table></figure><h3 id="é…ç½®æœåŠ¡"><a href="#é…ç½®æœåŠ¡" class="headerlink" title="é…ç½®æœåŠ¡"></a>é…ç½®æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;/etc/systemd/system/kubelet.service &lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span><br><br>[Unit]<br><br>Description=kubelet: The Kubernetes Node Agent<br><br>Documentation=https://kubernetes.io/docs/<br><br>After=containerd.service<br><br>Requires=containerd.service<br><br><br>[Service]<br><br><span class="hljs-comment"># ä¸è¦å†™æ­»kubeconfig,å› ä¸ºk8sä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª kubeletçš„é…ç½®</span><br><br>ExecStart=/usr/local/bin/kubelet<br><br>Restart=always<br><br>RestartSec=10<br><br><br><br>[Install]<br><br>WantedBy=multi-user.target<br><br>EOF<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»º-kubeadm-çš„-drop-inï¼ˆkubeadm-join-ä¼šå†™-flags-envï¼‰"><a href="#åˆ›å»º-kubeadm-çš„-drop-inï¼ˆkubeadm-join-ä¼šå†™-flags-envï¼‰" class="headerlink" title="åˆ›å»º kubeadm çš„ drop-inï¼ˆkubeadm join ä¼šå†™ flags&#x2F;envï¼‰"></a>åˆ›å»º kubeadm çš„ drop-inï¼ˆkubeadm join ä¼šå†™ flags&#x2F;envï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /etc/systemd/system/kubelet.service.d<br><br><span class="hljs-built_in">cat</span> &gt;/etc/systemd/system/kubelet.service.d/10-kubeadm.conf &lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span><br><br>[Service]<br><br>Environment=<span class="hljs-string">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span><br><br>Environment=<span class="hljs-string">&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&quot;</span><br><br>EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env<br><br>EnvironmentFile=-/etc/sysconfig/kubelet<br><br>ExecStart=<br><br>ExecStart=/usr/local/bin/kubelet <span class="hljs-variable">$KUBELET_KUBECONFIG_ARGS</span> <span class="hljs-variable">$KUBELET_CONFIG_ARGS</span> <span class="hljs-variable">$KUBELET_KUBEADM_ARGS</span> <span class="hljs-variable">$KUBELET_EXTRA_ARGS</span><br><br>EOF<br><br>!!!!! è¿™å°±æ˜¯ kubeadm çš„æ ‡å‡†æ¨¡å¼ï¼š<br><br>!!!   init/join å‰é  bootstrap-kubelet.confï¼Œ<span class="hljs-built_in">join</span> æˆåŠŸåç”Ÿæˆ kubelet.conf å¹¶è½®è½¬è¯ä¹¦ã€‚<br><br><br><span class="hljs-comment"># æ·»åŠ å®ŒæˆæœåŠ¡ï¼Œæ‰§è¡Œä¸‹é¢ä¸‰æ¡æ·»åŠ æœåŠ¡</span><br>systemctl daemon-reexec  <span class="hljs-comment"># è¿™æ¡å¯ä»¥ä¸æ‰§è¡Œï¼Œå¦‚æœä¸æ­£å¸¸æ‰æ‰§è¡Œ</span><br><br>systemctl daemon-reload<br><br>systemctl <span class="hljs-built_in">enable</span> kubelet<br></code></pre></td></tr></table></figure><h3 id="é‡æ–°åŠ å…¥å‘½ä»¤ï¼Œæ³¨æ„å¦‚æœé«˜ç‰ˆæœ¬è¿˜æ˜¯ç”¨dockerï¼Œè¦æ·»åŠ cri"><a href="#é‡æ–°åŠ å…¥å‘½ä»¤ï¼Œæ³¨æ„å¦‚æœé«˜ç‰ˆæœ¬è¿˜æ˜¯ç”¨dockerï¼Œè¦æ·»åŠ cri" class="headerlink" title="é‡æ–°åŠ å…¥å‘½ä»¤ï¼Œæ³¨æ„å¦‚æœé«˜ç‰ˆæœ¬è¿˜æ˜¯ç”¨dockerï¼Œè¦æ·»åŠ cri"></a>é‡æ–°åŠ å…¥å‘½ä»¤ï¼Œæ³¨æ„å¦‚æœé«˜ç‰ˆæœ¬è¿˜æ˜¯ç”¨dockerï¼Œè¦æ·»åŠ cri</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ‰“å°åŠ å…¥å‘½ä»¤</span><br>kubeadm token create --print-join-command <br><br><span class="hljs-comment"># ä½¿ç”¨ç”Ÿæˆçš„å‘½ä»¤åŠ å…¥é›†ç¾¤</span><br>kubeadm <span class="hljs-built_in">join</span> 172.16.1.101:6443 --tokenxxxxx   --cri-socket unix:///var/run/cri-dockerd.sock<br></code></pre></td></tr></table></figure><h3 id="k8s-åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹"><a href="#k8s-åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹" class="headerlink" title="k8s åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹"></a>k8s åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm <span class="hljs-built_in">join</span><br><br> â”‚<br><br> â”œâ”€â‘  Preflight æ£€æŸ¥ï¼ˆç³»ç»Ÿæ¡ä»¶ï¼‰<br><br> â”‚<br><br> â”œâ”€â‘¡ å‘ç°é›†ç¾¤ &amp; æ ¡éªŒ CAï¼ˆdiscoveryï¼‰<br><br> â”‚<br><br> â”œâ”€â‘¢ ç”Ÿæˆ bootstrap-kubelet.confï¼ˆä¸´æ—¶èº«ä»½ï¼‰<br><br> â”‚<br><br> â”œâ”€â‘£ å¯åŠ¨ kubeletï¼ˆTLS Bootstrapï¼‰<br><br> â”‚<br><br> â”œâ”€â‘¤ CSR ç”³è¯·è¯ä¹¦ â†’ apiserver ç­¾å‘<br><br> â”‚<br><br> â””â”€â‘¥ Node æ³¨å†ŒæˆåŠŸ â†’ Ready<br></code></pre></td></tr></table></figure><h3 id="Node-join-è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆå“ªäº›å…³é”®æ–‡ä»¶ï¼ˆéå¸¸é‡è¦ï¼‰"><a href="#Node-join-è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆå“ªäº›å…³é”®æ–‡ä»¶ï¼ˆéå¸¸é‡è¦ï¼‰" class="headerlink" title="Node join è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆå“ªäº›å…³é”®æ–‡ä»¶ï¼ˆéå¸¸é‡è¦ï¼‰"></a>Node join è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆå“ªäº›å…³é”®æ–‡ä»¶ï¼ˆéå¸¸é‡è¦ï¼‰</h3><table><thead><tr><th><strong>æ–‡ä»¶</strong></th><th><strong>ä»€ä¹ˆæ—¶å€™ç”Ÿæˆ</strong></th><th><strong>ä½œç”¨</strong></th></tr></thead><tbody><tr><td>bootstrap-kubelet.conf</td><td>join  åˆæœŸ</td><td>ä¸´æ—¶èº«ä»½</td></tr><tr><td>kubelet.conf</td><td>TLS  bootstrap æˆåŠŸå</td><td>æ­£å¼èº«ä»½</td></tr><tr><td>kubeadm-flags.env</td><td>join  ä¸­</td><td>kubelet  å¯åŠ¨å‚æ•°</td></tr><tr><td>&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;pki&#x2F;*</td><td>join  ä¸­</td><td>kubelet  è¯ä¹¦</td></tr><tr><td>&#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;*</td><td>CNI  æ­£å¸¸å</td><td>ç½‘ç»œé…ç½®</td></tr></tbody></table><h3 id="æœ€å¸¸è§çš„ã€Œå¡ç‚¹-â†’-æ ¹å› é€ŸæŸ¥è¡¨ã€"><a href="#æœ€å¸¸è§çš„ã€Œå¡ç‚¹-â†’-æ ¹å› é€ŸæŸ¥è¡¨ã€" class="headerlink" title="æœ€å¸¸è§çš„ã€Œå¡ç‚¹ â†’ æ ¹å› é€ŸæŸ¥è¡¨ã€"></a>æœ€å¸¸è§çš„ã€Œå¡ç‚¹ â†’ æ ¹å› é€ŸæŸ¥è¡¨ã€</h3><table><thead><tr><th><strong>å¡åœ¨å“ª</strong></th><th><strong>æ—¥å¿—ç‰¹å¾</strong></th><th><strong>æ ¹å› </strong></th></tr></thead><tbody><tr><td>preflight</td><td>FileExisting  &#x2F; conntrack</td><td>æ®‹ç•™æ–‡ä»¶  &#x2F; ä¾èµ–ç¼ºå¤±</td></tr><tr><td>discovery</td><td>x509  &#x2F; timeout</td><td>CA  hash &#x2F; ç½‘ç»œ</td></tr><tr><td>TLS  Bootstrap</td><td>Waiting  for TLS Bootstrap</td><td>CSR  æœªæ‰¹å‡† &#x2F; kubelet èµ·ä¸æ¥</td></tr><tr><td>æ³¨å†Œ  Node</td><td>forbidden  modify node</td><td>è¯ä¹¦èº«ä»½é”™</td></tr><tr><td>NetworkNotReady</td><td>cni  uninitialized</td><td>CNI  æ’ä»¶ä¸å…¨</td></tr><tr><td>Node  ä¸€ç›´ NotReady</td><td>kubelet  æ­£å¸¸ä½†ç½‘ç»œä¸é€š</td><td>CNI  &#x2F; iptables</td></tr></tbody></table><h4 id="æŸ¥çœ‹kubeletçš„æ—¥å¿—"><a href="#æŸ¥çœ‹kubeletçš„æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹kubeletçš„æ—¥å¿—"></a>æŸ¥çœ‹kubeletçš„æ—¥å¿—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs BASH">systemctl status kubelet --no-pager<br><br>journalctl -u kubelet -n 80 --no-pager<br></code></pre></td></tr></table></figure><h3 id="å¦‚æœé‡æ–°åŠ å…¥æœ‰é—®é¢˜ï¼Œ-éœ€è¦æ¸…ç†é›†ç¾¤ç„¶åé‡æ–°-kubeadm-join"><a href="#å¦‚æœé‡æ–°åŠ å…¥æœ‰é—®é¢˜ï¼Œ-éœ€è¦æ¸…ç†é›†ç¾¤ç„¶åé‡æ–°-kubeadm-join" class="headerlink" title="å¦‚æœé‡æ–°åŠ å…¥æœ‰é—®é¢˜ï¼Œ éœ€è¦æ¸…ç†é›†ç¾¤ç„¶åé‡æ–° kubeadm join"></a>å¦‚æœé‡æ–°åŠ å…¥æœ‰é—®é¢˜ï¼Œ éœ€è¦æ¸…ç†é›†ç¾¤ç„¶åé‡æ–° kubeadm join</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs BASH">systemctl stop kubelet<br><br>kubeadm reset -f --cri-socket unix:///var/run/cri-dockerd.sockï¼ˆé«˜ç‰ˆæœ¬æ‰åŠ ï¼‰<br><br> <br><br><span class="hljs-built_in">rm</span> -rf /etc/kubernetes<br><br><span class="hljs-built_in">rm</span> -rf /var/lib/kubelet/pki<br><br><span class="hljs-built_in">rm</span> -f /var/lib/kubelet/kubeadm-flags.env /var/lib/kubelet/config.yaml<br><br>systemctl restart containerd<br></code></pre></td></tr></table></figure><h3 id="å¿«é€Ÿåˆ¤æ–­æœ‰æ²¡æœ‰åŠ å…¥è¿‡é›†ç¾¤"><a href="#å¿«é€Ÿåˆ¤æ–­æœ‰æ²¡æœ‰åŠ å…¥è¿‡é›†ç¾¤" class="headerlink" title="å¿«é€Ÿåˆ¤æ–­æœ‰æ²¡æœ‰åŠ å…¥è¿‡é›†ç¾¤"></a>å¿«é€Ÿåˆ¤æ–­æœ‰æ²¡æœ‰åŠ å…¥è¿‡é›†ç¾¤</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">ls -l <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/kubelet/</span>kubeadm-flags.env <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/kubelet/</span>config.yaml  <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure><p><img src="https://img.biibll.com/file/1768117064363_image.png" alt="image.png"></p><h3 id="ç¡®è®¤è¯ä¹¦ä¿¡æ¯"><a href="#ç¡®è®¤è¯ä¹¦ä¿¡æ¯" class="headerlink" title="ç¡®è®¤è¯ä¹¦ä¿¡æ¯"></a>ç¡®è®¤è¯ä¹¦ä¿¡æ¯</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">openssl x509 -in <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/kubelet/</span>pki<span class="hljs-regexp">/kubelet-client-current.pem -noout -subject 2&gt;/</span>dev/<span class="hljs-keyword">null</span> || <span class="hljs-keyword">true</span><br></code></pre></td></tr></table></figure><h3 id="rockylinux-å®‰è£…ç½‘ç»œæ’ä»¶å-opt-cni-binä¸‹æ²¡æœ‰äºŒè¿›åˆ¶ç½‘ç»œæ–‡ä»¶æ€ä¹ˆè§£å†³"><a href="#rockylinux-å®‰è£…ç½‘ç»œæ’ä»¶å-opt-cni-binä¸‹æ²¡æœ‰äºŒè¿›åˆ¶ç½‘ç»œæ–‡ä»¶æ€ä¹ˆè§£å†³" class="headerlink" title="rockylinux å®‰è£…ç½‘ç»œæ’ä»¶å&#x2F;opt&#x2F;cni&#x2F;binä¸‹æ²¡æœ‰äºŒè¿›åˆ¶ç½‘ç»œæ–‡ä»¶æ€ä¹ˆè§£å†³"></a>rockylinux å®‰è£…ç½‘ç»œæ’ä»¶å&#x2F;opt&#x2F;cni&#x2F;binä¸‹æ²¡æœ‰äºŒè¿›åˆ¶ç½‘ç»œæ–‡ä»¶æ€ä¹ˆè§£å†³</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">å®‰è£…ç½‘ç»œæ’ä»¶ yum install -y containernetworking-pluginsï¼ˆä¸€èˆ¬æ˜¯è¿™ä¸ªï¼‰ æˆ–è€…æ˜¯ yum install -y kubernetes-cni<br><br>æ’ä»¶è¢«è£…åˆ°äº† /usr/libexec/cni/ï¼Œè€Œä¸æ˜¯ /opt/cni/bin<br><br><span class="hljs-built_in">mkdir</span> -p /opt/cni/bin <span class="hljs-comment"># ä¸€èˆ¬ä¸ç”¨åˆ›å»º</span><br><br> <br><br><span class="hljs-built_in">cp</span> -a /usr/libexec/cni/* /opt/cni/bin/<br><br><span class="hljs-built_in">ls</span> -l /opt/cni/bin | egrep <span class="hljs-string">&#x27;loopback|bridge|host-local|portmap&#x27;</span><br><br>systemctl restart cri-docker<br><br>systemctl restart kubelet<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é‡‘å¥</title>
    <link href="/2025/07/30/%E9%87%91%E5%8F%A5/"/>
    <url>/2025/07/30/%E9%87%91%E5%8F%A5/</url>
    
    <content type="html"><![CDATA[<hr><h2 id="æ¥è‡ªè”¡é›…å¥‡è€å¸ˆ"><a href="#æ¥è‡ªè”¡é›…å¥‡è€å¸ˆ" class="headerlink" title="æ¥è‡ªè”¡é›…å¥‡è€å¸ˆ"></a>æ¥è‡ªè”¡é›…å¥‡è€å¸ˆ</h2><h4 id="æˆ‘å¯ä»¥æœ‰ç«‹åœºï¼Œä½†æˆ‘æ­£å¸¸è¡¨è¾¾ï¼›"><a href="#æˆ‘å¯ä»¥æœ‰ç«‹åœºï¼Œä½†æˆ‘æ­£å¸¸è¡¨è¾¾ï¼›" class="headerlink" title="æˆ‘å¯ä»¥æœ‰ç«‹åœºï¼Œä½†æˆ‘æ­£å¸¸è¡¨è¾¾ï¼›"></a>æˆ‘å¯ä»¥æœ‰ç«‹åœºï¼Œä½†æˆ‘æ­£å¸¸è¡¨è¾¾ï¼›</h4><h4 id="æˆ‘å¯ä»¥æœ‰è§‚ç‚¹ï¼Œä½†æˆ‘å¿ƒå¹³æ°”å’Œï¼›"><a href="#æˆ‘å¯ä»¥æœ‰è§‚ç‚¹ï¼Œä½†æˆ‘å¿ƒå¹³æ°”å’Œï¼›" class="headerlink" title="æˆ‘å¯ä»¥æœ‰è§‚ç‚¹ï¼Œä½†æˆ‘å¿ƒå¹³æ°”å’Œï¼›"></a>æˆ‘å¯ä»¥æœ‰è§‚ç‚¹ï¼Œä½†æˆ‘å¿ƒå¹³æ°”å’Œï¼›</h4><h4 id="æˆ‘å¯ä»¥æœ‰æˆ‘çš„è¾“å‡ºï¼Œä½†æˆ‘è¦ç†æ€§å¹³å’Œï¼›"><a href="#æˆ‘å¯ä»¥æœ‰æˆ‘çš„è¾“å‡ºï¼Œä½†æˆ‘è¦ç†æ€§å¹³å’Œï¼›" class="headerlink" title="æˆ‘å¯ä»¥æœ‰æˆ‘çš„è¾“å‡ºï¼Œä½†æˆ‘è¦ç†æ€§å¹³å’Œï¼›"></a>æˆ‘å¯ä»¥æœ‰æˆ‘çš„è¾“å‡ºï¼Œä½†æˆ‘è¦ç†æ€§å¹³å’Œï¼›</h4><h4 id="ç»ä¸ä¼šä¸Šçº²ä¸Šçº¿ï¼Œç»ä¸ä¼šè¾±éª‚äººæ ¼ï¼Œ-å› ä¸ºè¿™å°±æ˜¯ä¸€ä»½å·¥ä½œï¼Œå°Šé‡æˆ‘ä»¬åŒè¡Œï¼Œ-å°±æ˜¯åœ¨å°Šé‡æˆ‘ä»¬è‡ªå·±çš„è¡Œä¸šã€‚"><a href="#ç»ä¸ä¼šä¸Šçº²ä¸Šçº¿ï¼Œç»ä¸ä¼šè¾±éª‚äººæ ¼ï¼Œ-å› ä¸ºè¿™å°±æ˜¯ä¸€ä»½å·¥ä½œï¼Œå°Šé‡æˆ‘ä»¬åŒè¡Œï¼Œ-å°±æ˜¯åœ¨å°Šé‡æˆ‘ä»¬è‡ªå·±çš„è¡Œä¸šã€‚" class="headerlink" title="ç»ä¸ä¼šä¸Šçº²ä¸Šçº¿ï¼Œç»ä¸ä¼šè¾±éª‚äººæ ¼ï¼Œ å› ä¸ºè¿™å°±æ˜¯ä¸€ä»½å·¥ä½œï¼Œå°Šé‡æˆ‘ä»¬åŒè¡Œï¼Œ å°±æ˜¯åœ¨å°Šé‡æˆ‘ä»¬è‡ªå·±çš„è¡Œä¸šã€‚"></a>ç»ä¸ä¼šä¸Šçº²ä¸Šçº¿ï¼Œç»ä¸ä¼šè¾±éª‚äººæ ¼ï¼Œ å› ä¸ºè¿™å°±æ˜¯ä¸€ä»½å·¥ä½œï¼Œå°Šé‡æˆ‘ä»¬åŒè¡Œï¼Œ å°±æ˜¯åœ¨å°Šé‡æˆ‘ä»¬è‡ªå·±çš„è¡Œä¸šã€‚</h4>]]></content>
    
    
    <categories>
      
      <category>é‡‘å¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é‡‘å¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shellç¼–ç¨‹ç¬¬ä¸€å¤©</title>
    <link href="/2025/07/14/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%E7%AC%AC1%E5%A4%A9/"/>
    <url>/2025/07/14/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%E7%AC%AC1%E5%A4%A9/</url>
    
    <content type="html"><![CDATA[<h1 id="1-shellç®€ä»‹"><a href="#1-shellç®€ä»‹" class="headerlink" title="1 shellç®€ä»‹"></a>1 shellç®€ä»‹</h1><h2 id="1-1-æ ¸å¿ƒå‘½ä»¤å›é¡¾"><a href="#1-1-æ ¸å¿ƒå‘½ä»¤å›é¡¾" class="headerlink" title="1.1 æ ¸å¿ƒå‘½ä»¤å›é¡¾"></a>1.1 æ ¸å¿ƒå‘½ä»¤å›é¡¾</h2><h3 id="1-1-1-ç­›é€‰ä¿¡æ¯"><a href="#1-1-1-ç­›é€‰ä¿¡æ¯" class="headerlink" title="1.1.1 ç­›é€‰ä¿¡æ¯"></a>1.1.1 ç­›é€‰ä¿¡æ¯</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» shellå¿«æ·é”®ã€grepã€sortã€å°ç»“ã€å››ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>shellå¿«æ·é”®</strong></p><p>å¿«æ·é”®ç¬¦å·</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs css">å‘½ä»¤æ‰§è¡Œï¼š   <br>    !!                  æ‰§è¡Œä¸Šä¸€æ¡å‘½ä»¤<br>    !num                æ‰§è¡Œå†å²å‘½ä»¤ä¸­çš„ç¬¬numè¡Œå‘½ä»¤<br>    Ctrl å…³é”®å­—          æ‰§è¡Œå†…å®¹åŒ¹é…çš„å‘½ä»¤<br>å‘½ä»¤è¡Œåˆ‡æ¢<br>    Ctrl + <span class="hljs-selector-tag">A</span>            å…‰æ ‡è¿…é€Ÿå›åˆ°è¡Œé¦–<br>    Ctrl + E            å…‰æ ‡è¿…é€Ÿå›åˆ°è¡Œå°¾<br>    Ctrl + k            åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾å†…å®¹<br>    Ctrl + u            åˆ é™¤å…‰æ ‡åˆ°è¡Œé¦–å†…å®¹<br>    Ctrl + <span class="hljs-attribute">y</span>            ç²˜è´´åˆ é™¤çš„å†…å®¹<br>    Ctrl + c            ä¸´æ—¶ç»ˆæ­¢å‘½ä»¤è¡Œå‘½ä»¤<br>    Esc + <span class="hljs-selector-tag">b</span>             ç§»åŠ¨åˆ°å½“å‰å•è¯çš„å¼€å¤´<br>    Esc + f             ç§»åŠ¨åˆ°å½“å‰å•è¯çš„ç»“å°¾<br></code></pre></td></tr></table></figure><p><strong>grepå‘½ä»¤</strong></p><p>è´Ÿè´£ä»æ•°æ®æºä¸­æ£€ç´¢å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè¡Œè¿‡æ»¤</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs nix">grep options &#x27;keys&#x27; filename<br><span class="hljs-params">OPTIONS:</span><br>    <span class="hljs-operator">-</span><span class="hljs-params">i:</span> ä¸åŒºåˆ†å¤§å°å†™<br>    <span class="hljs-operator">-</span><span class="hljs-params">v:</span> æŸ¥æ‰¾ä¸åŒ…å«æŒ‡å®šå†…å®¹çš„è¡Œ,åå‘é€‰æ‹©<br>    <span class="hljs-operator">-</span><span class="hljs-params">w:</span> æŒ‰å•è¯æœç´¢<br>    <span class="hljs-operator">-</span><span class="hljs-params">o:</span> æ‰“å°åŒ¹é…å…³é”®å­—<br>    <span class="hljs-operator">-</span><span class="hljs-params">c:</span> ç»Ÿè®¡åŒ¹é…åˆ°çš„æ¬¡æ•°<br>    <span class="hljs-operator">-</span><span class="hljs-params">n:</span> æ˜¾ç¤ºè¡Œå·<br>    <span class="hljs-operator">-</span><span class="hljs-params">r:</span> é€å±‚éå†ç›®å½•æŸ¥æ‰¾<br>    <span class="hljs-operator">-</span><span class="hljs-params">A:</span> æ˜¾ç¤ºåŒ¹é…è¡ŒåŠåé¢å¤šå°‘è¡Œ <br>    <span class="hljs-operator">-</span><span class="hljs-params">B:</span> æ˜¾ç¤ºåŒ¹é…è¡ŒåŠå‰é¢å¤šå°‘è¡Œ<br>    <span class="hljs-operator">-</span><span class="hljs-params">C:</span> æ˜¾ç¤ºåŒ¹é…è¡Œå‰åå¤šå°‘è¡Œ<br>    <span class="hljs-operator">-</span>lï¼šåªåˆ—å‡ºåŒ¹é…çš„æ–‡ä»¶å<br>    <span class="hljs-operator">-</span>Lï¼šåˆ—å‡ºä¸åŒ¹é…çš„æ–‡ä»¶å<br>    <span class="hljs-operator">-</span><span class="hljs-params">e:</span> ä½¿ç”¨æ­£åˆ™åŒ¹é…  <br>    <span class="hljs-operator">-</span>E:ä½¿ç”¨æ‰©å±•æ­£åˆ™åŒ¹é…<br>    ^key:ä»¥å…³é”®å­—å¼€å¤´<br>    key$:ä»¥å…³é”®å­—ç»“å°¾<br>    ^$:åŒ¹é…ç©ºè¡Œ<br>    <span class="hljs-operator">-</span>-color<span class="hljs-operator">=</span>auto ï¼šå¯ä»¥å°†æ‰¾åˆ°çš„å…³é”®è¯éƒ¨åˆ†åŠ ä¸Šé¢œè‰²çš„æ˜¾ç¤º<br>grep é«˜äº®æ˜¾ç¤º<br>centos7ä¸­å·²ç»ä¸ºå¤§å®¶è®¾ç½®äº†ï¼Œå­˜æ”¾åœ¨<span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>profile.d<span class="hljs-operator">/</span>colorgrep.shæ–‡ä»¶ä¸­ï¼Œå¦‚è‹¥å¤§å®¶ä½¿ç”¨çš„ç³»ç»Ÿä¸­æ²¡æœ‰è®¾ç½®é¢œè‰²è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥è‡ªè¡Œè®¾ç½®<br><br>ä¸´æ—¶è®¾ç½®ï¼š<br><span class="hljs-comment"># alias grep=&#x27;grep --color=auto&#x27;            //åªé’ˆå¯¹å½“å‰ç»ˆç«¯å’Œå½“å‰ç”¨æˆ·ç”Ÿæ•ˆ</span><br><br>æ°¸ä¹…è®¾ç½®ï¼š<br><span class="hljs-number">1</span>ï¼‰å…¨å±€ï¼ˆé’ˆå¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼‰<br>vim <span class="hljs-symbol">/etc/bashrc</span><br>alias grep<span class="hljs-operator">=</span>&#x27;grep <span class="hljs-operator">-</span>-color<span class="hljs-operator">=</span>auto&#x27;<br>source <span class="hljs-symbol">/etc/bashrc</span><br><br><span class="hljs-number">2</span>ï¼‰å±€éƒ¨ï¼ˆé’ˆå¯¹å…·ä½“çš„æŸä¸ªç”¨æˆ·ï¼‰<br>vim <span class="hljs-symbol">~/.bashrc</span><br>alias grep<span class="hljs-operator">=</span>&#x27;grep <span class="hljs-operator">-</span>-color<span class="hljs-operator">=</span>auto&#x27;<br>source <span class="hljs-symbol">~/.bashrc</span><br>å¸¸ç”¨å‘½ä»¤é€‰é¡¹å¿…çŸ¥å¿…ä¼š  ç¤ºä¾‹ï¼š<br><span class="hljs-comment"># grep -i root passwd                   å¿½ç•¥å¤§å°å†™åŒ¹é…åŒ…å«rootçš„è¡Œ</span><br><span class="hljs-comment"># grep -w ftp passwd                    ç²¾ç¡®åŒ¹é…ftpå•è¯</span><br><span class="hljs-comment"># grep -wo ftp passwd                   æ‰“å°åŒ¹é…åˆ°çš„å…³é”®å­—ftp</span><br><span class="hljs-comment"># grep -n root passwd                   æ‰“å°åŒ¹é…åˆ°rootå…³é”®å­—çš„è¡Œå¥½</span><br><span class="hljs-comment"># grep -ni root passwd                  å¿½ç•¥å¤§å°å†™åŒ¹é…ç»Ÿè®¡åŒ…å«å…³é”®å­—rootçš„è¡Œ</span><br><span class="hljs-comment"># grep -nic root passwd                 å¿½ç•¥å¤§å°å†™åŒ¹é…ç»Ÿè®¡åŒ…å«å…³é”®å­—rootçš„è¡Œæ•°</span><br><span class="hljs-comment"># grep -i ^root passwd                  å¿½ç•¥å¤§å°å†™åŒ¹é…ä»¥rootå¼€å¤´çš„è¡Œ</span><br><span class="hljs-comment"># grep bash$ passwd                     åŒ¹é…ä»¥bashç»“å°¾çš„è¡Œ</span><br><span class="hljs-comment"># grep -n ^$ passwd                     åŒ¹é…ç©ºè¡Œå¹¶æ‰“å°è¡Œå·</span><br><span class="hljs-comment"># grep ^# /etc/vsftpd/vsftpd.conf       åŒ¹é…ä»¥#å·å¼€å¤´çš„è¡Œ</span><br><span class="hljs-comment"># grep -v ^# /etc/vsftpd/vsftpd.conf    åŒ¹é…ä¸ä»¥#å·å¼€å¤´çš„è¡Œ</span><br><span class="hljs-comment"># grep -A 5 mail passwd                 åŒ¹é…åŒ…å«mailå…³é”®å­—åŠå…¶å5è¡Œ</span><br><span class="hljs-comment"># grep -B 5 mail passwd                 åŒ¹é…åŒ…å«mailå…³é”®å­—åŠå…¶å‰5è¡Œ</span><br><span class="hljs-comment"># grep -C 5 mail passwd                 åŒ¹é…åŒ…å«mailå…³é”®å­—åŠå…¶å‰å5è¡Œ</span><br></code></pre></td></tr></table></figure><p><strong>sortå‘½ä»¤</strong></p><p>ä¿¡æ¯æ’åº</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs vim">è¯­æ³•ï¼š<br><span class="hljs-keyword">sort</span> [<span class="hljs-keyword">options</span>] <span class="hljs-keyword">file</span><br>å°†æ–‡ä»¶çš„æ¯ä¸€è¡Œä½œä¸ºä¸€ä¸ªå•ä½ï¼Œä»é¦–å­—ç¬¦å‘åï¼Œä¾æ¬¡æŒ‰ASCIIç å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åå°†ä»–ä»¬æŒ‰å‡åºè¾“å‡ºã€‚<br><br><span class="hljs-keyword">options</span>:<br>-<span class="hljs-keyword">u</span> ï¼šå»é™¤é‡å¤è¡Œ<br>-r ï¼šé™åºæ’åˆ—ï¼Œé»˜è®¤æ˜¯å‡åº<br>-<span class="hljs-keyword">o</span> : å°†æ’åºç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ä¸­  ç±»ä¼¼ é‡å®šå‘ç¬¦å·&gt;<br>-n ï¼šä»¥æ•°å­—æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰å­—ç¬¦æ’åº<br>-t ï¼šåˆ†éš”ç¬¦<br>-<span class="hljs-keyword">k</span> ï¼šç¬¬<span class="hljs-keyword">N</span>åˆ—<br>-<span class="hljs-keyword">b</span> ï¼šå¿½ç•¥å‰å¯¼ç©ºæ ¼ã€‚<br>-R ï¼šéšæœºæ’åºï¼Œæ¯æ¬¡è¿è¡Œçš„ç»“æœå‡ä¸åŒã€‚<br>æ–‡ä»¶å†…å®¹<br>[root@localhost ~]# <span class="hljs-keyword">cat</span> num.txt<br><span class="hljs-number">9</span><br><span class="hljs-number">8</span><br><span class="hljs-number">6</span><br><span class="hljs-number">8</span><br><span class="hljs-number">4</span><br><span class="hljs-number">7</span><br><span class="hljs-number">2</span><br><span class="hljs-number">1</span><br><br>å†…å®¹å‡åº<br>[root@localhost ~]# <span class="hljs-keyword">sort</span> -n num.txt<br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">4</span><br><span class="hljs-number">6</span><br><span class="hljs-number">7</span><br><span class="hljs-number">8</span><br><span class="hljs-number">8</span><br><span class="hljs-number">9</span><br><br>å†…å®¹é™åº<br>[root@localhost ~]# <span class="hljs-keyword">sort</span> -r num.txt<br><span class="hljs-number">9</span><br><span class="hljs-number">9</span><br><span class="hljs-number">8</span><br><span class="hljs-number">7</span><br><span class="hljs-number">6</span><br><span class="hljs-number">4</span><br><span class="hljs-number">2</span><br><span class="hljs-number">1</span><br><br>å…¶ä»–å®è·µ<br><span class="hljs-keyword">sort</span> -<span class="hljs-keyword">nu</span> num.txt                å‡åºå»é‡<br><span class="hljs-keyword">sort</span> -<span class="hljs-keyword">ru</span> num.txt                é™åºå»é‡<br><span class="hljs-keyword">sort</span> -nru num.txt               å…ˆå‡åºåé™åºå†å»é‡<br><span class="hljs-keyword">sort</span> -R num.txt                 éšæœºæ’åº<br><span class="hljs-keyword">sort</span> -<span class="hljs-keyword">nu</span> num.txt -<span class="hljs-keyword">o</span> /tmp/<span class="hljs-keyword">a</span>.txt  å‡åºå»é‡åè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="1-1-2-å¤„ç†ä¿¡æ¯"><a href="#1-1-2-å¤„ç†ä¿¡æ¯" class="headerlink" title="1.1.2 å¤„ç†ä¿¡æ¯"></a>1.1.2 å¤„ç†ä¿¡æ¯</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» cutã€trã€uniq ã€å°ç»“ å››ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>cutå‘½ä»¤</strong></p><p>æ•°æ®æˆªå–</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Mandatory arguments <span class="hljs-keyword">to</span> long options are mandatory <span class="hljs-keyword">for</span> short options too.<br>  -b, <span class="hljs-comment">--bytes=åˆ—è¡¨              åªé€‰ä¸­æŒ‡å®šçš„è¿™äº›å­—èŠ‚</span><br>  -c, <span class="hljs-comment">--characters=åˆ—è¡¨         åªé€‰ä¸­æŒ‡å®šçš„è¿™äº›å­—ç¬¦</span><br>  -d, <span class="hljs-comment">--delimiter=åˆ†ç•Œç¬¦        ä½¿ç”¨æŒ‡å®šåˆ†ç•Œç¬¦ä»£æ›¿åˆ¶è¡¨ç¬¦ä½œä¸ºåŒºåŸŸåˆ†ç•Œ</span><br>  -f, <span class="hljs-comment">--fields=LIST       select only these fields;  also print any line</span><br>                            <span class="hljs-keyword">that</span> <span class="hljs-keyword">contains</span> no delimiter <span class="hljs-built_in">character</span>, unless<br>                            <span class="hljs-keyword">the</span> -s option <span class="hljs-keyword">is</span> specified<br>  -n                      <span class="hljs-keyword">with</span> -b: don&#x27;t split multibyte <span class="hljs-built_in">characters</span><br>      <span class="hljs-comment">--complement              è¡¥å…¨é€‰ä¸­çš„å­—èŠ‚ã€å­—ç¬¦æˆ–åŸŸ</span><br>  -s, <span class="hljs-comment">--only-delimited          ä¸æ‰“å°æ²¡æœ‰åŒ…å«åˆ†ç•Œç¬¦çš„è¡Œ</span><br>      <span class="hljs-comment">--output-delimiter=å­—ç¬¦ä¸² ä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦ä¸²ä½œä¸ºè¾“å‡ºåˆ†ç•Œç¬¦ï¼Œé»˜è®¤é‡‡ç”¨è¾“å…¥</span><br>                                çš„åˆ†ç•Œç¬¦<br>      <span class="hljs-comment">--help            æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º</span><br>      <span class="hljs-comment">--version         æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º</span><br><span class="hljs-comment"># cut -d: -f1 1.txt             ä»¥:å†’å·åˆ†å‰²ï¼Œæˆªå–ç¬¬1åˆ—å†…å®¹</span><br><span class="hljs-comment"># cut -d: -f1,6,7 1.txt         ä»¥:å†’å·åˆ†å‰²ï¼Œæˆªå–ç¬¬1,6,7åˆ—å†…å®¹</span><br><span class="hljs-comment"># cut -c4 1.txt                 æˆªå–æ–‡ä»¶ä¸­æ¯è¡Œç¬¬4ä¸ªå­—ç¬¦</span><br><span class="hljs-comment"># cut -c1-4 1.txt               æˆªå–æ–‡ä»¶ä¸­æ¯è¡Œçš„1-4ä¸ªå­—ç¬¦</span><br><span class="hljs-comment"># cut -c5- 1.txt                ä»ç¬¬5ä¸ªå­—ç¬¦å¼€å§‹æˆªå–åé¢æ‰€æœ‰å­—ç¬¦</span><br></code></pre></td></tr></table></figure><p><strong>trå‘½ä»¤</strong></p><p>å­—ç¬¦è½¬æ¢ã€æ›¿æ¢ã€åˆ é™¤</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs elixir">ç”¨æ³•ï¼štr [é€‰é¡¹]... <span class="hljs-title class_">SET1</span> [<span class="hljs-title class_">SET2</span>]<br>ä»æ ‡å‡†è¾“å…¥ä¸­æ›¿æ¢ã€ç¼©å‡å’Œ/æˆ–åˆ é™¤å­—ç¬¦ï¼Œå¹¶å°†ç»“æœå†™åˆ°æ ‡å‡†è¾“å‡ºã€‚<br><br>  -c, -C, --complement          é¦–å…ˆè¡¥è¶³<span class="hljs-title class_">SET1</span><br>  -d, --delete                  åˆ é™¤åŒ¹é…<span class="hljs-title class_">SET1</span> çš„å†…å®¹ï¼Œå¹¶ä¸ä½œæ›¿æ¢<br>  -s, --squeeze-repeats         å¦‚æœåŒ¹é…äº<span class="hljs-title class_">SET1</span> çš„å­—ç¬¦åœ¨è¾“å…¥åºåˆ—ä¸­å­˜åœ¨è¿ç»­çš„<br>                                é‡å¤ï¼Œåœ¨æ›¿æ¢æ—¶ä¼šè¢«ç»Ÿä¸€ç¼©ä¸ºä¸€ä¸ªå­—ç¬¦çš„é•¿åº¦<br>  -t, --truncate-set1           å…ˆå°†<span class="hljs-title class_">SET1</span> çš„é•¿åº¦æˆªä¸ºå’Œ<span class="hljs-title class_">SET2</span> ç›¸ç­‰<br>      --help                    æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º<br>      --version                 æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º<br>      <br>ç”¨æ³•<span class="hljs-number">1</span>ï¼šæŠŠcommandså‘½ä»¤è¾“å‡ºåšä¸ºtrè¾“å…¥è¿›è¡Œå¤„ç†<br>commands | tr  <span class="hljs-string">&#x27;string1&#x27;</span>  <span class="hljs-string">&#x27;string2&#x27;</span><br><br>ç”¨æ³•<span class="hljs-number">2</span>ï¼šæŠŠæ–‡ä»¶ä¸­çš„å†…å®¹è¾“å…¥ç»™trè¿›è¡Œå¤„ç†<br>tr  <span class="hljs-string">&#x27;string1&#x27;</span>  <span class="hljs-string">&#x27;string2&#x27;</span> &lt; filename<br><br>ç”¨æ³•<span class="hljs-number">3</span>ï¼šæŠŠæ–‡ä»¶ä¸­çš„å†…å®¹è¾“å…¥ç»™trè¿›è¡Œå¤„ç†ï¼Œéœ€è¦ä½¿ç”¨åˆ°é€‰é¡¹<br>tr options <span class="hljs-string">&#x27;string1&#x27;</span> &lt; filename<br>ç¤ºä¾‹<span class="hljs-number">1</span>ï¼šé€šè¿‡træŠŠåå¤å‡ºç°çš„å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œå‹ç¼©åå†å¤„ç†ã€‚<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># ifconfig eth0 | grep -w inet</span><br>        inet <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span>  netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span>  broadcast <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># ifconfig eth0 | grep -w inet | tr -s &quot; &quot;</span><br> inet <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span> netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> broadcast <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># ifconfig eth0 | grep -w inet | tr -s &quot; &quot; | cut -d &quot; &quot; -f 3  # å› ä¸ºå‹ç¼©ç©ºæ ¼ä¹‹åå‰é¢çš„ç©ºæ ¼å‰è¿˜æœ‰ä¸€æ®µ</span><br><span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br>ç¤ºä¾‹<span class="hljs-number">2</span>ï¼š æ–‡ä»¶çš„æ¼”ç¤º<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># head -n 5 /etc/passwd &gt; test1.txt</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># tr &#x27;[0-9]&#x27; &#x27;@&#x27; &lt; test1.txt</span><br><span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span>@<span class="hljs-symbol">:</span>@<span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/bash</span><br><span class="hljs-symbol">bin:</span><span class="hljs-symbol">x:</span>@<span class="hljs-symbol">:</span>@<span class="hljs-symbol">:bin</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">daemon:</span><span class="hljs-symbol">x:</span>@<span class="hljs-symbol">:</span>@<span class="hljs-symbol">:daemon</span><span class="hljs-symbol">:/sbin</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">adm:</span><span class="hljs-symbol">x:</span>@<span class="hljs-symbol">:</span>@<span class="hljs-symbol">:adm</span><span class="hljs-symbol">:/var/adm</span><span class="hljs-symbol">:/sbin/nologin</span><br><span class="hljs-symbol">lp:</span><span class="hljs-symbol">x:</span>@<span class="hljs-symbol">:</span>@<span class="hljs-symbol">:lp</span><span class="hljs-symbol">:/var/spool/lpd</span><span class="hljs-symbol">:/sbin/nologin</span><br><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># tr &#x27;[a-z]&#x27; &#x27;[A-Z]&#x27; &lt; test1.txt</span><br><span class="hljs-symbol">ROOT:</span><span class="hljs-symbol">X:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:ROOT</span><span class="hljs-symbol">:/ROOT</span><span class="hljs-symbol">:/BIN/BASH</span><br><span class="hljs-symbol">BIN:</span><span class="hljs-symbol">X:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:BIN</span><span class="hljs-symbol">:/BIN</span><span class="hljs-symbol">:/SBIN/NOLOGIN</span><br><span class="hljs-symbol">DAEMON:</span><span class="hljs-symbol">X:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:DAEMON</span><span class="hljs-symbol">:/SBIN</span><span class="hljs-symbol">:/SBIN/NOLOGIN</span><br><span class="hljs-symbol">ADM:</span><span class="hljs-symbol">X:</span><span class="hljs-number">3</span><span class="hljs-symbol">:</span><span class="hljs-number">4</span><span class="hljs-symbol">:ADM</span><span class="hljs-symbol">:/VAR/ADM</span><span class="hljs-symbol">:/SBIN/NOLOGIN</span><br><span class="hljs-symbol">LP:</span><span class="hljs-symbol">X:</span><span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:LP</span><span class="hljs-symbol">:/VAR/SPOOL/LPD</span><span class="hljs-symbol">:/SBIN/NOLOGIN</span><br></code></pre></td></tr></table></figure><p><strong>uniqå‘½ä»¤</strong> </p><p>è¿ç»­ä¿¡æ¯å»é‡</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs vim">Mandatory arguments <span class="hljs-keyword">to</span> long <span class="hljs-keyword">options</span> are mandatory <span class="hljs-keyword">for</span> short <span class="hljs-keyword">options</span> too.<br>  -<span class="hljs-keyword">c</span>, --<span class="hljs-built_in">count</span>           ç»Ÿè®¡é‡å¤è¡Œæ¬¡æ•°<br>  -d, --repeated        åªæ˜¾ç¤ºé‡å¤è¡Œ<br>  -i, --ignore-case     å¿½ç•¥å¤§å°å†™<br>  -s, --skip-chars=<span class="hljs-keyword">N</span>    avoid comparing the <span class="hljs-keyword">first</span> <span class="hljs-keyword">N</span> characters<br>  -<span class="hljs-keyword">u</span>, --unique          <span class="hljs-keyword">only</span> <span class="hljs-keyword">print</span> unique lines<br>æ–‡ä»¶å†…å®¹<br>[root@localhost ~]# <span class="hljs-keyword">cat</span> uniq.txt<br>AA<br>aa<br>aa<br>bb<br><span class="hljs-keyword">cc</span><br><span class="hljs-keyword">cc</span><br>dd<br><br>å»é‡æ¼”ç¤º<br>[root@localhost ~]# uniq uniq.txt<br>AA<br>aa<br>bb<br><span class="hljs-keyword">cc</span><br>dd<br><br>å…¶ä»–æ¼”ç¤º<br>uniq -i uniq.txt            å¤§å°å†™ä¸æ•æ„Ÿå»é‡<br>uniq -ic uniq.txt           å¤§å°å†™ä¸æ•æ„Ÿå»é‡åè®¡æ•°<br>uniq -d uniq.txt            ä»…æ˜¾ç¤ºé‡å¤çš„å†…å®¹<br><span class="hljs-keyword">sort</span> -n num.txt  | uniq     ç»“åˆ<span class="hljs-keyword">sort</span>æ’åºåå»é‡<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="1-1-3-ç»„åˆä¿¡æ¯"><a href="#1-1-3-ç»„åˆä¿¡æ¯" class="headerlink" title="1.1.3 ç»„åˆä¿¡æ¯"></a>1.1.3 ç»„åˆä¿¡æ¯</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä»  pasteã€xargsã€å°ç»“ã€ä¸¤ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>pasteå‘½ä»¤</strong></p><p>åˆå¹¶æ–‡ä»¶è¡Œå†…å®¹è¾“å‡ºåˆ°å±å¹•ï¼Œä¸ä¼šæ”¹åŠ¨æºæ–‡ä»¶</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs autoit">Mandatory arguments <span class="hljs-keyword">to</span> long options are mandatory <span class="hljs-keyword">for</span> short options too.<br>  -d, --delimiters=åˆ—è¡¨ æ”¹ç”¨æŒ‡å®šåˆ—è¡¨é‡Œçš„å­—ç¬¦æ›¿ä»£åˆ¶è¡¨åˆ†éš”ç¬¦<br>  -s, --serial          ä¸ä½¿ç”¨å¹³è¡Œçš„è¡Œç›®è¾“å‡ºæ¨¡å¼ï¼Œè€Œæ˜¯æ¯ä¸ªæ–‡ä»¶å ç”¨ä¸€è¡Œ<br>      --help            æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º<br>      --version         æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º<br>æ–‡ä»¶å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat a.txt</span><br>hello<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat b.txt</span><br>world<br><span class="hljs-number">888</span><br><span class="hljs-number">999</span><br><br>å†…å®¹åˆå¹¶<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># paste a.txt b.txt</span><br>hello   world<br>        <span class="hljs-number">888</span><br>        <span class="hljs-number">999</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># paste b.txt a.txt</span><br>world   hello<br><span class="hljs-number">888</span><br><span class="hljs-number">999</span><br><br>è‡ªå®šä¹‰åˆ†éš”ç¬¦ååˆå¹¶å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># paste -d<span class="hljs-string">&#x27;@&#x27;</span> b.txt a.txt</span><br>world<span class="hljs-symbol">@hello</span><br><span class="hljs-number">888</span>@<br><span class="hljs-number">999</span>@<br><br>å°†ä¸€ä¸ªæ–‡ä»¶æ‰€æœ‰å†…å®¹ä¸€è¡Œè¾“å‡º<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># paste -s b.txt</span><br>world   <span class="hljs-number">888</span>     <span class="hljs-number">999</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># paste -d<span class="hljs-string">&#x27;@&#x27;</span> -s b.txt</span><br>world<span class="hljs-symbol">@888</span><span class="hljs-symbol">@999</span><br></code></pre></td></tr></table></figure><p><strong>xargså‘½ä»¤</strong></p><p>å‘½ä»¤ç»“æœä¼ é€’</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">ä½œç”¨ï¼š<br>    xargs å¯ä»¥å°†ç®¡é“æˆ–æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰æ•°æ®è½¬æ¢æˆå‘½ä»¤è¡Œå‚æ•°ï¼Œä¹Ÿèƒ½å¤Ÿä»æ–‡ä»¶çš„è¾“å‡ºä¸­è¯»å–æ•°æ®ã€‚<br>    xargs ä¸€èˆ¬æ˜¯å’Œç®¡é“ä¸€èµ·ä½¿ç”¨ã€‚<br><br>å‘½ä»¤æ ¼å¼ï¼š<br>    somecommand |xargs -item  <span class="hljs-keyword">command</span><br><br>OPTIONS:<br>    -a file ä»æ–‡ä»¶ä¸­è¯»å…¥ä½œä¸ºsdtin<br>    -E flag flagå¿…é¡»æ˜¯ä¸€ä¸ªä»¥ç©ºæ ¼åˆ†éš”çš„æ ‡å¿—ï¼Œå½“xargsåˆ†æåˆ°å«æœ‰flagè¿™ä¸ªæ ‡å¿—çš„æ—¶å€™å°±åœæ­¢ã€‚<br>    -p å½“æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªargumentçš„æ—¶å€™è¯¢é—®ä¸€æ¬¡ç”¨æˆ·ã€‚<br>    -n num åé¢åŠ æ¬¡æ•°ï¼Œè¡¨ç¤ºå‘½ä»¤åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸€æ¬¡ç”¨çš„argumentçš„ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯ç”¨æ‰€æœ‰çš„ã€‚<br>    -t è¡¨ç¤ºå…ˆæ‰“å°å‘½ä»¤ï¼Œç„¶åå†æ‰§è¡Œã€‚<br>    -i æˆ–è€…æ˜¯-Iï¼Œå°†xargsæ¥æ”¶çš„æ¯é¡¹åç§°ï¼Œé€è¡Œèµ‹å€¼ç»™ &#123;&#125;ï¼Œå¯ä»¥ç”¨ &#123;&#125; ä»£æ›¿ã€‚<br>    -r no-run-if-empty å½“xargsçš„è¾“å…¥ä¸ºç©ºçš„æ—¶å€™åˆ™åœæ­¢xargsï¼Œä¸ç”¨å†å»æ‰§è¡Œäº†ã€‚<br>    -d delim åˆ†éš”ç¬¦ï¼Œé»˜è®¤çš„xargsåˆ†éš”ç¬¦æ˜¯å›è½¦ï¼Œargumentçš„åˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ï¼Œè¿™é‡Œä¿®æ”¹çš„æ˜¯xargsçš„åˆ†éš”ç¬¦ã€‚<br><br><br>æ³¨æ„ï¼šlinuxå‘½ä»¤æ ¼å¼ä¸€èˆ¬ä¸º<br>    å‘½ä»¤    å‘½ä»¤é€‰é¡¹     å‚æ•°<br>    ä¸Šä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºå°±æ˜¯ä¸‹ä¸€ä¸ªå‘½ä»¤çš„å‚æ•°  è¿™å¥è¯ç»“åˆå‘½ä»¤è¯­æ³•  åº”è¯¥çŸ¥é“è¾“å‡ºçš„å†…å®¹åœ¨ä¸‹ä¸€ä¸ªå‘½ä»¤çš„ä½ç½®äº†å§ã€‚<br>ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹<br>[root@localhost ~]<span class="hljs-comment"># xargs -a num.txt</span><br>9 8 6 8 4 7 2 1<br><br>ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹æ—¶ï¼ŒæŒ‡å®šå†…å®¹ç»“æŸç¬¦å·<br>[root@localhost ~]<span class="hljs-comment"># xargs -a num.txt -E 4</span><br>9 8 6 8<br><br>ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹æ—¶ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦æ˜¾ç¤ºï¼Œyæ˜¾ç¤ºï¼Œå…¶ä»–ä¸æ˜¾ç¤º<br>[root@localhost ~]<span class="hljs-comment"># xargs -a num.txt -p</span><br><span class="hljs-keyword">echo</span> 9 8 6 8 4 7 2 1 ?<span class="hljs-string">...y</span><br>9 8 6 8 4 7 2 1<br>[root@localhost ~]<span class="hljs-comment"># xargs -a num.txt -p</span><br><span class="hljs-keyword">echo</span> 9 8 6 8 4 7 2 1 ?<span class="hljs-string">...n</span><br><br>ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹æ—¶ï¼ŒæŒ‡å®šæ¯è¡Œæ˜¾ç¤ºå‡ ä¸ªå†…å®¹<br>[root@localhost ~]<span class="hljs-comment"># xargs -a num.txt -n4</span><br>9 8 6 8<br>4 7 2 1<br><br>ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹æ—¶ï¼ŒæŒ‡å®šæ¯è¡Œæ˜¾ç¤ºå‡ ä¸ªå†…å®¹ï¼Œæ²¡æ˜¾ç¤ºä¸€è¡Œè¯¢é—®ä¸€ä¸‹ç”¨æˆ·<br>[root@localhost ~]<span class="hljs-comment"># xargs -a num.txt -n4 -p</span><br><span class="hljs-keyword">echo</span> 9 8 6 8 ?<span class="hljs-string">...y</span><br>9 8 6 8<br><span class="hljs-keyword">echo</span> 4 7 2 1 ?<span class="hljs-string">...y</span><br>4 7 2 1<br><br>é»˜è®¤xargsä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦ï¼Œå¯ä»¥é€šè¿‡-dæ¥è‡ªå®šä¹‰åˆ†éš”ç¬¦<br>[root@localhost ~]<span class="hljs-comment"># echo &quot;ab cd ef g&quot; | xargs</span><br>ab <span class="hljs-keyword">cd</span> ef g<br>[root@localhost ~]<span class="hljs-comment"># echo &quot;nameXnameXnameXname&quot; | xargs -dX</span><br>name name name name<br>[root@localhost ~]<span class="hljs-comment"># echo &quot;nameXnameXnameXname&quot; | xargs</span><br>nameXnameXnameXname<br>-I ä¸´æ—¶å­˜å‚¨å†…å®¹ç»™ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè¿›è¡Œåç»­å¤„ç†<br>[root@localhost ~]<span class="hljs-comment"># xargs -a num.txt -n1 -I &#123;&#125; echo &#123;&#125;--bak</span><br>9<span class="hljs-params">--bak</span><br>8<span class="hljs-params">--bak</span><br>6<span class="hljs-params">--bak</span><br>8<span class="hljs-params">--bak</span><br>4<span class="hljs-params">--bak</span><br>7<span class="hljs-params">--bak</span><br>2<span class="hljs-params">--bak</span><br>1<span class="hljs-params">--bak</span><br><br>-Içš„ç»¼åˆè¿ç”¨ï¼Œè½¬ç§»æ–‡ä»¶å¹¶æ”¹å<br>[root@localhost ~]<span class="hljs-comment"># ls *.txt</span><br>a.txt  b.txt  num.txt  test1.txt  uniq.txt<br>[root@localhost ~]<span class="hljs-comment"># ls *.txt | xargs -n1 -I &#123;&#125; cp &#123;&#125; /tmp/&#123;&#125;-bak</span><br>[root@localhost ~]<span class="hljs-comment"># ls /tmp/*-bak</span><br><span class="hljs-string">/tmp/a.txt-bak</span>  <span class="hljs-string">/tmp/num.txt-bak</span>    <span class="hljs-string">/tmp/uniq.txt-bak</span><br><span class="hljs-string">/tmp/b.txt-bak</span>  <span class="hljs-string">/tmp/test1.txt-bak</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="1-2-ç¼–ç¨‹ç®€ä»‹"><a href="#1-2-ç¼–ç¨‹ç®€ä»‹" class="headerlink" title="1.2 ç¼–ç¨‹ç®€ä»‹"></a>1.2 ç¼–ç¨‹ç®€ä»‹</h2><h3 id="1-2-1-ç¼–ç¨‹è¯­è¨€è§£è¯»"><a href="#1-2-1-ç¼–ç¨‹è¯­è¨€è§£è¯»" class="headerlink" title="1.2.1 ç¼–ç¨‹è¯­è¨€è§£è¯»"></a>1.2.1 ç¼–ç¨‹è¯­è¨€è§£è¯»</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç¼–ç¨‹è¯­è¨€ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>ç¨‹åº</p><p><img src="H:/2024/msb2023shell%20%E7%BC%96%E7%A8%8B/shell%E7%BC%96%E7%A8%8B/%E8%AF%BE%E4%BB%B6%E5%86%85%E5%AE%B9/%E8%AF%BE%E4%BB%B6%E5%86%85%E5%AE%B9/%E7%AC%AC1%E5%A4%A9/image/image-20220607184357946.png?lastModify=1752502307" alt="image-20220607184357946"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown">å¤–åœ¨å…³ç³»ï¼š<br><span class="hljs-code">    ä¸šåŠ¡æ•°æ®ï¼šç”¨æˆ·è®¿é—®ä¸šåŠ¡æ—¶å€™ï¼Œäº§ç”Ÿçš„ä¿¡æ¯å†…å®¹</span><br><span class="hljs-code">    æ•°æ®ç»“æ„ï¼šé™æ€çš„æè¿°äº†æ•°æ®å…ƒç´ ä¹‹é—´çš„å…³ç³»</span><br><span class="hljs-code">    ç®—æ³•ï¼šè§£å†³å„ç§å®é™…é—®é¢˜çš„æ–¹æ³•å’Œæ€è·¯</span><br><span class="hljs-code">    æ•°æ®ç»“æ„ + ç®—æ³• = ç¨‹åº</span><br><span class="hljs-code">å†…åœ¨å…³ç³»ï¼š</span><br><span class="hljs-code">    ç®—æ³•å…¶å®å°±æ˜¯æ•°æ®çš„è¡¨ç¤ºå’Œå¤„ç†ï¼Œè€Œæ•°æ®çš„å¤„ç†å—åˆ°æ•°æ®çš„å„ç§å­˜å‚¨å½¢å¼çš„çº¦æŸï¼Œæ‰€ä»¥ç®—æ³•çš„æ•ˆç‡å’Œæ ·å¼å—åˆ°æ•°æ®ç»“æ„çš„ä¸¥é‡çº¦æŸã€‚</span><br><span class="hljs-code"></span><br><span class="hljs-code">    æ•°æ®ç»“æ„å­˜å‚¨ä¸‹æ¥çš„æ•°æ®ä¸ºä¸ºç®—æ³•æœåŠ¡çš„ï¼Œè€Œç®—æ³•å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†æ•°æ®ç»“æ„ä¸­çš„å†…å®¹è€Œå­˜åœ¨çš„ã€‚</span><br><span class="hljs-code">    æ‰€ä»¥è¯´ï¼šæ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œæ˜¯ä½ ä¸­æœ‰æˆ‘ï¼Œæˆ‘ä¸­æœ‰ä½ çš„åˆäºŒä¸ºä¸€çš„å…³ç³»</span><br><span class="hljs-code"></span><br>ç†è§£ï¼š<br><span class="hljs-code">    æˆ‘ä»¬ä¸€èˆ¬è¯´çš„æ•°æ®ä¸æ˜¯å¹²å·´å·´çš„å­—æ¯æ•°å­—ï¼Œè€Œæ˜¯åœ¨æŸç§åœºæ™¯ä¸‹æ¥å¯¹è¿™äº›æ•°æ®çš„å«ä¹‰è¿›è¡Œåˆ†æç­‰æ“ä½œï¼Œæ•°æ®ä¸€æ—¦æœ‰äº†åœºæ™¯æ„ä¹‰: </span><br><span class="hljs-code">    &quot;ä¸€&quot; åœ¨ä¸åŒåœºæ™¯çš„å£°éŸ³å’Œå«ä¹‰ã€‚</span><br><span class="hljs-code">    çº¯ç²¹çš„æ•°æ®åŠ ä¸Šåœºæ™¯ï¼Œä»–ä»¬å°±æœ‰äº†æ–°çš„åç§°ï¼šADT</span><br></code></pre></td></tr></table></figure><p>ADT</p><p><img src="http://cdn.882227.xyz/image-20220607184745329.png" alt="image-20220607184745329"></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs isbl">ä¸¾ä¾‹ä¸€ï¼š<br>    æ•°æ®ç±»å‹-äºº                       å¤šä¸ªäººï¼Œé™ˆæµ©å—ã€å±±é¸¡ã€å¤§å¤©äºŒã€å¤§é£...<br>    æ•°æ®è¿ç®—-å…³ç³»                     å½¼æ­¤é—´çš„å›¢é˜Ÿè”ç³»<br>    æŠ½è±¡æ•°æ®ç±»å‹=ç±»å‹+è¿ç®—=äºº+å…³ç³»       æ´ªå…´<br>ä¸¾ä¾‹äºŒï¼š<br>    æ¸¸æˆæŒ‰é’®â€œç©ºæ ¼â€ï¼šäººç‰©<span class="hljs-function"><span class="hljs-title">A</span>(æ•°æ®ç±»å‹) + æ‰“å­å¼¹(åŠ¨ä½œ)</span><br></code></pre></td></tr></table></figure><p><strong>ç¼–ç¨‹è¯­è¨€</strong></p><p>ç¼–ç¨‹</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext">æ‰€è°“çš„ç¼–ç¨‹ï¼Œå°±æ˜¯å°†æˆ‘ä»¬çš„åŠŸèƒ½æ€è·¯ç”¨ä»£ç çš„æ–¹å¼å®ç°å‡ºæ¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™äº›å®ç°çš„æ€è·¯ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š<br><br>é¢å‘è¿‡ç¨‹ç¼–ç¨‹<br>    å°†ä»»åŠ¡åŠŸèƒ½æ‹†åˆ†æˆå¤šä¸ªå­éƒ¨åˆ†ï¼Œç„¶åæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œä¸‹å»ã€‚<br>    <span class="hljs-bullet">-</span> <span class="hljs-string">é—®é¢˜è§„æ¨¡å°ï¼Œå¯ä»¥æ­¥éª¤åŒ–ï¼ŒæŒ‰éƒ¨å°±ç­å¤„ç†</span><br>    æ¯”è¾ƒç¬¦åˆæˆ‘ä»¬è‡ªå·±åšä¸€ä»¶äº‹æƒ…çš„æ€è·¯ã€‚<br>é¢å‘å¯¹è±¡ç¼–ç¨‹<br>    å°†ä»»åŠ¡åŠŸèƒ½æ‹†åˆ†æˆå¤šä¸ªå­éƒ¨åˆ†ï¼Œç„¶åæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰¾ä¸åŒçš„äººæ‰§è¡Œä¸‹å»ã€‚<br>    <span class="hljs-bullet">-</span> <span class="hljs-string">é—®é¢˜è§„æ¨¡å¤§ï¼Œå¤æ‚ç³»ç»Ÿ</span><br>    æ¯”è¾ƒç¬¦åˆæˆ‘ä»¬çš„é¢†å¯¼æŒ‡æŒ¥ä¸€ä¸ªéƒ¨é—¨çš„äººåšäº‹æƒ…çš„æ€è·¯ã€‚<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607190012445.png" alt="image-20220607190012445"></p><p>ç¼–ç¨‹è¯­è¨€</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ‰€è°“ç¼–ç¨‹è¯­è¨€ï¼ŒæŒ‡çš„æ˜¯ä»¥å“ªç§é£æ ¼ä»£ç æ–¹å¼æŠŠç¨‹åºç¼–å†™å‡ºæ¥ã€‚æ¯ä¸€ç§ç¼–ç¨‹é£æ ¼å°±æ˜¯ä¸€ç³»åˆ—çš„ç¼–ç¨‹è¯­è¨€ã€‚<br><br>å‚è€ƒèµ„æ–™ï¼š<br>    https:<span class="hljs-regexp">//</span>www.tiobe.com<span class="hljs-regexp">/tiobe-index/</span><br>    https:<span class="hljs-regexp">//</span>hellogithub.com<span class="hljs-regexp">/report/</span>tiobe/<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607191238570.png" alt="image-20220607191238570"></p><p><strong>å°ç»“</strong></p><h3 id="1-2-2-ç¼–ç¨‹è¯­è¨€é€»è¾‘"><a href="#1-2-2-ç¼–ç¨‹è¯­è¨€é€»è¾‘" class="headerlink" title="1.2.2 ç¼–ç¨‹è¯­è¨€é€»è¾‘"></a>1.2.2 ç¼–ç¨‹è¯­è¨€é€»è¾‘</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» è¯­è¨€åˆ†ç±»ã€ç¼–ç¨‹é€»è¾‘ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>è¯­è¨€åˆ†ç±»</strong></p><p>è¯­è¨€åˆ†ç±»</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext">ä½çº§ç¼–ç¨‹è¯­è¨€ï¼š<br>    æœºå™¨ï¼š<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">äºŒè¿›åˆ¶çš„0å’Œ1çš„åºåˆ—ï¼Œç§°ä¸ºæœºå™¨æŒ‡ä»¤ã€‚</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">ä¸€èˆ¬äººçœ‹ä¸æ‡‚</span><br>    æ±‡ç¼–ï¼š<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">ç”¨ä¸€äº›åŠ©è®°ç¬¦å·æ›¿ä»£æœºå™¨æŒ‡ä»¤ï¼Œç§°ä¸ºæ±‡ç¼–è¯­è¨€ã€‚</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">ä¸€èˆ¬äººçœ‹ä¸æ‡‚ï¼Œä½†æ˜¯èƒ½å¤Ÿæœ‰æ„Ÿè§‰</span><br>é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼š<br>    ç¼–è¯‘ï¼š<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">å€ŸåŠ©äºä¸“å±ç¼–è¯‘å™¨å°†ä¸€äº›é«˜çº§è¯­è¨€ç¼–è¯‘æˆæœºå™¨ä»£ç æ–‡ä»¶ï¼Œç„¶åå†äº¤ç»™ç¨‹åºå»æ‰§è¡Œã€‚</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">å¦‚ï¼šCï¼ŒC++ç­‰</span><br>    è§£é‡Šï¼š<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">å°†é«˜çº§è¯­è¨€çš„ä»£ç é€è¡ŒåŠ è½½åˆ°è§£é‡Šå™¨ç¯å¢ƒï¼Œé€è¡Œè§£é‡Šä¸ºæœºå™¨ä»£ç ï¼Œç„¶åå†äº¤ç»™ç¨‹åºå»æ‰§è¡Œã€‚</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">å¦‚ï¼šshellï¼Œpythonï¼Œphpï¼ŒJavaScriptç­‰</span><br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607192547404.png" alt="image-20220607192547404"></p><p><strong>ç¼–ç¨‹é€»è¾‘</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">ç¼–ç¨‹è¯­è¨€çš„ç›®çš„æ˜¯é€šè¿‡é£æ ¼åŒ–çš„ç¼–ç¨‹æ€è·¯å°†ä»£ç å†™å‡ºæ¥åï¼Œå®ç°é¡¹ç›®åŠŸèƒ½çš„ã€‚ä¸ºäº†å®ç°åŠŸèƒ½ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨ä»£ç å±‚é¢é€šè¿‡ä¸€äº›ä»£ç é€»è¾‘æ¥å®ç°ï¼š<br>    é¡ºåºæ‰§è¡Œ - ç¨‹åºæŒ‰ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ<br>    é€‰æ‹©æ‰§è¡Œ - ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ¡ä»¶é€‰æ‹©ä¸åŒçš„é¡ºåºæ‰§è¡Œ<br>    å¾ªç¯æ‰§è¡Œ - ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ¡ä»¶é‡å¤æ‰§è¡Œä»£ç <br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607193946767.png" alt="image-20220607193946767"></p><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="1-3-shellåŸºç¡€"><a href="#1-3-shellåŸºç¡€" class="headerlink" title="1.3 shellåŸºç¡€"></a>1.3 shellåŸºç¡€</h2><h3 id="1-3-1-shellç®€ä»‹"><a href="#1-3-1-shellç®€ä»‹" class="headerlink" title="1.3.1 shellç®€ä»‹"></a>1.3.1 shellç®€ä»‹</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä»  è¿ç»´ã€shellè¯­è¨€ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>è¿ç»´</strong></p><p>ç®€ä»‹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">è¿ç»´æ˜¯ä»€ä¹ˆï¼Ÿ<br>    æ‰€è°“çš„è¿ç»´ï¼Œå…¶å®å°±æ˜¯å…¬å¸çš„å†…éƒ¨é¡¹ç›®å½“ä¸­çš„ä¸€ä¸ªæŠ€æœ¯å²—ä½è€Œå·²ï¼Œå®ƒä¸»è¦åšçš„æ˜¯é¡¹ç›®çš„ç»´æŠ¤æ€§å·¥ä½œã€‚å®ƒæ‰€æ¶‰åŠçš„å†…å®¹èŒƒå›´éå¸¸å¤šã€‚<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607195615193.png" alt="image-20220607195615193"></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">ä»¥xxé¡¹ç›®ä¸ºä¾‹ï¼š<br>    è§„åˆ’ï¼šæˆ‘ä»¬éœ€è¦å¤šå°‘èµ„æºæ¥æ”¯æŒé¡¹ç›®çš„è¿è¡Œ         <br>    ç®¡ç†ï¼šé¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ç®¡ç†èµ·æ¥<br>    æµç¨‹è§„èŒƒï¼šæ‰€æœ‰æ“ä½œéƒ½å½¢æˆåˆ¶åº¦ï¼Œæé«˜å·¥ä½œæ•ˆç‡<br>    å¹³å°ï¼šå¤§å¹…åº¦æé«˜å·¥ä½œæ•ˆç‡<br>    ç›‘æ§ï¼šå®æ—¶æŸ¥çœ‹é¡¹ç›®è¿è¡ŒçŠ¶æ€æŒ‡æ ‡<br>    å‘Šè­¦ï¼šçŠ¶æ€æŒ‡æ ‡å¼‚å¸¸ï¼Œå‘ŠçŸ¥å·¥ä½œäººå‘˜å¤„ç†<br>    å®‰å…¨ï¼šç½‘ç«™è¿è¥å®‰å…¨æªæ–½<br>    ä¼˜åŒ–ï¼šä¿è¯ç”¨æˆ·è®¿é—®ç½‘ç«™ä½“éªŒå¾ˆå¥½<br>    è€ƒæ ¸ï¼šæƒè´£åˆ†é…ï¼Œä¿è¯åˆ©ç›Š<br>è‡ªåŠ¨åŒ–è¿ç»´ï¼šå°±æ˜¯å°†å›¾é‡Œé¢æ‰€æœ‰çš„å·¥ä½œéƒ½ä½¿ç”¨è‡ªåŠ¨åŒ–çš„æ–¹å¼æ¥å®ç°ã€‚<br>    å®ç°è‡ªåŠ¨åŒ–çš„æ–¹å¼å¾ˆå¤šï¼Œå¸¸è§çš„æ–¹å¼ï¼šå·¥å…·å’Œè„šæœ¬ã€‚<br>    å·¥ä½œä¸­å¸¸è§çš„è„šæœ¬æœ‰å“ªäº›å‘¢ï¼Ÿ<br>    <span class="hljs-keyword">shell</span><span class="language-bash">è„šæœ¬ å’Œ å…¶ä»–å¼€å‘è¯­è¨€è„šæœ¬</span><br></code></pre></td></tr></table></figure><p><strong>shellè¯­è¨€</strong></p><p>shellå®šä¹‰</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss">åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ<span class="hljs-built_in">Shell</span>å°±æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ã€‚<br><span class="hljs-built_in">shell</span>æ˜¯ä½äºæ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæ˜¯ä»–ä»¬äºŒè€…æœ€ä¸»è¦çš„æ¥å£ï¼Œ<span class="hljs-built_in">shell</span>è´Ÿè´£æŠŠåº”ç”¨ç¨‹åºçš„è¾“å…¥å‘½ä»¤ä¿¡æ¯è§£é‡Šç»™æ“ä½œç³»ç»Ÿï¼Œå°†æ“ä½œç³»ç»ŸæŒ‡ä»¤å¤„ç†åçš„ç»“æœè§£é‡Šç»™åº”ç”¨ç¨‹åºã€‚<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607200101373.png" alt="image-20220607200101373"></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">ä¸€å¥è¯ï¼Œ<span class="hljs-keyword">shell</span><span class="language-bash">å°±æ˜¯åœ¨æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸€ä¸ªå‘½ä»¤ç¿»è¯‘å·¥å…·ã€‚</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="1-3-2-shellå®è·µ"><a href="#1-3-2-shellå®è·µ" class="headerlink" title="1.3.2 shellå®è·µ"></a>1.3.2 shellå®è·µ</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» shellåˆ†ç±»ã€shellå®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>shellåˆ†ç±»</strong></p><p>ç®€ä»‹</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œ<span class="hljs-keyword">shell</span>çš„è¡¨ç°æ ·å¼æ˜¯ä¸ä¸€æ ·çš„ï¼ŒæŒ‰ç…§æˆ‘çš„è§’åº¦ï¼Œå®ƒä¸»è¦åˆ†ä¸ºä¸¤ç±»<br>å›¾å½¢ç•Œé¢<span class="hljs-keyword">shell</span><br>    å›¾å½¢ç•Œé¢<span class="hljs-keyword">shell</span>å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ¡Œé¢ã€€ã€€<br>å‘½ä»¤è¡Œå¼<span class="hljs-keyword">shell</span><br>    windowsç³»ç»Ÿ:<br>        cmd.<span class="hljs-keyword">exe</span>  å‘½ä»¤æç¤ºå­—ç¬¦<br>    linuxç³»ç»Ÿ:<br>        <span class="hljs-keyword">sh</span> / csh / ksh / bash(é»˜è®¤) / ...<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607200616935.png" alt="image-20220607200616935"></p><p>æŸ¥çœ‹ç³»ç»Ÿçš„shell</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs awk">æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„shellç±»å‹<br>[root@localhost ~]<span class="hljs-comment"># echo $SHELL</span><br><span class="hljs-regexp">/bin/</span>bash<br><br>æŸ¥çœ‹å½“å‰ç³»ç»Ÿç¯å¢ƒæ”¯æŒçš„shell<br>[root@localhost ~]<span class="hljs-comment"># cat /etc/shells</span><br><span class="hljs-regexp">/bin/</span>sh<br><span class="hljs-regexp">/bin/</span>bash<br><span class="hljs-regexp">/usr/</span>bin/sh<br><span class="hljs-regexp">/usr/</span>bin/bash<br>æ›´æ”¹é»˜è®¤çš„shell<br>chsh &lt;ç”¨æˆ·å&gt; -s &lt;æ–°shell&gt;<br><br>[root@localhost ~]<span class="hljs-comment"># su - python</span><br>[python@localhost ~]$ <span class="hljs-keyword">exit</span><br>ç™»å‡º<br>[root@localhost ~]<span class="hljs-comment"># chsh python -s /bin/sh</span><br>Changing shell <span class="hljs-keyword">for</span> python.<br>Shell changed.<br>[root@localhost ~]<span class="hljs-comment"># su - python</span><br>ä¸Šä¸€æ¬¡ç™»å½•ï¼šäºŒ <span class="hljs-number">6</span>æœˆ  <span class="hljs-number">7</span> <span class="hljs-number">20</span>:<span class="hljs-number">11</span>:<span class="hljs-number">13</span> CST <span class="hljs-number">2022</span>pts/<span class="hljs-number">0</span> ä¸Š<br>-sh-<span class="hljs-number">4.2</span>$ <span class="hljs-keyword">exit</span><br>ç™»å‡º<br>[root@localhost ~]<span class="hljs-comment"># chsh python -s /bin/bash</span><br>Changing shell <span class="hljs-keyword">for</span> python.<br>Shell changed.<br>[root@localhost ~]<span class="hljs-comment"># su - python</span><br>ä¸Šä¸€æ¬¡ç™»å½•ï¼šäºŒ <span class="hljs-number">6</span>æœˆ  <span class="hljs-number">7</span> <span class="hljs-number">20</span>:<span class="hljs-number">11</span>:<span class="hljs-number">35</span> CST <span class="hljs-number">2022</span>pts/<span class="hljs-number">0</span> ä¸Š<br>[python@localhost ~]$ echo <span class="hljs-variable">$SHELL</span><br><span class="hljs-regexp">/bin/</span>bash<br>å®‰è£…shell<br>yum list | grep zsh<br>yum install -y zsh<br><br>æŸ¥çœ‹æ•ˆæœ<br>[root@localhost ~]<span class="hljs-comment"># cat /etc/shells</span><br><span class="hljs-regexp">/bin/</span>sh<br><span class="hljs-regexp">/bin/</span>bash<br><span class="hljs-regexp">/usr/</span>bin/sh<br><span class="hljs-regexp">/usr/</span>bin/bash<br><span class="hljs-regexp">/bin/</span>zsh<br></code></pre></td></tr></table></figure><p><strong>shellå®è·µ</strong></p><p>å‘½ä»¤è¡Œå®è·µæ–¹å¼</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æè¿°ï¼š<br>    æ‰‹å·¥æ•²å‡»é”®ç›˜,åœ¨shellçš„å‘½ä»¤è¡Œè¾“å…¥å‘½ä»¤,æŒ‰Enterå,æ‰§è¡Œé€šè¿‡é”®ç›˜è¾“å…¥çš„å‘½ä»¤,ç„¶åshellè¿”å›å¹¶æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œçš„ç»“æœ.<br>    <br>é‡ç‚¹ï¼š<br>    é€è¡Œè¾“å…¥å‘½ä»¤ã€é€è¡Œè¿›è¡Œç¡®è®¤æ‰§è¡Œ<br>ç›´æ¥æ‰¾ä¸€ä¸ªç»ˆç«¯ç•Œé¢æ‰§è¡Œä¸€äº›å¯æ‰§è¡Œçš„å‘½ä»¤å³å¯<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># whoami</span><br>root<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># pwd</span><br>/root<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># date +<span class="hljs-string">&quot;%F %T&quot;</span></span><br><span class="hljs-number">2022</span><span class="hljs-number">-06</span><span class="hljs-number">-07</span> <span class="hljs-number">20</span>:<span class="hljs-number">14</span>:<span class="hljs-number">46</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶å®ç°æ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">æè¿°ï¼š<br>    å°±æ˜¯è¯´æˆ‘ä»¬æŠŠæ‰‹å·¥æ‰§è¡Œçš„å‘½ä»¤aï¼Œå†™åˆ°ä¸€ä¸ªè„šæœ¬æ–‡ä»¶bä¸­ï¼Œç„¶åé€šè¿‡æ‰§è¡Œè„šæœ¬bï¼Œè¾¾åˆ°æ‰§è¡Œå‘½ä»¤açš„æ•ˆæœ.<br>    <br>é‡ç‚¹ï¼š<br>    æŒ‰ç…§æ–‡ä»¶å†…å®¹çš„é¡ºåºæ‰§è¡Œã€‚<br>æ‰¾ä¸€ä¸ªæ–‡ä»¶ï¼Œå°†æˆ‘ä»¬åˆšæ‰æ‰§è¡ŒæˆåŠŸçš„å‘½ä»¤æ”¾åˆ°é‡Œé¢ã€‚<br><br>[root@localhost ~]# <span class="hljs-built_in">cat</span> <span class="hljs-built_in">test</span><br><span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%F %T&quot;</span><br>[root@localhost ~]# /bin/bash <span class="hljs-built_in">test</span><br>root<br>/root<br>2022-06-07 20:16:20<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="1-3-3-shellè„šæœ¬å®è·µ"><a href="#1-3-3-shellè„šæœ¬å®è·µ" class="headerlink" title="1.3.3 shellè„šæœ¬å®è·µ"></a>1.3.3 shellè„šæœ¬å®è·µ</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä»  è„šæœ¬åŸºç¡€ã€è„šæœ¬å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ </p><p><strong>è„šæœ¬åŸºç¡€</strong></p><p>shellè„šæœ¬</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">å½“å¯æ‰§è¡Œçš„Linuxå‘½ä»¤æˆ–è¯­å¥ä¸åœ¨å‘½ä»¤è¡ŒçŠ¶æ€ä¸‹æ‰§è¡Œï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªæ–‡ä»¶æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ç§°æ–‡ä»¶ä¸º<span class="hljs-keyword">shell</span><span class="language-bash">è„šæœ¬ã€‚</span><br></code></pre></td></tr></table></figure><p>åº”ç”¨åœºæ™¯</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">é‡å¤åŒ–ã€å¤æ‚åŒ–çš„å·¥ä½œï¼Œé€šè¿‡æŠŠå·¥ä½œçš„å‘½ä»¤å†™æˆè„šæœ¬ï¼Œä»¥åä»…ä»…éœ€è¦æ‰§è¡Œè„šæœ¬å°±èƒ½å®Œæˆè¿™äº›å·¥ä½œã€‚<br>    è‡ªåŠ¨åŒ–åˆ†æå¤„ç†<br>    è‡ªåŠ¨åŒ–å¤‡ä»½<br>    è‡ªåŠ¨åŒ–æ‰¹é‡éƒ¨ç½²å®‰è£…<br>    ç­‰ç­‰<span class="hljs-string">...</span> <br></code></pre></td></tr></table></figure><p>è„šæœ¬åˆ›å»º</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">è„šæœ¬åˆ›å»ºå·¥å…·ï¼š<br>    åˆ›å»ºè„šæœ¬çš„å¸¸è§ç¼–è¾‘å™¨æ˜¯ <span class="hljs-keyword">vi</span>/<span class="hljs-keyword">vim</span>.<br><br>è„šæœ¬å‘½å<br>    <span class="hljs-keyword">shell</span>è„šæœ¬çš„å‘½åç®€å•æ¥è¯´å°±æ˜¯è¦æœ‰æ„ä¹‰ï¼Œæ–¹ä¾¿æˆ‘ä»¬é€šè¿‡è„šæœ¬åï¼Œæ¥çŸ¥é“è¿™ä¸ªæ–‡ä»¶æ˜¯å¹²ä»€ä¹ˆç”¨çš„ã€‚<br><br>è„šæœ¬å†…å®¹ï¼š<br>    å„ç§å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤<br></code></pre></td></tr></table></figure><p>è„šæœ¬æ³¨é‡Š</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">å•è¡Œæ³¨é‡Šï¼š<br>    é™¤äº†é¦–è¡Œçš„<span class="hljs-comment">#ä¸æ˜¯æ³¨é‡Šå¤–ï¼Œå…¶ä»–æ‰€æœ‰è¡Œå†…å®¹ï¼Œåªè¦é¦–ä¸ªå­—ç¬¦æ˜¯#,é‚£ä¹ˆå°±è¡¨ç¤ºè¯¥è¡Œæ˜¯æ³¨é‡Š</span><br>å¤šè¡Œæ³¨é‡Šï¼š<br>    å¤šè¡Œæ³¨é‡Šæœ‰ä¸¤ç§æ–¹æ³•ï¼š<span class="hljs-symbol">:&lt;&lt;</span>! ... !  å’Œ <span class="hljs-symbol">:&lt;&lt;</span>å­—ç¬¦ ... å­—ç¬¦<br></code></pre></td></tr></table></figure><p><strong>è„šæœ¬å®è·µ</strong></p><p>è„šæœ¬ç¤ºä¾‹1</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs perl">è„šæœ¬å†…å®¹<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># cat get_netinfo.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># åŠŸèƒ½ï¼šè·å–å½“å‰ä¸»æœºçš„ç½‘å¡è®¾å¤‡ä¿¡æ¯</span><br><span class="hljs-comment"># ä½œè€…ï¼šwangshuji</span><br><span class="hljs-comment"># ç‰ˆæœ¬ï¼šV0.1</span><br><span class="hljs-comment"># è”ç³»ï¼šwww.superopsmsb.com</span><br><br><span class="hljs-comment"># è·å–ipåœ°å€ä¿¡æ¯</span><br>ifconfig eth0 | <span class="hljs-keyword">grep</span> -w inet | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs echo <span class="hljs-string">&quot;IP: &quot;</span><br><br><span class="hljs-comment"># è·å–æ©ç åœ°å€ä¿¡æ¯</span><br>ifconfig eth0 | <span class="hljs-keyword">grep</span> -w inet | awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span> | xargs echo <span class="hljs-string">&quot;NetMask: &quot;</span><br><br><span class="hljs-comment"># è·å–å¹¿æ’­åœ°å€ä¿¡æ¯</span><br>ifconfig eth0 | <span class="hljs-keyword">grep</span> -w inet | awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span> | xargs echo <span class="hljs-string">&quot;Broadcast: &quot;</span><br><br><span class="hljs-comment"># è·å–MACåœ°å€ä¿¡æ¯</span><br>ifconfig eth0 | <span class="hljs-keyword">grep</span> ether | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> |xargs echo <span class="hljs-string">&quot;MAC Address: &quot;</span><br>æ‰§è¡Œè„šæœ¬<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># /bin/bash get_netinfo.sh</span><br>IP:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br>NetMask:  <span class="hljs-number">255.255</span><span class="hljs-number">.255</span>.<span class="hljs-number">0</span><br>Broadcast:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>MAC Address:  <span class="hljs-number">00</span>:0c:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:8c<br></code></pre></td></tr></table></figure><p>è„šæœ¬æ³¨é‡Š</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs d">æ›´æ”¹è„šæœ¬å†…å®¹<br>[root<span class="hljs-keyword">@localhost</span> ~]# cat get_netinfo.sh<br><span class="hljs-meta">#!/bin/bash</span><br>:&lt;&lt;!<br>åŠŸèƒ½ï¼šè·å–å½“å‰ä¸»æœºçš„ç½‘å¡è®¾å¤‡ä¿¡æ¯<br>ä½œè€…ï¼šwangshuji<br>ç‰ˆæœ¬ï¼šV0<span class="hljs-number">.1</span><br>è”ç³»ï¼šwww.superopsmsb.com<br>!<br>... ...<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="1-3-4-è„šæœ¬æ‰§è¡Œ"><a href="#1-3-4-è„šæœ¬æ‰§è¡Œ" class="headerlink" title="1.3.4 è„šæœ¬æ‰§è¡Œ"></a>1.3.4 è„šæœ¬æ‰§è¡Œ</h3><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» è„šæœ¬æ‰§è¡Œã€è„šæœ¬è°ƒè¯•ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>è„šæœ¬æ‰§è¡Œ</strong></p><p>è„šæœ¬æ‰§è¡Œæ–¹æ³•</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æ–¹æ³•<span class="hljs-number">1</span>ï¼š<br>    bash /<span class="hljs-type">path</span>/<span class="hljs-keyword">to</span>/script-<span class="hljs-type">name</span>   æˆ–   /bin/bash /<span class="hljs-type">path</span>/<span class="hljs-keyword">to</span>/script-<span class="hljs-type">name</span>  ï¼ˆå¼ºçƒˆæ¨èä½¿ç”¨ï¼‰<br>    <br>æ–¹æ³•<span class="hljs-number">2</span>ï¼š<br>    /<span class="hljs-type">path</span>/<span class="hljs-keyword">to</span>/script-<span class="hljs-type">name</span>        æˆ–   ./script-<span class="hljs-type">name</span>   ï¼ˆå½“å‰è·¯å¾„ä¸‹æ‰§è¡Œè„šæœ¬ï¼‰<br>    <br>æ–¹æ³•<span class="hljs-number">3</span>ï¼š<br>    source script-<span class="hljs-type">name</span>          æˆ–   . script-<span class="hljs-type">name</span>   ï¼ˆæ³¨æ„â€œ.â€œç‚¹å·ï¼‰<br>    <br>æ–¹æ³•<span class="hljs-number">1</span>å˜ç§ï¼š<br>    cat /<span class="hljs-type">path</span>/<span class="hljs-keyword">to</span>/script-<span class="hljs-type">name</span> | bash<br>    bash /<span class="hljs-type">path</span>/<span class="hljs-keyword">to</span>/script-<span class="hljs-type">name</span><br>è„šæœ¬æ‰§è¡Œè¯´æ˜<br><span class="hljs-number">1</span>ã€è„šæœ¬æ–‡ä»¶æœ¬èº«æ²¡æœ‰å¯æ‰§è¡Œæƒé™æˆ–è€…è„šæœ¬é¦–è¡Œæ²¡æœ‰å‘½ä»¤è§£é‡Šå™¨æ—¶ä½¿ç”¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¨èç”¨bashæ‰§è¡Œã€‚<br>    ä½¿ç”¨é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†â˜†<br><span class="hljs-number">2</span>ã€è„šæœ¬æ–‡ä»¶å…·æœ‰å¯æ‰§è¡Œæƒé™æ—¶ä½¿ç”¨ã€‚<br>    ä½¿ç”¨é¢‘ç‡ï¼šâ˜†â˜†â˜†â˜†<br><span class="hljs-number">3</span>ã€ä½¿ç”¨sourceæˆ–è€….ç‚¹å·ï¼ŒåŠ è½½shellè„šæœ¬æ–‡ä»¶å†…å®¹ï¼Œä½¿shellè„šæœ¬å†…å®¹ç¯å¢ƒå’Œå½“å‰ç”¨æˆ·ç¯å¢ƒä¸€è‡´ã€‚<br>    ä½¿ç”¨é¢‘ç‡ï¼šâ˜†â˜†â˜†<br>    ä½¿ç”¨åœºæ™¯ï¼šç¯å¢ƒä¸€è‡´æ€§<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç¤ºä¾‹</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs nix">æ–¹æ³•<span class="hljs-number">1</span>ï¼š<br>[root@localhost ~]<span class="hljs-comment"># /bin/bash get_netinfo.sh</span><br><span class="hljs-params">IP:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br><span class="hljs-params">NetMask:</span>  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-params">Broadcast:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>MAC <span class="hljs-params">Address:</span>  <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span>c<br>æ–¹æ³•<span class="hljs-number">2</span>ï¼š<br>[root@localhost ~]<span class="hljs-comment"># ./get_netinfo.sh</span><br><span class="hljs-params">bash:</span> .<span class="hljs-operator">/</span>get_netinfo.<span class="hljs-params">sh:</span> æƒé™ä¸å¤Ÿ<br>[root@localhost ~]<span class="hljs-comment"># ll get_netinfo.sh</span><br><span class="hljs-operator">-</span>rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">521</span> <span class="hljs-number">6</span>æœˆ   <span class="hljs-number">7</span> <span class="hljs-number">20</span>:<span class="hljs-number">41</span> get_netinfo.sh<br>[root@localhost ~]<span class="hljs-comment"># chmod +x get_netinfo.sh</span><br>[root@localhost ~]<span class="hljs-comment"># ./get_netinfo.sh</span><br><span class="hljs-params">IP:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br><span class="hljs-params">NetMask:</span>  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-params">Broadcast:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>MAC <span class="hljs-params">Address:</span>  <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span>c<br>æ–¹æ³•<span class="hljs-number">3</span>ï¼š<br>[root@localhost ~]<span class="hljs-comment"># source get_netinfo.sh</span><br><span class="hljs-params">IP:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br><span class="hljs-params">NetMask:</span>  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-params">Broadcast:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>MAC <span class="hljs-params">Address:</span>  <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span>c<br>[root@localhost ~]<span class="hljs-comment"># chmod -x get_netinfo.sh</span><br>[root@localhost ~]<span class="hljs-comment"># ll get_netinfo.sh</span><br><span class="hljs-operator">-</span>rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">521</span> <span class="hljs-number">6</span>æœˆ   <span class="hljs-number">7</span> <span class="hljs-number">20</span>:<span class="hljs-number">41</span> get_netinfo.sh<br>[root@localhost ~]<span class="hljs-comment"># source get_netinfo.sh</span><br><span class="hljs-params">IP:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br><span class="hljs-params">NetMask:</span>  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-params">Broadcast:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>MAC <span class="hljs-params">Address:</span>  <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span>c<br>æ–¹æ³•<span class="hljs-number">1</span>å˜ç§ï¼š<br>[root@localhost ~]<span class="hljs-comment"># cat get_netinfo.sh | bash</span><br><span class="hljs-params">IP:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br><span class="hljs-params">NetMask:</span>  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-params">Broadcast:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>MAC <span class="hljs-params">Address:</span>  <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span>c<br>[root@localhost ~]<span class="hljs-comment"># bash &lt; get_netinfo.sh</span><br><span class="hljs-params">IP:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br><span class="hljs-params">NetMask:</span>  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-params">Broadcast:</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>MAC <span class="hljs-params">Address:</span>  <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span>c<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="1-3-5-è„šæœ¬è°ƒè¯•"><a href="#1-3-5-è„šæœ¬è°ƒè¯•" class="headerlink" title="1.3.5 è„šæœ¬è°ƒè¯•"></a>1.3.5 è„šæœ¬è°ƒè¯•</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» è„šæœ¬è°ƒè¯•ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>è„šæœ¬è°ƒè¯•</strong></p><p>éœ€æ±‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">æˆ‘ä»¬åœ¨ç¼–å†™è„šæœ¬çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå—åˆ°å„ç§å› ç´ çš„é™åˆ¶ï¼Œå¯¼è‡´è„šæœ¬åŠŸèƒ½éå¸¸å¤§æˆ–è€…å†…å®¹æœ‰è¯¯ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œè„šæœ¬çš„æ—¶å€™ï¼Œå› ä¸ºè„šæœ¬å†…å®¹æœ‰è¯¯ï¼Œå¯¼è‡´è„šæœ¬æ‰§è¡Œå¤±è´¥ã€‚<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è„šæœ¬æ‰§è¡Œçš„æ—¶å€™ï¼Œä¿è¯è„šæœ¬æ²¡é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºå¤šç§è„šæœ¬è°ƒè¯•æ–¹å¼æ¥éªŒè¯è„šæœ¬ã€‚<br></code></pre></td></tr></table></figure><p>è°ƒè¯•æ–¹å¼</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-n      æ£€æŸ¥è„šæœ¬ä¸­çš„è¯­æ³•é”™è¯¯</span><br><span class="hljs-deletion">-v      å…ˆæ˜¾ç¤ºè„šæœ¬æ‰€æœ‰å†…å®¹ï¼Œç„¶åæ‰§è¡Œè„šæœ¬ï¼Œç»“æœè¾“å‡ºï¼Œå¦‚æœæ‰§è¡Œé‡åˆ°é”™è¯¯ï¼Œå°†é”™è¯¯è¾“å‡ºã€‚</span><br><span class="hljs-deletion">-x      å°†æ‰§è¡Œçš„æ¯ä¸€æ¡å‘½ä»¤å’Œæ‰§è¡Œç»“æœéƒ½æ‰“å°å‡ºæ¥</span><br></code></pre></td></tr></table></figure><p><strong>ç®€å•å®è·µ</strong></p><p>å‡†å¤‡å·¥ä½œ</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stata">å‡†å¤‡å¤‡ä»½æ–‡ä»¶<br>cp get_netinfo.<span class="hljs-keyword">sh</span> get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span><br><br>è®¾ç½®é”™è¯¯æ–‡ä»¶<br>[root@localhost ~]# <span class="hljs-keyword">cat</span> get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span><br>...<br># å°†æœ€åä¸€è¡Œæœ«å°¾çš„&quot;å–æ¶ˆ<br>ifconfig eth0 | grep ether | awk &#x27;&#123;<span class="hljs-keyword">print</span> <span class="hljs-variable">$2&#125;</span>&#x27; |xargs echo <span class="hljs-string">&quot;MAC Address: &quot;</span><br>é”™è¯¯è„šæœ¬æ‰§è¡Œæ•ˆæœ<br>[root@localhost ~]# /bin/bash get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span><br>IP:  10.0.0.12<br>NetMask:  255.255.255.0<br>Broadcast:  10.0.0.255<br>get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span>:è¡Œ19: å¯»æ‰¾åŒ¹é…çš„ `&quot;&#x27; æ˜¯é‡åˆ°äº†æœªé¢„æœŸçš„æ–‡ä»¶ç»“æŸç¬¦<br>get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span>:è¡Œ20: è¯­æ³•é”™è¯¯: æœªé¢„æœŸçš„æ–‡ä»¶ç»“å°¾<br></code></pre></td></tr></table></figure><p>æ£€æŸ¥è¯­æ³•å®è·µ</p><p>æ£€æŸ¥è¯­æ³•å®è·µ</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata">[root@localhost ~]# /bin/bash -<span class="hljs-keyword">n</span> get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span><br>get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span>:è¡Œ19: å¯»æ‰¾åŒ¹é…çš„ `&quot;&#x27; æ˜¯é‡åˆ°äº†æœªé¢„æœŸçš„æ–‡ä»¶ç»“æŸç¬¦<br>get_netinfo-<span class="hljs-keyword">error</span>.<span class="hljs-keyword">sh</span>:è¡Œ20: è¯­æ³•é”™è¯¯: æœªé¢„æœŸçš„æ–‡ä»¶ç»“å°¾<br></code></pre></td></tr></table></figure><p>æ£€æŸ¥è¯­æ³•è°ƒè¯•</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@localhost ~]# /bin/bash -v get_netinfo-error.<span class="hljs-keyword">sh</span><br>#!/bin/bash<br>:&lt;&lt;!<br>åŠŸèƒ½ï¼šè·å–å½“å‰ä¸»æœºçš„ç½‘å¡è®¾å¤‡ä¿¡æ¯<br>ä½œè€…ï¼šwangshuji<br>ç‰ˆæœ¬ï¼šV0.<span class="hljs-number">1</span><br>è”ç³»ï¼šwww.superopsmsb.<span class="hljs-keyword">com</span><br>!<br><br># è·å–ipåœ°å€ä¿¡æ¯<br>ifconfig eth0 | <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;IP: &quot;</span><br>IP:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br><br># è·å–æ©ç åœ°å€ä¿¡æ¯<br>ifconfig eth0 | <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet | awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span> | xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NetMask: &quot;</span><br>NetMask:  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><br># è·å–å¹¿æ’­åœ°å€ä¿¡æ¯<br>ifconfig eth0 | <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet | awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span> | xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Broadcast: &quot;</span><br>Broadcast:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br><br># è·å–MACåœ°å€ä¿¡æ¯<br>ifconfig eth0 | <span class="hljs-keyword">grep</span> ether | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> |xargs <span class="hljs-keyword">echo</span> <span class="hljs-comment">&quot;MAC Address:</span><br>get_netinfo-error.<span class="hljs-keyword">sh</span>:è¡Œ<span class="hljs-number">19</span>: å¯»æ‰¾åŒ¹é…çš„ `<span class="hljs-comment">&quot;&#x27; æ˜¯é‡åˆ°äº†æœªé¢„æœŸçš„æ–‡ä»¶ç»“æŸç¬¦</span><br>get_netinfo-error.<span class="hljs-keyword">sh</span>:è¡Œ<span class="hljs-number">20</span>: è¯­æ³•é”™è¯¯: æœªé¢„æœŸçš„æ–‡ä»¶ç»“å°¾<br></code></pre></td></tr></table></figure><p>è„šæœ¬è·Ÿè¸ªå®è·µ</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs vim">å¤±è´¥æ¼”ç¤º<br>[root@localhost ~]# /bin/bash -<span class="hljs-keyword">x</span> get_netinfo-error.<span class="hljs-keyword">sh</span><br>+ :<br>+ ifconfig eth0<br>+ awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>+ <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet<br>+ xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;IP: &#x27;</span><br>IP:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br>+ ifconfig eth0<br>+ <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet<br>+ awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span><br>+ xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;NetMask: &#x27;</span><br>NetMask:  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>+ ifconfig eth0<br>+ <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet<br>+ xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Broadcast: &#x27;</span><br>+ awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span><br>Broadcast:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>get_netinfo-error.<span class="hljs-keyword">sh</span>:è¡Œ<span class="hljs-number">19</span>: å¯»æ‰¾åŒ¹é…çš„ `<span class="hljs-comment">&quot;&#x27; æ˜¯é‡åˆ°äº†æœªé¢„æœŸçš„æ–‡ä»¶ç»“æŸç¬¦</span><br>get_netinfo-error.<span class="hljs-keyword">sh</span>:è¡Œ<span class="hljs-number">20</span>: è¯­æ³•é”™è¯¯: æœªé¢„æœŸçš„æ–‡ä»¶ç»“å°¾<br>æˆåŠŸæ¼”ç¤º<br>[root@localhost ~]# /bin/bash -<span class="hljs-keyword">x</span> get_netinfo.<span class="hljs-keyword">sh</span><br>+ :<br>+ ifconfig eth0<br>+ awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>+ <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet<br>+ xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;IP: &#x27;</span><br>IP:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span><br>+ ifconfig eth0<br>+ <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet<br>+ awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span><br>+ xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;NetMask: &#x27;</span><br>NetMask:  <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>+ ifconfig eth0<br>+ <span class="hljs-keyword">grep</span> -<span class="hljs-keyword">w</span> inet<br>+ awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span><br>+ xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Broadcast: &#x27;</span><br>Broadcast:  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.255</span><br>+ ifconfig eth0<br>+ <span class="hljs-keyword">grep</span> ether<br>+ awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>+ xargs <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;MAC Address: &#x27;</span><br>MAC Address:  <span class="hljs-number">00</span>:<span class="hljs-number">0</span><span class="hljs-keyword">c</span>:<span class="hljs-number">29</span>:<span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">8</span><span class="hljs-keyword">c</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="1-3-6-è„šæœ¬å¼€å‘è§„èŒƒ"><a href="#1-3-6-è„šæœ¬å¼€å‘è§„èŒƒ" class="headerlink" title="1.3.6 è„šæœ¬å¼€å‘è§„èŒƒ"></a>1.3.6 è„šæœ¬å¼€å‘è§„èŒƒ</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» å¼€å‘è§„èŒƒã€è§„èŒƒè§£æã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>å¼€å‘è§„èŒƒ</strong></p><p>è„šæœ¬è§„èŒƒ</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-number">1</span>ã€è„šæœ¬å‘½åè¦æœ‰æ„ä¹‰ï¼Œæ–‡ä»¶åç¼€æ˜¯.sh<br><span class="hljs-number">2</span>ã€è„šæœ¬æ–‡ä»¶é¦–è¡Œæ˜¯è€Œä¸”å¿…é¡»æ˜¯è„šæœ¬è§£é‡Šå™¨<br>    #!/bin/bash<br><span class="hljs-number">3</span>ã€è„šæœ¬æ–‡ä»¶è§£é‡Šå™¨åé¢è¦æœ‰è„šæœ¬çš„åŸºæœ¬ä¿¡æ¯ç­‰å†…å®¹<br>    è„šæœ¬æ–‡ä»¶ä¸­å°½é‡ä¸ç”¨ä¸­æ–‡æ³¨é‡Š;<br>    å°½é‡ç”¨è‹±æ–‡æ³¨é‡Šï¼Œé˜²æ­¢æœ¬æœºæˆ–åˆ‡æ¢ç³»ç»Ÿç¯å¢ƒåä¸­æ–‡ä¹±ç çš„å›°æ‰°<br>    å¸¸è§çš„æ³¨é‡Šä¿¡æ¯ï¼šè„šæœ¬åç§°ã€è„šæœ¬åŠŸèƒ½æè¿°ã€è„šæœ¬ç‰ˆæœ¬ã€è„šæœ¬ä½œè€…ã€è”ç³»æ–¹å¼ç­‰<br><span class="hljs-number">4</span>ã€è„šæœ¬æ–‡ä»¶å¸¸è§æ‰§è¡Œæ–¹å¼ï¼šbash è„šæœ¬å<br><span class="hljs-number">5</span>ã€è„šæœ¬å†…å®¹æ‰§è¡Œï¼šä»ä¸Šåˆ°ä¸‹ï¼Œä¾æ¬¡æ‰§è¡Œ<br><span class="hljs-number">6</span>ã€ä»£ç ä¹¦å†™ä¼˜ç§€ä¹ æƒ¯;<br>    <span class="hljs-number">1</span>ï¼‰æˆå¯¹å†…å®¹çš„ä¸€æ¬¡æ€§å†™å‡ºæ¥,é˜²æ­¢é—æ¼ã€‚<br>å¦‚ï¼š()ã€&#123;&#125;ã€[]ã€<span class="hljs-string">&#x27;&#x27;</span>ã€<span class="hljs-string">``</span>ã€<span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-number">2</span>ï¼‰[]ä¸­æ‹¬å·ä¸¤ç«¯è¦æœ‰ç©ºæ ¼,ä¹¦å†™æ—¶å³å¯ç•™å‡ºç©ºæ ¼[    ],ç„¶åå†é€€æ ¼ä¹¦å†™å†…å®¹ã€‚<br>    <span class="hljs-number">3</span>ï¼‰æµç¨‹æ§åˆ¶è¯­å¥ä¸€æ¬¡æ€§ä¹¦å†™å®Œï¼Œå†æ·»åŠ å†…å®¹<br><span class="hljs-number">7</span>ã€é€šè¿‡ç¼©è¿›è®©ä»£ç æ˜“è¯»;(å³è¯¥æœ‰ç©ºæ ¼çš„åœ°æ–¹å°±è¦æœ‰ç©ºæ ¼)<br></code></pre></td></tr></table></figure><p><strong>è§„èŒƒè§£æ</strong></p><p>ç¼–å†™æ¢³ç†</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">shell</span>è„šæœ¬å¼€å‘è§„èŒƒé‡ç‚¹ï¼š<span class="hljs-number">2</span>-<span class="hljs-number">4</span>-<span class="hljs-number">5</span><br><span class="hljs-attribute">shell</span>è„šæœ¬å¼€å‘å°æŠ€å·§ï¼š<span class="hljs-number">3</span>-<span class="hljs-number">6</span>-<span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–æŠ€å·§</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>å°½å¯èƒ½è®°å¿†æ›´å¤šçš„å‘½ä»¤<br><span class="hljs-symbol">2 </span>æŒæ¡è„šæœ¬çš„æ ‡å‡†çš„æ ¼å¼<br><span class="hljs-symbol">3 </span>å¤šçœ‹ã€å¤šæ¨¡ä»¿ã€å¤šæ€è€ƒ<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h1 id="2-shellå˜é‡"><a href="#2-shellå˜é‡" class="headerlink" title="2 shellå˜é‡"></a>2 shellå˜é‡</h1><h2 id="2-1-å˜é‡åŸºç¡€"><a href="#2-1-å˜é‡åŸºç¡€" class="headerlink" title="2.1 å˜é‡åŸºç¡€"></a>2.1 å˜é‡åŸºç¡€</h2><h3 id="2-1-1-å˜é‡åœºæ™¯"><a href="#2-1-1-å˜é‡åœºæ™¯" class="headerlink" title="2.1.1 å˜é‡åœºæ™¯"></a>2.1.1 å˜é‡åœºæ™¯</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œ æˆ‘ä»¬ä» æ•°æ®å­˜å‚¨ã€å˜é‡åœºæ™¯ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>æ•°æ®å­˜å‚¨</strong></p><p>æ•°æ®å­˜å‚¨</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">æ‰€è°“çš„æ•°æ®å­˜å‚¨ï¼Œæˆ‘ä»¬ä»ä¸‰æ–¹é¢æ¥ç†è§£è¿™å¥è¯ï¼š<br>    <span class="hljs-number">1</span>ã€æ•°æ®ä¿å­˜åˆ°å“ªé‡Œ   <span class="hljs-comment">--  å„ç§åª’ä»‹ï¼ŒCPUã€å†…å­˜ã€ç£ç›˜ã€ç£å¸¦ã€ç½‘ç›˜...</span><br>    <span class="hljs-number">2</span>ã€æ•°æ®ä¿å­˜çš„æ•ˆæœ   <span class="hljs-comment">--  å®Œæ•´ã€å®‰å…¨ã€æœ‰æ•ˆ</span><br>    <span class="hljs-number">3</span>ã€æ•°æ®ä¿å­˜çš„å•å…ƒ   <span class="hljs-comment">--  å­˜å‚¨ç©ºé—´</span><br>    æ•°æ®çš„å­˜å‚¨ç©ºé—´é»˜è®¤ä¸æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªä¸ªçš„å­˜å‚¨å•å…ƒç»„æˆï¼Œæ¯ä¸€ä¸ªå­˜å‚¨å•å…ƒéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°ç¼–å·ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªç¼–å·ä¸ºï¼šåœ°å€<br>    å­˜å‚¨å•å…ƒçš„ä½œç”¨ï¼šå­˜å‚¨æ•°æ®+è¯»å†™æ•°æ®<br>    å­˜å‚¨ç©ºé—´å¤§å°ï¼š<span class="hljs-number">1</span>å­—èŠ‚(B) = <span class="hljs-number">8</span><span class="hljs-built_in">bit</span> == <span class="hljs-number">00000000</span><br>    åœ°å€ç‰¹ç‚¹ï¼šåå…­è¿›åˆ¶ï¼Œä¾‹å¦‚ï¼š<span class="hljs-number">0</span>x20000000<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220607232318465.png" alt="image-20220607232318465"></p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext">å¯¹äºæ•°æ®çš„å­˜å‚¨æ¥è¯´ï¼Œä¸»è¦æœ‰ä¸¤ç§æ ·å¼ï¼šç‰©ç†åœ°å€å’Œé€»è¾‘åœ°å€ã€‚<br>    ç‰©ç†åœ°å€ï¼šå†…å­˜æˆ–ç¡¬ç›˜ä¸­çœŸæ­£å­˜å‚¨æ•°æ®çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡ç£ç›˜è®¾å¤‡æŸ¥æ‰¾çš„ä½ç½®<br>    é€»è¾‘åœ°å€ï¼šç”¨äºæŸ¥æ‰¾ç‰©ç†åœ°å€çš„å­˜å‚¨å—åœ°å€å«é€»è¾‘åœ°å€ã€‚ç¨‹åºä¸­ç”¨çš„åœ°å€ä¸€èˆ¬éƒ½æ˜¯é€»è¾‘åœ°å€<br>    é€»è¾‘åœ°å€åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šèµ·å§‹å€¼(åå…­è¿›åˆ¶)+åç§»é‡(åå…­è¿›åˆ¶)<br>    æ•°æ®è¡¨çš„æè¿°ä¸»è¦æ˜¯é€»è¾‘åœ°å€ï¼Œå› ä¸ºç¨‹åºä¸€èˆ¬å­˜å‚¨çš„æ˜¯é€»è¾‘åœ°å€ã€‚<br>æ•°æ®ä¸€æ—¦å­˜å‚¨ä¸‹æ¥å°±ä¸å†å‘ç”Ÿå˜åŒ–äº†ï¼Œè€Œç¨‹åºä¸­å¯èƒ½ä¼šåœ¨å¾ˆå¤šåœºæ™¯ä¸­ç”¨åˆ°åŒä¸€ä¸ªæ•°æ®ï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜ï¼š<br>    1 ç‰©ç†åœ°å€äººå¬å¾—æ‡‚ï¼Œæœºå™¨çœ‹ä¸æ‡‚ <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">æ‰€ä»¥ç”¨é€»è¾‘åœ°å€æ‰¾ç‰©ç†åœ°å€</span><br>    2 è½¯ä»¶å¯ä»¥é€šè¿‡é€»è¾‘åœ°å€æ‰¾åˆ°æ•°æ®åœ°å€ï¼Œä½†æ˜¯è½¯ä»¶ä¸æ‡‚åœºæ™¯<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">æ‰€ä»¥äººç”¨é€»è¾‘åœ°å€çš„åˆ«åæ¥ä»£æŒ‡å‘åŒä¸€ä¸ªxxåœ°å€</span><br>        <br>åº”ç”¨ç¨‹åºä¸­ä¸ºäº† å¤šåœºæ™¯åº”ç”¨è¿™ä¸ªé€»è¾‘åœ°å€çš„åˆ«åï¼Œæœ¬è´¨ä¸Šå°±æ˜¯â€œå˜é‡â€ã€‚<br></code></pre></td></tr></table></figure><p><strong>å˜é‡åœºæ™¯</strong></p><p>å˜é‡çš„æœ¬è´¨</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">å˜é‡çš„æœ¬è´¨å…¶å®å°±æ˜¯ é€šè¿‡ä¸€ä¸ªåç§°å¸®åŠ©ç¨‹åºå¿«é€Ÿæ‰¾åˆ°å†…å­˜ä¸­å…·ä½“æ•°æ®çš„åœ°å€ã€‚<br><span class="hljs-bullet">    -</span> å˜é‡è¯´ç™½äº†å°±æ˜¯æŒ‡å‘xxå€¼ã€‚<br></code></pre></td></tr></table></figure><p>ç¼–ç¨‹è¯­è¨€</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs axapta">ç¼–ç¨‹è¯­è¨€åœ¨æ•°æ®è°ƒç”¨å±‚é¢åˆ†ç±»çš„è¯ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š<br>    é™æ€ç¼–è¯‘è¯­è¨€ï¼š<br>        ä½¿ç”¨å˜é‡å‰ï¼Œå…ˆå£°æ˜å˜é‡ç±»å‹ï¼Œä¹‹åç±»å‹ä¸èƒ½æ”¹å˜ï¼Œåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ã€‚<br>        å¦‚ï¼šjavaï¼Œc<br>    åŠ¨æ€ç¼–è¯‘è¯­è¨€ï¼š<br>        ä¸ç”¨äº‹å…ˆå£°æ˜ï¼Œå¯éšæ—¶æ”¹å˜ç±»å‹ã€‚<br>        å¦‚ï¼šbashï¼ŒPython<br>æ ¹æ®ç¼–ç¨‹è¯­è¨€åœ¨ä½¿ç”¨å˜é‡çš„ç¨‹åº¦ä¸Šï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå¼ºç±»å‹ã€å¼±ç±»å‹è¯­è¨€ï¼š<br>    å¼ºç±»å‹è¯­è¨€ï¼š<br>        ä¸åŒç±»å‹æ•°æ®æ“ä½œï¼Œå¿…é¡»ç»è¿‡å¼ºåˆ¶è½¬æ¢æ‰åŒä¸€ç±»å‹æ‰èƒ½è¿ç®—ã€‚<br>            å¦‚java ï¼Œ c<span class="hljs-meta"># ï¼Œpython</span><br>        ç¤ºä¾‹ï¼š<br>            <span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;shuji&#x27;</span> + <span class="hljs-number">10</span>) æç¤ºå‡ºé”™ï¼Œä¸ä¼šè‡ªåŠ¨è½¬æ¢ç±»å‹<br>            <span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;shuji&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">10</span>)) ç»“æœä¸ºmagedu10ï¼Œéœ€è¦æ˜¾ç¤ºè½¬æ¢ç±»å‹<br>    å¼±ç±»å‹è¯­è¨€ï¼š<br>        è¯­è¨€çš„è¿è¡Œæ—¶ä¼šéšå¼åšæ•°æ®ç±»å‹è½¬æ¢ã€‚æ— é¡»æŒ‡å®šç±»å‹ï¼Œé»˜è®¤å‡ä¸ºå­—ç¬¦å‹ï¼›<br>        å‚ä¸è¿ç®—ä¼šè‡ªåŠ¨è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼›å˜é‡æ— é¡»äº‹å…ˆå®šä¹‰å¯ç›´æ¥è°ƒç”¨ã€‚<br>        å¦‚ï¼šbash ï¼Œphpï¼Œjavascript<br>        ç¤ºä¾‹ï¼š<br>            echo <span class="hljs-string">&#x27;aaa&#x27;</span>+<span class="hljs-number">222</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-1-2-å˜é‡å®šä¹‰"><a href="#2-1-2-å˜é‡å®šä¹‰" class="headerlink" title="2.1.2 å˜é‡å®šä¹‰"></a>2.1.2 å˜é‡å®šä¹‰</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» å˜é‡å®šä¹‰ã€å˜é‡åˆ†ç±»ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>å˜é‡å®šä¹‰</strong></p><p>å˜é‡å®šä¹‰</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">å˜é‡åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š<br>    å˜é‡å - ä¸å˜çš„<br>    å˜é‡å€¼ - å˜åŒ–çš„<br>    èµ‹å€¼åŠ¨ä½œ - å˜é‡åæŒ‡å‘å˜é‡å€¼<br>è¡¨ç°æ ·å¼ï¼š<br>    å˜é‡å<span class="hljs-operator">=</span>å˜é‡å€¼<br>    å˜é‡çš„å…¨ç§°åº”è¯¥æˆä¸ºå˜é‡èµ‹å€¼ï¼Œç®€ç§°å˜é‡ï¼Œåœ¨å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬åªxxæ˜¯å˜é‡ï¼Œå…¶å®æ˜¯æ˜¯å°†è¿™ä¸¤è€…ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥æè¿°äº†ã€‚å‡†ç¡®æ¥è¯´ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ‰€è¯´çš„å˜é‡å…¶å®æŒ‡çš„æ˜¯ï¼šå˜é‡åã€‚<br></code></pre></td></tr></table></figure><p>å‘½åè§„èŒƒ</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-number">1</span> åç§°æœ‰æ„ä¹‰<br><span class="hljs-number">2</span> åç§°ç»†èŠ‚<br>    å‘½ååªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ï¼Œæ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œé¦–ä¸ªå­—ç¬¦ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ã€‚<br>    ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€‚<br>    ä¸èƒ½ä½¿ç”¨æ ‡ç‚¹ç¬¦å·ã€‚<br>    ä¸èƒ½ä½¿ç”¨bashé‡Œçš„å…³é”®å­—ï¼ˆå¯ç”¨helpå‘½ä»¤æŸ¥çœ‹ä¿ç•™å…³é”®å­—ï¼‰ã€‚<br><span class="hljs-number">3</span> å‘½åæ ·å¼<br>    å¤§é©¼å³°HelloWorld,æ¯ä¸ªå•è¯çš„é¦–å­—æ¯æ˜¯å¤§å†™<br>    å°é©¼å³°helloWorld,ç¬¬ä¸€ä¸ªå•è¯çš„é¦–å­—æ¯å°å†™ï¼Œåç»­æ¯ä¸ªå•è¯çš„é¦–å­—æ¯æ˜¯å¤§å†™<br>    ä¸‹åˆ’çº¿: Hello_World<br>    å¤§å°å†™å­—æ¯ï¼š helloworld, HELLOWORLD<br>æ³¨æ„ï¼š<br>    å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œä»–ä»¬å¯¹äºå˜é‡åçš„è§„èŒƒæ¯”è¾ƒå¤šï¼Œä»€ä¹ˆç±»ã€å‡½æ•°ã€å¯¹è±¡ã€å±æ€§ã€å‘½åç©ºé—´ç­‰éƒ½æœ‰è¦æ±‚<br>    å¯¹äºè¿ç»´äººå‘˜æ¥è¯´ï¼Œè®°ä½ä¸€ä¸ªè¯ <span class="hljs-comment">-- æœ‰æ„ä¹‰ã€‚</span><br></code></pre></td></tr></table></figure><p><strong>å˜é‡åˆ†ç±»</strong></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-built_in">shell</span> ä¸­çš„å˜é‡åˆ†ä¸ºä¸‰å¤§ç±»ï¼š<br>    æœ¬åœ°å˜é‡        å˜é‡åä»…ä»…åœ¨å½“å‰ç»ˆç«¯æœ‰æ•ˆ    <br>    å…¨å±€å˜é‡        å˜é‡ååœ¨å½“å‰æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰ç»ˆç«¯éƒ½æœ‰æ•ˆ<br>    <span class="hljs-built_in">shell</span>å†…ç½®å˜é‡   <span class="hljs-built_in">shell</span>è§£æå™¨å†…éƒ¨çš„ä¸€äº›åŠŸèƒ½å‚æ•°å˜é‡<br>æ³¨æ„ï¼š<br>    è¿™é‡Œçš„å˜é‡åˆ†ç±»çš„ç‰¹ç‚¹ä»…ä»…æ˜¯ä»å­—é¢ä¸Šæ¥ç†è§£çš„ï¼Œå› ä¸ºåœ¨å®é™…çš„æ“ä½œçš„æ—¶å€™ï¼Œè¿˜ä¼šæ¶‰åŠåˆ°ç¯å¢ƒä¼˜å…ˆçº§çš„é—®é¢˜<br>    æ‰€ä»¥ç”Ÿäº§ä¸­å¯¹äºè¿™ä¸‰è€…çš„åˆ’åˆ†æ²¡æœ‰ç‰¹åˆ«å¤§çš„å¼ºåˆ¶ã€‚<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-1-3-åŸºæœ¬æ“ä½œ"><a href="#2-1-3-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.1.3 åŸºæœ¬æ“ä½œ"></a>2.1.3 åŸºæœ¬æ“ä½œ</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» å˜é‡æŸ¥çœ‹ã€å˜é‡å®šä¹‰ã€å˜é‡ç§»é™¤ã€å°ç»“å››ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>å˜é‡æŸ¥çœ‹</strong></p><p>è¯­æ³•è§£æ</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crystal">åŸºæœ¬æ ¼å¼<br>    <span class="hljs-variable">$å˜</span>é‡å<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">æŸ¥çœ‹é»˜è®¤çš„shellç±»å‹<br>[root@localhost ~]# <span class="hljs-built_in">echo</span> <span class="hljs-variable">$SHELL</span><br>/bin/bash<br></code></pre></td></tr></table></figure><p><strong>å˜é‡å®šä¹‰</strong></p><p>æ™®é€šè¯­æ³•è§£æ</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">åŸºæœ¬æ ¼å¼<br>    å˜é‡å<span class="hljs-operator">=</span>å˜é‡å€¼<br>    <br>æ³¨æ„ï¼š<br>    <span class="hljs-operator">=</span> ä¸¤ä¾§ä¸å…è®¸æœ‰ç©ºæ ¼<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æŸ¥çœ‹ä¸€ä¸ªç©ºå€¼å˜é‡å<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#  echo $myname</span><br><br>å®šåˆ¶å˜é‡å®è·µ<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># myname=shuji</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#  echo $myname</span><br>shuji<br>é”™è¯¯çš„å®šåˆ¶å˜é‡å‘½ä»¤<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#  echo $myage</span><br><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># myage = 18</span><br>bash: myage: æœªæ‰¾åˆ°å‘½ä»¤<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#  echo $myage</span><br><br></code></pre></td></tr></table></figure><p>ç±»å‹å˜é‡å®šä¹‰</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs autoit">å‘½ä»¤è¯­æ³•<br>    declare å‚æ•° å˜é‡å=å˜é‡å€¼<br>å‚æ•°è§£æï¼š<br>    -i å°†å˜é‡çœ‹æˆæ•´æ•° <br>    -r ä½¿å˜é‡åªè¯»  readonly,==**è¯¥å˜é‡çš„å€¼æ— æ³•æ”¹å˜ï¼Œå¹¶ä¸”ä¸èƒ½ä¸ºunset**==<br>    -x æ ‡è®°å˜é‡ä¸ºå…¨å±€å˜é‡ï¼Œç±»ä¼¼äºexport<br>    -a  æŒ‡å®šä¸ºç´¢å¼•æ•°ç»„ï¼ˆæ™®é€šæ•°ç»„ï¼‰ï¼›æŸ¥çœ‹æ™®é€šæ•°ç»„<br>    -A æŒ‡å®šä¸ºå…³è”æ•°ç»„ï¼›æŸ¥çœ‹å…³è”æ•°ç»„<br>æ³¨æ„ï¼š<br>    åœ¨ç”Ÿäº§åœºæ™¯ä¸­ï¼Œè¿™ç§æ–¹æ³•æ¯”è¾ƒé¸¡è‚‹ï¼Œä½¿ç”¨é¢‘ç‡ <span class="hljs-number">0</span><span class="hljs-number">-20</span>æ¬¡/<span class="hljs-number">3</span>å¹´<br>è®¾å®šåˆ¶å®šç±»å‹çš„å˜é‡å€¼<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># declare -i mynum=<span class="hljs-string">&#x27;shuzi&#x27;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $mynum</span><br><span class="hljs-number">0</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># declare -i mynum=<span class="hljs-string">&#x27;123456&#x27;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $mynum</span><br><span class="hljs-number">123456</span><br>è®¾å®šåªè¯»ç±»å‹å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># declare -r myread1=<span class="hljs-string">&quot;aaa&quot;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># myread2=myread</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># readonly myread2</span><br><br>æŸ¥çœ‹åªè¯»å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># declare -r | grep myread</span><br>declare -r myread1=<span class="hljs-string">&quot;aaa&quot;</span><br>declare -r myread2=<span class="hljs-string">&quot;myread&quot;</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># readonly -p | grep myread</span><br>declare -r myread1=<span class="hljs-string">&quot;aaa&quot;</span><br>declare -r myread2=<span class="hljs-string">&quot;myread&quot;</span><br><br>æ— æ³•ä½¿ç”¨unsetåˆ é™¤åªè¯»å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># unset myread1 myread2</span><br>bash: unset: myread1: æ— æ³•åè®¾å®š: åªè¯» variable<br>bash: unset: myread2: æ— æ³•åè®¾å®š: åªè¯» variable<br><br>å€ŸåŠ©äº<span class="hljs-keyword">exit</span>æ–¹å¼åˆ é™¤åªè¯»å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># exit</span><br>...... é‡æ–°ç™»å½•åå†æ¬¡æŸ¥çœ‹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># declare -r | grep myread</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><strong>å˜é‡ç§»é™¤</strong></p><p>è¯­æ³•è§£æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">åŸºæœ¬æ ¼å¼<br>    <span class="hljs-built_in">unset</span> å˜é‡å<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æŸ¥çœ‹åˆšæ‰å®šåˆ¶çš„å˜é‡å<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#  echo $myname</span><br>shuji<br><br>ç§»é™¤å˜é‡å<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># unset myname</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#  echo $myname</span><br><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="2-2-æœ¬åœ°å˜é‡"><a href="#2-2-æœ¬åœ°å˜é‡" class="headerlink" title="2.2 æœ¬åœ°å˜é‡"></a>2.2 æœ¬åœ°å˜é‡</h2><h3 id="2-2-1-æœ¬åœ°å˜é‡åˆ†ç±»"><a href="#2-2-1-æœ¬åœ°å˜é‡åˆ†ç±»" class="headerlink" title="2.2.1 æœ¬åœ°å˜é‡åˆ†ç±»"></a>2.2.1 æœ¬åœ°å˜é‡åˆ†ç±»</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>æœ¬åœ°å˜é‡</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æ‰€è°“çš„æœ¬åœ°å˜é‡å°±æ˜¯ï¼šåœ¨å½“å‰ç³»ç»Ÿçš„æŸä¸ªç¯å¢ƒä¸‹æ‰èƒ½ç”Ÿæ•ˆçš„å˜é‡ï¼Œä½œç”¨èŒƒå›´å°ã€‚<br></code></pre></td></tr></table></figure><p>å˜é‡åˆ†ç±»</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">æœ¬åœ°å˜é‡æŒ‰ç…§å˜é‡å€¼çš„ç”Ÿæˆæ–¹å¼åŒ…å«ä¸¤ç§ï¼š<br>    æ™®é€šå˜é‡ï¼š<br>        è‡ªå®šä¹‰å˜é‡åå’Œå˜é‡å€¼<br>    å‘½ä»¤å˜é‡ï¼š<br>        è‡ªå®šä¹‰å˜é‡åï¼Œè€Œå˜é‡å€¼æ˜¯é€šè¿‡ä¸€æ¡å‘½ä»¤è·å–çš„<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-2-2-æ™®é€šå˜é‡"><a href="#2-2-2-æ™®é€šå˜é‡" class="headerlink" title="2.2.2 æ™®é€šå˜é‡"></a>2.2.2 æ™®é€šå˜é‡</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>å˜é‡åˆ†ç±»</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">æ‰€è°“çš„æœ¬åœ°å˜é‡å°±æ˜¯ï¼šåœ¨å½“å‰ç³»ç»Ÿçš„æŸä¸ªç¯å¢ƒä¸‹æ‰èƒ½ç”Ÿæ•ˆçš„å˜é‡ï¼Œä½œç”¨èŒƒå›´å°ã€‚æœ¬åœ°å˜é‡æŒ‰ç…§å˜é‡å€¼çš„ç”Ÿæˆæ–¹å¼åŒ…å«ä¸¤ç§ï¼š<br>    æ™®é€šå˜é‡ï¼š<br>        è‡ªå®šä¹‰å˜é‡åå’Œå˜é‡å€¼<br>    å‘½ä»¤å˜é‡ï¼š<br>        è‡ªå®šä¹‰å˜é‡åï¼Œè€Œå˜é‡å€¼æ˜¯é€šè¿‡ä¸€æ¡å‘½ä»¤è·å–çš„<br></code></pre></td></tr></table></figure><p>åŸºæœ¬æ ¼å¼</p><table><thead><tr><th>åºå·</th><th>æ ·å¼</th><th>è¦ç‚¹</th></tr></thead><tbody><tr><td>æ–¹å¼ä¸€</td><td>å˜é‡å&#x3D;å˜é‡å€¼</td><td>å˜é‡å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œä¸­é—´æ²¡æœ‰ç‰¹æ®Šå­—ç¬¦<br />â€œ&#x3D;â€ å‰åä¸èƒ½æœ‰ç©ºæ ¼</td></tr><tr><td>æ–¹å¼äºŒ</td><td>å˜é‡å&#x3D;â€™å˜é‡å€¼â€™</td><td>åŸå­—ç¬¦è¾“å‡ºï¼Œæˆ‘çœ‹åˆ°çš„å†…å®¹ï¼Œæˆ‘å°±è¾“å‡ºä»€ä¹ˆå†…å®¹ï¼Œ</td></tr><tr><td>æ–¹å¼ä¸‰</td><td>å˜é‡å&#x3D;â€å˜é‡å€¼â€</td><td>å¦‚æœå˜é‡å€¼èŒƒå›´å†…ï¼Œæœ‰å¯ä»¥è§£æçš„å˜é‡Aï¼Œé‚£ä¹ˆé¦–å…ˆè§£æå˜é‡Aï¼Œ<br />å°†Açš„ç»“æœå’Œå…¶ä»–å†…å®¹ç»„åˆæˆä¸€ä¸ªæ•´ä½“ï¼Œé‡æ–°èµ‹å€¼ç»™å˜é‡B</td></tr></tbody></table><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">ä¹ æƒ¯ï¼š<br>    æ•°å­—ä¸åŠ å¼•å·ï¼Œå…¶ä»–é»˜è®¤åŠ åŒå¼•å·<br>    å› ä¸ºbashå±äºå¼±ç±»å‹è¯­è¨€ï¼Œé»˜è®¤ä¼šå°†æ‰€æœ‰å†…å®¹å½“æˆå­—ç¬¦ä¸²<br></code></pre></td></tr></table></figure><p>å˜é‡å®šä¹‰</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æŸ¥çœ‹é»˜è®¤çš„ç©ºå€¼å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name</span><br><br>æ–¹æ³•<span class="hljs-number">1</span>è®¾å®šå˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name=shuji</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name</span><br>shuji<br><br>æ–¹æ³•<span class="hljs-number">2</span>è®¾å®šå˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name=<span class="hljs-string">&#x27;shuji1&#x27;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name</span><br>shuji1<br><br>æ–¹æ³•<span class="hljs-number">3</span>è®¾å®šå˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name=<span class="hljs-string">&quot;shuji2&quot;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name</span><br>shuji2<br><br>æ¸…ç†å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># unset name</span><br></code></pre></td></tr></table></figure><p>ä½œç”¨åŒºåˆ«æ¼”ç¤º</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æŸ¥çœ‹é»˜è®¤çš„ç©ºå€¼å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name2</span><br><br>æ–¹æ³•<span class="hljs-number">1</span>è®¾å®šå˜é‡çš„è¦ç‚¹ï¼Œå˜é‡å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ•´ä½“<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name2=shuji haoshuai</span><br>bash: haoshuai: æœªæ‰¾åˆ°å‘½ä»¤<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name2</span><br>åŸå› è§£æï¼š<br>    ç©ºæ ¼æ˜¯ä¸€ä¸ªç‰¹æ®Šç¬¦å·ï¼Œè¡¨ç¤ºä¸¤æ¡å‘½ä»¤çš„éš”å¼€<br>    å®ƒå°†shuji å’Œ haoshuaiå½“æˆä¸¤æ¡å‘½ä»¤äº†ï¼Œæ‰€ä»¥æŠ¥é”™ä¿¡æ¯æ˜¯å‘½ä»¤æ‰¾ä¸åˆ°<br>    <br>æ–¹æ³•<span class="hljs-number">2</span>è®¾å®šå˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name2=<span class="hljs-string">&#x27;shuji haoshuai&#x27;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name2</span><br>shuji haoshuai<br><br>æ–¹æ³•<span class="hljs-number">3</span>è®¾å®šå˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name2=<span class="hljs-string">&quot;shuji haoweiwu&quot;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name2</span><br>haoweiwu    <br><br>æ¸…ç†å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># unset name2</span><br>å®šåˆ¶åŸºç¡€å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name=shuji</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name</span><br>shuji<br><br>æ–¹æ³•<span class="hljs-number">2</span>è®¾å®šå˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name2=<span class="hljs-string">&#x27;dan-$name&#x27;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name2</span><br>dan-$name<br><br>æ–¹æ³•<span class="hljs-number">3</span>è®¾å®šå˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># name2=<span class="hljs-string">&quot;shuang-$name&quot;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $name2</span><br>shuang-shuji<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-2-3-å‘½ä»¤å˜é‡"><a href="#2-2-3-å‘½ä»¤å˜é‡" class="headerlink" title="2.2.3 å‘½ä»¤å˜é‡"></a>2.2.3 å‘½ä»¤å˜é‡</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>åŸºæœ¬æ ¼å¼</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">å®šä¹‰æ–¹å¼ä¸€ï¼š<br>    å˜é‡å=`å‘½ä»¤`<br>    æ³¨æ„ï¼š<br>    ` æ˜¯åå¼•å·<br><br>å®šä¹‰æ–¹å¼äºŒï¼š<br>    å˜é‡å=$(å‘½ä»¤)<br>æ‰§è¡Œæµç¨‹ï¼š<br>    <span class="hljs-number">1</span>ã€æ‰§è¡Œ ` æˆ–è€… $() èŒƒå›´å†…çš„å‘½ä»¤<br>    <span class="hljs-number">2</span>ã€å°†å‘½ä»¤æ‰§è¡Œåçš„ç»“æœï¼Œèµ‹å€¼ç»™æ–°çš„å˜é‡åA<br></code></pre></td></tr></table></figure><p><strong>ç®€å•å®è·µ</strong></p><p>å‘½ä»¤å˜é‡å®è·µ</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æŸ¥çœ‹é»˜è®¤çš„ç©ºå€¼å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $myuser</span><br><br>æ–¹æ³•<span class="hljs-number">1</span>è®¾å®šå˜é‡å<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># myuser=`whoami`</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $myuser</span><br>root<br>æŸ¥çœ‹é»˜è®¤çš„ç©ºå€¼å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $mydir</span><br><br>æ–¹æ³•<span class="hljs-number">2</span>è®¾å®šå˜é‡å<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># mydir=$(pwd)</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $mydir</span><br>/root<br><br>æ¸…ç†å˜é‡<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># unset mydir myuser</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–å¸¸è§çš„å®è·µ</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mel">è‡ªåŠ¨ç”Ÿæˆä¸€ç³»åˆ—æ•°å­—<br>[root@localhost ~]# NUM=<span class="hljs-string">`seq 10`</span><br>[root@localhost ~]# echo $NUM<br><span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span><br><br>æ–‡ä»¶å¤‡ä»½æ·»åŠ æ—¶é—´æˆ³<br>[root@localhost ~]# touch <span class="hljs-keyword">file</span>-a<br>[root@localhost ~]# cp <span class="hljs-keyword">file</span>-a <span class="hljs-keyword">file</span>-a-$(<span class="hljs-keyword">date</span> +%F)<br>[root@localhost ~]# <span class="hljs-keyword">ls</span> <span class="hljs-keyword">file</span>-a*<br><span class="hljs-keyword">file</span>-a  <span class="hljs-keyword">file</span>-a<span class="hljs-number">-2022</span><span class="hljs-number">-06</span><span class="hljs-number">-08</span><br></code></pre></td></tr></table></figure><p>ç®€å•å°ç»¼åˆå®è·µ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[root@localhost ~]# cat get_netinfo_v2.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># åŠŸèƒ½ï¼šè·å–å½“å‰ä¸»æœºçš„ç½‘å¡è®¾å¤‡ä¿¡æ¯</span><br><span class="hljs-comment"># ä½œè€…ï¼šwangshuji</span><br><span class="hljs-comment"># ç‰ˆæœ¬ï¼šV0.2</span><br><span class="hljs-comment"># è”ç³»ï¼šwww.superopsmsb.com</span><br><br><span class="hljs-comment"># å®šåˆ¶åŸºç¡€å˜é‡</span><br><span class="hljs-attribute">RED</span>=<span class="hljs-string">&quot;\E[1;31m&quot;</span><br><span class="hljs-attribute">GREEN</span>=<span class="hljs-string">&quot;echo -e \E[1;32m&quot;</span><br><span class="hljs-attribute">END</span>=<span class="hljs-string">&quot;\E[0m&quot;</span><br><br><span class="hljs-comment"># è·å–ipåœ°å€ä¿¡æ¯</span><br><span class="hljs-attribute">IPDDR</span>=$(ifconfig eth0 | grep -w inet | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>)<br><span class="hljs-comment"># è·å–æ©ç åœ°å€ä¿¡æ¯</span><br><span class="hljs-attribute">NETMAST</span>=$(ifconfig eth0 | grep -w inet | awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span>)<br><span class="hljs-comment"># è·å–å¹¿æ’­åœ°å€ä¿¡æ¯</span><br><span class="hljs-attribute">BROADCAST</span>=$(ifconfig eth0 | grep -w inet | awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span>)<br><span class="hljs-comment"># è·å–MACåœ°å€ä¿¡æ¯</span><br><span class="hljs-attribute">MACADDR</span>=$(ifconfig eth0 | grep ether | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>)<br><br><span class="hljs-comment"># æ‰“å°ç½‘ç»œåŸºæœ¬ä¿¡æ¯</span><br><span class="hljs-variable">$GREEN</span>---------ä¸»æœºç½‘å¡åŸºæœ¬ä¿¡æ¯---------<span class="hljs-variable">$END</span><br>echo -e  <span class="hljs-string">&quot;HOSTNAME:     <span class="hljs-variable">$RED</span> `hostname` <span class="hljs-variable">$END</span>&quot;</span><br>echo -e  <span class="hljs-string">&quot;IP:           <span class="hljs-variable">$RED</span> <span class="hljs-variable">$IPDDR</span> <span class="hljs-variable">$END</span>&quot;</span><br>echo -e  <span class="hljs-string">&quot;NetMask:      <span class="hljs-variable">$RED</span> <span class="hljs-variable">$NETMAST</span> <span class="hljs-variable">$END</span>&quot;</span><br>echo -e  <span class="hljs-string">&quot;Broadcast:    <span class="hljs-variable">$RED</span> <span class="hljs-variable">$BROADCAST</span> <span class="hljs-variable">$END</span>&quot;</span><br>echo -e  <span class="hljs-string">&quot;MAC Address:  <span class="hljs-variable">$RED</span> <span class="hljs-variable">$MACADDR</span> <span class="hljs-variable">$END</span>&quot;</span><br><span class="hljs-variable">$GREEN</span>---------ä¸»æœºç½‘å¡åŸºæœ¬ä¿¡æ¯---------<span class="hljs-variable">$END</span><br>æ–‡ä»¶æ‰§è¡Œåæ•ˆæœ<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220608010705436.png" alt="image-20220608010705436"></p><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="2-3-å…¨å±€å˜é‡"><a href="#2-3-å…¨å±€å˜é‡" class="headerlink" title="2.3 å…¨å±€å˜é‡"></a>2.3 å…¨å±€å˜é‡</h2><h3 id="2-3-1-åŸºæœ¬æ“ä½œ"><a href="#2-3-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.3.1 åŸºæœ¬æ“ä½œ"></a>2.3.1 åŸºæœ¬æ“ä½œ</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>åŸºæœ¬å®šä¹‰</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">å…¨å±€å˜é‡æ˜¯ä»€ä¹ˆ<br>    å…¨å±€å˜é‡å°±æ˜¯ï¼šåœ¨å½“å‰ç³»ç»Ÿçš„æ‰€æœ‰ç¯å¢ƒä¸‹éƒ½èƒ½ç”Ÿæ•ˆçš„å˜é‡ã€‚<br></code></pre></td></tr></table></figure><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">æŸ¥çœ‹å…¨å±€ç¯å¢ƒå˜é‡<br>    <span class="hljs-built_in">env</span>         åªæ˜¾ç¤ºå…¨å±€å˜é‡,ä¸€èˆ¬ç»“åˆ grep å’Œç®¡é“ç¬¦æ¥ä½¿ç”¨<br>    <span class="hljs-built_in">printenv</span>    æ•ˆæœä¸<span class="hljs-built_in">env</span>ç­‰åŒ<br>    <br>    <span class="hljs-built_in">export</span>      æŸ¥çœ‹æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬å£°æ˜çš„è¿‡ç¨‹ç­‰ä¿¡æ¯ï¼Œä¸€èˆ¬ä¸ç”¨<br>    <span class="hljs-built_in">declare</span> -x  æ•ˆæœä¸<span class="hljs-built_in">export</span>ç±»ä¼¼<br>å®šä¹‰å…¨å±€å˜é‡æ–¹æ³•ä¸€ï¼š<br>    å˜é‡=å€¼<br>    <span class="hljs-built_in">export</span> å˜é‡<br>å®šä¹‰å…¨å±€å˜é‡æ–¹æ³•äºŒï¼šï¼ˆæœ€å¸¸ç”¨ï¼‰<br>    <span class="hljs-built_in">export</span> å˜é‡=å€¼<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å…¨å±€å˜é‡</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs perl">æŸ¥çœ‹æ‰€æœ‰çš„å…¨å±€å˜é‡<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># env</span><br>XDG_SESSION_ID=<span class="hljs-number">4</span><br>HOSTNAME=localhost<br>SHELL=<span class="hljs-regexp">/bin/</span>bash<br>TERM=xterm<br>HISTSIZE=<span class="hljs-number">1000</span><br>...<br><br>æŸ¥çœ‹åˆ¶å®šçš„å…¨å±€å˜é‡<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># env | grep SHELL</span><br>SHELL=<span class="hljs-regexp">/bin/</span>bash<br>å®šåˆ¶æœ¬åœ°å˜é‡<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># envtype=local</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $envtype</span><br><span class="hljs-keyword">local</span><br><br>ä»å…¨å±€å˜é‡ä¸­æŸ¥çœ‹<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># env | grep envtype</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment">#</span><br>ç»“æœæ˜¾ç¤ºï¼š<br>    æ— æ³•ä»å…¨å±€å˜é‡ä¸­æŸ¥çœ‹æœ¬åœ°å˜é‡çš„åç§°<br>æ–¹æ³•<span class="hljs-number">1</span>å®šåˆ¶å…¨å±€å˜é‡<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $envtype</span><br><span class="hljs-keyword">local</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># env | grep envtype</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># export envtype</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># env | grep envtype</span><br>envtype=<span class="hljs-keyword">local</span><br><br>æ–¹æ³•<span class="hljs-number">2</span>å®šåˆ¶å…¨å±€å˜é‡<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># export myuser=root</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># env | grep myuser</span><br>myuser=root<br><br>é¸¡è‚‹æ–¹æ³•å®šåˆ¶å…¨å±€å˜é‡<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># declare -x mydir=/root</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># env | grep mydir</span><br>mydir=/root<br><br>æ¸…ç†å…¨å±€å˜é‡<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># unset envtype myuser mydir</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong> </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-3-2-æ–‡ä»¶ä½“ç³»"><a href="#2-3-2-æ–‡ä»¶ä½“ç³»" class="headerlink" title="2.3.2 æ–‡ä»¶ä½“ç³»"></a>2.3.2 æ–‡ä»¶ä½“ç³»</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» å˜é‡æ–‡ä»¶ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>å˜é‡æ–‡ä»¶</strong></p><p>å˜é‡æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">åœ¨linuxç¯å¢ƒä¸­ï¼Œæœ‰å¾ˆå¤šç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½å¯ä»¥å®šåˆ¶ä¸€äº›ä½œç”¨èŒƒå›´æ›´å¹¿çš„å˜é‡ï¼Œè¿™äº›æ–‡ä»¶æˆ–æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æœ‰ï¼š<br>    ä½œç”¨èŒƒå›´åœ¨åˆ¶å®šçš„ç”¨æˆ·èŒƒå›´ï¼š<br>        ~/.bashrc<br>        ~/.bash_profile<br>    ä½œç”¨çš„èŒƒå›´åœ¨ç³»ç»ŸèŒƒå›´ï¼š<br>        /etc/profile<br>        /etc/profile.d/env_file_name<br></code></pre></td></tr></table></figure><p><strong>ç®€å•å®è·µ</strong></p><p>bashrc æˆ– bash_profile å®è·µ</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs crystal">æŸ¥çœ‹æœªçŸ¥çš„å˜é‡å<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $NAME</span><br><br>å®šåˆ¶å˜é‡ååˆ°æ–‡ä»¶ä¸­<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo NAME=shuji &gt;&gt; ~/.bashrc</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># source ~/.bashrc</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $NAME</span><br>shuji<br><br>æ–°å¼€ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹æ•ˆæœ<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $NAME</span><br>shuji<br><br>æ–°å¼€ä¸€ä¸ªæ™®é€šç”¨æˆ·çš„ç»ˆç«¯æŸ¥çœ‹æ•ˆæœ<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># su - python</span><br>[python<span class="hljs-variable">@localhost</span> ~]<span class="hljs-variable">$ </span>echo <span class="hljs-variable">$NAME</span><br><br>[python<span class="hljs-variable">@localhost</span> ~]<span class="hljs-variable">$</span><br><span class="hljs-variable"></span>æ¸…ç†.bashrc æ–‡ä»¶é‡Œçš„å˜é‡ï¼Œç„¶åæ¸…é™¤å½“å‰ç¯å¢ƒä¸‹çš„å˜é‡å<br>unset NAME<br></code></pre></td></tr></table></figure><p>profileå®è·µ</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs crystal">æŸ¥çœ‹æœªçŸ¥çš„å˜é‡å<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $PROFILE</span><br><br>å®šåˆ¶å˜é‡ååˆ°æ–‡ä»¶ä¸­<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo PROFILE=shuji &gt;&gt; /etc/profile</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># source /etc/profile</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $PROFILE</span><br>shuji<br><br>æ–°å¼€ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹æ•ˆæœ<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># echo $PROFILE</span><br>shuji<br><br>æ–°å¼€ä¸€ä¸ªæ™®é€šç”¨æˆ·çš„ç»ˆç«¯æŸ¥çœ‹æ•ˆæœ<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># su - python</span><br>[python<span class="hljs-variable">@localhost</span> ~]<span class="hljs-variable">$ </span>echo <span class="hljs-variable">$PROFILE</span><br>shuji<br>[python<span class="hljs-variable">@localhost</span> ~]$<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-3-3-åµŒå¥—shell"><a href="#2-3-3-åµŒå¥—shell" class="headerlink" title="2.3.3 åµŒå¥—shell"></a>2.3.3 åµŒå¥—shell</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» exportåŸç†ã€åµŒå¥—å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>exportåŸç†</strong></p><p>åŸç†è§£æ</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gauss">ç”¨æˆ·ç™»å½•æ—¶:<br>    ç”¨æˆ·ç™»å½•åˆ°Linuxç³»ç»Ÿåï¼Œç³»ç»Ÿå°†å¯åŠ¨ä¸€ä¸ªç”¨æˆ·<span class="hljs-built_in">shell</span>ã€‚<br>    åœ¨è¿™ä¸ª<span class="hljs-built_in">shell</span>ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<span class="hljs-built_in">shell</span>å‘½ä»¤æˆ–å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå¹¶è¿è¡Œ <span class="hljs-built_in">shell</span>è„šæœ¬ç¨‹åºã€‚<br><br>è¿è¡Œè„šæœ¬æ—¶:<br>    è¿è¡Œ<span class="hljs-built_in">shell</span>è„šæœ¬ç¨‹åºæ—¶ï¼Œç³»ç»Ÿå°†åˆ›å»ºä¸€ä¸ªå­<span class="hljs-built_in">shell</span>ã€‚ æ­¤æ—¶ï¼Œç³»ç»Ÿä¸­å°†æœ‰ä¸¤ä¸ª<span class="hljs-built_in">shell</span><br>        - ä¸€ä¸ªæ˜¯ç™»å½•æ—¶ç³»ç»Ÿå¯åŠ¨çš„<span class="hljs-built_in">shell</span>ï¼Œå¦ä¸€ä¸ªæ˜¯ç³»ç»Ÿä¸ºè¿è¡Œè„šæœ¬ç¨‹åºåˆ›å»ºçš„<span class="hljs-built_in">shell</span>ã€‚<br>        å½“ä¸€ä¸ªè„šæœ¬ç¨‹åºè¿è¡Œå®Œæ¯•ï¼Œå®ƒçš„è„šæœ¬<span class="hljs-built_in">shell</span>å°†ç»ˆæ­¢ï¼Œå¯ä»¥è¿”å›åˆ°æ‰§è¡Œè¯¥è„šæœ¬ä¹‹å‰çš„<span class="hljs-built_in">shell</span>ã€‚<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220608013404270.png" alt="image-20220608013404270"></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gauss">æ„ä¹‰è§£è¯»<br>    ä»è¿™ç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œç”¨æˆ·å¯ä»¥æœ‰è®¸å¤š <span class="hljs-built_in">shell</span>ï¼Œæ¯ä¸ª<span class="hljs-built_in">shell</span>éƒ½æ˜¯ç”±æŸä¸ª<span class="hljs-built_in">shell</span>ï¼ˆç§°ä¸ºçˆ¶<span class="hljs-built_in">shell</span>ï¼‰æ´¾ç”Ÿçš„ã€‚<br>åœ¨å­<span class="hljs-built_in">shell</span>ä¸­å®šä¹‰çš„å˜é‡åªåœ¨è¯¥å­<span class="hljs-built_in">shell</span>å†…æœ‰æ•ˆã€‚å¦‚æœåœ¨ä¸€ä¸ª<span class="hljs-built_in">shell</span>è„šæœ¬ç¨‹åºä¸­å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå½“è¯¥è„šæœ¬ç¨‹åºè¿è¡Œæ—¶ï¼Œè¿™ä¸ªå®šä¹‰çš„å˜é‡åªæ˜¯è¯¥è„šæœ¬ç¨‹åºå†…çš„ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå…¶ä»–çš„<span class="hljs-built_in">shell</span>ä¸èƒ½å¼•ç”¨å®ƒï¼Œè¦ä½¿æŸä¸ªå˜é‡çš„å€¼å¯ä»¥åœ¨å…¶ä»–<span class="hljs-built_in">shell</span>ä¸­è¢«æ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨exportå‘½ä»¤å¯¹å·²å®šä¹‰çš„å˜é‡è¿›è¡Œè¾“å‡ºã€‚ <br><br>    exportå‘½ä»¤å°†ä½¿ç³»ç»Ÿåœ¨åˆ›å»ºæ¯ä¸€ä¸ªæ–°çš„<span class="hljs-built_in">shell</span>æ—¶å®šä¹‰è¿™ä¸ªå˜é‡çš„ä¸€ä¸ªæ‹·è´ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºå˜é‡è¾“å‡ºã€‚<br></code></pre></td></tr></table></figure><p>å®è·µè§£è¯»</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss">å½“å‰çˆ¶<span class="hljs-built_in">shell</span>ä¸­å®šä¹‰å˜é‡ä¸­,åˆ†ä¸ºå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ï¼Œä¸åŒç‚¹æ˜¯ï¼š<br>    - å±€éƒ¨å˜é‡åªèƒ½ä½œç”¨äºæœ¬çˆ¶<span class="hljs-built_in">shell</span>ï¼Œå­<span class="hljs-built_in">shell</span>æ— æ³•ç»§ç»­ä½¿ç”¨<br>    - å¦‚æœä½¿ç”¨äº†exportå°†å±€éƒ¨å˜é‡å®šä¹‰ä¸ºå…¨å±€å˜é‡ï¼Œé‚£ä¹ˆå­<span class="hljs-built_in">shell</span>åˆ›å»ºçš„æ—¶å€™ä¼šç»§æ‰¿çˆ¶<span class="hljs-built_in">shell</span>çš„å…¨å±€å˜é‡<br></code></pre></td></tr></table></figure><p><strong>åµŒå¥—å®è·µ</strong></p><p>ç®€å•å®è·µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">æŸ¥çœ‹çˆ¶shellçš„è„šæœ¬<br>[root@localhost ~]# <span class="hljs-built_in">cat</span> father.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># å®šåˆ¶å…¨å±€å˜é‡</span><br><span class="hljs-built_in">export</span> _xing=<span class="hljs-string">&#x27;ç‹&#x27;</span><br>_name=<span class="hljs-string">&quot;ä¹¦è®°&quot;</span><br>_age=<span class="hljs-string">&quot;42&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;çˆ¶shellä¿¡æ¯: $_xing<span class="hljs-variable">$_name</span>,<span class="hljs-variable">$_age</span>&quot;</span><br><span class="hljs-built_in">sleep</span> 3<br><br><span class="hljs-comment"># è°ƒç”¨child.shè¿›è¡ŒéªŒè¯,æœ€å¥½æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹</span><br>/bin/bash child.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;çˆ¶shellä¿¡æ¯: $_xing<span class="hljs-variable">$_name</span>,<span class="hljs-variable">$_age</span>&quot;</span><br>æŸ¥çœ‹å­shellçš„è„šæœ¬<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># æ˜¾ç¤ºçˆ¶shellçš„å…¨å±€å˜é‡</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å­shellä¿¡æ¯: $_xing<span class="hljs-variable">$_name</span>,<span class="hljs-variable">$_age</span>&quot;</span><br><br><span class="hljs-comment"># åŒåå˜é‡ å­shell çš„ä¼˜å…ˆçº§é«˜äºçˆ¶shell,ä½†æ˜¯ä¸ä¼šä¼ é€’ç»™çˆ¶shell</span><br>_xing=<span class="hljs-string">&quot;ç‹èƒ–èƒ–&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å­shellä¿®æ”¹åçš„ä¿¡æ¯: <span class="hljs-variable">$_xing</span>&quot;</span><br>æ‰§è¡Œæµ‹è¯•æ•ˆæœ<br>[root@localhost ~]# /bin/bash father.sh<br>çˆ¶shellä¿¡æ¯: ç‹ä¹¦è®°,42<br>å­shellä¿¡æ¯: ç‹,<br>å­shellä¿®æ”¹åçš„ä¿¡æ¯: ç‹èƒ–èƒ–<br>çˆ¶shellä¿¡æ¯: ç‹ä¹¦è®°,42<br></code></pre></td></tr></table></figure><h2 id="2-4-å†…ç½®å˜é‡"><a href="#2-4-å†…ç½®å˜é‡" class="headerlink" title="2.4 å†…ç½®å˜é‡"></a>2.4 å†…ç½®å˜é‡</h2><h3 id="2-4-1-è„šæœ¬ç›¸å…³"><a href="#2-4-1-è„šæœ¬ç›¸å…³" class="headerlink" title="2.4.1 è„šæœ¬ç›¸å…³"></a>2.4.1 è„šæœ¬ç›¸å…³</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ </p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>è„šæœ¬ç›¸å…³çš„å˜é‡è§£æ</p><table><thead><tr><th>åºå·</th><th>å˜é‡å</th><th>è§£æ</th></tr></thead><tbody><tr><td>1</td><td>$0</td><td>è·å–å½“å‰æ‰§è¡Œçš„shellè„šæœ¬æ–‡ä»¶å</td></tr><tr><td>2</td><td>$n</td><td>è·å–å½“å‰æ‰§è¡Œçš„shellè„šæœ¬çš„ç¬¬nä¸ªå‚æ•°å€¼ï¼Œn&#x3D;1..9ï¼Œ<br />å½“nä¸º0æ—¶è¡¨ç¤ºè„šæœ¬çš„æ–‡ä»¶åï¼Œå¦‚æœnå¤§äº9å°±è¦ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥${10}</td></tr><tr><td>3</td><td>$#</td><td>è·å–å½“å‰shellå‘½ä»¤è¡Œä¸­å‚æ•°çš„æ€»ä¸ªæ•°</td></tr><tr><td>4</td><td>$?</td><td>è·å–æ‰§è¡Œä¸Šä¸€ä¸ªæŒ‡ä»¤çš„è¿”å›å€¼ï¼ˆ0ä¸ºæˆåŠŸï¼Œé0ä¸ºå¤±è´¥ï¼‰</td></tr></tbody></table><p><strong>ç®€å•å®è·µ</strong></p><p>å®è·µ1 - $0 è·å–è„šæœ¬çš„åç§°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]# <span class="hljs-built_in">cat</span> get_name.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># è·å–è„šæœ¬çš„åç§°</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æˆ‘è„šæœ¬çš„åç§°æ˜¯ï¼š file.sh&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æˆ‘è„šæœ¬çš„åç§°æ˜¯ï¼š<span class="hljs-variable">$0</span>&quot;</span><br></code></pre></td></tr></table></figure><p>å®è·µ2 - $n è·å–å½“å‰è„šæœ¬ä¼ å…¥çš„ç¬¬nä¸ªä½ç½®çš„å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]# <span class="hljs-built_in">cat</span> get_args.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># è·å–æŒ‡å®šä½ç½®çš„å‚æ•°</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªä½ç½®çš„å‚æ•°æ˜¯ï¼š <span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¬¬äºŒä¸ªä½ç½®çš„å‚æ•°æ˜¯ï¼š <span class="hljs-variable">$2</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¬¬ä¸‰ä¸ªä½ç½®çš„å‚æ•°æ˜¯ï¼š <span class="hljs-variable">$3</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ç¬¬å››ä¸ªä½ç½®çš„å‚æ•°æ˜¯ï¼š <span class="hljs-variable">$4</span>&quot;</span><br></code></pre></td></tr></table></figure><p>å®è·µ3 - $# è·å–å½“å‰è„šæœ¬ä¼ å…¥å‚æ•°çš„æ•°é‡</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs d">[root<span class="hljs-keyword">@localhost</span> ~]# cat get_number.sh<br><span class="hljs-meta">#!/bin/bash</span><br># è·å–å½“å‰è„šæœ¬ä¼ å…¥çš„å‚æ•°æ•°é‡<br>echo <span class="hljs-string">&quot;å½“å‰è„šæœ¬ä¼ å…¥çš„å‚æ•°æ•°é‡æ˜¯ï¼š $#&quot;</span><br></code></pre></td></tr></table></figure><p>å®è·µ4 - $? è·å–æ–‡ä»¶æ‰§è¡Œæˆ–è€…å‘½ä»¤æ‰§è¡Œçš„è¿”å›çŠ¶æ€å€¼</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">[root@localhost ~]<span class="hljs-comment">#  bash nihao</span><br><span class="hljs-keyword">bash: </span>nihao: No such file <span class="hljs-keyword">or </span><span class="hljs-keyword">directory</span><br><span class="hljs-keyword"></span>[root@localhost ~]<span class="hljs-comment">#  echo $?</span><br><span class="hljs-number">127</span><br><br>[root@localhost ~]<span class="hljs-comment">#  ls</span><br>get_name.<span class="hljs-keyword">sh </span>get_args.<span class="hljs-keyword">sh </span>get_number.<span class="hljs-keyword">sh</span><br><span class="hljs-keyword"></span>[root@localhost ~]<span class="hljs-comment">#  echo $?</span><br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-4-2-å­—ç¬¦ä¸²ç›¸å…³"><a href="#2-4-2-å­—ç¬¦ä¸²ç›¸å…³" class="headerlink" title="2.4.2 å­—ç¬¦ä¸²ç›¸å…³"></a>2.4.2 å­—ç¬¦ä¸²ç›¸å…³</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ </p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>å­—ç¬¦ä¸²ç›¸å…³çš„å˜é‡è§£æ</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gams">å­—ç¬¦ä¸²è®¡æ•°<br>    <span class="hljs-symbol">$</span>&#123;#<span class="hljs-keyword">file</span>&#125;            è·å–å­—ç¬¦ä¸²çš„é•¿åº¦<br><br>å­—ç¬¦ä¸²æˆªå–   <br>    - è¯­æ³•ä¸º<span class="hljs-symbol">$</span>&#123;var:pos:length&#125;   è¡¨ç¤ºå¯¹å˜é‡varä»poså¼€å§‹æˆªå–lengthä¸ªå­—ç¬¦ï¼Œposä¸ºç©ºæ ‡ç¤º<span class="hljs-number">0</span><br>    <span class="hljs-symbol">$</span>&#123;<span class="hljs-keyword">file</span>:<span class="hljs-number">0</span>:<span class="hljs-number">5</span>&#125;         ä»<span class="hljs-number">0</span>å¼€å§‹ï¼Œæˆªå–<span class="hljs-number">5</span>ä¸ªå­—ç¬¦<br>    <span class="hljs-symbol">$</span>&#123;<span class="hljs-keyword">file</span>:<span class="hljs-number">5</span>:<span class="hljs-number">5</span>&#125;         ä»<span class="hljs-number">5</span>å¼€å§‹ï¼Œæˆªå–<span class="hljs-number">5</span>ä¸ªå­—ç¬¦<br>    <span class="hljs-symbol">$</span>&#123;<span class="hljs-keyword">file</span>::<span class="hljs-number">5</span>&#125;          ä»<span class="hljs-number">0</span>å¼€å§‹ï¼Œæˆªå–<span class="hljs-number">5</span>ä¸ªå­—ç¬¦<br>    <span class="hljs-symbol">$</span>&#123;<span class="hljs-keyword">file</span>:<span class="hljs-number">0</span><span class="hljs-number">-6</span>:<span class="hljs-number">3</span>&#125;       ä»å€’æ•°ç¬¬<span class="hljs-number">6</span>ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæˆªå–ä¹‹åçš„<span class="hljs-number">3</span>ä¸ªå­—ç¬¦<br>    <span class="hljs-symbol">$</span>&#123;<span class="hljs-keyword">file</span>: <span class="hljs-number">-4</span>&#125;         è¿”å›å­—ç¬¦ä¸²æœ€åå››ä¸ªå­—èŠ‚ï¼Œ-å‰é¢æ˜¯<span class="hljs-string">&quot;ç©ºæ ¼&quot;</span><br></code></pre></td></tr></table></figure><p><strong>ç®€å•å®è·µ</strong></p><p>å­—ç¬¦ä¸²å®è·µ</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs autoit">å®šåˆ¶å­—ç¬¦ä¸²å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># string_context=<span class="hljs-string">&quot;dsjfdsafjkldjsklfajkdsa&quot;</span></span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $string_context</span><br>dsjfdsafjkldjsklfajkdsa<br>è·å–å­—ç¬¦ä¸²é•¿åº¦<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $&#123;#string_context&#125;</span><br><span class="hljs-number">23</span><br>ä»<span class="hljs-number">0</span>å¼€å§‹ï¼Œæˆªå–<span class="hljs-number">5</span>ä¸ªå­—ç¬¦<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $&#123;string_context:0:5&#125;</span><br>dsjfd<br><br>ä»<span class="hljs-number">5</span>å¼€å§‹ï¼Œæˆªå–<span class="hljs-number">5</span>ä¸ªå­—ç¬¦<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $&#123;string_context:5:5&#125;</span><br>safjk   <br><br>ä»<span class="hljs-number">0</span>å¼€å§‹ï¼Œæˆªå–<span class="hljs-number">5</span>ä¸ªå­—ç¬¦<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $&#123;string_context::5&#125;</span><br>dsjfd<br><br>ä»å€’æ•°ç¬¬<span class="hljs-number">6</span>ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæˆªå–ä¹‹åçš„<span class="hljs-number">3</span>ä¸ªå­—ç¬¦<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $&#123;string_context:0-6:3&#125;</span><br>ajk<br><br>è¿”å›å­—ç¬¦ä¸²æœ€åå››ä¸ªå­—èŠ‚ï¼Œ-å‰é¢æ˜¯<span class="hljs-string">&quot;ç©ºæ ¼&quot;</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo $&#123;string_context: -4&#125;</span><br>kdsa    <br><br></code></pre></td></tr></table></figure><h3 id="2-4-3-é»˜è®¤å€¼ç›¸å…³"><a href="#2-4-3-é»˜è®¤å€¼ç›¸å…³" class="headerlink" title="2.4.3 é»˜è®¤å€¼ç›¸å…³"></a>2.4.3 é»˜è®¤å€¼ç›¸å…³</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ </p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>è¯­æ³•è§£è¯»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">æ ¼å¼ä¸€ï¼š<span class="hljs-variable">$&#123;å˜é‡å:-é»˜è®¤å€¼&#125;</span> <br>    å˜é‡aå¦‚æœæœ‰å†…å®¹ï¼Œé‚£ä¹ˆå°±è¾“å‡ºaçš„å˜é‡å€¼<br>    å˜é‡aå¦‚æœæ²¡æœ‰å†…å®¹ï¼Œé‚£ä¹ˆå°±è¾“å‡ºé»˜è®¤çš„å†…å®¹<br><br>æ ¼å¼äºŒï¼š<span class="hljs-variable">$&#123;å˜é‡å+é»˜è®¤å€¼&#125;</span>  <br>    æ— è®ºå˜é‡aæ˜¯å¦æœ‰å†…å®¹ï¼Œéƒ½è¾“å‡ºé»˜è®¤å€¼<br></code></pre></td></tr></table></figure><p>å®è·µ1 - æœ‰æ¡ä»¶çš„é»˜è®¤å€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">è´­ä¹°æ‰‹æœºçš„æ—¶å€™é€‰æ‹©å¥—é¤ï¼š<br>    å¦‚æœæˆ‘è¾“å…¥çš„å‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆè¾“å‡ºå†…å®¹æ˜¯ <span class="hljs-string">&quot;æ‚¨é€‰æ‹©çš„å¥—é¤æ˜¯ï¼š å¥—é¤ 1&quot;</span><br>    å¦‚æœæˆ‘è¾“å…¥çš„å‚æ•°ä¸ºnï¼Œé‚£ä¹ˆè¾“å‡ºå†…å®¹æ˜¯ <span class="hljs-string">&quot;æ‚¨é€‰æ‹©çš„å¥—é¤æ˜¯ï¼š å¥—é¤ n&quot;</span>  <br>[root@localhost ~]# select_default_value.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># å¥—é¤é€‰æ‹©æ¼”ç¤º</span><br>a=<span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ‚¨é€‰æ‹©çš„æ‰‹æœºå¥—é¤æ˜¯ï¼š å¥—é¤ <span class="hljs-variable">$&#123;a:-1&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p>å®è·µ2 - å¼ºåˆ¶é»˜è®¤å€¼</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs d">å›½å®¶æ³•å¾‹å¼ºåˆ¶è§„å®šï¼š<br>    ä¸ç®¡æˆ‘è¯´å›½å®¶æ³•å®šç»“å©šå¹´é¾„æ˜¯ å¤šå°‘å²ï¼Œéƒ½è¾“å‡º å›½å®¶æ³•å®šç»“å©šå¹´é¾„(ç”·æ€§)æ˜¯ <span class="hljs-number">22</span> å²    <br>[root<span class="hljs-keyword">@localhost</span> ~]# froce_default_value.sh<br><span class="hljs-meta">#!/bin/bash</span><br># é»˜è®¤å€¼æ¼”ç¤ºç¤ºä¾‹äºŒ<br>a=<span class="hljs-string">&quot;$1&quot;</span><br>echo <span class="hljs-string">&quot;å›½å®¶æ³•å®šç»“å©šå¹´é¾„(ç”·æ€§)æ˜¯ $&#123;a+22&#125; å²&quot;</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="2-4-4-å…¶ä»–ç›¸å…³"><a href="#2-4-4-å…¶ä»–ç›¸å…³" class="headerlink" title="2.4.4 å…¶ä»–ç›¸å…³"></a>2.4.4 å…¶ä»–ç›¸å…³</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ </p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>è„šæœ¬ç›¸å…³çš„å˜é‡è§£æ</p><table><thead><tr><th>åºå·</th><th>å˜é‡å</th><th>è§£æ</th></tr></thead><tbody><tr><td>1</td><td>$_</td><td>åœ¨æ­¤ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬çš„ç¬¬ä¸€ä¸ªå†…å®¹</td></tr><tr><td>2</td><td>$@</td><td>ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°</td></tr><tr><td>3</td><td>$*</td><td>æ˜¯ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºé‡Œæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ï¼Œä¸ä½ç½®å‚æ•°ä¸åŒï¼Œå‚æ•°å¯è¶…è¿‡9ä¸ª</td></tr><tr><td>4</td><td>$$</td><td>æ˜¯è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹çš„IDå·ï¼Œä½œç”¨æ˜¯æ–¹ä¾¿ä»¥åç®¡ç†å®ƒæ€æ‰ä»–</td></tr><tr><td>5</td><td>$!</td><td>å‰ä¸€æ¡å‘½ä»¤è¿›ç¨‹çš„IDå·ï¼Œä½œç”¨æ˜¯æ–¹ä¾¿ä»¥åç®¡ç†å®ƒæ€æ‰ä»–</td></tr></tbody></table><p><strong>ç®€å•å®è·µ</strong></p><p>å®è·µ1 - å…¶ä»–å˜é‡çš„ä½œç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost ~]# <span class="hljs-built_in">cat</span> get_other.sh<br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;è„šæœ¬æ‰§è¡Œå‘½ä»¤çš„ç¬¬ä¸€ä¸ªå†…å®¹: <span class="hljs-variable">$_</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ä¼ é€’ç»™å½“å‰è„šæœ¬çš„æ‰€æœ‰å‚æ•°æ˜¯: <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‚æ•°: $*&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;å½“å‰è„šæœ¬æ‰§è¡Œæ—¶å€™çš„è¿›ç¨‹å·æ˜¯: $$&quot;</span><br><span class="hljs-built_in">sleep</span> 5 &amp;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œæ—¶å€™çš„è¿›ç¨‹å·æ˜¯: $!&quot;</span><br></code></pre></td></tr></table></figure><p>å®è·µ2 - $$ è·å–å½“å‰çš„è¿›ç¨‹å·</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vim">æŸ¥çœ‹å½“å‰çš„è¿›ç¨‹å·<br>[root@localhost ~]# <span class="hljs-keyword">echo</span> $$<br><span class="hljs-number">4759</span><br>[root@localhost ~]# <span class="hljs-keyword">ps</span> aux | <span class="hljs-keyword">grep</span> <span class="hljs-number">4759</span><br>root       <span class="hljs-number">4759</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span> <span class="hljs-number">116712</span>  <span class="hljs-number">3356</span> <span class="hljs-keyword">pts</span>/<span class="hljs-number">1</span>    Ss   <span class="hljs-number">00</span>:<span class="hljs-number">11</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> -bash<br>root       <span class="hljs-number">5547</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span> <span class="hljs-number">112828</span>   <span class="hljs-number">984</span> <span class="hljs-keyword">pts</span>/<span class="hljs-number">1</span>    S+   <span class="hljs-number">02</span>:<span class="hljs-number">00</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">grep</span> --color=auto <span class="hljs-number">4759</span><br>æ€æ­»å½“å‰çš„è¿›ç¨‹<br>[root@localhost ~]# kill -<span class="hljs-number">9</span> <span class="hljs-number">4759</span><br>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>Session stopped<br>    - Press <span class="hljs-symbol">&lt;return&gt;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">exit</span> <span class="hljs-keyword">tab</span><br>    - Press R <span class="hljs-keyword">to</span> restart session<br>    - Press S <span class="hljs-keyword">to</span> save terminal output <span class="hljs-keyword">to</span> <span class="hljs-keyword">file</span><br></code></pre></td></tr></table></figure><p>å®è·µ3 - $@ å’Œ $* çš„åŒºåˆ«</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">å®šåˆ¶fatherè„šæœ¬<br>[root@localhost ~]# <span class="hljs-built_in">cat</span> father.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>: æ‰€æœ‰çš„å‚æ•° <span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>: æ‰€æœ‰çš„å‚æ•° $*&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;å°† $* å€¼ä¼ é€’ç»™ child-1.sh æ–‡ä»¶&#x27;</span><br>/bin/bash child-1.sh <span class="hljs-string">&quot;$*&quot;</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;å°† $@ å€¼ä¼ é€’ç»™ child-2.sh æ–‡ä»¶&#x27;</span><br>/bin/bash child-2.sh <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>å®šåˆ¶ä¸¤ä¸ªchildè„šæœ¬<br>[root@localhost ~]# <span class="hljs-built_in">cat</span> child-1.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>: è·å–æ‰€æœ‰çš„å‚æ•° <span class="hljs-variable">$1</span>&quot;</span><br><br>[root@localhost ~]# <span class="hljs-built_in">cat</span> child-2.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>: è·å–æ‰€æœ‰çš„å‚æ•° <span class="hljs-variable">$1</span>&quot;</span><br>æ‰§è¡Œ father.sh è„šæœ¬<br>[root@localhost ~]# /bin/bash father.sh 1 2 3<br>father.sh: æ‰€æœ‰çš„å‚æ•° 1 2 3<br>father.sh: æ‰€æœ‰çš„å‚æ•° 1 2 3<br>å°† $* å€¼ä¼ é€’ç»™ child-1.sh æ–‡ä»¶<br>child-1.sh: è·å–æ‰€æœ‰çš„å‚æ•° 1 2 3<br>å°† <span class="hljs-variable">$@</span> å€¼ä¼ é€’ç»™ child-2.sh æ–‡ä»¶<br>child-2.sh: è·å–æ‰€æœ‰çš„å‚æ•° 1<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h1 id="3-å†…å®¹æ ¼å¼åŒ–"><a href="#3-å†…å®¹æ ¼å¼åŒ–" class="headerlink" title="3 å†…å®¹æ ¼å¼åŒ–"></a>3 å†…å®¹æ ¼å¼åŒ–</h1><h2 id="3-1-å¸¸ç”¨ç¬¦å·è§£è¯»"><a href="#3-1-å¸¸ç”¨ç¬¦å·è§£è¯»" class="headerlink" title="3.1 å¸¸ç”¨ç¬¦å·è§£è¯»"></a>3.1 å¸¸ç”¨ç¬¦å·è§£è¯»</h2><h3 id="3-1-1-ä¿¡æ¯ä¼ é€’"><a href="#3-1-1-ä¿¡æ¯ä¼ é€’" class="headerlink" title="3.1.1 ä¿¡æ¯ä¼ é€’"></a>3.1.1 ä¿¡æ¯ä¼ é€’</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» é‡å®šå‘ã€ç®¡é“ç¬¦ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>é‡å®šå‘</strong></p><p>é‡å®šå‘ç¬¦å·</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bnf">åœ¨shellè„šæœ¬ä¸­æœ‰ä¸¤ç±»å¸¸è§çš„é‡å®šå‘ç¬¦å·ï¼š<br>è¦†ç›–å¼é‡å®šå‘ï¼š<br>    &gt; è¡¨ç¤ºå°†ç¬¦å·å·¦ä¾§çš„å†…å®¹ï¼Œä»¥è¦†ç›–çš„æ–¹å¼è¾“å…¥åˆ°å³ä¾§æ–‡ä»¶ä¸­<br>    <span class="hljs-attribute">&lt; è¡¨ç¤ºå°†ç¬¦å·å³ä¾§çš„å†…å®¹ï¼Œä»¥è¦†ç›–çš„æ–¹å¼è¾“å…¥åˆ°å·¦ä¾§æ–‡ä»¶ä¸­</span><br><span class="hljs-attribute">è¿½åŠ å¼é‡å®šå‘ï¼š</span><br><span class="hljs-attribute">    &gt;</span>&gt; è¡¨ç¤ºå°†ç¬¦å·å·¦ä¾§çš„å†…å®¹ï¼Œä»¥è¿½åŠ çš„æ–¹å¼è¾“å…¥åˆ°å³ä¾§æ–‡ä»¶çš„æœ«å°¾è¡Œä¸­<br>    <span class="hljs-attribute">&lt;&lt; è¡¨ç¤ºå°†ç¬¦å·å³ä¾§çš„å†…å®¹ï¼Œä»¥è¿½åŠ çš„æ–¹å¼è¾“å…¥åˆ°å·¦ä¾§æ–‡ä»¶çš„æœ«å°¾è¡Œä¸­</span><br></code></pre></td></tr></table></figure><p>å®è·µ1 - è¦†ç›–å¼é‡å®šå‘</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æŸ¥çœ‹æ–‡ä»¶å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat file.txt</span><br>nihao<br><br>ä½¿ç”¨é‡å®šå‘ç¬¦å·ç»™æ–‡ä»¶ä¸­å¢åŠ å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo <span class="hljs-string">&quot;file1.txt&quot;</span> &gt; file.txt</span><br><br>å†æ¬¡æŸ¥çœ‹æ–‡ä»¶å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat file.txt</span><br>file1.txt<br></code></pre></td></tr></table></figure><p>å®è·µ2 - è¿½åŠ å¼é‡å®šå‘</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æŸ¥çœ‹æ–‡ä»¶å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat file.txt </span><br>file1.txt<br><br>ä½¿ç”¨é‡å®šå‘ç¬¦å·ç»™æ–‡ä»¶ä¸­å¢åŠ å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># echo <span class="hljs-string">&quot;file2.txt&quot;</span> &gt;&gt; file.txt </span><br><br>å†æ¬¡æŸ¥çœ‹æ–‡ä»¶å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat file.txt </span><br>file1.txt<br>file2.txt<br></code></pre></td></tr></table></figure><p><strong>ç®¡é“ç¬¦</strong></p><p>ç¬¦å·ç®€ä»‹</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-string">| è¿™ä¸ªå°±æ˜¯ç®¡é“ç¬¦ï¼Œå¸¸ç”¨äºå°†ä¸¤ä¸ªå‘½ä»¤éš”å¼€ï¼Œç„¶åå‘½ä»¤é—´(ä»å·¦å‘å³)ä¼ é€’ä¿¡æ¯ä½¿ç”¨çš„ã€‚</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ ¼å¼</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">å‘½ä»¤<span class="hljs-number">1</span> <span class="hljs-string">| å‘½ä»¤2</span><br>    ç®¡é“ç¬¦å·¦ä¾§å‘½ä»¤<span class="hljs-number">1</span> æ‰§è¡Œåçš„ç»“æœï¼Œä¼ é€’ç»™ç®¡é“ç¬¦å³ä¾§çš„å‘½ä»¤<span class="hljs-number">2</span>ä½¿ç”¨<br></code></pre></td></tr></table></figure><p>å®è·µ1 - ä¿¡æ¯çš„ä¼ é€’</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­çš„å…¨å±€å˜é‡<span class="hljs-keyword">SHELL</span><span class="language-bash"></span><br><span class="language-bash">[root@localhost ~]# <span class="hljs-built_in">env</span> | grep SHELL</span><br><span class="hljs-keyword">SHELL</span><span class="language-bash">=/bin/bash</span><br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="3-1-2-ç»ˆç«¯è¾“å‡º"><a href="#3-1-2-ç»ˆç«¯è¾“å‡º" class="headerlink" title="3.1.2  ç»ˆç«¯è¾“å‡º"></a>3.1.2  ç»ˆç«¯è¾“å‡º</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åå°æ‰§è¡Œã€ä¿¡æ¯ç¬¦å·ã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>åå°æ‰§è¡Œ</strong></p><p>ç®€ä»‹</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta">&amp; å°±æ˜¯å°†ä¸€ä¸ªå‘½ä»¤ä»å‰å°è½¬åˆ°åå°æ‰§è¡Œ,ä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š</span><br>    å‘½ä»¤ <span class="hljs-meta">&amp;</span><br></code></pre></td></tr></table></figure><p>ç®€å•æ¼”ç¤º</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vim">å‰å°æ‰§è¡Œä¼‘çœ å‘½ä»¤<br>[root@localhost ~]# <span class="hljs-keyword">sleep</span> <span class="hljs-number">4</span><br>ç•Œé¢å¡ä½<span class="hljs-number">4</span>ç§’åæ¶ˆå¤±<br><br>åå°æ‰§è¡Œä¼‘çœ å‘½ä»¤<br>[root@localhost ~]# <span class="hljs-keyword">sleep</span> <span class="hljs-number">10</span> &amp;<br>[<span class="hljs-number">1</span>] <span class="hljs-number">4198</span><br>[root@localhost ~]# <span class="hljs-keyword">ps</span> aux | <span class="hljs-keyword">grep</span> <span class="hljs-keyword">sleep</span><br>root       <span class="hljs-number">4198</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span>   <span class="hljs-number">9032</span>   <span class="hljs-number">808</span> <span class="hljs-keyword">pts</span>/<span class="hljs-number">17</span>   S    <span class="hljs-number">21</span>:<span class="hljs-number">58</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">sleep</span> <span class="hljs-number">10</span><br>root       <span class="hljs-number">4200</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">15964</span>   <span class="hljs-number">944</span> <span class="hljs-keyword">pts</span>/<span class="hljs-number">17</span>   S+   <span class="hljs-number">21</span>:<span class="hljs-number">58</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">grep</span> --color=auto <span class="hljs-keyword">sleep</span><br></code></pre></td></tr></table></figure><p><strong>ä¿¡æ¯ç¬¦å·</strong></p><p>ä¿¡æ¯ç®€ä»‹</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>è¡¨ç¤ºæ­£ç¡®è¾“å‡ºçš„ä¿¡æ¯<br><span class="hljs-symbol">2 </span>è¡¨ç¤ºé”™è¯¯è¾“å‡ºçš„ä¿¡æ¯<br><span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> ä»£è¡¨æ‰€æœ‰è¾“å‡ºçš„ä¿¡æ¯,ä¹Ÿå¯ä»¥ç®€å†™ä¸º <span class="hljs-string">&quot;&amp;&gt;&quot;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹1 - ç¬¦å·æ¼”ç¤º</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">æ ‡å‡†æ­£ç¡®è¾“å‡ºé‡å®šå‘åˆ°zhengqueæ–‡ä»¶<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat nihao.txt 1&gt;&gt; zhengque </span><br><br>æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°errfileæ–‡ä»¶<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># dsfadsfadsfa 2&gt;&gt; errfile</span><br></code></pre></td></tr></table></figure><p>å®ä¾‹2 - ç»¼åˆæ¼”ç»ƒ</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs autoit">è„šæœ¬æ–‡ä»¶å†…å®¹<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat ceshi.sh</span><br><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-meta"># è¾“å‡ºæ­£ç¡®ä¿¡æ¯</span><br>echo <span class="hljs-string">&#x27;ä¸‹ä¸€æ¡é”™è¯¯å‘½ä»¤&#x27;</span><br><span class="hljs-meta"># æ‰§è¡Œé”™è¯¯å‘½ä»¤ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯</span><br>dsfsafsafdsa<br><br>è„šæœ¬æ‰§è¡Œæ•ˆæœ<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># /bin/bash ceshi.sh</span><br>ä¸‹ä¸€æ¡é”™è¯¯å‘½ä»¤<br>ceshi.sh:è¡Œ<span class="hljs-number">5</span>: dsfsafsafdsa: æœªæ‰¾åˆ°å‘½ä»¤<br><span class="hljs-number">1</span> å’Œ <span class="hljs-number">2</span> ç»¼åˆæ¼”ç»ƒ<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># /bin/bash ceshi.sh 1&gt;&gt; ceshi-ok 2&gt;&gt; ceshi-err</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat ceshi-ok</span><br>ä¸‹ä¸€æ¡é”™è¯¯å‘½ä»¤<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat ceshi-err</span><br>ceshi.sh:è¡Œ<span class="hljs-number">5</span>: dsfsafsafdsa: æœªæ‰¾åˆ°å‘½ä»¤<br>å…¨éƒ¨ä¿¡æ¯æ¼”ç»ƒ<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># /bin/bash ceshi.sh &gt;&gt; ceshi-all 2&gt;&amp;1</span><br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># cat ceshi-all</span><br>ä¸‹ä¸€æ¡é”™è¯¯å‘½ä»¤<br>ceshi.sh:è¡Œ<span class="hljs-number">5</span>: dsfsafsafdsa: æœªæ‰¾åˆ°å‘½ä»¤<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="3-2-è¾“å…¥æ ¼å¼åŒ–"><a href="#3-2-è¾“å…¥æ ¼å¼åŒ–" class="headerlink" title="3.2 è¾“å…¥æ ¼å¼åŒ–"></a>3.2 è¾“å…¥æ ¼å¼åŒ–</h2><h3 id="3-2-1-EOFåŸç†"><a href="#3-2-1-EOFåŸç†" class="headerlink" title="3.2.1 EOFåŸç†"></a>3.2.1 EOFåŸç†</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» åŸºç¡€çŸ¥è¯†ã€ç®€å•å®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>åŸºç¡€çŸ¥è¯†</strong></p><p>åœºæ™¯éœ€æ±‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">åœ¨è¿ç»´å²—ä½ä¸­ï¼Œæœ‰éå¸¸å¤šçš„åœºæ™¯éœ€è¦æˆ‘ä»¬åœ¨è„šæœ¬ä¸­ç¼–å†™åº”ç”¨è½¯ä»¶çš„é…ç½®æ–‡ä»¶ã€‚åœ¨è¿™äº›åº”ç”¨è½¯ä»¶çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œç»å¸¸æºå¸¦å¤§é‡çš„æ ¼å¼ï¼Œå°¤å…¶æ˜¯æºå¸¦ç©ºæ ¼çš„å±‚çº§æ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçš„ç¼–å†™å¥½æ ‡å‡†çš„é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸€æ—¦æ¶‰åŠåˆ°åœºæ™¯ä¿¡æ¯çš„åŠ¨æ€åŒ–è°ƒæ•´ï¼Œå›ºå®šå¥½çš„é…ç½®æ–‡ä»¶å°±ä¸å¤ªé€‚åˆäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•èƒ½å¤Ÿå®ç°æ•´ä¸ªåŠ¨æ€çš„æ ¼å¼åŒ–éœ€æ±‚ã€‚<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">åœ¨<span class="hljs-built_in">shell</span>ç¼–ç¨‹ä¸­ï¼Œ<span class="hljs-string">&quot;EOFâ€é€šå¸¸ä¸&quot;</span>&lt;&lt;â€ç»“åˆä½¿ç”¨ï¼Œ<span class="hljs-string">&quot;&lt;&lt;EOFâ€è¡¨ç¤ºåç»­çš„è¾“å…¥ä½œä¸ºå­å‘½ä»¤æˆ–å­shellçš„è¾“å…¥ï¼Œç›´åˆ°é‡åˆ°&quot;</span><span class="hljs-literal">EOF</span>â€ï¼Œå†æ¬¡è¿”å›åˆ°ä¸»è°ƒç”¨<span class="hljs-built_in">shell</span>ï¼Œå¯å°†å…¶ç†è§£ä¸ºåˆ†ç•Œç¬¦ï¼ˆdelimiterï¼‰ã€‚<br>æ‰€è°“çš„ <span class="hljs-literal">EOF</span>ï¼Œå°±æ˜¯End <span class="hljs-keyword">of</span> <span class="hljs-built_in">file</span>çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ç§è‡ªå®šä¹‰çš„æ–‡ä»¶å†…å®¹ç»ˆæ­¢ç¬¦ã€‚<br>æ—¢ç„¶æ˜¯åˆ†ç•Œç¬¦ï¼Œé‚£ä¹ˆå½¢å¼è‡ªç„¶ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™é‡Œå¯ä»¥å°†â€<span class="hljs-literal">EOF</span><span class="hljs-string">&quot;å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ï¼Œä½†æ˜¯å‰åçš„â€EOF&quot;</span>å¿…é¡»æˆå¯¹å‡ºç°ä¸”ä¸èƒ½å’Œ<span class="hljs-built_in">shell</span>å‘½ä»¤å†²çªã€‚å…¶ä½¿ç”¨å½¢å¼å¦‚ä¸‹ï¼š<br></code></pre></td></tr></table></figure><p>è¯­æ³•æ ¼å¼</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">äº¤äº’å¼ç¨‹åº &lt;&lt; <span class="hljs-literal">EOF</span><br>command1<br>command2<br>...<br><span class="hljs-literal">EOF</span><br>æ³¨æ„ï¼š<br>    æœ€åçš„<span class="hljs-string">&quot;EOF&quot;</span>å¿…é¡»å•ç‹¬å ä¸€è¡Œï¼Œè€Œä¸”å¿…é¡»é¡¶æ ¼å†™ï¼Œå¦‚æœä¸æƒ³å—åˆ°å¦‚æ­¤é™åˆ¶çš„è¯ï¼Œä½¿ç”¨&lt;&lt;-ç¬¦å·<br>        &lt;&lt;- çš„ä½œç”¨æ˜¯è‡ªåŠ¨å»é™¤æœ€åä¸€ä¸ª<span class="hljs-literal">EOF</span>å‰é¢çš„åˆ¶è¡¨ç¬¦\tã€æ³¨æ„ï¼Œå¯¹äºç©ºæ ¼æ— æ•ˆã€‘<br>    å‰åä¸¤ä¸ª<span class="hljs-literal">EOF</span>å¯ä»¥æ˜¯ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚aaaï¼Œåªè¦å‰åä¸¤ä¸ªè¾¹ç•Œå†…å®¹ä¸€è‡´å³å¯ã€‚<br>    <span class="hljs-string">&quot;EOF&quot;</span>ä¸­é—´çš„å†…å®¹å°†ä»¥æ ‡å‡†è¾“å…¥çš„å½¢å¼è¾“å…¥åˆ°â€äº¤äº’å¼ç¨‹åº<span class="hljs-string">&quot;ï¼Œå½“shellçœ‹åˆ°â€&lt;&lt;&quot;</span>çŸ¥é“å…¶åé¢è¾“å…¥çš„åˆ†ç•Œç¬¦ï¼Œå½“<span class="hljs-built_in">shell</span>å†æ¬¡çœ‹åˆ°åˆ†ç•Œç¬¦æ—¶ï¼Œä¸¤ä¸ªåˆ†ç•Œç¬¦ä¸­é—´çš„éƒ¨åˆ†å°†ä½œä¸ºæ ‡å‡†è¾“å…¥ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç®€å•å®è·µ</strong></p><p>å®è·µ1 - EOFä¿¡æ¯æ ¼å¼åŒ–è¾“å‡º</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">ç»ˆç«¯æ–¹å¼æ¥æ”¶å¤šè¡Œä¿¡æ¯ï¼Œç„¶åäº¤ä¸ªä¸€ä¸ªå‘½ä»¤<br>[root@localhost ~]# cat &lt;&lt; EOF<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-title class_">Dear</span> <span class="hljs-title class_">Wang</span>:</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">  jian dao ni hen gaoxing.</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">danshi wo bu xihuan ni.</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">zaijian.</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">               zhaoliu</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">               <span class="hljs-number">2100</span>-<span class="hljs-number">11</span>-<span class="hljs-number">11</span></span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-variable constant_">EOF</span></span><br>Dear Wang:<br>  jian dao ni hen gaoxing.<br>danshi wo bu xihuan ni.<br>zaijian.<br>               zhaoliu<br>               2100-11-11<br></code></pre></td></tr></table></figure><p>å®è·µ2 - è„šæœ¬ä¸­å®è·µEOF</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç¼–å†™è¯·å‡æ¡<br>[root@localhost ~]# <span class="hljs-built_in">cat</span> qingjiatiao.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># EOFæ¼”ç¤ºè¯·å‡æ¡ç¤ºä¾‹</span><br><br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">                        è¯·å‡æ¡</span><br><span class="hljs-string">ç‹è€å¸ˆ:</span><br><span class="hljs-string">    æˆ‘å› æ‚£æ€¥æ€§ç©ºè…¹ç—…ï¼Œç°åœ¨éœ€è¦åˆ°ç«é”…ç†ç–—ï¼Œä¸èƒ½åˆ°å­¦æ ¡ä¸Šè¯¾ï¼Œ</span><br><span class="hljs-string">è¯·å‡†å‡ä¸€å¤©ã€‚æ³è¯·æ‰¹å‡†ï¼</span><br><span class="hljs-string">                                             è¯·å‡äººï¼šæå››</span><br><span class="hljs-string">                                                 6æœˆ1æ—¥</span><br><span class="hljs-string">EOF</span><br><br>æ‰§è¡Œè„šæœ¬ç¤ºä¾‹<br>[root@localhost ~]# /bin/bash qingjiatiao.sh<br>                        è¯·å‡æ¡<br>ç‹è€å¸ˆ:<br>    æˆ‘å› æ‚£æ€¥æ€§ç©ºè…¹ç—…ï¼Œç°åœ¨éœ€è¦åˆ°ç«é”…ç†ç–—ï¼Œä¸èƒ½åˆ°å­¦æ ¡ä¸Šè¯¾ï¼Œ<br>è¯·å‡†å‡ä¸€å¤©ã€‚æ³è¯·æ‰¹å‡†ï¼<br>                                             è¯·å‡äººï¼šæå››<br>                                                 6æœˆ1æ—¥<br></code></pre></td></tr></table></figure><p>å®è·µ3 - æœ«å°¾EOFå‰é¢æœ‰åˆ¶è¡¨ç¬¦</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">ä¿®æ”¹è„šæœ¬<br>[root<span class="hljs-meta">@localhost</span> ~]<span class="hljs-comment"># cat qingjiatiao.sh</span><br>...<br><span class="hljs-comment"># EOFå‰é¢æœ‰ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼Œä¹Ÿå°±æ˜¯ Tabé”®æ•ˆæœ</span><br>    EOF<br>    <br>æ‰§è¡Œè„šæœ¬åæ•ˆæœ<br>[root<span class="hljs-meta">@localhost</span> ~]<span class="hljs-comment"># /bin/bash qingjiatiao.sh</span><br>qingjiatiao.sh:è¡Œ11: è­¦å‘Š:ç«‹å³æ–‡æ¡£åœ¨ç¬¬ 4 è¡Œè¢«æ–‡ä»¶ç»“æŸç¬¦åˆ†éš” (éœ€è¦ `EOF&#x27;)<br>...<br>ä¿®æ”¹è„šæœ¬æ•ˆæœ<br>[root<span class="hljs-meta">@localhost</span> ~]<span class="hljs-comment"># cat qingjiatiao.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># EOFæ¼”ç¤ºè¯·å‡æ¡ç¤ºä¾‹ï¼Œå°†&lt;&lt; æ›¿æ¢ä¸º &lt;&lt;-</span><br><br>cat <span class="hljs-variable">&lt;&lt;- EOF</span><br><span class="hljs-variable">                        è¯·å‡æ¡</span><br><span class="hljs-variable">ç‹è€å¸ˆ:</span><br><span class="hljs-variable">    æˆ‘å› æ‚£æ€¥æ€§ç©ºè…¹ç—…ï¼Œç°åœ¨éœ€è¦åˆ°ç«é”…ç†ç–—ï¼Œä¸èƒ½åˆ°å­¦æ ¡ä¸Šè¯¾ï¼Œ</span><br><span class="hljs-variable">è¯·å‡†å‡ä¸€å¤©ã€‚æ³è¯·æ‰¹å‡†ï¼</span><br><span class="hljs-variable">                                             è¯·å‡äººï¼šæå››</span><br><span class="hljs-variable">                                                 6æœˆ1æ—¥</span><br><span class="hljs-variable">        EOF</span><br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/image-20220609002516145.png" alt="image-20220609002516145"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autoit">è„šæœ¬æ‰§è¡Œåçš„æ•ˆæœ<br>[root<span class="hljs-symbol">@localhost</span> ~]<span class="hljs-meta"># /bin/bash qingjiatiao.sh</span><br>                        è¯·å‡æ¡<br>ç‹è€å¸ˆ:<br>    æˆ‘å› æ‚£æ€¥æ€§ç©ºè…¹ç—…ï¼Œç°åœ¨éœ€è¦åˆ°ç«é”…ç†ç–—ï¼Œä¸èƒ½åˆ°å­¦æ ¡ä¸Šè¯¾ï¼Œ<br>è¯·å‡†å‡ä¸€å¤©ã€‚æ³è¯·æ‰¹å‡†ï¼<br>                                             è¯·å‡äººï¼šæå››<br>                                                 <span class="hljs-number">6</span>æœˆ<span class="hljs-number">1</span>æ—¥<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong> </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h3 id="3-2-2-æ–‡æœ¬è¾“å…¥"><a href="#3-2-2-æ–‡æœ¬è¾“å…¥" class="headerlink" title="3.2.2 æ–‡æœ¬è¾“å…¥"></a>3.2.2 æ–‡æœ¬è¾“å…¥</h3><p>å­¦ä¹ ç›®æ ‡</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä» catå®è·µã€teeå®è·µã€å°ç»“ ä¸‰ä¸ªæ–¹é¢æ¥å­¦ä¹ ã€‚</p><p><strong>catå®è·µ</strong></p><p>å®ç°å¤šè¡Œæ–‡ä»¶çš„è¾“å‡º</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">è¯­æ³•æ ¼å¼<br>    cat &gt; <span class="hljs-built_in">file</span>  &lt;&lt; <span class="hljs-literal">EOF</span><br>    ...<br>    <span class="hljs-literal">EOF</span><br>æ³¨æ„ï¼š<br>    &gt; ä»£è¡¨è¦†ç›–å¼å¢åŠ å†…å®¹åˆ° <span class="hljs-built_in">file</span> æ–‡ä»¶<br>    &gt;&gt; ä»£è¡¨è¿½åŠ å¼å¢åŠ å†…å®¹åˆ° <span class="hljs-built_in">file</span> æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>ç®€å•ç¤ºä¾‹</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">å®šåˆ¶ä¸»æœºè§£æåä¿¡æ¯<br><span class="hljs-string">[root@localhost ~]</span># cat &gt;&gt; hosts &lt;&lt; EOF<br><span class="hljs-number">10.0.0.13</span> k8s-master<br><span class="hljs-number">10.0.0.14</span> k8s-node1<br><span class="hljs-number">10.0.0.15</span> k8s-node2<br>EOF<br><br>æ¼”ç¤ºæ•ˆæœ<br><span class="hljs-string">[root@localhost ~]</span># cat hosts<br><span class="hljs-number">10.0.0.13</span> k8s-master<br><span class="hljs-number">10.0.0.14</span> k8s-node1<br><span class="hljs-number">10.0.0.15</span> k8s-node2<br></code></pre></td></tr></table></figure><p>å®è·µ1- å®šåˆ¶nginxé…ç½®æ–‡ä»¶</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs perl">å®šåˆ¶nginxé…ç½®æ–‡ä»¶çš„è„šæœ¬<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># cat define-nginx-conf.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># å®šåˆ¶nginxçš„é…ç½®æ–‡ä»¶</span><br><br><span class="hljs-comment"># å®šåˆ¶é…ç½®æ–‡ä»¶ç›®å½•</span><br>NGINX_DIR=<span class="hljs-string">&#x27;/data/server/conf&#x27;</span><br>NGINX_CONF=<span class="hljs-string">&#x27;nginx.conf&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºåŸºæœ¬ç›®å½•</span><br><span class="hljs-keyword">mkdir</span> -p <span class="hljs-variable">$NGINX_DIR</span><br><br><span class="hljs-comment"># å®šåˆ¶nginxé…ç½®æ–‡ä»¶</span><br>cat &gt; <span class="hljs-variable">$NGINX_DIR</span>/<span class="hljs-variable">$NGINX_CONF</span> &lt;&lt; EOF<br>server &#123;<br>  <span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>  server_name www.example.com<br>  <span class="hljs-keyword">listen</span> / &#123;<br>     proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span>:<span class="hljs-number">10086</span>;<br>  &#125;<br>&#125;<br>EOF<br>æ‰§è¡Œæ–‡ä»¶åçš„æ•ˆæœ<br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># /bin/bash define-nginx-conf.sh</span><br>[root<span class="hljs-variable">@localhost</span> ~]<span class="hljs-comment"># cat /data/server/conf/nginx.conf</span><br>server &#123;<br>  <span class="hljs-keyword">listen</span> <span class="hljs-number">80</span>;<br>  server_name www.example.com<br>  <span class="hljs-keyword">listen</span> / &#123;<br>     proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">10.0</span>.<span class="hljs-number">0.12</span>:<span class="hljs-number">10086</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>teeå®è·µ</strong></p><p>åŠŸèƒ½ç®€ä»‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tee</span>å‘½ä»¤è¯»å–æ ‡å‡†è¾“å…¥ï¼ŒæŠŠè¿™äº›å†…å®¹åŒæ—¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºå’Œï¼ˆå¤šä¸ªï¼‰æ–‡ä»¶ä¸­ï¼Œ<span class="hljs-built_in">tee</span>å‘½ä»¤å¯ä»¥é‡å®šå‘æ ‡å‡†è¾“å‡ºåˆ°å¤šä¸ªæ–‡ä»¶ã€‚è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ä½¿ç”¨ç®¡é“çº¿æ—¶ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†é”™è¯¯è¾“å‡ºä¸ä¼šè¢«<span class="hljs-built_in">tee</span>è¯»å–ã€‚<br></code></pre></td></tr></table></figure><p>å‘½ä»¤æ ¼å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">æ ·å¼1ï¼šåªè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º<br>    <span class="hljs-built_in">tee</span><br>æ ·å¼2ï¼šè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºçš„åŒæ—¶ï¼Œä¿å­˜åˆ°æ–‡ä»¶fileä¸­<br>    <span class="hljs-built_in">tee</span> file<br>æ ·å¼3ï¼šè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºçš„åŒæ—¶ï¼Œè¿½åŠ åˆ°æ–‡ä»¶fileä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼›å¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™è¿½åŠ ã€‚<br>    <span class="hljs-built_in">tee</span> -a file<br>    <span class="hljs-built_in">tee</span> host2 &lt;&lt;- <span class="hljs-string">EOF ... EOF</span><br>æ ·å¼4: è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸¤æ¬¡ã€‚<br>    <span class="hljs-built_in">tee</span> -<br>æ ·å¼5ï¼šè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸¤æ¬¡ï¼ŒåŒæ—¶ä¿å­˜åˆ°file1å’Œfile2ä¸­ã€‚<br>    <span class="hljs-built_in">tee</span> file1 file2 -<br></code></pre></td></tr></table></figure><p>ç®€å•æ¼”ç¤º</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs powershell">å®è·µ<span class="hljs-number">1</span> - ä»…è¾“å‡ºåˆ°å½“å‰å±å¹•<br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test | tee</span><br><span class="hljs-built_in">tee-test</span><br><br>å®è·µ<span class="hljs-number">2</span> - åŒæ—¶è¾“å‡ºåˆ°å±å¹•å’Œæ–‡ä»¶<br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test | tee tee-file</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat tee-file</span><br><span class="hljs-built_in">tee-test</span><br>å®è·µ<span class="hljs-number">3</span> - è¿½åŠ åˆ°å¯¹åº”çš„æ–‡ä»¶ä¸­<br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat tee-file</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test1 | tee tee-file</span><br><span class="hljs-built_in">tee-test1</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat tee-file</span><br><span class="hljs-built_in">tee-test1</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test2 | tee -a tee-file</span><br><span class="hljs-built_in">tee-test2</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat tee-file</span><br><span class="hljs-built_in">tee-test1</span><br><span class="hljs-built_in">tee-test2</span><br>å®è·µ<span class="hljs-number">4</span> - è¾“å‡ºå¤šæ¬¡ä¿¡æ¯<br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test | tee</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test | tee -</span><br><span class="hljs-built_in">tee-test</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test | tee - -</span><br><span class="hljs-built_in">tee-test</span><br><span class="hljs-built_in">tee-test</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test | tee - - -</span><br><span class="hljs-built_in">tee-test</span><br><span class="hljs-built_in">tee-test</span><br><span class="hljs-built_in">tee-test</span><br><span class="hljs-built_in">tee-test</span><br>å®è·µ<span class="hljs-number">5</span> - ä¿å­˜åˆ°å¤šä¸ªæ–‡ä»¶<br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># echo tee-test | tee file-1 file-2 file-3</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat file-1</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat file-2</span><br><span class="hljs-built_in">tee-test</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat file-3</span><br><span class="hljs-built_in">tee-test</span><br>å®è·µ<span class="hljs-number">6</span> - æ¥æ”¶å‘½ä»¤è¡Œå¤šè¡Œä¿¡æ¯ï¼ŒåŒæ—¶åœ¨æ–‡ä»¶å’Œå½“å‰ç»ˆç«¯æ˜¾ç¤º<br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># tee host2 &lt;&lt;- EOF</span><br>&gt; <span class="hljs-number">10.0</span>.<span class="hljs-number">0.13</span> k8s<span class="hljs-literal">-master</span><br>&gt; <span class="hljs-number">10.0</span>.<span class="hljs-number">0.14</span> k8s<span class="hljs-literal">-node1</span><br>&gt; <span class="hljs-number">10.0</span>.<span class="hljs-number">0.15</span> k8s<span class="hljs-literal">-node2</span><br>&gt; EOF<br><span class="hljs-number">10.0</span>.<span class="hljs-number">0.13</span> k8s<span class="hljs-literal">-master</span><br><span class="hljs-number">10.0</span>.<span class="hljs-number">0.14</span> k8s<span class="hljs-literal">-node1</span><br><span class="hljs-number">10.0</span>.<span class="hljs-number">0.15</span> k8s<span class="hljs-literal">-node2</span><br><br>æŸ¥çœ‹æ–‡ä»¶å†…å®¹<br>[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># cat host2</span><br><span class="hljs-number">10.0</span>.<span class="hljs-number">0.13</span> k8s<span class="hljs-literal">-master</span><br><span class="hljs-number">10.0</span>.<span class="hljs-number">0.14</span> k8s<span class="hljs-literal">-node1</span><br><span class="hljs-number">10.0</span>.<span class="hljs-number">0.15</span> k8s<span class="hljs-literal">-node2</span><br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹å®è·µ - kuberneteså‚æ•°é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">å®šåˆ¶kubernetesçš„ç½‘ç»œæ¨¡å—åŠ è½½<br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class="hljs-string">br_netfilter</span><br><span class="hljs-string">EOF</span><br><br>å®šåˆ¶kubernetesçš„æ•°æ®åŒ…å†…æ ¸å‚æ•°<br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br><span class="hljs-built_in">sudo</span> sysctl --system<br></code></pre></td></tr></table></figure><p><strong>å°ç»“</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>shell</category>
      
    </categories>
    
    
    <tags>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlä¸»ä»</title>
    <link href="/2025/07/07/Mysql%E4%B8%BB%E4%BB%8E/"/>
    <url>/2025/07/07/Mysql%E4%B8%BB%E4%BB%8E/</url>
    
    <content type="html"><![CDATA[<h2 id="1-MySQL-ä¸»ä»"><a href="#1-MySQL-ä¸»ä»" class="headerlink" title="1. MySQL ä¸»ä»"></a>1. MySQL ä¸»ä»</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯-MySQL-ä¸»ä»"><a href="#1-1-ä»€ä¹ˆæ˜¯-MySQL-ä¸»ä»" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ MySQL ä¸»ä» ?"></a>1.1 ä»€ä¹ˆæ˜¯ MySQL ä¸»ä» ?</h3><p>æ‰€è°“ MySQL ä¸»ä»ï¼Œå°±æ˜¯å»ºç«‹ä¸¤ä¸ªå®Œå…¨ä¸€æ ·çš„æ•°æ®åº“ï¼Œä¸€ä¸ªæ˜¯ä¸»åº“ï¼Œä¸€ä¸ªæ˜¯ä»åº“ï¼Œ<strong>ä¸»åº“å¯¹å¤–æä¾›è¯»å†™çš„æ“ä½œï¼Œä»åº“å¯¹å¤–æä¾›è¯»çš„æ“ä½œ</strong>ã€‚</p><p><img src="http://cdn.882227.xyz/dd2b3ec0fe2a4ee78ab814bb3793498a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p><h3 id="1-2-ä¸ºä»€ä¹ˆä½¿ç”¨-MySQL-ä¸»ä»"><a href="#1-2-ä¸ºä»€ä¹ˆä½¿ç”¨-MySQL-ä¸»ä»" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆä½¿ç”¨ MySQL ä¸»ä» ?"></a>1.2 ä¸ºä»€ä¹ˆä½¿ç”¨ MySQL ä¸»ä» ?</h3><p>å¯¹äºæ•°æ®åº“å•æœºéƒ¨ç½²ï¼Œåœ¨ 4 æ ¸ 8G çš„æœºå™¨ä¸Šè¿è¡Œ MySQL 5.7 æ—¶ï¼Œå¤§æ¦‚å¯ä»¥æ”¯æ’‘ 500 çš„ TPS å’Œ 10000 çš„ QPSï¼Œ<strong>å½“é‡åˆ°ä¸€äº›æ´»åŠ¨æ—¶ï¼ŒæŸ¥è¯¢æµé‡éª¤ç„¶ï¼Œå°±éœ€è¦è¿›è¡Œä¸»ä»åˆ†ç¦»ã€‚</strong></p><p>å¤§éƒ¨åˆ†ç³»ç»Ÿçš„è®¿é—®æ¨¡å‹æ˜¯è¯»å¤šå†™å°‘ï¼Œè¯»å†™è¯·æ±‚é‡çš„å·®è·å¯èƒ½è¾¾åˆ°å‡ ä¸ªæ•°é‡çº§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸»å¤šä»çš„æ–¹å¼ï¼Œ<strong>ä¸»åº“åªè´Ÿè´£å†™å…¥å’Œéƒ¨åˆ†æ ¸å¿ƒé€»è¾‘çš„æŸ¥è¯¢ï¼Œå¤šä¸ªä»åº“åªè´Ÿè´£æŸ¥è¯¢ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ï¼Œé™ä½ä¸»åº“å‹åŠ›ã€‚</strong></p><p>å½“ä¸»åº“å®•æœºæ—¶ï¼Œä»åº“å¯ä»¥åˆ‡æˆä¸»åº“ï¼Œä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ï¼Œç„¶åä¸»åº“ä¹Ÿå¯ä»¥åšæ•°æ®çš„å®¹ç¾å¤‡ä»½ï¼Œæ•´ä½“åœºæ™¯æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li><strong>è¯»å†™åˆ†ç¦»</strong>ï¼šä»åº“æä¾›æŸ¥è¯¢ï¼Œå‡å°‘ä¸»åº“å‹åŠ›ï¼Œæå‡æ€§èƒ½ï¼›</li><li><strong>é«˜å¯ç”¨</strong>ï¼šæ•…éšœæ—¶å¯åˆ‡æ¢ä»åº“ï¼Œä¿è¯æœåŠ¡é«˜å¯ç”¨ï¼›</li><li><strong>æ•°æ®å¤‡ä»½</strong>ï¼šæ•°æ®å¤‡ä»½åˆ°ä»åº“ï¼Œé˜²æ­¢æœåŠ¡å™¨å®•æœºå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</li></ul><h2 id="2-ä¸»ä»å¤åˆ¶"><a href="#2-ä¸»ä»å¤åˆ¶" class="headerlink" title="2. ä¸»ä»å¤åˆ¶"></a>2. ä¸»ä»å¤åˆ¶</h2><h3 id="2-1-ä¸»ä»å¤åˆ¶åŸç†"><a href="#2-1-ä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="2.1 ä¸»ä»å¤åˆ¶åŸç†"></a>2.1 ä¸»ä»å¤åˆ¶åŸç†</h3><p>MySQL çš„ä¸»ä»å¤åˆ¶æ˜¯ä¾èµ–äº binlogï¼Œä¹Ÿå°±æ˜¯è®°å½• MySQL ä¸Šçš„æ‰€æœ‰å˜åŒ–å¹¶ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸ŠäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚</p><p>ä¸»ä»å¤åˆ¶å°±æ˜¯å°† binlog ä¸­çš„æ•°æ®ä»ä¸»åº“ä¼ è¾“åˆ°ä»åº“ä¸Šï¼Œä¸€èˆ¬è¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œå³ä¸»åº“ä¸Šçš„æ“ä½œä¸ä¼šç­‰å¾… binlog åŒæ­¥åœ°å®Œæˆã€‚</p><p><img src="http://cdn.882227.xyz/453ed3ddf7a343d2a7f17abeec833e08~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p><p>è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>ä¸»åº“å†™ binlog</strong>ï¼šä¸»åº“çš„æ›´æ–° SQL(updateã€insertã€delete) è¢«å†™åˆ° binlogï¼›</li><li><strong>ä¸»åº“å‘é€ binlog</strong>ï¼šä¸»åº“åˆ›å»ºä¸€ä¸ª log dump çº¿ç¨‹æ¥å‘é€ binlog ç»™ä»åº“ï¼›</li><li><strong>ä»åº“å†™ relay log</strong>ï¼šä»åº“åœ¨è¿æ¥åˆ°ä¸»èŠ‚ç‚¹æ—¶ä¼šåˆ›å»ºä¸€ä¸ª IO çº¿ç¨‹ï¼Œä»¥è¯·æ±‚ä¸»åº“æ›´æ–°çš„ binlogï¼Œå¹¶ä¸”æŠŠæ¥æ”¶åˆ°çš„ binlog ä¿¡æ¯å†™å…¥ä¸€ä¸ªå«åš relay log çš„æ—¥å¿—æ–‡ä»¶ï¼›</li><li><strong>ä»åº“å›æ”¾</strong>ï¼šä»åº“è¿˜ä¼šåˆ›å»ºä¸€ä¸ª SQL çº¿ç¨‹è¯»å– relay log ä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨ä»åº“ä¸­åšå›æ”¾ï¼Œæœ€ç»ˆå®ç°ä¸»ä»çš„ä¸€è‡´æ€§ã€‚</li></ol><h3 id="2-2-å¦‚ä½•ä¿è¯ä¸»ä»ä¸€è‡´"><a href="#2-2-å¦‚ä½•ä¿è¯ä¸»ä»ä¸€è‡´" class="headerlink" title="2.2 å¦‚ä½•ä¿è¯ä¸»ä»ä¸€è‡´"></a>2.2 å¦‚ä½•ä¿è¯ä¸»ä»ä¸€è‡´</h3><p>å½“ä¸»åº“å’Œä»åº“æ•°æ®åŒæ­¥æ—¶ï¼Œçªç„¶ä¸­æ–­æ€ä¹ˆåŠï¼Ÿå› ä¸ºä¸»åº“ä¸ä»åº“ä¹‹é—´ç»´æŒäº†ä¸€ä¸ªé•¿é“¾æ¥ï¼Œä¸»åº“å†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨æœåŠ¡äºä»åº“çš„è¿™ä¸ªé•¿é“¾æ¥ã€‚</p><p>å¯¹äºä¸‹é¢çš„æƒ…å†µï¼Œå‡å¦‚ä¸»åº“æ‰§è¡Œå¦‚ä¸‹ SQLï¼Œå…¶ä¸­ a å’Œ create_time éƒ½æ˜¯ç´¢å¼•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> a <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;666&#x27;</span> <span class="hljs-keyword">and</span> create_time<span class="hljs-operator">&lt;</span><span class="hljs-string">&#x27;2022-03-01&#x27;</span> limit <span class="hljs-number">1</span>;<br>å¤åˆ¶ä»£ç <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ•°æ®é€‰æ‹©äº† a ç´¢å¼•å’Œé€‰æ‹© create_time ç´¢å¼•ï¼Œæœ€å limit 1 å‡ºæ¥çš„æ•°æ®ä¸€èˆ¬æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>æ‰€ä»¥å°±ä¼šå­˜åœ¨è¿™ç§æƒ…å†µï¼šåœ¨ binlog &#x3D; statement æ ¼å¼æ—¶ï¼Œä¸»åº“åœ¨æ‰§è¡Œè¿™æ¡ SQL æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ç´¢å¼• aï¼Œè€Œä»åº“åœ¨æ‰§è¡Œè¿™æ¡ SQL æ—¶ï¼Œä½¿ç”¨äº†ç´¢å¼• create_timeï¼Œæœ€åä¸»ä»æ•°æ®ä¸ä¸€è‡´äº†ã€‚</p><p><strong>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</strong></p><p>å¯ä»¥æŠŠ binlog æ ¼å¼ä¿®æ”¹ä¸º rowï¼Œrow æ ¼å¼çš„ binlog æ—¥å¿—è®°å½•çš„ä¸æ˜¯ SQL åŸæ–‡ï¼Œè€Œæ˜¯ä¸¤ä¸ª event:Table_map å’Œ Delete_rowsã€‚</p><p>Table_map event è¯´æ˜è¦æ“ä½œçš„è¡¨ï¼ŒDelete_rows eventç”¨äºå®šä¹‰è¦åˆ é™¤çš„è¡Œä¸ºï¼Œè®°å½•åˆ é™¤çš„å…·ä½“è¡Œæ•°ã€‚<strong>row æ ¼å¼çš„ binlog è®°å½•çš„å°±æ˜¯è¦åˆ é™¤çš„ä¸»é”® ID ä¿¡æ¯ï¼Œå› æ­¤ä¸ä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</strong></p><p>ä½†æ˜¯å¦‚æœ SQL åˆ é™¤ 10 ä¸‡è¡Œæ•°æ®ï¼Œä½¿ç”¨ row æ ¼å¼å°±ä¼šå¾ˆå ç©ºé—´ï¼Œ10 ä¸‡æ¡æ•°æ®éƒ½åœ¨ binlog é‡Œé¢ï¼Œå†™ binlog çš„æ—¶å€™ä¹Ÿå¾ˆè€— IOã€‚ä½†æ˜¯ statement æ ¼å¼çš„ binlog å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>è®¾è®¡ MySQL çš„å¤§å”æƒ³äº†ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œmixed æ ¼å¼çš„ binlogï¼Œå…¶å®å°±æ˜¯ row å’Œ statement æ ¼å¼æ··åˆä½¿ç”¨ï¼Œ<strong>å½“ MySQL åˆ¤æ–­å¯èƒ½æ•°æ®ä¸ä¸€è‡´æ—¶ï¼Œå°±ç”¨ row æ ¼å¼ï¼Œå¦åˆ™ä½¿ç”¨å°±ç”¨ statement æ ¼å¼ã€‚</strong></p><h2 id="3-ä¸»ä»å»¶è¿Ÿ"><a href="#3-ä¸»ä»å»¶è¿Ÿ" class="headerlink" title="3. ä¸»ä»å»¶è¿Ÿ"></a>3. ä¸»ä»å»¶è¿Ÿ</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬é‡åˆ°ä»æ•°æ®åº“ä¸­è·å–ä¸åˆ°ä¿¡æ¯çš„è¯¡å¼‚é—®é¢˜æ—¶ï¼Œä¼šçº ç»“äºä»£ç ä¸­æ˜¯å¦æœ‰ä¸€äº›é€»è¾‘ä¼šæŠŠä¹‹å‰å†™å…¥çš„å†…å®¹åˆ é™¤ï¼Œä½†æ˜¯ä½ åˆä¼šå‘ç°ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´å†å»æŸ¥è¯¢æ—¶åˆå¯ä»¥è¯»åˆ°æ•°æ®äº†ï¼Œè¿™åŸºæœ¬ä¸Šå°±æ˜¯ä¸»ä»å»¶è¿Ÿåœ¨ä½œæ€ªã€‚</p><p>ä¸»ä»å»¶è¿Ÿï¼Œå…¶å®å°±æ˜¯â€œä»åº“å›æ”¾â€ å®Œæˆçš„æ—¶é—´ï¼Œä¸ â€œä¸»åº“å†™ binlogâ€ å®Œæˆæ—¶é—´çš„å·®å€¼ï¼Œ<strong>ä¼šå¯¼è‡´ä»åº“æŸ¥è¯¢çš„æ•°æ®ï¼Œå’Œä¸»åº“çš„ä¸ä¸€è‡´</strong>ã€‚</p><h3 id="3-1-ä¸»ä»å»¶è¿ŸåŸç†"><a href="#3-1-ä¸»ä»å»¶è¿ŸåŸç†" class="headerlink" title="3.1 ä¸»ä»å»¶è¿ŸåŸç†"></a>3.1 ä¸»ä»å»¶è¿ŸåŸç†</h3><p>è°ˆåˆ° MySQL æ•°æ®åº“ä¸»ä»åŒæ­¥å»¶è¿ŸåŸç†ï¼Œå¾—ä» MySQL çš„ä¸»ä»å¤åˆ¶åŸç†è¯´èµ·ï¼š</p><ul><li>MySQL çš„ä¸»ä»å¤åˆ¶éƒ½æ˜¯å•çº¿ç¨‹çš„æ“ä½œï¼Œä¸»åº“å¯¹æ‰€æœ‰ DDL å’Œ DML äº§ç”Ÿ binlogï¼Œbinlog æ˜¯é¡ºåºå†™ï¼Œæ‰€ä»¥æ•ˆç‡å¾ˆé«˜ï¼›</li><li>Slave çš„ Slave_IO_Running çº¿ç¨‹ä¼šåˆ°ä¸»åº“å–æ—¥å¿—ï¼Œæ”¾å…¥ relay logï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒé«˜ï¼›</li><li>Slave çš„ Slave_SQL_Running çº¿ç¨‹å°†ä¸»åº“çš„ DDL å’Œ DML æ“ä½œéƒ½åœ¨ Slave å®æ–½ï¼Œ<strong>DML å’Œ DDL çš„ IO æ“ä½œæ˜¯éšæœºçš„ï¼Œä¸æ˜¯é¡ºåºçš„</strong>ï¼Œå› æ­¤æˆæœ¬ä¼šå¾ˆé«˜ï¼Œè¿˜å¯èƒ½æ˜¯ Slave ä¸Šçš„å…¶ä»–æŸ¥è¯¢äº§ç”Ÿ lock äº‰ç”¨ï¼Œç”±äº Slave_SQL_Running ä¹Ÿæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ä¸€ä¸ª DDL å¡ä½äº†ï¼Œéœ€è¦æ‰§è¡Œ 10 åˆ†é’Ÿï¼Œé‚£ä¹ˆæ‰€æœ‰ä¹‹åçš„ DDL ä¼šç­‰å¾…è¿™ä¸ª DDL æ‰§è¡Œå®Œæ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œè¿™å°±å¯¼è‡´äº†å»¶æ—¶ã€‚</li></ul><p><strong>æ€»ç»“ä¸€ä¸‹ä¸»ä»å»¶è¿Ÿçš„ä¸»è¦åŸå› </strong>ï¼šä¸»ä»å»¶è¿Ÿä¸»è¦æ˜¯å‡ºç°åœ¨ â€œrelay log å›æ”¾â€ è¿™ä¸€æ­¥ï¼Œå½“ä¸»åº“çš„ TPS å¹¶å‘è¾ƒé«˜ï¼Œäº§ç”Ÿçš„ DDL æ•°é‡è¶…è¿‡ä»åº“ä¸€ä¸ª SQL çº¿ç¨‹æ‰€èƒ½æ‰¿å—çš„èŒƒå›´ï¼Œé‚£ä¹ˆå»¶æ—¶å°±äº§ç”Ÿäº†ï¼Œå½“ç„¶è¿˜æœ‰å°±æ˜¯å¯èƒ½ä¸ä»åº“çš„å¤§å‹ query è¯­å¥äº§ç”Ÿäº†é”ç­‰å¾…ã€‚</p><h3 id="3-2-ä¸»ä»å»¶è¿Ÿæƒ…å†µ"><a href="#3-2-ä¸»ä»å»¶è¿Ÿæƒ…å†µ" class="headerlink" title="3.2 ä¸»ä»å»¶è¿Ÿæƒ…å†µ"></a>3.2 ä¸»ä»å»¶è¿Ÿæƒ…å†µ</h3><ul><li><strong>ä»åº“æœºå™¨æ€§èƒ½</strong>ï¼šä»åº“æœºå™¨æ¯”ä¸»åº“çš„æœºå™¨æ€§èƒ½å·®ï¼Œåªéœ€é€‰æ‹©ä¸»ä»åº“ä¸€æ ·è§„æ ¼çš„æœºå™¨å°±å¥½ã€‚</li><li><strong>ä»åº“å‹åŠ›å¤§</strong>ï¼šå¯ä»¥æäº†ä¸€ä¸»å¤šä»çš„æ¶æ„ï¼Œè¿˜å¯ä»¥æŠŠ binlog æ¥å…¥åˆ° Hadoop è¿™ç±»ç³»ç»Ÿï¼Œè®©å®ƒä»¬æä¾›æŸ¥è¯¢çš„èƒ½åŠ›ã€‚</li><li><strong>ä»åº“è¿‡å¤š</strong>ï¼šè¦é¿å…å¤åˆ¶çš„ä»èŠ‚ç‚¹æ•°é‡è¿‡å¤šï¼Œ<strong>ä»åº“æ•°æ®ä¸€èˆ¬ä»¥3-5ä¸ªä¸ºå®œã€‚</strong></li><li><strong>å¤§äº‹åŠ¡</strong>ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå°±è¦ 10 åˆ†é’Ÿï¼Œé‚£ä¹ˆä¸»åº“æ‰§è¡Œå®Œåï¼Œç»™åˆ°ä»åº“æ‰§è¡Œï¼Œæœ€åè¿™ä¸ªäº‹åŠ¡å¯èƒ½å°±ä¼šå¯¼è‡´ä»åº“å»¶è¿Ÿ 10 åˆ†é’Ÿå•¦ã€‚æ—¥å¸¸å¼€å‘ä¸­ï¼Œ<strong>ä¸è¦ä¸€æ¬¡æ€§ delete å¤ªå¤š SQL</strong>ï¼Œéœ€è¦åˆ†æ‰¹è¿›è¡Œï¼Œå¦å¤–å¤§è¡¨çš„ DDL è¯­å¥ï¼Œä¹Ÿä¼šå¯¼è‡´å¤§äº‹åŠ¡ã€‚</li><li><strong>ç½‘ç»œå»¶è¿Ÿ</strong>ï¼šä¼˜åŒ–ç½‘ç»œï¼Œæ¯”å¦‚å¸¦å®½ 20M å‡çº§åˆ° 100Mã€‚</li><li><strong>MySQL ç‰ˆæœ¬ä½</strong>ï¼šä½ç‰ˆæœ¬çš„ MySQL åªæ”¯æŒå•çº¿ç¨‹å¤åˆ¶ï¼Œå¦‚æœä¸»åº“å¹¶å‘é«˜ï¼Œæ¥ä¸åŠä¼ é€åˆ°ä»åº“ï¼Œå°±ä¼šå¯¼è‡´å»¶è¿Ÿï¼Œå¯ä»¥æ¢ç”¨æ›´é«˜ç‰ˆæœ¬çš„ MySQLï¼Œæ”¯æŒå¤šçº¿ç¨‹å¤åˆ¶ã€‚</li></ul><h3 id="3-3-ä¸»ä»å»¶è¿Ÿè§£å†³æ–¹æ¡ˆ"><a href="#3-3-ä¸»ä»å»¶è¿Ÿè§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.3 ä¸»ä»å»¶è¿Ÿè§£å†³æ–¹æ¡ˆ"></a>3.3 ä¸»ä»å»¶è¿Ÿè§£å†³æ–¹æ¡ˆ</h3><p>æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠä»åº“è½åçš„æ—¶é—´ä½œä¸ºä¸€ä¸ªé‡ç‚¹çš„æ•°æ®åº“æŒ‡æ ‡åšç›‘æ§å’ŒæŠ¥è­¦ï¼Œæ­£å¸¸çš„æ—¶é—´æ˜¯åœ¨æ¯«ç§’çº§åˆ«ï¼Œä¸€æ—¦è½åçš„æ—¶é—´è¾¾åˆ°äº†ç§’çº§åˆ«å°±éœ€è¦å‘Šè­¦äº†ã€‚</p><p>è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•ï¼Œé™¤äº†ç¼©çŸ­ä¸»ä»å»¶è¿Ÿçš„æ—¶é—´ï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ƒçš„æ–¹æ³•ï¼ŒåŸºæœ¬åŸç†éƒ½æ˜¯å°½é‡ä¸æŸ¥è¯¢ä»åº“ï¼Œå…·ä½“è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li><strong>ä½¿ç”¨ç¼“å­˜</strong>ï¼šæˆ‘ä»¬åœ¨åŒæ­¥å†™æ•°æ®åº“çš„åŒæ—¶ï¼Œä¹ŸæŠŠæ•°æ®å†™åˆ°ç¼“å­˜ï¼ŒæŸ¥è¯¢æ•°æ®æ—¶ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œä¸è¿‡è¿™ç§æƒ…å†µä¼šå¸¦æ¥ MySQL å’Œ Redis æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li><strong>æŸ¥è¯¢ä¸»åº“</strong>ï¼šç›´æ¥æŸ¥è¯¢ä¸»åº“ï¼Œè¿™ç§æƒ…å†µä¼šç»™ä¸»åº“å¤ªå¤§å‹åŠ›ï¼Œä¸å»ºè®®è¿™ç§æ–¹å¼ã€‚</li><li><strong>æ•°æ®å†—ä½™</strong>ï¼šå¯¹äºä¸€äº›å¼‚æ­¥å¤„ç†çš„åœºæ™¯ï¼Œå¦‚æœåªæ‰”æ•°æ® IDï¼Œæ¶ˆè´¹æ•°æ®æ—¶ï¼Œéœ€è¦æŸ¥è¯¢ä»åº“ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®å…¨éƒ¨éƒ½æ‰”ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™æ ·æ¶ˆè´¹è€…å°±æ— éœ€å†æŸ¥è¯¢ä»åº“ã€‚ï¼ˆè¿™ç§æƒ…å†µåº”è¯¥ä¸å¤ªèƒ½å‡ºç°ï¼Œæ•°æ®è½¬äº†ä¸€åœˆï¼ŒMySQL ä¸»ä»è¿˜æ²¡æœ‰åŒæ­¥å¥½ï¼Œç›´æ¥å»æ’• DBA å§ï¼‰</li></ul><p>åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯¹äºä¸€äº›éå¸¸æ ¸å¿ƒçš„åœºæ™¯ï¼Œæ¯”å¦‚åº“å­˜ï¼Œæ”¯ä»˜è®¢å•ç­‰ï¼Œéœ€è¦ç›´æ¥æŸ¥è¯¢ä¸»åº“ï¼Œå…¶å®ƒéæ ¸å¿ƒåœºæ™¯ï¼Œå°±ä¸è¦å»æŸ¥ä¸»åº“äº†ã€‚</p><h2 id="4-ä¸»ä»åˆ‡æ¢"><a href="#4-ä¸»ä»åˆ‡æ¢" class="headerlink" title="4. ä¸»ä»åˆ‡æ¢"></a>4. ä¸»ä»åˆ‡æ¢</h2><h3 id="4-1-ä¸€ä¸»ä¸€ä»"><a href="#4-1-ä¸€ä¸»ä¸€ä»" class="headerlink" title="4.1 ä¸€ä¸»ä¸€ä»"></a>4.1 ä¸€ä¸»ä¸€ä»</h3><p>ä¸¤å°æœºå™¨ A å’Œ Bï¼ŒA ä¸ºä¸»åº“ï¼Œè´Ÿè´£è¯»å†™ï¼ŒB ä¸ºä»åº“ï¼Œè´Ÿè´£è¯»æ•°æ®ã€‚</p><p>å¦‚æœ A åº“å‘ç”Ÿæ•…éšœï¼ŒB åº“æˆä¸ºä¸»åº“è´Ÿè´£è¯»å†™ï¼Œä¿®å¤æ•…éšœåï¼ŒA æˆä¸ºä»åº“ï¼Œä¸»åº“ B åŒæ­¥æ•°æ®åˆ°ä»åº“ Aã€‚</p><p><img src="http://cdn.882227.xyz/5e03e730169040c8b12903c149980a0c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š ä»åº“æ”¯æŒè¯»ï¼Œåˆ†æ‹…äº†ä¸»åº“çš„å‹åŠ›ï¼Œæå‡äº†å¹¶å‘åº¦ï¼Œä¸”ä¸€ä¸ªæœºå™¨æ•…éšœäº†å¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œæ“ä½œæ¯”è¾ƒç®€å•ï¼Œå…¬å¸ä»åº“è¿˜å¯ä»¥å……å½“æ•°æ®å¤‡ä»½çš„è§’è‰²ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼š ä¸€å°ä»åº“ï¼Œå¹¶å‘æ”¯æŒè¿˜æ˜¯ä¸å¤Ÿï¼Œå¹¶ä¸”ä¸€å…±ä¸¤å°æœºå™¨ï¼Œè¿˜æ˜¯å­˜åœ¨åŒæ—¶æ•…éšœçš„æœºç‡ï¼Œä¸å¤Ÿé«˜å¯ç”¨ã€‚</li></ul><p>å¯¹äºä¸€ä¸»ä¸€ä»çš„æ¨¡å¼ï¼Œä¸€èˆ¬å°å…¬å¸ä¼šè¿™ä¹ˆç”¨ï¼Œä¸è¿‡è¯¥æ¨¡å¼ä¸‹ï¼Œä¸»ä»åˆ†ç¦»çš„æ„ä¹‰å…¶å®å¹¶ä¸å¤§ï¼Œå› ä¸ºå°å…¬å¸çš„æµé‡ä¸é«˜ï¼Œæ›´å¤šæ˜¯ä¸ºäº†æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œä»¥åŠæ•°æ®å¤‡ä»½ã€‚</p><h3 id="4-2-ä¸€ä¸»å¤šä»"><a href="#4-2-ä¸€ä¸»å¤šä»" class="headerlink" title="4.2 ä¸€ä¸»å¤šä»"></a>4.2 ä¸€ä¸»å¤šä»</h3><p>ä¸€å°ä¸»åº“å¤šå°ä»åº“ï¼ŒA ä¸ºä¸»åº“ï¼Œè´Ÿè´£è¯»å†™ï¼ŒBã€Cã€Dä¸ºä»åº“ï¼Œè´Ÿè´£è¯»æ•°æ®ã€‚</p><p>å¦‚æœ A åº“å‘ç”Ÿæ•…éšœï¼ŒB åº“æˆä¸ºä¸»åº“è´Ÿè´£è¯»å†™ï¼ŒCã€D è´Ÿè´£è¯»ï¼Œä¿®å¤æ•…éšœåï¼ŒA ä¹Ÿæˆä¸ºä»åº“ï¼Œä¸»åº“ B åŒæ­¥æ•°æ®åˆ°ä»åº“ Aã€‚</p><p><img src="http://cdn.882227.xyz/7a58403f9c6440f4ba947c9167ae6b51~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="img"></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š å¤šä¸ªä»åº“æ”¯æŒè¯»ï¼Œåˆ†æ‹…äº†ä¸»åº“çš„å‹åŠ›ï¼Œæ˜æ˜¾æå‡äº†è¯»çš„å¹¶å‘åº¦ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š åªæœ‰ä¸€å°ä¸»æœºå†™ï¼Œå› æ­¤å†™çš„å¹¶å‘åº¦ä¸é«˜ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlæ—¥å¿—æ ¼å¼</title>
    <link href="/2025/07/07/Mysql%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F/"/>
    <url>/2025/07/07/Mysql%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>MySQL çš„æ—¥å¿—ä¸»è¦åŒ…æ‹¬<strong>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰</strong>ã€<strong>é”™è¯¯æ—¥å¿—</strong>ã€<strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ã€<strong>ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—</strong>å’Œ<strong>ä¸­ç»§æ—¥å¿—</strong>ã€‚å…¶ä¸­ï¼ŒäºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ç›´æ¥å½±å“ä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç»äºŒè¿›åˆ¶æ—¥å¿—çš„ä¸‰ç§æ ¼å¼ï¼š<strong>Statement (SBR)</strong>ã€<strong>Row (RBR)</strong> å’Œ <strong>Mixed</strong>ï¼Œå¹¶ç®€è¿°å…¶ä»–æ—¥å¿—ç±»å‹ã€‚</p><h2 id="äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼"><a href="#äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼" class="headerlink" title="äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼"></a>äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼</h2><h3 id="1-Statementï¼ˆåŸºäºè¯­å¥çš„å¤åˆ¶ï¼ŒSBRï¼‰"><a href="#1-Statementï¼ˆåŸºäºè¯­å¥çš„å¤åˆ¶ï¼ŒSBRï¼‰" class="headerlink" title="1. Statementï¼ˆåŸºäºè¯­å¥çš„å¤åˆ¶ï¼ŒSBRï¼‰"></a>1. Statementï¼ˆåŸºäºè¯­å¥çš„å¤åˆ¶ï¼ŒSBRï¼‰</h3><ul><li><strong>æè¿°</strong>ï¼šè®°å½•æ‰§è¡Œçš„ SQL è¯­å¥ï¼Œå¦‚ INSERT INTO table VALUES (â€¦);ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>æ—¥å¿—æ–‡ä»¶è¾ƒå°ï¼Œä»…è®°å½• SQL è¯­å¥ã€‚</li><li>éç¡®å®šæ€§æ“ä½œï¼ˆå¦‚ NOW()ã€RAND()ï¼‰å¯èƒ½å¯¼è‡´ä¸»ä»å¤åˆ¶ä¸ä¸€è‡´ã€‚</li><li>è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ç­‰å¯èƒ½æ— æ³•æ­£ç¡®å¤åˆ¶ã€‚</li><li>æ—¥å¿—å¯è¯»æ€§é«˜ï¼Œé€‚åˆäººå·¥åˆ†æã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul><li>å­˜å‚¨ç©ºé—´æœ‰é™ã€‚</li><li>æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ï¼Œæˆ–æ“ä½œå¤šä¸ºç¡®å®šæ€§ã€‚</li><li>éœ€è¦å®¡è®¡ SQL æ‰§è¡Œå†å²ã€‚</li></ul></li><li><strong>é…ç½®</strong>ï¼šbinlog_format &#x3D; STATEMENT</li></ul><h3 id="2-Rowï¼ˆåŸºäºè¡Œçš„å¤åˆ¶ï¼ŒRBRï¼‰"><a href="#2-Rowï¼ˆåŸºäºè¡Œçš„å¤åˆ¶ï¼ŒRBRï¼‰" class="headerlink" title="2. Rowï¼ˆåŸºäºè¡Œçš„å¤åˆ¶ï¼ŒRBRï¼‰"></a>2. Rowï¼ˆåŸºäºè¡Œçš„å¤åˆ¶ï¼ŒRBRï¼‰</h3><ul><li><strong>æè¿°</strong>ï¼šè®°å½•æ¯è¡Œæ•°æ®çš„å®é™…å˜åŒ–ï¼ˆæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼Œè€Œé SQL è¯­å¥ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>æ—¥å¿—æ–‡ä»¶è¾ƒå¤§ï¼Œè®°å½•å…·ä½“æ•°æ®å˜åŒ–ã€‚</li><li>ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œé€‚åˆéç¡®å®šæ€§æ“ä½œã€‚</li><li>å¯¹å¤æ‚æŸ¥è¯¢ï¼ˆå¦‚å¤šè¡¨è”æ¥ï¼‰æ•ˆç‡è¾ƒé«˜ã€‚</li><li>æ—¥å¿—å¯è¯»æ€§ä½ï¼Œä¸ä¾¿äºäººå·¥åˆ†æã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul><li>é«˜ä¸€è‡´æ€§çš„ä¸»ä»å¤åˆ¶ã€‚</li><li>æ¶‰åŠéç¡®å®šæ€§æ“ä½œï¼ˆå¦‚ UUID()ã€RAND()ï¼‰ã€‚</li><li>æ•°æ®æ›´æ–°é¢‘ç¹ï¼Œå¤æ‚æŸ¥è¯¢è¾ƒå¤šã€‚</li></ul></li><li><strong>é…ç½®</strong>ï¼šbinlog_format &#x3D; ROW</li></ul><h3 id="3-Mixedï¼ˆæ··åˆæ¨¡å¼ï¼‰"><a href="#3-Mixedï¼ˆæ··åˆæ¨¡å¼ï¼‰" class="headerlink" title="3. Mixedï¼ˆæ··åˆæ¨¡å¼ï¼‰"></a>3. Mixedï¼ˆæ··åˆæ¨¡å¼ï¼‰</h3><ul><li><strong>æè¿°</strong>ï¼šç»“åˆ Statement å’Œ Row æ ¼å¼ï¼ŒMySQL æ ¹æ®æ“ä½œç±»å‹è‡ªåŠ¨é€‰æ‹©ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>é»˜è®¤ä½¿ç”¨ Statement æ ¼å¼ï¼Œè®°å½• SQL è¯­å¥ã€‚</li><li>éç¡®å®šæ€§æ“ä½œæˆ–ç‰¹å®šåœºæ™¯ï¼ˆå¦‚ INSERT â€¦ SELECTï¼‰åˆ‡æ¢ä¸º Row æ ¼å¼ã€‚</li><li>å…¼é¡¾æ—¥å¿—å¤§å°å’Œä¸€è‡´æ€§ï¼Œä½†è¡Œä¸ºå¯èƒ½ä¸å¤Ÿæ˜ç¡®ã€‚</li><li>å¯è¯»æ€§å–å†³äºè®°å½•æ ¼å¼ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul><li>éœ€è¦å¹³è¡¡ä¸€è‡´æ€§å’Œå­˜å‚¨ç©ºé—´ã€‚</li><li>ä¸ç¡®å®šæ“ä½œç±»å‹ï¼Œä¾èµ– MySQL è‡ªåŠ¨ä¼˜åŒ–ã€‚</li></ul></li><li><strong>é…ç½®</strong>ï¼šbinlog_format &#x3D; MIXED</li></ul><h2 id="å…¶ä»–æ—¥å¿—ç±»å‹"><a href="#å…¶ä»–æ—¥å¿—ç±»å‹" class="headerlink" title="å…¶ä»–æ—¥å¿—ç±»å‹"></a>å…¶ä»–æ—¥å¿—ç±»å‹</h2><ul><li><strong>é”™è¯¯æ—¥å¿—ï¼ˆError Logï¼‰</strong>ï¼š<ul><li>è®°å½• MySQL å¯åŠ¨ã€åœæ­¢åŠè¿è¡Œé”™è¯¯ï¼Œæ ¼å¼ä¸ºçº¯æ–‡æœ¬ã€‚</li></ul></li><li><strong>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow Query Logï¼‰</strong>ï¼š<ul><li>è®°å½•æ‰§è¡Œæ—¶é—´è¶…é˜ˆå€¼çš„æŸ¥è¯¢ï¼Œæ ¼å¼ä¸ºæ–‡æœ¬ï¼ŒåŒ…å« SQL å’Œæ‰§è¡Œæ—¶é—´ã€‚</li></ul></li><li><strong>ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼ˆGeneral Query Logï¼‰</strong>ï¼š<ul><li>è®°å½•æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥å’Œ SQL è¯­å¥ï¼Œæ ¼å¼ä¸ºæ–‡æœ¬ï¼Œé€‚åˆè°ƒè¯•ä½†å¼€é”€å¤§ã€‚</li></ul></li><li><strong>ä¸­ç»§æ—¥å¿—ï¼ˆRelay Logï¼‰</strong>ï¼š<ul><li>ç”¨äºä¸»ä»å¤åˆ¶ï¼Œå­˜å‚¨ä»ä¸»åº“æ¥æ”¶çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ ¼å¼ä¸äºŒè¿›åˆ¶æ—¥å¿—ä¸€è‡´ã€‚</li></ul></li></ul><h2 id="æ ¼å¼å¯¹æ¯”"><a href="#æ ¼å¼å¯¹æ¯”" class="headerlink" title="æ ¼å¼å¯¹æ¯”"></a>æ ¼å¼å¯¹æ¯”</h2><table><thead><tr><th>ç‰¹æ€§</th><th>Statement (SBR)</th><th>Row (RBR)</th><th>Mixed</th></tr></thead><tbody><tr><td><strong>è®°å½•å†…å®¹</strong></td><td>SQL è¯­å¥</td><td>æ¯è¡Œæ•°æ®å˜åŒ–</td><td>è‡ªåŠ¨é€‰æ‹© Statement æˆ– Row</td></tr><tr><td><strong>æ—¥å¿—å¤§å°</strong></td><td>è¾ƒå°</td><td>è¾ƒå¤§</td><td>ä¸­ç­‰</td></tr><tr><td><strong>ä¸€è‡´æ€§</strong></td><td>å¯èƒ½ä¸ä¸€è‡´ï¼ˆéç¡®å®šæ€§æ“ä½œï¼‰</td><td>é«˜ä¸€è‡´æ€§</td><td>è¾ƒé«˜ï¼ˆè§†æƒ…å†µåˆ‡æ¢ï¼‰</td></tr><tr><td><strong>å¯è¯»æ€§</strong></td><td>é«˜ï¼ˆSQL è¯­å¥æ˜“è¯»ï¼‰</td><td>ä½ï¼ˆæ•°æ®å˜åŒ–éš¾è¯»ï¼‰</td><td>è§†è®°å½•æ ¼å¼è€Œå®š</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å®¡è®¡ã€ç®€å•æ“ä½œã€ç©ºé—´å—é™</td><td>é«˜ä¸€è‡´æ€§ã€å¤æ‚æŸ¥è¯¢</td><td>æŠ˜ä¸­åœºæ™¯</td></tr><tr><td><strong>æ€§èƒ½å½±å“</strong></td><td>ä¸»åº“æ‰§è¡Œå¿«ï¼Œæ—¥å¿—å°</td><td>ä¸»åº“è®°å½•å¼€é”€å¤§ï¼Œå¤åˆ¶å¯é </td><td>å¹³è¡¡æ€§èƒ½ä¸ä¸€è‡´æ€§</td></tr></tbody></table><h2 id="é…ç½®ä¸æŸ¥çœ‹"><a href="#é…ç½®ä¸æŸ¥çœ‹" class="headerlink" title="é…ç½®ä¸æŸ¥çœ‹"></a>é…ç½®ä¸æŸ¥çœ‹</h2><ul><li><p><strong>æŸ¥çœ‹å½“å‰æ—¥å¿—æ ¼å¼</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;binlog_format&#x27;</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>è®¾ç½®æ—¥å¿—æ ¼å¼</strong>ï¼ˆéœ€ SUPER æƒé™ï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> binlog_format <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;STATEMENT&#x27;</span>; <span class="hljs-comment">-- æˆ– ROW, MIXED</span><br></code></pre></td></tr></table></figure><p>æˆ–åœ¨ my.cnf ä¸­é…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">binlog_format</span> = ROW<br></code></pre></td></tr></table></figure></li></ul><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ul><li><strong>ç‰ˆæœ¬å·®å¼‚</strong>ï¼šMySQL 5.7 èµ·æ¨è Row æ ¼å¼ï¼Œå› å…¶å¤åˆ¶ä¸€è‡´æ€§æ›´é«˜ã€‚</li><li><strong>å¤åˆ¶ç¯å¢ƒ</strong>ï¼šRow æ ¼å¼é€‚åˆé«˜å¯ç”¨ã€é«˜ä¸€è‡´æ€§åœºæ™¯ã€‚</li><li><strong>å­˜å‚¨ç©ºé—´</strong>ï¼šRow æ ¼å¼æ—¥å¿—æ–‡ä»¶è¾ƒå¤§ï¼Œéœ€ç¡®ä¿è¶³å¤Ÿç£ç›˜ç©ºé—´ã€‚</li><li><strong>éç¡®å®šæ€§æ“ä½œ</strong>ï¼šå¦‚ LIMIT æ—  ORDER BYã€è§¦å‘å™¨ç­‰ï¼Œæ¨è Row æˆ– Mixed æ¨¡å¼ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>prometheusæ·»åŠ åŸºæœ¬è®¤è¯</title>
    <link href="/2025/06/19/prometheus%E6%B7%BB%E5%8A%A0%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%EF%BC%88Basic%20auth%EF%BC%89/"/>
    <url>/2025/06/19/prometheus%E6%B7%BB%E5%8A%A0%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%EF%BC%88Basic%20auth%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹é…ç½®è¯´æ˜ï¼š</p><p><a href="https://prometheus.io/docs/guides/basic-auth/" title="Basic auth | Prometheus">Basic auth | Prometheus</a></p><h4 id="ä¸€ã€ç”Ÿæˆå¯†ç åŠ å¯†ä¸²"><a href="#ä¸€ã€ç”Ÿæˆå¯†ç åŠ å¯†ä¸²" class="headerlink" title="ä¸€ã€ç”Ÿæˆå¯†ç åŠ å¯†ä¸²"></a>ä¸€ã€ç”Ÿæˆå¯†ç åŠ å¯†ä¸²</h4><p>Prometheusäº2.24ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬2.24ï¼‰ä¹‹åæä¾›Basic AuthåŠŸèƒ½è¿›è¡ŒåŠ å¯†è®¿é—®ï¼Œåœ¨æµè§ˆå™¨ç™»å½•UIçš„æ—¶å€™éœ€è¦è¾“å…¥ç”¨æˆ·å¯†ç ï¼Œè®¿é—®Prometheus apiçš„æ—¶å€™ä¹Ÿéœ€è¦åŠ ä¸Šç”¨æˆ·å¯†ç ã€‚</p><p>ä½¿ç”¨<a href="https://so.csdn.net/so/search?q=python%E8%84%9A%E6%9C%AC&spm=1001.2101.3001.7020">pythonè„šæœ¬</a>ï¼Œç”ŸæˆåŠ å¯†å¯†ç ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> getpassimport bcrypt password = getpass.getpass(<span class="hljs-string">&quot;password: &quot;</span>)hashed_password = bcrypt.hashpw(password.encode(<span class="hljs-string">&quot;utf-8&quot;</span>), bcrypt.gensalt())<span class="hljs-built_in">print</span>(hashed_password.decode())<br></code></pre></td></tr></table></figure><p>å°†ä»¥ä¸Šè„šæœ¬å¤åˆ¶ä¿å­˜ä¸º getpass.py</p><p>ç„¶åé€šè¿‡cmdå‘½ä»¤è¡Œ<a href="https://so.csdn.net/so/search?q=%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC&spm=1001.2101.3001.7020">æ‰§è¡Œè„šæœ¬</a></p><p>python.exe getpass.py</p><p><img src="http://cdn.882227.xyz/9da3a765b9bff25867a255fbc607bf25.png"></p><p>æ‰§è¡Œè„šæœ¬åï¼Œåœ¨passwordï¼šåé¢è¾“å…¥ä½ è¦è®¾ç½®çš„å¯†ç ï¼Œç„¶åå°±ä¼šç”Ÿæˆä¸€ä¸²åŠ å¯†çš„å¯†ç ä¸²ï¼Œè®°å½•ä¸‹è¯¥å¯†ç ä¸²ï¼Œåé¢é…ç½®ä¼šä½¿ç”¨åˆ°ã€‚</p><h4 id="äºŒã€æœåŠ¡ç«¯é…ç½®"><a href="#äºŒã€æœåŠ¡ç«¯é…ç½®" class="headerlink" title="äºŒã€æœåŠ¡ç«¯é…ç½®"></a>äºŒã€æœåŠ¡ç«¯é…ç½®</h4><p>ä»¥æˆ‘é…ç½®ä¹ æƒ¯ä¸ºä¾‹ï¼ŒPrometheusæœåŠ¡ç«¯æˆ‘é»˜è®¤å°†é…ç½®å­˜æ”¾åœ¨ &#x2F;etc&#x2F;prometheusç›®å½•ä¸‹</p><p>åœ¨è¯¥ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ web.ymlï¼Œç„¶åæ·»åŠ æ­¥éª¤ä¸€ç”Ÿæˆçš„å¯†ç åŠ å¯†ä¸²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">basic_auth_users:    admin: $2b$12$/cUMX6b8JAu9onTddMfHAetdlOJS9XU....................<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/d33347f22ab682ec17b78737cb6eae45.png"></p><p>ä¿å­˜æ–‡ä»¶åï¼Œä½¿ç”¨promtoolå·¥å…·å¯¹æ–‡ä»¶è¿›è¡Œæ ¡éªŒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">promtool check web-config /etc/prometheus/web.yml<br></code></pre></td></tr></table></figure><p><img src="http://cdn.882227.xyz/b53fc10d2f0ccbe546317b3346b30c62.png"></p><p>Â è¾“å‡ºSUCCESSè¡¨ç¤ºæ ¡éªŒé€šè¿‡</p><p>ä»¥ä¸Šå‡†å¤‡å·¥ä½œå®Œæˆåï¼Œæœ€ååœ¨å¯åŠ¨çš„å‘½ä»¤è„šæœ¬ä¸­ï¼Œéœ€åŠ å…¥web.config.fileçš„é…ç½®å‚æ•°</p><p><img src="http://cdn.882227.xyz/0a6621366e2069dfec7505ccd094e636.png"></p><p>æˆ‘æœ¬åœ°æ˜¯å°†å¯åŠ¨è„šæœ¬é…ç½®æˆæœåŠ¡å¯åŠ¨ï¼Œæ‰€ä»¥åœ¨æœåŠ¡è„šæœ¬ä¸­åŠ å…¥å‚æ•°å³å¯</p><p><img src="http://cdn.882227.xyz/f6a5451059eb5f740c2c7ffac2c05660.png"></p><p>ç„¶åé‡æ–°åŠ è½½æœåŠ¡è„šæœ¬ï¼šsystemctl daemon-reload</p><p>å†é‡å¯æœåŠ¡ï¼šsystemctl restart prometheus</p><p>Â æœ€åå†è¿›è¡ŒéªŒè¯</p><p><img src="http://cdn.882227.xyz/f737a40933cccda8307b440d1c6e44b2.png"></p><p>ç°åœ¨å°±éœ€è¦è¾“å…¥è´¦å·å¯†ç éªŒè¯</p><p>ç™»å½•åï¼ŒæŸ¥çœ‹targetä¼šå‘ç°ï¼ŒPrometheusçš„è‡ªæ£€èŠ‚ç‚¹æ— æ³•é€šè¿‡æ ¡éªŒ</p><p><img src="http://cdn.882227.xyz/da5f0305e15ed11769d994f4b0923460.png"></p><p>è¿™æ˜¯å› ä¸ºèŠ‚ç‚¹åœ¨è·å–metricsæ¥å£æ—¶æœªé…ç½®basic authè®¤è¯æ ¡éªŒï¼Œåªéœ€è¦åœ¨æœåŠ¡ç«¯å°†è´¦å·å¯†ç é…ç½®ä¸Šå°±è¡Œ</p><p><img src="http://cdn.882227.xyz/ded3201d4cfd6d50c28710b05855b6f6.png"></p><p>æ³¨æ„çš„æ˜¯ï¼Œå¯†ç æ˜¯åŠ å¯†å‰çš„æ˜æ–‡å¯†ç ï¼Œé…ç½®å®Œæˆåé‡å¯æœåŠ¡å°±æ­£å¸¸äº†ã€‚</p><p>æœ¬æ–‡è½¬è‡ª <a href="https://blog.csdn.net/Hu_wen/article/details/136869252">https://blog.csdn.net/Hu_wen/article/details/136869252</a>ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8s-é¢è¯•é¢˜</title>
    <link href="/2025/06/18/k8s%20%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <url>/2025/06/18/k8s%20%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="k8s-é¢è¯•é¢˜"><a href="#k8s-é¢è¯•é¢˜" class="headerlink" title="k8s-é¢è¯•é¢˜"></a>k8s-é¢è¯•é¢˜</h1><h3 id="1ã€ç®€è¿°etcdåŠå…¶ç‰¹ç‚¹ï¼Ÿ"><a href="#1ã€ç®€è¿°etcdåŠå…¶ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="1ã€ç®€è¿°etcdåŠå…¶ç‰¹ç‚¹ï¼Ÿ"></a>1ã€ç®€è¿°etcdåŠå…¶ç‰¹ç‚¹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>etcd æ˜¯ CoreOS å›¢é˜Ÿå‘èµ·çš„å¼€æºé¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªç®¡ç†é…ç½®ä¿¡æ¯å’ŒæœåŠ¡å‘ç°ï¼ˆservice discoveryï¼‰çš„é¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªé«˜å¯ç”¨çš„åˆ†å¸ƒå¼é”®å€¼ï¼ˆkey-valueï¼‰æ•°æ®åº“ï¼ŒåŸºäº Go è¯­è¨€å®ç°ã€‚<br>ç‰¹ç‚¹ï¼š</p><ul><li>ç®€å•ï¼šæ”¯æŒ REST é£æ ¼çš„ HTTP+JSON API</li><li>å®‰å…¨ï¼šæ”¯æŒ HTTPS æ–¹å¼çš„è®¿é—®</li><li>å¿«é€Ÿï¼šæ”¯æŒå¹¶å‘ 1k&#x2F;s çš„å†™æ“ä½œ</li><li>å¯é ï¼šæ”¯æŒåˆ†å¸ƒå¼ç»“æ„ï¼ŒåŸºäº Raft çš„ä¸€è‡´æ€§ç®—æ³•ï¼ŒRaft æ˜¯ä¸€å¥—é€šè¿‡é€‰ä¸¾ä¸»èŠ‚ç‚¹æ¥å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§çš„ç®—æ³•</li></ul><h3 id="2ã€ç®€è¿°etcdé€‚åº”çš„åœºæ™¯ï¼Ÿ"><a href="#2ã€ç®€è¿°etcdé€‚åº”çš„åœºæ™¯ï¼Ÿ" class="headerlink" title="2ã€ç®€è¿°etcdé€‚åº”çš„åœºæ™¯ï¼Ÿ"></a>2ã€ç®€è¿°etcdé€‚åº”çš„åœºæ™¯ï¼Ÿ</h3><p>ç­”ï¼š</p><p>etcdåŸºäºå…¶ä¼˜ç§€çš„ç‰¹ç‚¹ï¼Œå¯å¹¿æ³›çš„åº”ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li>æœåŠ¡å‘ç°(Service Discovery)ï¼šæœåŠ¡å‘ç°ä¸»è¦è§£å†³åœ¨åŒä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„è¿›ç¨‹æˆ–æœåŠ¡ï¼Œè¦å¦‚ä½•æ‰èƒ½æ‰¾åˆ°å¯¹æ–¹å¹¶å»ºç«‹è¿æ¥ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒæœåŠ¡å‘ç°å°±æ˜¯æƒ³è¦äº†è§£é›†ç¾¤ä¸­æ˜¯å¦æœ‰è¿›ç¨‹åœ¨ç›‘å¬udpæˆ–tcpç«¯å£ï¼Œå¹¶ä¸”é€šè¿‡åå­—å°±å¯ä»¥æŸ¥æ‰¾å’Œè¿æ¥ã€‚</li><li>æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ€é€‚ç”¨çš„ä¸€ç§ç»„ä»¶é—´é€šä¿¡æ–¹å¼å°±æ˜¯æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…ã€‚å³æ„å»ºä¸€ä¸ªé…ç½®å…±äº«ä¸­å¿ƒï¼Œæ•°æ®æä¾›è€…åœ¨è¿™ä¸ªé…ç½®ä¸­å¿ƒå‘å¸ƒæ¶ˆæ¯ï¼Œè€Œæ¶ˆæ¯ä½¿ç”¨è€…åˆ™è®¢é˜…ä»–ä»¬å…³å¿ƒçš„ä¸»é¢˜ï¼Œä¸€æ—¦ä¸»é¢˜æœ‰æ¶ˆæ¯å‘å¸ƒï¼Œå°±ä¼šå®æ—¶é€šçŸ¥è®¢é˜…è€…ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥åšåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿé…ç½®çš„é›†ä¸­å¼ç®¡ç†ä¸åŠ¨æ€æ›´æ–°ã€‚åº”ç”¨ä¸­ç”¨åˆ°çš„ä¸€äº›é…ç½®ä¿¡æ¯æ”¾åˆ°etcdä¸Šè¿›è¡Œé›†ä¸­ç®¡ç†ã€‚</li><li>è´Ÿè½½å‡è¡¡ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ä»¥åŠæ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸éƒ½ä¼šæŠŠæ•°æ®å’ŒæœåŠ¡éƒ¨ç½²å¤šä»½ï¼Œä»¥æ­¤è¾¾åˆ°å¯¹ç­‰æœåŠ¡ï¼Œå³ä½¿å…¶ä¸­çš„æŸä¸€ä¸ªæœåŠ¡å¤±æ•ˆäº†ï¼Œä¹Ÿä¸å½±å“ä½¿ç”¨ã€‚etcdæœ¬èº«åˆ†å¸ƒå¼æ¶æ„å­˜å‚¨çš„ä¿¡æ¯è®¿é—®æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚etcdé›†ç¾¤åŒ–ä»¥åï¼Œæ¯ä¸ªetcdçš„æ ¸å¿ƒèŠ‚ç‚¹éƒ½å¯ä»¥å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚æ‰€ä»¥ï¼ŒæŠŠæ•°æ®é‡å°ä½†æ˜¯è®¿é—®é¢‘ç¹çš„æ¶ˆæ¯æ•°æ®ç›´æ¥å­˜å‚¨åˆ°etcdä¸­ä¹Ÿå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚</li><li>åˆ†å¸ƒå¼é€šçŸ¥ä¸åè°ƒï¼šä¸æ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…ç±»ä¼¼ï¼Œéƒ½ç”¨åˆ°äº†etcd ä¸­çš„Watcher æœºåˆ¶ï¼Œé€šè¿‡æ³¨å†Œä¸å¼‚æ­¥é€šçŸ¥æœºåˆ¶ï¼Œå®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸åŒç³»ç»Ÿä¹‹é—´çš„é€šçŸ¥ä¸åè°ƒï¼Œä»è€Œå¯¹æ•°æ®å˜æ›´åšåˆ°å®æ—¶å¤„ç†ã€‚</li><li>åˆ†å¸ƒå¼é”ï¼šå› ä¸ºetcdä½¿ç”¨Raftç®—æ³•ä¿æŒäº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼ŒæŸæ¬¡æ“ä½œå­˜å‚¨åˆ°é›†ç¾¤ä¸­çš„å€¼å¿…ç„¶æ˜¯å…¨å±€ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å®ç°åˆ†å¸ƒå¼é”ã€‚é”æœåŠ¡æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸€æ˜¯ä¿æŒç‹¬å ï¼ŒäºŒæ˜¯æ§åˆ¶æ—¶åºã€‚</li><li>é›†ç¾¤ç›‘æ§ä¸Leader ç«é€‰ï¼šé€šè¿‡etcd æ¥è¿›è¡Œç›‘æ§å®ç°èµ·æ¥éå¸¸ç®€å•å¹¶ä¸”å®æ—¶æ€§å¼ºã€‚</li></ul><h3 id="3ã€ç®€è¿°ä»€ä¹ˆæ˜¯Kubernetesï¼Ÿ"><a href="#3ã€ç®€è¿°ä»€ä¹ˆæ˜¯Kubernetesï¼Ÿ" class="headerlink" title="3ã€ç®€è¿°ä»€ä¹ˆæ˜¯Kubernetesï¼Ÿ"></a>3ã€ç®€è¿°ä»€ä¹ˆæ˜¯Kubernetesï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesæ˜¯ä¸€ä¸ªå…¨æ–°çš„åŸºäºå®¹å™¨æŠ€æœ¯çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ”¯æ’‘å¹³å°ã€‚æ˜¯Googleå¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼ˆè°·æ­Œå†…éƒ¨:Borgï¼‰ã€‚åœ¨DockeræŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œä¸ºå®¹å™¨åŒ–çš„åº”ç”¨æä¾›éƒ¨ç½²è¿è¡Œã€èµ„æºè°ƒåº¦ã€æœåŠ¡å‘ç°å’ŒåŠ¨æ€ä¼¸ç¼©ç­‰ä¸€ç³»åˆ—å®Œæ•´åŠŸèƒ½ï¼Œæé«˜äº†å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤ç®¡ç†çš„ä¾¿æ·æ€§ã€‚å¹¶ä¸”å…·æœ‰å®Œå¤‡çš„é›†ç¾¤ç®¡ç†èƒ½åŠ›ï¼Œå¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤å’Œå‡†å…¥æœºåˆ¶ã€å¤šç§Ÿæˆ·åº”ç”¨æ”¯æ’‘èƒ½åŠ›ã€é€æ˜çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°æœºåˆ¶ã€å…§å»ºæ™ºèƒ½è´Ÿè½½å‡è¡¡å™¨ã€å¼ºå¤§çš„æ•…éšœå‘ç°å’Œè‡ªæˆ‘ä¿®å¤èƒ½åŠ›ã€æœåŠ¡æ»šåŠ¨å‡çº§å’Œåœ¨çº¿æ‰©å®¹èƒ½åŠ›ã€å¯æ‰©å±•çš„èµ„æºè‡ªåŠ¨è°ƒåº¦æœºåˆ¶ä»¥åŠå¤šç²’åº¦çš„èµ„æºé…é¢ç®¡ç†èƒ½åŠ›ã€‚</p><h3 id="4ã€ç®€è¿°Kuberneteså’ŒDockerçš„å…³ç³»ï¼Ÿ"><a href="#4ã€ç®€è¿°Kuberneteså’ŒDockerçš„å…³ç³»ï¼Ÿ" class="headerlink" title="4ã€ç®€è¿°Kuberneteså’ŒDockerçš„å…³ç³»ï¼Ÿ"></a>4ã€ç®€è¿°Kuberneteså’ŒDockerçš„å…³ç³»ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Docker æä¾›å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œï¼ŒDocker é•œåƒæ„å»ºè¿è¡Œæ—¶å®¹å™¨ã€‚å®ƒçš„ä¸»è¦ä¼˜ç‚¹æ˜¯å°†å°†è½¯ä»¶&#x2F;åº”ç”¨ç¨‹åºè¿è¡Œæ‰€éœ€çš„è®¾ç½®å’Œä¾èµ–é¡¹æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œä»è€Œå®ç°äº†å¯ç§»æ¤æ€§ç­‰ä¼˜ç‚¹ã€‚<br>Kubernetes ç”¨äºå…³è”å’Œç¼–æ’åœ¨å¤šä¸ªä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨ã€‚</p><h3 id="5ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯Minikubeã€Kubectlã€Kubeletï¼Ÿ"><a href="#5ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯Minikubeã€Kubectlã€Kubeletï¼Ÿ" class="headerlink" title="5ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯Minikubeã€Kubectlã€Kubeletï¼Ÿ"></a>5ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯Minikubeã€Kubectlã€Kubeletï¼Ÿ</h3><p>ç­”ï¼š</p><ul><li>Minikube æ˜¯ä¸€ç§å¯ä»¥åœ¨æœ¬åœ°è½»æ¾è¿è¡Œä¸€ä¸ªå•èŠ‚ç‚¹ Kubernetes ç¾¤é›†çš„å·¥å…·ã€‚</li><li>Kubectl æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å·¥å…·æ§åˆ¶Kubernetesé›†ç¾¤ç®¡ç†å™¨ï¼Œå¦‚æ£€æŸ¥ç¾¤é›†èµ„æºï¼Œåˆ›å»ºã€åˆ é™¤å’Œæ›´æ–°ç»„ä»¶ï¼ŒæŸ¥çœ‹åº”ç”¨ç¨‹åºã€‚</li><li>Kubelet æ˜¯ä¸€ä¸ªä»£ç†æœåŠ¡ï¼Œå®ƒåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¹¶ä½¿ä»æœåŠ¡å™¨ä¸ä¸»æœåŠ¡å™¨é€šä¿¡ã€‚</li></ul><h3 id="6ã€ç®€è¿°Kuberneteså¸¸è§çš„éƒ¨ç½²æ–¹å¼ï¼Ÿ"><a href="#6ã€ç®€è¿°Kuberneteså¸¸è§çš„éƒ¨ç½²æ–¹å¼ï¼Ÿ" class="headerlink" title="6ã€ç®€è¿°Kuberneteså¸¸è§çš„éƒ¨ç½²æ–¹å¼ï¼Ÿ"></a>6ã€ç®€è¿°Kuberneteså¸¸è§çš„éƒ¨ç½²æ–¹å¼ï¼Ÿ</h3><p>ç­”ï¼š</p><p>å¸¸è§çš„Kuberneteséƒ¨ç½²æ–¹å¼æœ‰ï¼š</p><ul><li>kubeadmï¼šä¹Ÿæ˜¯æ¨èçš„ä¸€ç§éƒ¨ç½²æ–¹å¼ï¼›</li><li>äºŒè¿›åˆ¶ï¼šè¾ƒæ·±å…¥çš„éƒ¨ç½²æ–¹å¼ï¼›</li><li>minikubeï¼šåœ¨æœ¬åœ°è½»æ¾è¿è¡Œä¸€ä¸ªå•èŠ‚ç‚¹ Kubernetes ç¾¤é›†çš„å·¥å…·ï¼›</li><li>kubekeyï¼šç”±é’äº‘å¼€æºçš„ï¼Œç¬¬ä¸‰æ–¹å¼éƒ¨ç½²æ–¹å¼ï¼Œå°é—­kubeadm;</li><li>kubeaseï¼šä½¿ç”¨ansibleéƒ¨ç½²æ–¹å¼ï¼›</li><li>sealosï¼šæé€Ÿéƒ¨ç½²Kubernetesé›†ç¾¤æ–¹å¼ï¼Œå°è£…kubeadm</li></ul><h3 id="7ã€ç®€è¿°Kuberneteså¦‚ä½•å®ç°é›†ç¾¤ç®¡ç†ï¼Ÿ"><a href="#7ã€ç®€è¿°Kuberneteså¦‚ä½•å®ç°é›†ç¾¤ç®¡ç†ï¼Ÿ" class="headerlink" title="7ã€ç®€è¿°Kuberneteså¦‚ä½•å®ç°é›†ç¾¤ç®¡ç†ï¼Ÿ"></a>7ã€ç®€è¿°Kuberneteså¦‚ä½•å®ç°é›†ç¾¤ç®¡ç†ï¼Ÿ</h3><p>ç­”ï¼š</p><p>åœ¨é›†ç¾¤ç®¡ç†æ–¹é¢ï¼ŒKuberneteså°†é›†ç¾¤ä¸­çš„æœºå™¨åˆ’åˆ†ä¸ºä¸€ä¸ªMasterèŠ‚ç‚¹å’Œä¸€ç¾¤å·¥ä½œèŠ‚ç‚¹Nodeã€‚</p><p>å…¶ä¸­ï¼Œåœ¨MasterèŠ‚ç‚¹è¿è¡Œç€é›†ç¾¤ç®¡ç†ç›¸å…³çš„ä¸€ç»„è¿›ç¨‹kubeapiserverã€kube-controller-managerå’Œkube-schedulerï¼Œè¿™äº›è¿›ç¨‹å®ç°äº†æ•´ä¸ªé›†ç¾¤çš„èµ„æºç®¡ç†ã€Podè°ƒåº¦ã€å¼¹æ€§ä¼¸ç¼©ã€å®‰å…¨æ§åˆ¶ã€ç³»ç»Ÿç›‘æ§å’Œçº é”™ç­‰ç®¡ç†èƒ½åŠ›ï¼Œå¹¶ä¸”éƒ½æ˜¯å…¨è‡ªåŠ¨å®Œæˆçš„ã€‚</p><h3 id="8ã€ç®€è¿°Kubernetesçš„ä¼˜åŠ¿ã€é€‚åº”åœºæ™¯åŠå…¶ç‰¹ç‚¹ï¼Ÿ"><a href="#8ã€ç®€è¿°Kubernetesçš„ä¼˜åŠ¿ã€é€‚åº”åœºæ™¯åŠå…¶ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="8ã€ç®€è¿°Kubernetesçš„ä¼˜åŠ¿ã€é€‚åº”åœºæ™¯åŠå…¶ç‰¹ç‚¹ï¼Ÿ"></a>8ã€ç®€è¿°Kubernetesçš„ä¼˜åŠ¿ã€é€‚åº”åœºæ™¯åŠå…¶ç‰¹ç‚¹ï¼Ÿ</h3><p>ç­”ï¼š<br>Kubernetesä½œä¸ºä¸€ä¸ªå®Œå¤‡çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ”¯æ’‘å¹³å°ï¼Œå…¶ä¸»è¦ä¼˜åŠ¿ï¼š</p><ul><li><p>å®¹å™¨ç¼–æ’</p></li><li><p>è½»é‡çº§</p></li><li><p>å¼€æº</p></li><li><p>å¼¹æ€§ä¼¸ç¼©</p></li><li><p>è´Ÿè½½å‡è¡¡</p></li></ul><p>Kuberneteså¸¸è§åœºæ™¯ï¼š</p><ul><li><p>å¿«é€Ÿéƒ¨ç½²åº”ç”¨</p></li><li><p>å¿«é€Ÿæ‰©å±•åº”ç”¨</p></li><li><p>æ— ç¼å¯¹æ¥æ–°çš„åº”ç”¨åŠŸèƒ½</p></li><li><p>èŠ‚çœèµ„æºï¼Œä¼˜åŒ–ç¡¬ä»¶èµ„æºçš„ä½¿ç”¨</p></li></ul><p>Kubernetesç›¸å…³ç‰¹ç‚¹ï¼š</p><ul><li>å¯ç§»æ¤: æ”¯æŒå…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ã€å¤šé‡äº‘ï¼ˆmulti-cloudï¼‰ã€‚</li><li>å¯æ‰©å±•: æ¨¡å—åŒ–,ã€æ’ä»¶åŒ–ã€å¯æŒ‚è½½ã€å¯ç»„åˆã€‚</li><li>è‡ªåŠ¨åŒ–: è‡ªåŠ¨éƒ¨ç½²ã€è‡ªåŠ¨é‡å¯ã€è‡ªåŠ¨å¤åˆ¶ã€è‡ªåŠ¨ä¼¸ç¼©&#x2F;æ‰©å±•ã€‚</li></ul><h3 id="9ã€ç®€è¿°Kubernetesçš„ç¼ºç‚¹æˆ–å½“å‰çš„ä¸è¶³ä¹‹å¤„ï¼Ÿ"><a href="#9ã€ç®€è¿°Kubernetesçš„ç¼ºç‚¹æˆ–å½“å‰çš„ä¸è¶³ä¹‹å¤„ï¼Ÿ" class="headerlink" title="9ã€ç®€è¿°Kubernetesçš„ç¼ºç‚¹æˆ–å½“å‰çš„ä¸è¶³ä¹‹å¤„ï¼Ÿ"></a>9ã€ç®€è¿°Kubernetesçš„ç¼ºç‚¹æˆ–å½“å‰çš„ä¸è¶³ä¹‹å¤„ï¼Ÿ</h3><p>Kuberneteså½“å‰å­˜åœ¨çš„ç¼ºç‚¹ï¼ˆä¸è¶³ï¼‰å¦‚ä¸‹ï¼š</p><ul><li>å®‰è£…è¿‡ç¨‹å’Œé…ç½®ç›¸å¯¹å›°éš¾å¤æ‚ã€‚</li><li>ç®¡ç†æœåŠ¡ç›¸å¯¹ç¹çã€‚</li><li>è¿è¡Œå’Œç¼–è¯‘éœ€è¦å¾ˆå¤šæ—¶é—´ã€‚</li><li>å®ƒæ¯”å…¶ä»–æ›¿ä»£å“æ›´æ˜‚è´µã€‚</li><li>å¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå¯èƒ½ä¸éœ€è¦æ¶‰åŠKuberneteså³å¯æ»¡è¶³ã€‚</li></ul><h3 id="10ã€ç®€è¿°Kubernetesç›¸å…³åŸºç¡€æ¦‚å¿µï¼Ÿ"><a href="#10ã€ç®€è¿°Kubernetesç›¸å…³åŸºç¡€æ¦‚å¿µï¼Ÿ" class="headerlink" title="10ã€ç®€è¿°Kubernetesç›¸å…³åŸºç¡€æ¦‚å¿µï¼Ÿ"></a>10ã€ç®€è¿°Kubernetesç›¸å…³åŸºç¡€æ¦‚å¿µï¼Ÿ</h3><p>ç­”ï¼š</p><ul><li>masterï¼šk8sé›†ç¾¤çš„ç®¡ç†èŠ‚ç‚¹ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤ï¼Œæä¾›é›†ç¾¤çš„èµ„æºæ•°æ®è®¿é—®å…¥å£ã€‚æ‹¥æœ‰Etcdå­˜å‚¨æœåŠ¡ï¼ˆå¯é€‰ï¼‰ï¼Œè¿è¡ŒApi Serverè¿›ç¨‹ï¼ŒController ManageræœåŠ¡è¿›ç¨‹åŠScheduleræœåŠ¡è¿›ç¨‹ã€‚</li><li>nodeï¼ˆworkerï¼‰ï¼šNodeï¼ˆworkerï¼‰æ˜¯Kubernetesé›†ç¾¤æ¶æ„ä¸­è¿è¡ŒPodçš„æœåŠ¡èŠ‚ç‚¹ï¼Œæ˜¯Kubernetesé›†ç¾¤æ“ä½œçš„å•å…ƒï¼Œç”¨æ¥æ‰¿è½½è¢«åˆ†é…Podçš„è¿è¡Œï¼Œæ˜¯Pod<br>è¿è¡Œçš„å®¿ä¸»æœºã€‚è¿è¡Œdocker eningeæœåŠ¡ï¼Œå®ˆæŠ¤è¿›ç¨‹kuneletåŠè´Ÿè½½å‡è¡¡å™¨kube-proxyã€‚</li><li>podï¼šè¿è¡ŒäºNodeèŠ‚ç‚¹ä¸Šï¼Œè‹¥å¹²ç›¸å…³å®¹å™¨çš„ç»„åˆã€‚Podå†…åŒ…å«çš„å®¹å™¨è¿è¡Œåœ¨åŒä¸€å®¿ä¸»æœºä¸Šï¼Œä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ã€IPåœ°å€å’Œç«¯å£ï¼Œèƒ½å¤Ÿé€šè¿‡localhostè¿›<br>  è¡Œé€šä¿¡ã€‚Podæ˜¯Kurbernetesè¿›è¡Œåˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†çš„æœ€å°å•ä½ï¼Œå®ƒæä¾›äº†æ¯”å®¹å™¨æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œä½¿å¾—éƒ¨ç½²å’Œç®¡ç†æ›´åŠ çµæ´»ã€‚ä¸€ä¸ªPodå¯ä»¥åŒ…å«ä¸€ä¸ªå®¹å™¨æˆ–è€…å¤šä¸ªç›¸å…³å®¹å™¨ã€‚</li><li>labelï¼šKubernetesä¸­çš„Labelå®è´¨æ˜¯ä¸€ç³»åˆ—çš„Key&#x2F;Valueé”®å€¼å¯¹ï¼Œå…¶ä¸­keyä¸valueå¯è‡ªå®šä¹‰ã€‚Labelå¯ä»¥é™„åŠ åˆ°å„ç§èµ„æºå¯¹è±¡ä¸Šï¼Œå¦‚Nodeã€Podã€Serviceã€<br>  RCç­‰ã€‚ä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„Labelï¼ŒåŒä¸€ä¸ªLabelä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå»ã€‚Kubernetesé€šè¿‡Label Selectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰æŸ¥è¯¢<br>  å’Œç­›é€‰èµ„æºå¯¹è±¡ã€‚</li><li>Replication Controllerï¼šReplication Controllerç”¨æ¥ç®¡ç†Podçš„å‰¯æœ¬ï¼Œä¿è¯é›†ç¾¤ä¸­å­˜åœ¨æŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬ã€‚é›†ç¾¤ä¸­å‰¯æœ¬çš„æ•°é‡å¤§äºæŒ‡å®šæ•°é‡ï¼Œåˆ™ä¼šåœæ­¢æŒ‡å®š<br>æ•°é‡ä¹‹å¤–çš„å¤šä½™å®¹å™¨æ•°é‡ã€‚åä¹‹ï¼Œåˆ™ä¼šå¯åŠ¨å°‘äºæŒ‡å®šæ•°é‡ä¸ªæ•°çš„å®¹å™¨ï¼Œä¿è¯æ•°é‡ä¸å˜ã€‚Replication Controlleræ˜¯å®ç°å¼¹æ€§ä¼¸ç¼©ã€åŠ¨æ€æ‰©å®¹å’Œæ»šåŠ¨å‡çº§çš„æ ¸å¿ƒã€‚</li><li>Deploymentï¼šDeploymentåœ¨å†…éƒ¨ä½¿ç”¨äº†RSæ¥å®ç°ç›®çš„ï¼ŒDeploymentç›¸å½“äºRCçš„ä¸€æ¬¡å‡çº§ï¼Œå…¶æœ€å¤§çš„ç‰¹è‰²ä¸ºå¯ä»¥éšæ—¶è·çŸ¥å½“å‰Podçš„éƒ¨ç½²è¿›åº¦ã€‚</li><li>HPAï¼ˆHorizontal Pod Autoscalerï¼‰ï¼šPodçš„æ¨ªå‘è‡ªåŠ¨æ‰©å®¹ï¼Œä¹Ÿæ˜¯Kubernetesçš„ä¸€ç§èµ„æºï¼Œé€šè¿‡è¿½è¸ªåˆ†æRCæ§åˆ¶çš„æ‰€æœ‰Podç›®æ ‡çš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯<br>  å¦éœ€è¦é’ˆå¯¹æ€§çš„è°ƒæ•´Podå‰¯æœ¬æ•°é‡ã€‚</li><li>Serviceï¼šServiceå®šä¹‰äº†Podçš„é€»è¾‘é›†åˆå’Œè®¿é—®è¯¥é›†åˆçš„ç­–ç•¥ï¼Œæ˜¯çœŸå®æœåŠ¡çš„æŠ½è±¡ã€‚Serviceæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æœåŠ¡è®¿é—®å…¥å£ä»¥åŠæœåŠ¡ä»£ç†å’Œå‘ç°æœºåˆ¶ï¼Œå…³è”å¤šä¸ªç›¸åŒLabelçš„Podï¼Œç”¨æˆ·ä¸éœ€è¦äº†è§£åå°Podæ˜¯å¦‚ä½•è¿è¡Œã€‚</li><li>Volumeï¼šVolumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼ŒKubernetesä¸­çš„Volumeæ˜¯å®šä¹‰åœ¨Podä¸Šï¼Œå¯ä»¥è¢«ä¸€ä¸ªæˆ–å¤šä¸ªPodä¸­çš„å®¹å™¨æŒ‚è½½åˆ°æŸä¸ªç›®å½•ä¸‹ã€‚</li><li>Namespaceï¼šNamespaceç”¨äºå®ç°å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ï¼Œå¯å°†é›†ç¾¤å†…éƒ¨çš„èµ„æºå¯¹è±¡åˆ†é…åˆ°ä¸åŒçš„Namespaceä¸­ï¼Œå½¢æˆé€»è¾‘ä¸Šçš„ä¸åŒé¡¹ç›®ã€å°ç»„æˆ–ç”¨æˆ·ç»„ï¼Œä¾¿äºä¸åŒçš„Namespaceåœ¨å…±äº«ä½¿ç”¨æ•´ä¸ªé›†ç¾¤çš„èµ„æºçš„åŒæ—¶è¿˜èƒ½è¢«åˆ†åˆ«ç®¡ç†ã€‚</li></ul><h3 id="11ã€ç®€è¿°Kubernetesé›†ç¾¤ç›¸å…³ç»„ä»¶ï¼Ÿ"><a href="#11ã€ç®€è¿°Kubernetesé›†ç¾¤ç›¸å…³ç»„ä»¶ï¼Ÿ" class="headerlink" title="11ã€ç®€è¿°Kubernetesé›†ç¾¤ç›¸å…³ç»„ä»¶ï¼Ÿ"></a>11ã€ç®€è¿°Kubernetesé›†ç¾¤ç›¸å…³ç»„ä»¶ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetes Masteræ§åˆ¶ç»„ä»¶ï¼Œè°ƒåº¦ç®¡ç†æ•´ä¸ªç³»ç»Ÿï¼ˆé›†ç¾¤ï¼‰ï¼ŒåŒ…å«å¦‚ä¸‹ç»„ä»¶:</p><ul><li>Kubernetes API Serverï¼šä½œä¸ºKubernetesç³»ç»Ÿçš„å…¥å£ï¼Œå…¶å°è£…äº†æ ¸å¿ƒå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä»¥RESTful APIæ¥å£æ–¹å¼æä¾›ç»™å¤–éƒ¨å®¢æˆ·å’Œå†…éƒ¨ç»„ä»¶è°ƒç”¨ï¼Œé›†ç¾¤å†…<br>å„ä¸ªåŠŸèƒ½æ¨¡å—ä¹‹é—´æ•°æ®äº¤äº’å’Œé€šä¿¡çš„ä¸­å¿ƒæ¢çº½ã€‚</li><li>Kubernetes Schedulerï¼šä¸ºæ–°å»ºç«‹çš„Podè¿›è¡ŒèŠ‚ç‚¹(node)é€‰æ‹©(å³åˆ†é…æœºå™¨)ï¼Œè´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦ã€‚</li><li>Kubernetes Controllerï¼šè´Ÿè´£æ‰§è¡Œå„ç§æ§åˆ¶å™¨ï¼Œç›®å‰å·²ç»æä¾›äº†å¾ˆå¤šæ§åˆ¶å™¨æ¥ä¿è¯Kubernetesçš„æ­£å¸¸è¿è¡Œã€‚</li><li>Replication Controllerï¼šç®¡ç†ç»´æŠ¤Replication Controllerï¼Œå…³è”ReplicationControllerå’ŒPodï¼Œä¿è¯Replication Controllerå®šä¹‰çš„å‰¯æœ¬æ•°é‡ä¸å®é™…è¿è¡Œ<br>  Podæ•°é‡ä¸€è‡´ã€‚</li><li>Node Controllerï¼šç®¡ç†ç»´æŠ¤Nodeï¼Œå®šæœŸæ£€æŸ¥Nodeçš„å¥åº·çŠ¶æ€ï¼Œæ ‡è¯†å‡º(å¤±æ•ˆ|æœªå¤±æ•ˆ)çš„NodeèŠ‚ç‚¹ã€‚</li><li>Namespace Controllerï¼šç®¡ç†ç»´æŠ¤Namespaceï¼Œå®šæœŸæ¸…ç†æ— æ•ˆçš„Namespaceï¼ŒåŒ…æ‹¬Namesapceä¸‹çš„APIå¯¹è±¡ï¼Œæ¯”å¦‚Podã€Serviceç­‰ã€‚</li><li>Service Controllerï¼šç®¡ç†ç»´æŠ¤Serviceï¼Œæä¾›è´Ÿè½½ä»¥åŠæœåŠ¡ä»£ç†ã€‚</li><li>EndPoints Controllerï¼šç®¡ç†ç»´æŠ¤Endpointsï¼Œå…³è”Serviceå’ŒPodï¼Œåˆ›å»ºEndpointsä¸ºServiceçš„åç«¯ï¼Œå½“Podå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®æ—¶æ›´æ–°Endpointsã€‚</li><li>Service Account Controllerï¼šç®¡ç†ç»´æŠ¤Service Accountï¼Œä¸ºæ¯ä¸ªNamespaceåˆ›å»ºé»˜è®¤çš„Service Accountï¼ŒåŒæ—¶ä¸ºService Accountåˆ›å»ºService Account<br>  Secretã€‚</li><li>Persistent Volume Controllerï¼šç®¡ç†ç»´æŠ¤Persistent Volumeå’ŒPersistent Volume Claimï¼Œä¸ºæ–°çš„Persistent Volume Claimåˆ†é…Persistent Volumeè¿›<br>  è¡Œç»‘å®šï¼Œä¸ºé‡Šæ”¾çš„Persistent Volumeæ‰§è¡Œæ¸…ç†å›æ”¶ã€‚</li><li>Daemon Set Controllerï¼šç®¡ç†ç»´æŠ¤Daemon Setï¼Œè´Ÿè´£åˆ›å»ºDaemon Podï¼Œä¿è¯æŒ‡å®šçš„Nodeä¸Šæ­£å¸¸çš„è¿è¡ŒDaemon Podã€‚</li><li>Deployment Controllerï¼šç®¡ç†ç»´æŠ¤Deploymentï¼Œå…³è”Deploymentå’ŒReplication Controllerï¼Œä¿è¯è¿è¡ŒæŒ‡å®šæ•°é‡çš„Podã€‚å½“Deploymentæ›´æ–°æ—¶ï¼Œ<br>æ§åˆ¶å®ç°Replication Controllerå’ŒPodçš„æ›´æ–°ã€‚</li><li>Job Controllerï¼šç®¡ç†ç»´æŠ¤Jobï¼Œä¸ºJodåˆ›å»ºä¸€æ¬¡æ€§ä»»åŠ¡Podï¼Œä¿è¯å®ŒæˆJobæŒ‡å®šå®Œæˆçš„ä»»åŠ¡æ•°ç›®</li><li>Pod Autoscaler Controllerï¼šå®ç°Podçš„è‡ªåŠ¨ä¼¸ç¼©ï¼Œå®šæ—¶è·å–ç›‘æ§æ•°æ®ï¼Œè¿›è¡Œç­–ç•¥åŒ¹é…ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶æ‰§è¡ŒPodçš„ä¼¸ç¼©åŠ¨ä½œã€‚</li></ul><h3 id="12ã€ç®€è¿°Kubernetes-RCçš„æœºåˆ¶ï¼Ÿ"><a href="#12ã€ç®€è¿°Kubernetes-RCçš„æœºåˆ¶ï¼Ÿ" class="headerlink" title="12ã€ç®€è¿°Kubernetes RCçš„æœºåˆ¶ï¼Ÿ"></a>12ã€ç®€è¿°Kubernetes RCçš„æœºåˆ¶ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Replication Controllerç”¨æ¥ç®¡ç†Podçš„å‰¯æœ¬ï¼Œä¿è¯é›†ç¾¤ä¸­å­˜åœ¨æŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬ã€‚å½“å®šä¹‰äº†RCå¹¶æäº¤è‡³Kubernetesé›†ç¾¤ä¸­ä¹‹åï¼ŒMasterèŠ‚ç‚¹ä¸Šçš„Controller<br>Managerç»„ä»¶è·æ‚‰ï¼Œå¹¶åŒæ—¶å·¡æ£€ç³»ç»Ÿä¸­å½“å‰å­˜æ´»çš„ç›®æ ‡Podï¼Œå¹¶ç¡®ä¿ç›®æ ‡Podå®ä¾‹çš„æ•°é‡åˆšå¥½ç­‰äºæ­¤RCçš„æœŸæœ›å€¼ï¼Œè‹¥å­˜åœ¨è¿‡å¤šçš„Podå‰¯æœ¬åœ¨è¿è¡Œï¼Œç³»ç»Ÿä¼šåœæ­¢ä¸€äº›<br>Podï¼Œåä¹‹åˆ™è‡ªåŠ¨åˆ›å»ºä¸€äº›Podã€‚</p><h3 id="13ã€ç®€è¿°Kubernetes-Replica-Set-å’Œ-Replication-Controller-ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#13ã€ç®€è¿°Kubernetes-Replica-Set-å’Œ-Replication-Controller-ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="13ã€ç®€è¿°Kubernetes Replica Set å’Œ Replication Controller ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>13ã€ç®€è¿°Kubernetes Replica Set å’Œ Replication Controller ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Replica Set å’Œ Replication Controller ç±»ä¼¼ï¼Œéƒ½æ˜¯ç¡®ä¿åœ¨ä»»ä½•ç»™å®šæ—¶é—´è¿è¡ŒæŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬ã€‚ä¸åŒä¹‹å¤„åœ¨äºRS ä½¿ç”¨åŸºäºé›†åˆçš„é€‰æ‹©å™¨ï¼Œè€Œ Replication<br>Controller ä½¿ç”¨åŸºäºæƒé™çš„é€‰æ‹©å™¨ã€‚</p><h3 id="14ã€ç®€è¿°kube-proxyä½œç”¨ï¼Ÿ"><a href="#14ã€ç®€è¿°kube-proxyä½œç”¨ï¼Ÿ" class="headerlink" title="14ã€ç®€è¿°kube-proxyä½œç”¨ï¼Ÿ"></a>14ã€ç®€è¿°kube-proxyä½œç”¨ï¼Ÿ</h3><p>ç­”ï¼škube-proxy è¿è¡Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œå®ƒç›‘å¬ apiserver ä¸­ service å’Œ endpoint çš„å˜åŒ–æƒ…å†µï¼Œåˆ›å»ºè·¯ç”±è§„åˆ™ä»¥æä¾›æœåŠ¡ IP å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ç®€å•ç†è§£æ­¤è¿›ç¨‹æ˜¯Serviceçš„é€æ˜ä»£ç†å…¼è´Ÿè½½å‡è¡¡å™¨ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†åˆ°æŸä¸ªServiceçš„è®¿é—®è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¤šä¸ªPodå®ä¾‹ä¸Šã€‚</p><h3 id="15ã€ç®€è¿°kube-proxy-iptablesåŸç†ï¼Ÿ"><a href="#15ã€ç®€è¿°kube-proxy-iptablesåŸç†ï¼Ÿ" class="headerlink" title="15ã€ç®€è¿°kube-proxy iptablesåŸç†ï¼Ÿ"></a>15ã€ç®€è¿°kube-proxy iptablesåŸç†ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesä»1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå°†iptablesä½œä¸ºkube-proxyçš„é»˜è®¤æ¨¡å¼ã€‚iptablesæ¨¡å¼ä¸‹çš„kube-proxyä¸å†èµ·åˆ°Proxyçš„ä½œç”¨ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½ï¼šé€šè¿‡API<br>Serverçš„Watchæ¥å£å®æ—¶è·Ÿè¸ªServiceä¸Endpointçš„å˜æ›´ä¿¡æ¯ï¼Œå¹¶æ›´æ–°å¯¹åº”çš„iptablesè§„åˆ™ï¼ŒClientçš„è¯·æ±‚æµé‡åˆ™é€šè¿‡iptablesçš„NATæœºåˆ¶â€œç›´æ¥è·¯ç”±â€åˆ°ç›®æ ‡<br>Podã€‚</p><h3 id="16ã€ç®€è¿°kube-proxy-ipvsåŸç†ï¼Ÿ"><a href="#16ã€ç®€è¿°kube-proxy-ipvsåŸç†ï¼Ÿ" class="headerlink" title="16ã€ç®€è¿°kube-proxy ipvsåŸç†ï¼Ÿ"></a>16ã€ç®€è¿°kube-proxy ipvsåŸç†ï¼Ÿ</h3><p>ç­”ï¼š</p><p>IPVS åœ¨Kubernetes1.11 ä¸­å‡çº§ä¸ºGA ç¨³å®šç‰ˆã€‚IPVS åˆ™ä¸“é—¨ç”¨äºé«˜æ€§èƒ½è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ˆHashè¡¨ï¼‰ï¼Œå…è®¸å‡ ä¹æ— é™çš„è§„æ¨¡æ‰©å¼ ï¼Œå› æ­¤è¢«kubeproxyé‡‡çº³ä¸ºæœ€æ–°æ¨¡å¼ã€‚<br>åœ¨IPVSæ¨¡å¼ä¸‹ï¼Œä½¿ç”¨iptablesçš„æ‰©å±•ipsetï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨iptablesæ¥ç”Ÿæˆè§„åˆ™é“¾ã€‚iptablesè§„åˆ™é“¾æ˜¯ä¸€ä¸ªçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œipsetåˆ™å¼•å…¥äº†å¸¦ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤å½“è§„åˆ™å¾ˆå¤šæ—¶ï¼Œä¹Ÿå¯ä»¥å¾ˆé«˜æ•ˆåœ°æŸ¥æ‰¾å’ŒåŒ¹é…ã€‚<br>å¯ä»¥å°†ipsetç®€å•ç†è§£ä¸ºä¸€ä¸ªIPï¼ˆæ®µï¼‰çš„é›†åˆï¼Œè¿™ä¸ªé›†åˆçš„å†…å®¹å¯ä»¥æ˜¯IPåœ°å€ã€IPç½‘æ®µã€ç«¯å£ç­‰ï¼Œiptableså¯ä»¥ç›´æ¥æ·»åŠ è§„åˆ™å¯¹è¿™ä¸ªâ€œå¯å˜çš„é›†åˆâ€è¿›è¡Œæ“ä½œï¼Œè¿™æ ·åšçš„å¥½å¤„åœ¨äºå¯ä»¥å¤§å¤§å‡å°‘iptablesè§„åˆ™çš„æ•°é‡ï¼Œä»è€Œå‡å°‘æ€§èƒ½æŸè€—ã€‚</p><h3 id="17ã€ç®€è¿°kube-proxy-ipvså’Œiptablesçš„å¼‚åŒï¼Ÿ"><a href="#17ã€ç®€è¿°kube-proxy-ipvså’Œiptablesçš„å¼‚åŒï¼Ÿ" class="headerlink" title="17ã€ç®€è¿°kube-proxy ipvså’Œiptablesçš„å¼‚åŒï¼Ÿ"></a>17ã€ç®€è¿°kube-proxy ipvså’Œiptablesçš„å¼‚åŒï¼Ÿ</h3><p>ç­”ï¼š</p><p>iptablesä¸IPVSéƒ½æ˜¯åŸºäºNetfilter å®ç°çš„ï¼Œä½†å› ä¸ºå®šä½ä¸åŒï¼ŒäºŒè€…æœ‰ç€æœ¬è´¨çš„å·®åˆ«ï¼šiptablesæ˜¯ä¸ºé˜²ç«å¢™è€Œè®¾è®¡çš„ï¼›IPVSåˆ™ä¸“é—¨ç”¨äºé«˜æ€§èƒ½è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä½¿ç”¨æ›´é«˜<br>æ•ˆçš„æ•°æ®ç»“æ„ï¼ˆHashè¡¨ï¼‰ï¼Œå…è®¸å‡ ä¹æ— é™çš„è§„æ¨¡æ‰©å¼ ã€‚<br>ä¸iptablesç›¸æ¯”ï¼ŒIPVSæ‹¥æœ‰ä»¥ä¸‹æ˜æ˜¾ä¼˜åŠ¿ï¼š</p><ul><li>1ã€ä¸ºå¤§å‹é›†ç¾¤æä¾›äº†æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œæ€§èƒ½ï¼›</li><li>2ã€æ”¯æŒæ¯”iptablesæ›´å¤æ‚çš„å¤åˆ¶å‡è¡¡ç®—æ³•ï¼ˆæœ€å°è´Ÿè½½ã€æœ€å°‘è¿æ¥ã€åŠ æƒç­‰ï¼‰ï¼›</li><li>3ã€æ”¯æŒæœåŠ¡å™¨å¥åº·æ£€æŸ¥å’Œè¿æ¥é‡è¯•ç­‰åŠŸèƒ½ï¼›</li><li>4ã€å¯ä»¥åŠ¨æ€ä¿®æ”¹ipsetçš„é›†åˆï¼Œå³ä½¿iptablesçš„è§„åˆ™æ­£åœ¨ä½¿ç”¨è¿™ä¸ªé›†åˆã€‚</li></ul><h3 id="18ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯é™æ€Podï¼Ÿ"><a href="#18ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯é™æ€Podï¼Ÿ" class="headerlink" title="18ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯é™æ€Podï¼Ÿ"></a>18ã€ç®€è¿°Kubernetesä¸­ä»€ä¹ˆæ˜¯é™æ€Podï¼Ÿ</h3><p>ç­”ï¼š</p><p>é™æ€podæ˜¯ç”±kubeletè¿›è¡Œç®¡ç†çš„ä»…å­˜åœ¨äºç‰¹å®šNodeçš„Podä¸Šï¼Œä»–ä»¬ä¸èƒ½é€šè¿‡API Serverè¿›è¡Œç®¡ç†ï¼Œæ— æ³•ä¸ReplicationControllerã€Deploymentæˆ–è€…<br>DaemonSetè¿›è¡Œå…³è”ï¼Œå¹¶ä¸”kubeletæ— æ³•å¯¹ä»–ä»¬è¿›è¡Œå¥åº·æ£€æŸ¥ã€‚é™æ€Podæ€»æ˜¯ç”±kubeletè¿›è¡Œåˆ›å»ºï¼Œå¹¶ä¸”æ€»æ˜¯åœ¨kubeletæ‰€åœ¨çš„Nodeä¸Šè¿è¡Œã€‚</p><h3 id="19ã€ç®€è¿°Kubernetesä¸­Podå¯èƒ½ä½äºçš„çŠ¶æ€ï¼Ÿ"><a href="#19ã€ç®€è¿°Kubernetesä¸­Podå¯èƒ½ä½äºçš„çŠ¶æ€ï¼Ÿ" class="headerlink" title="19ã€ç®€è¿°Kubernetesä¸­Podå¯èƒ½ä½äºçš„çŠ¶æ€ï¼Ÿ"></a>19ã€ç®€è¿°Kubernetesä¸­Podå¯èƒ½ä½äºçš„çŠ¶æ€ï¼Ÿ</h3><p>ç­”ï¼š</p><ul><li>Pendingï¼šAPI Serverå·²ç»åˆ›å»ºè¯¥Podï¼Œä¸”Podå†…è¿˜æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„é•œåƒæ²¡æœ‰åˆ›å»ºï¼ŒåŒ…æ‹¬æ­£åœ¨ä¸‹è½½é•œåƒçš„è¿‡ç¨‹ã€‚</li><li>Runningï¼šPodå†…æ‰€æœ‰å®¹å™¨å‡å·²åˆ›å»ºï¼Œä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ã€æ­£åœ¨å¯åŠ¨çŠ¶æ€æˆ–æ­£åœ¨é‡å¯çŠ¶æ€ã€‚</li><li>Succeededï¼šPodå†…æ‰€æœ‰å®¹å™¨å‡æˆåŠŸæ‰§è¡Œé€€å‡ºï¼Œä¸”ä¸ä¼šé‡å¯ã€‚</li><li>Failedï¼šPodå†…æ‰€æœ‰å®¹å™¨å‡å·²é€€å‡ºï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨é€€å‡ºä¸ºå¤±è´¥çŠ¶æ€ã€‚</li><li>Unknownï¼šç”±äºæŸç§åŸå› æ— æ³•è·å–è¯¥PodçŠ¶æ€ï¼Œå¯èƒ½ç”±äºç½‘ç»œé€šä¿¡ä¸ç•…å¯¼è‡´ã€‚</li></ul><h3 id="20ã€ç®€è¿°Kubernetesåˆ›å»ºä¸€ä¸ªPodçš„ä¸»è¦æµç¨‹ï¼Ÿ"><a href="#20ã€ç®€è¿°Kubernetesåˆ›å»ºä¸€ä¸ªPodçš„ä¸»è¦æµç¨‹ï¼Ÿ" class="headerlink" title="20ã€ç®€è¿°Kubernetesåˆ›å»ºä¸€ä¸ªPodçš„ä¸»è¦æµç¨‹ï¼Ÿ"></a>20ã€ç®€è¿°Kubernetesåˆ›å»ºä¸€ä¸ªPodçš„ä¸»è¦æµç¨‹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesä¸­åˆ›å»ºä¸€ä¸ªPodæ¶‰åŠå¤šä¸ªç»„ä»¶ä¹‹é—´è”åŠ¨ï¼Œä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>1ã€å®¢æˆ·ç«¯æäº¤Podçš„é…ç½®ä¿¡æ¯ï¼ˆå¯ä»¥æ˜¯yamlæ–‡ä»¶å®šä¹‰çš„ä¿¡æ¯ï¼‰åˆ°kubeapiserverã€‚</li><li>2ã€Apiserveræ”¶åˆ°æŒ‡ä»¤åï¼Œé€šçŸ¥ç»™controller-manageråˆ›å»ºä¸€ä¸ªèµ„æºå¯¹è±¡ã€‚</li><li>3ã€Controller-manageré€šè¿‡api-serverå°†podçš„é…ç½®ä¿¡æ¯å­˜å‚¨åˆ°ETCDæ•°æ®ä¸­å¿ƒä¸­ã€‚</li><li>4ã€Kube-scheduleræ£€æµ‹åˆ°podä¿¡æ¯ä¼šå¼€å§‹è°ƒåº¦é¢„é€‰ï¼Œä¼šå…ˆè¿‡æ»¤æ‰ä¸ç¬¦åˆPodèµ„æºé…ç½®è¦æ±‚çš„èŠ‚ç‚¹ï¼Œç„¶åå¼€å§‹è°ƒåº¦è°ƒä¼˜ï¼Œä¸»è¦æ˜¯æŒ‘é€‰å‡ºæ›´é€‚åˆè¿è¡Œpod çš„èŠ‚ç‚¹ï¼Œç„¶åå°†podçš„èµ„æºé…ç½®å•å‘é€åˆ°nodeèŠ‚ç‚¹ä¸Šçš„kubeletç»„ä»¶ä¸Šã€‚</li><li>5ã€Kubeletæ ¹æ®schedulerå‘æ¥çš„èµ„æºé…ç½®å•è¿è¡Œpodï¼Œè¿è¡ŒæˆåŠŸåï¼Œå°†podçš„è¿è¡Œä¿¡æ¯è¿”å›ç»™schedulerï¼Œschedulerå°†è¿”å›çš„podè¿è¡ŒçŠ¶å†µçš„ä¿¡æ¯å­˜å‚¨åˆ°<br>  etcdæ•°æ®ä¸­å¿ƒã€‚</li></ul><h3 id="21ã€ç®€è¿°Kubernetesä¸­Podçš„é‡å¯ç­–ç•¥ï¼Ÿ"><a href="#21ã€ç®€è¿°Kubernetesä¸­Podçš„é‡å¯ç­–ç•¥ï¼Ÿ" class="headerlink" title="21ã€ç®€è¿°Kubernetesä¸­Podçš„é‡å¯ç­–ç•¥ï¼Ÿ"></a>21ã€ç®€è¿°Kubernetesä¸­Podçš„é‡å¯ç­–ç•¥ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Podé‡å¯ç­–ç•¥ï¼ˆRestartPolicyï¼‰åº”ç”¨äºPodå†…çš„æ‰€æœ‰å®¹å™¨ï¼Œå¹¶ä¸”ä»…åœ¨Podæ‰€å¤„çš„Nodeä¸Šç”±kubeletè¿›è¡Œåˆ¤æ–­å’Œé‡å¯æ“ä½œã€‚å½“æŸä¸ªå®¹å™¨å¼‚å¸¸é€€å‡ºæˆ–è€…å¥åº·æ£€æŸ¥å¤±è´¥<br>æ—¶ï¼Œkubeletå°†æ ¹æ®RestartPolicyçš„è®¾ç½®æ¥è¿›è¡Œç›¸åº”æ“ä½œã€‚</p><p>Podçš„é‡å¯ç­–ç•¥åŒ…æ‹¬Alwaysã€OnFailureå’ŒNeverï¼Œé»˜è®¤å€¼ä¸ºAlwaysã€‚</p><ul><li>Alwaysï¼šå½“å®¹å™¨å¤±æ•ˆæ—¶ï¼Œç”±kubeletè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼›</li><li>OnFailureï¼šå½“å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶ï¼Œç”±kubeletè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼›</li><li>Neverï¼šä¸è®ºå®¹å™¨è¿è¡ŒçŠ¶æ€å¦‚ä½•ï¼Œkubeletéƒ½ä¸ä¼šé‡å¯è¯¥å®¹å™¨ã€‚</li></ul><p>åŒæ—¶Podçš„é‡å¯ç­–ç•¥ä¸æ§åˆ¶æ–¹å¼å…³è”ï¼Œå½“å‰å¯ç”¨äºç®¡ç†Podçš„æ§åˆ¶å™¨åŒ…æ‹¬ReplicationControllerã€Jobã€DaemonSet åŠç›´æ¥ç®¡ç†kubelet ç®¡ç†ï¼ˆé™æ€Podï¼‰ã€‚<br>ä¸åŒæ§åˆ¶å™¨çš„é‡å¯ç­–ç•¥é™åˆ¶å¦‚ä¸‹ï¼š</p><ul><li>RCå’ŒDaemonSetï¼šå¿…é¡»è®¾ç½®ä¸ºAlwaysï¼Œéœ€è¦ä¿è¯è¯¥å®¹å™¨æŒç»­è¿è¡Œï¼›</li><li>Jobï¼šOnFailureæˆ–Neverï¼Œç¡®ä¿å®¹å™¨æ‰§è¡Œå®Œæˆåä¸å†é‡å¯ï¼›</li><li>kubeletï¼šåœ¨Podå¤±æ•ˆæ—¶é‡å¯ï¼Œä¸è®ºå°†RestartPolicyè®¾ç½®ä¸ºä½•å€¼ï¼Œä¹Ÿä¸ä¼šå¯¹Podè¿›è¡Œå¥åº·æ£€æŸ¥ã€‚</li></ul><h3 id="22ã€ç®€è¿°Kubernetesä¸­Podçš„å¥åº·æ£€æŸ¥æ–¹å¼ï¼Ÿ"><a href="#22ã€ç®€è¿°Kubernetesä¸­Podçš„å¥åº·æ£€æŸ¥æ–¹å¼ï¼Ÿ" class="headerlink" title="22ã€ç®€è¿°Kubernetesä¸­Podçš„å¥åº·æ£€æŸ¥æ–¹å¼ï¼Ÿ"></a>22ã€ç®€è¿°Kubernetesä¸­Podçš„å¥åº·æ£€æŸ¥æ–¹å¼ï¼Ÿ</h3><p>ç­”ï¼š</p><p>å¯¹Podçš„å¥åº·æ£€æŸ¥å¯ä»¥é€šè¿‡ä¸¤ç±»æ¢é’ˆæ¥æ£€æŸ¥ï¼šLivenessProbeå’ŒReadinessProbeã€‚</p><ul><li>LivenessProbeæ¢é’ˆï¼šç”¨äºåˆ¤æ–­å®¹å™¨æ˜¯å¦å­˜æ´»ï¼ˆrunningçŠ¶æ€ï¼‰ï¼Œå¦‚æœLivenessProbeæ¢é’ˆæ¢æµ‹åˆ°å®¹å™¨ä¸å¥åº·ï¼Œåˆ™kubeletå°†æ€æ‰è¯¥å®¹å™¨ï¼Œå¹¶æ ¹æ®å®¹å™¨<br>çš„é‡å¯ç­–ç•¥åšç›¸åº”å¤„ç†ã€‚è‹¥ä¸€ä¸ªå®¹å™¨ä¸åŒ…å«LivenessProbeæ¢é’ˆï¼Œkubeletè®¤ä¸ºè¯¥å®¹å™¨çš„LivenessProbeæ¢é’ˆè¿”å›å€¼ç”¨äºæ˜¯â€œSuccessâ€ã€‚</li><li>ReadineeProbeæ¢é’ˆï¼šç”¨äºåˆ¤æ–­å®¹å™¨æ˜¯å¦å¯åŠ¨å®Œæˆï¼ˆreadyçŠ¶æ€ï¼‰ã€‚å¦‚æœReadinessProbeæ¢é’ˆæ¢æµ‹åˆ°å¤±è´¥ï¼Œåˆ™Podçš„çŠ¶æ€å°†è¢«ä¿®æ”¹ã€‚Endpoint<br>Controllerå°†ä»Serviceçš„Endpointä¸­åˆ é™¤åŒ…å«è¯¥å®¹å™¨æ‰€åœ¨Podçš„Eenpointã€‚</li><li>startupProbeæ¢é’ˆï¼šå¯åŠ¨æ£€æŸ¥æœºåˆ¶ï¼Œåº”ç”¨ä¸€äº›å¯åŠ¨ç¼“æ…¢çš„ä¸šåŠ¡ï¼Œé¿å…ä¸šåŠ¡é•¿æ—¶é—´å¯åŠ¨è€Œè¢«ä¸Šé¢ä¸¤ç±»æ¢é’ˆkillæ‰ã€‚</li></ul><h3 id="23ã€ç®€è¿°Kubernetes-Podçš„LivenessProbeæ¢é’ˆçš„å¸¸è§æ–¹å¼ï¼Ÿ"><a href="#23ã€ç®€è¿°Kubernetes-Podçš„LivenessProbeæ¢é’ˆçš„å¸¸è§æ–¹å¼ï¼Ÿ" class="headerlink" title="23ã€ç®€è¿°Kubernetes Podçš„LivenessProbeæ¢é’ˆçš„å¸¸è§æ–¹å¼ï¼Ÿ"></a>23ã€ç®€è¿°Kubernetes Podçš„LivenessProbeæ¢é’ˆçš„å¸¸è§æ–¹å¼ï¼Ÿ</h3><p>ç­”ï¼š</p><p>kubeletå®šæœŸæ‰§è¡ŒLivenessProbeæ¢é’ˆæ¥è¯Šæ–­å®¹å™¨çš„å¥åº·çŠ¶æ€ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>ExecActionï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œè‹¥è¿”å›ç ä¸º0ï¼Œåˆ™è¡¨æ˜å®¹å™¨å¥åº·ã€‚</li><li>TCPSocketActionï¼šé€šè¿‡å®¹å™¨çš„IPåœ°å€å’Œç«¯å£å·æ‰§è¡ŒTCPæ£€æŸ¥ï¼Œè‹¥èƒ½å»ºç«‹TCPè¿æ¥ï¼Œåˆ™è¡¨æ˜å®¹å™¨å¥åº·ã€‚</li><li>HTTPGetActionï¼šé€šè¿‡å®¹å™¨çš„IPåœ°å€ã€ç«¯å£å·åŠè·¯å¾„è°ƒç”¨HTTP Getæ–¹æ³•ï¼Œè‹¥å“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº200ä¸”å°äº400ï¼Œåˆ™è¡¨æ˜å®¹å™¨å¥åº·ã€‚</li></ul><h3 id="24ã€ç®€è¿°Kubernetes-Podçš„å¸¸è§è°ƒåº¦æ–¹å¼ï¼Ÿ"><a href="#24ã€ç®€è¿°Kubernetes-Podçš„å¸¸è§è°ƒåº¦æ–¹å¼ï¼Ÿ" class="headerlink" title="24ã€ç®€è¿°Kubernetes Podçš„å¸¸è§è°ƒåº¦æ–¹å¼ï¼Ÿ"></a>24ã€ç®€è¿°Kubernetes Podçš„å¸¸è§è°ƒåº¦æ–¹å¼ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesä¸­ï¼ŒPodé€šå¸¸æ˜¯å®¹å™¨çš„è½½ä½“ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å¸¸è§è°ƒåº¦æ–¹å¼ï¼š</p><ul><li>Deployment æˆ–RCï¼šè¯¥è°ƒåº¦ç­–ç•¥ä¸»è¦åŠŸèƒ½å°±æ˜¯è‡ªåŠ¨éƒ¨ç½²ä¸€ä¸ªå®¹å™¨åº”ç”¨çš„å¤šä»½å‰¯æœ¬ï¼Œä»¥åŠæŒç»­ç›‘æ§å‰¯æœ¬çš„æ•°é‡ï¼Œåœ¨é›†ç¾¤å†…å§‹ç»ˆç»´æŒç”¨æˆ·æŒ‡å®šçš„å‰¯æœ¬æ•°é‡ã€‚</li><li>NodeSelectorï¼šå®šå‘è°ƒåº¦ï¼Œå½“éœ€è¦æ‰‹åŠ¨æŒ‡å®šå°†Podè°ƒåº¦åˆ°ç‰¹å®šNodeä¸Šï¼Œå¯ä»¥é€šè¿‡Nodeçš„æ ‡ç­¾ï¼ˆLabelï¼‰å’ŒPodçš„nodeSelector å±æ€§ç›¸åŒ¹é…ã€‚</li><li>NodeAffinity äº²å’Œæ€§è°ƒåº¦ï¼šäº²å’Œæ€§è°ƒåº¦æœºåˆ¶æå¤§çš„æ‰©å±•äº†Podçš„è°ƒåº¦èƒ½åŠ›ï¼Œç›®å‰æœ‰ä¸¤ç§èŠ‚ç‚¹äº²å’ŒåŠ›è¡¨è¾¾ï¼š</li><li>requiredDuringSchedulingIgnoredDuringExecutionï¼šç¡¬è§„åˆ™ï¼Œå¿…é¡»æ»¡è¶³æŒ‡å®šçš„è§„åˆ™ï¼Œè°ƒåº¦å™¨æ‰å¯ä»¥è°ƒåº¦Pod è‡³Node ä¸Šï¼ˆç±»ä¼¼nodeSelectorï¼Œè¯­æ³•ä¸åŒï¼‰ã€‚</li><li>preferredDuringSchedulingIgnoredDuringExecutionï¼šè½¯è§„åˆ™ï¼Œä¼˜å…ˆè°ƒåº¦è‡³æ»¡è¶³çš„Nodeçš„èŠ‚ç‚¹ï¼Œä½†ä¸å¼ºæ±‚ï¼Œå¤šä¸ªä¼˜å…ˆçº§è§„åˆ™è¿˜å¯ä»¥è®¾ç½®æƒé‡å€¼ã€‚</li><li>Taintså’ŒTolerationsï¼ˆæ±¡ç‚¹å’Œå®¹å¿ï¼‰ï¼š<ul><li>Taintï¼šä½¿Nodeæ‹’ç»ç‰¹å®šPodè¿è¡Œï¼›</li><li>Tolerationï¼šä¸ºPodçš„å±æ€§ï¼Œè¡¨ç¤ºPodèƒ½å®¹å¿ï¼ˆè¿è¡Œï¼‰æ ‡æ³¨äº†Taintçš„Nodeã€‚</li></ul></li></ul><h3 id="25ã€ç®€è¿°Kubernetesåˆå§‹åŒ–å®¹å™¨ï¼ˆinit-containerï¼‰ï¼Ÿ"><a href="#25ã€ç®€è¿°Kubernetesåˆå§‹åŒ–å®¹å™¨ï¼ˆinit-containerï¼‰ï¼Ÿ" class="headerlink" title="25ã€ç®€è¿°Kubernetesåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰ï¼Ÿ"></a>25ã€ç®€è¿°Kubernetesåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰ï¼Ÿ</h3><p>ç­”ï¼š</p><p>init containerçš„è¿è¡Œæ–¹å¼ä¸åº”ç”¨å®¹å™¨ä¸åŒï¼Œå®ƒä»¬å¿…é¡»å…ˆäºåº”ç”¨å®¹å™¨æ‰§è¡Œå®Œæˆï¼Œå½“è®¾ç½®äº†å¤šä¸ªinit containeræ—¶ï¼Œå°†æŒ‰é¡ºåºé€ä¸ªè¿è¡Œï¼Œå¹¶ä¸”åªæœ‰å‰ä¸€ä¸ªinit containerè¿è¡ŒæˆåŠŸåæ‰èƒ½è¿è¡Œåä¸€ä¸ªinit containerã€‚å½“æ‰€æœ‰init containeréƒ½æˆåŠŸè¿è¡Œåï¼ŒKubernetesæ‰ä¼šåˆå§‹åŒ–Podçš„å„ç§ä¿¡æ¯ï¼Œå¹¶å¼€å§‹åˆ›å»ºå’Œè¿è¡Œåº”ç”¨å®¹å™¨ã€‚</p><h3 id="26ã€ç®€è¿°Kubernetes-deploymentå‡çº§è¿‡ç¨‹ï¼Ÿ"><a href="#26ã€ç®€è¿°Kubernetes-deploymentå‡çº§è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="26ã€ç®€è¿°Kubernetes deploymentå‡çº§è¿‡ç¨‹ï¼Ÿ"></a>26ã€ç®€è¿°Kubernetes deploymentå‡çº§è¿‡ç¨‹ï¼Ÿ</h3><p>ç­”ï¼š</p><ul><li>åˆå§‹åˆ›å»ºDeploymentæ—¶ï¼Œç³»ç»Ÿåˆ›å»ºäº†ä¸€ä¸ªReplicaSetï¼Œå¹¶æŒ‰ç”¨æˆ·çš„éœ€æ±‚åˆ›å»ºäº†å¯¹åº”æ•°é‡çš„Podå‰¯æœ¬ã€‚</li><li>å½“æ›´æ–°Deploymentæ—¶ï¼Œç³»ç»Ÿåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ReplicaSetï¼Œå¹¶å°†å…¶å‰¯æœ¬æ•°é‡æ‰©å±•åˆ°1ï¼Œç„¶åå°†æ—§ReplicaSetç¼©å‡ä¸º2ã€‚</li><li>ä¹‹åï¼Œç³»ç»Ÿç»§ç»­æŒ‰ç…§ç›¸åŒçš„æ›´æ–°ç­–ç•¥å¯¹æ–°æ—§ä¸¤ä¸ªReplicaSetè¿›è¡Œé€ä¸ªè°ƒæ•´ã€‚</li><li>æœ€åï¼Œæ–°çš„ReplicaSetè¿è¡Œäº†å¯¹åº”ä¸ªæ–°ç‰ˆæœ¬Podå‰¯æœ¬ï¼Œæ—§çš„ReplicaSetå‰¯æœ¬æ•°é‡åˆ™ç¼©å‡ä¸º0ã€‚</li></ul><h3 id="27ã€ç®€è¿°Kubernetes-deploymentå‡çº§ç­–ç•¥ï¼Ÿ"><a href="#27ã€ç®€è¿°Kubernetes-deploymentå‡çº§ç­–ç•¥ï¼Ÿ" class="headerlink" title="27ã€ç®€è¿°Kubernetes deploymentå‡çº§ç­–ç•¥ï¼Ÿ"></a>27ã€ç®€è¿°Kubernetes deploymentå‡çº§ç­–ç•¥ï¼Ÿ</h3><p>ç­”ï¼š<br>åœ¨Deploymentçš„å®šä¹‰ä¸­ï¼Œå¯ä»¥é€šè¿‡spec.strategyæŒ‡å®šPodæ›´æ–°çš„ç­–ç•¥ï¼Œç›®å‰æ”¯æŒ<br>ä¸¤ç§ç­–ç•¥ï¼šRecreateï¼ˆé‡å»ºï¼‰å’ŒRollingUpdateï¼ˆæ»šåŠ¨æ›´æ–°ï¼‰ï¼Œé»˜è®¤å€¼ä¸ºRollingUpdateã€‚</p><ul><li>Recreateï¼šè®¾ç½®spec.strategy.type&#x3D;Recreateï¼Œè¡¨ç¤ºDeploymentåœ¨æ›´æ–°Podæ—¶ï¼Œä¼šå…ˆæ€æ‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„Podï¼Œç„¶ååˆ›å»ºæ–°çš„Podã€‚</li><li>RollingUpdateï¼šè®¾ç½®spec.strategy.type&#x3D;RollingUpdateï¼Œè¡¨ç¤ºDeploymentä¼šä»¥æ»šåŠ¨æ›´æ–°çš„æ–¹å¼æ¥é€ä¸ªæ›´æ–°Podã€‚åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®<br>spec.strategy.rollingUpdateä¸‹çš„ä¸¤ä¸ªå‚æ•°ï¼ˆmaxUnavailableå’ŒmaxSurgeï¼‰æ¥æ§åˆ¶æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ã€‚</li></ul><h3 id="28ã€ç®€è¿°Kubernetes-DaemonSetç±»å‹çš„èµ„æºç‰¹æ€§ï¼Ÿ"><a href="#28ã€ç®€è¿°Kubernetes-DaemonSetç±»å‹çš„èµ„æºç‰¹æ€§ï¼Ÿ" class="headerlink" title="28ã€ç®€è¿°Kubernetes DaemonSetç±»å‹çš„èµ„æºç‰¹æ€§ï¼Ÿ"></a>28ã€ç®€è¿°Kubernetes DaemonSetç±»å‹çš„èµ„æºç‰¹æ€§ï¼Ÿ</h3><p>ç­”ï¼š</p><p>DaemonSetèµ„æºå¯¹è±¡ä¼šåœ¨æ¯ä¸ªKubernetesé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚åªèƒ½è¿è¡Œä¸€ä¸ªpodï¼Œè¿™æ˜¯å®ƒå’Œdeployment èµ„æºå¯¹è±¡çš„æœ€å¤§ä¹Ÿæ˜¯å”¯ä¸€çš„åŒºåˆ«ã€‚å› æ­¤ï¼Œ<br>åœ¨å®šä¹‰yamlæ–‡ä»¶ä¸­ï¼Œä¸æ”¯æŒå®šä¹‰replicasã€‚<br>å®ƒçš„ä¸€èˆ¬ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ul><li>åœ¨å»åšæ¯ä¸ªèŠ‚ç‚¹çš„æ—¥å¿—æ”¶é›†å·¥ä½œã€‚</li><li>ç›‘æ§æ¯ä¸ªèŠ‚ç‚¹çš„çš„è¿è¡ŒçŠ¶æ€ã€‚</li></ul><h3 id="29ã€ç®€è¿°Kubernetesè‡ªåŠ¨æ‰©å®¹æœºåˆ¶ï¼Ÿ"><a href="#29ã€ç®€è¿°Kubernetesè‡ªåŠ¨æ‰©å®¹æœºåˆ¶ï¼Ÿ" class="headerlink" title="29ã€ç®€è¿°Kubernetesè‡ªåŠ¨æ‰©å®¹æœºåˆ¶ï¼Ÿ"></a>29ã€ç®€è¿°Kubernetesè‡ªåŠ¨æ‰©å®¹æœºåˆ¶ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesä½¿ç”¨Horizontal Pod Autoscalerï¼ˆHPAï¼‰çš„æ§åˆ¶å™¨å®ç°åŸºäºCPUä½¿ç”¨ç‡è¿›è¡Œè‡ªåŠ¨Podæ‰©ç¼©å®¹çš„åŠŸèƒ½ã€‚HPAæ§åˆ¶å™¨å‘¨æœŸæ€§åœ°ç›‘æµ‹ç›®æ ‡Podçš„èµ„æºæ€§èƒ½<br>æŒ‡æ ‡ï¼Œå¹¶ä¸HPAèµ„æºå¯¹è±¡ä¸­çš„æ‰©ç¼©å®¹æ¡ä»¶è¿›è¡Œå¯¹æ¯”ï¼Œåœ¨æ»¡è¶³æ¡ä»¶æ—¶å¯¹Podå‰¯æœ¬æ•°é‡è¿›è¡Œè°ƒæ•´ã€‚</p><p><strong>HPAåŸç†</strong><br>Kubernetesä¸­çš„æŸä¸ªMetrics Serverï¼ˆHeapsteræˆ–è‡ªå®šä¹‰Metrics Serverï¼‰æŒç»­é‡‡é›†æ‰€æœ‰Podå‰¯æœ¬çš„æŒ‡æ ‡æ•°æ®ã€‚HPAæ§åˆ¶å™¨é€šè¿‡Metrics Serverçš„APIï¼ˆHeapsterçš„APIæˆ–èšåˆAPIï¼‰è·å–è¿™äº›æ•°æ®ï¼ŒåŸºäºç”¨æˆ·å®šä¹‰çš„æ‰©ç¼©å®¹è§„åˆ™è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°ç›®æ ‡Podå‰¯æœ¬æ•°é‡ã€‚å½“ç›®æ ‡Podå‰¯æœ¬æ•°é‡ä¸å½“å‰å‰¯æœ¬æ•°é‡ä¸åŒæ—¶ï¼ŒHPAæ§åˆ¶å™¨å°±å‘Podçš„å‰¯æœ¬æ§åˆ¶å™¨ï¼ˆDeploymentã€RCæˆ–ReplicaSetï¼‰å‘èµ·scaleæ“ä½œï¼Œè°ƒæ•´Podçš„å‰¯æœ¬æ•°é‡ï¼Œå®Œæˆæ‰©ç¼©å®¹æ“ä½œã€‚</p><h3 id="30ã€ç®€è¿°Kubernetes-Serviceç±»å‹ï¼Ÿ"><a href="#30ã€ç®€è¿°Kubernetes-Serviceç±»å‹ï¼Ÿ" class="headerlink" title="30ã€ç®€è¿°Kubernetes Serviceç±»å‹ï¼Ÿ"></a>30ã€ç®€è¿°Kubernetes Serviceç±»å‹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>é€šè¿‡åˆ›å»ºServiceï¼Œå¯ä»¥ä¸ºä¸€ç»„å…·æœ‰ç›¸åŒåŠŸèƒ½çš„å®¹å™¨åº”ç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ï¼Œå¹¶ä¸”å°†è¯·æ±‚è´Ÿè½½åˆ†å‘åˆ°åç«¯çš„å„ä¸ªå®¹å™¨åº”ç”¨ä¸Šã€‚å…¶ä¸»è¦ç±»å‹æœ‰ï¼š</p><ul><li>ClusterIPï¼šè™šæ‹Ÿçš„æœåŠ¡IP åœ°å€ï¼Œè¯¥åœ°å€ç”¨äºKubernetes é›†ç¾¤å†…éƒ¨çš„Pod è®¿é—®ï¼Œåœ¨Nodeä¸Škube-proxyé€šè¿‡è®¾ç½®çš„iptablesè§„åˆ™è¿›è¡Œè½¬å‘ï¼›</li><li>NodePortï¼šä½¿ç”¨å®¿ä¸»æœºçš„ç«¯å£ï¼Œä½¿èƒ½å¤Ÿè®¿é—®å„Nodeçš„å¤–éƒ¨å®¢æˆ·ç«¯é€šè¿‡Nodeçš„IPåœ°å€å’Œç«¯å£å·å°±èƒ½è®¿é—®æœåŠ¡ï¼›</li><li>LoadBalancerï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œéœ€è¦åœ¨spec.status.loadBalancer å­—æ®µæŒ‡å®šå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„IP åœ°å€ï¼Œé€šå¸¸ç”¨äºå…¬æœ‰äº‘ã€‚</li><li>externalï¼šæŠŠkubernetesé›†ç¾¤å¤–çš„æœåŠ¡å¼•å…¥åˆ°kubernetesé›†ç¾¤å†…</li></ul><h3 id="31ã€ç®€è¿°Kubernetes-Serviceåˆ†å‘åç«¯çš„ç­–ç•¥ï¼Ÿ"><a href="#31ã€ç®€è¿°Kubernetes-Serviceåˆ†å‘åç«¯çš„ç­–ç•¥ï¼Ÿ" class="headerlink" title="31ã€ç®€è¿°Kubernetes Serviceåˆ†å‘åç«¯çš„ç­–ç•¥ï¼Ÿ"></a>31ã€ç®€è¿°Kubernetes Serviceåˆ†å‘åç«¯çš„ç­–ç•¥ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Serviceè´Ÿè½½åˆ†å‘çš„ç­–ç•¥æœ‰ï¼šRoundRobinå’ŒSessionAffinity</p><ul><li>RoundRobinï¼šé»˜è®¤ä¸ºè½®è¯¢æ¨¡å¼ï¼Œå³è½®è¯¢å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å„ä¸ªPodä¸Šã€‚</li><li>SessionAffinityï¼šåŸºäºå®¢æˆ·ç«¯IPåœ°å€è¿›è¡Œä¼šè¯ä¿æŒçš„æ¨¡å¼ï¼Œå³ç¬¬1æ¬¡å°†æŸä¸ªå®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚è½¬å‘åˆ°åç«¯çš„æŸä¸ªPodä¸Šï¼Œä¹‹åä»ç›¸åŒçš„å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚éƒ½å°†è¢«<br>è½¬å‘åˆ°åç«¯ç›¸åŒçš„Podä¸Šã€‚</li></ul><h3 id="32ã€ç®€è¿°Kubernetes-Headless-Serviceï¼Ÿ"><a href="#32ã€ç®€è¿°Kubernetes-Headless-Serviceï¼Ÿ" class="headerlink" title="32ã€ç®€è¿°Kubernetes Headless Serviceï¼Ÿ"></a>32ã€ç®€è¿°Kubernetes Headless Serviceï¼Ÿ</h3><p>ç­”ï¼š</p><p>åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸­ï¼Œè‹¥éœ€è¦äººä¸ºæŒ‡å®šè´Ÿè½½å‡è¡¡å™¨ï¼Œä¸ä½¿ç”¨Serviceæä¾›çš„é»˜è®¤è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œæˆ–è€…åº”ç”¨ç¨‹åºå¸Œæœ›çŸ¥é“å±äºåŒç»„æœåŠ¡çš„å…¶ä»–å®ä¾‹ã€‚Kubernetesæä¾›äº†Headless Service æ¥å®ç°è¿™ç§åŠŸèƒ½ï¼Œå³ä¸ä¸ºService è®¾ç½®ClusterIPï¼ˆå…¥å£IP åœ°å€ï¼‰ï¼Œä»…é€šè¿‡Label Selectorå°†åç«¯çš„Podåˆ—è¡¨è¿”å›ç»™è°ƒç”¨çš„å®¢æˆ·ç«¯ã€‚</p><h3 id="33ã€ç®€è¿°Kuberneteså¤–éƒ¨å¦‚ä½•è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼Ÿ"><a href="#33ã€ç®€è¿°Kuberneteså¤–éƒ¨å¦‚ä½•è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼Ÿ" class="headerlink" title="33ã€ç®€è¿°Kuberneteså¤–éƒ¨å¦‚ä½•è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼Ÿ"></a>33ã€ç®€è¿°Kuberneteså¤–éƒ¨å¦‚ä½•è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼Ÿ</h3><p>ç­”ï¼š</p><p>å¯¹äºKubernetesï¼Œé›†ç¾¤å¤–çš„å®¢æˆ·ç«¯é»˜è®¤æƒ…å†µï¼Œæ— æ³•é€šè¿‡Podçš„IPåœ°å€æˆ–è€…Serviceçš„è™šæ‹ŸIPåœ°å€:è™šæ‹Ÿç«¯å£å·è¿›è¡Œè®¿é—®ã€‚é€šå¸¸å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œè®¿é—®<br>Kubernetesé›†ç¾¤å†…çš„æœåŠ¡ï¼š</p><ul><li>æ˜ å°„Podåˆ°ç‰©ç†æœºï¼šå°†Podç«¯å£å·æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå³åœ¨Podä¸­é‡‡ç”¨hostPortæ–¹å¼ï¼Œä»¥ä½¿å®¢æˆ·ç«¯åº”ç”¨èƒ½å¤Ÿé€šè¿‡ç‰©ç†æœºè®¿é—®å®¹å™¨åº”ç”¨ã€‚</li><li>æ˜ å°„Serviceåˆ°ç‰©ç†æœºï¼šå°†Serviceç«¯å£å·æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå³åœ¨Serviceä¸­é‡‡ç”¨nodePortæ–¹å¼ï¼Œä»¥ä½¿å®¢æˆ·ç«¯åº”ç”¨èƒ½å¤Ÿé€šè¿‡ç‰©ç†æœºè®¿é—®å®¹å™¨åº”ç”¨ã€‚</li><li>æ˜ å°„Serviceåˆ°LoadBalancerï¼šé€šè¿‡è®¾ç½®LoadBalanceræ˜ å°„åˆ°äº‘æœåŠ¡å•†æä¾›çš„LoadBalanceråœ°å€ã€‚è¿™ç§ç”¨æ³•ä»…ç”¨äºåœ¨å…¬æœ‰äº‘æœåŠ¡æä¾›å•†çš„äº‘å¹³å°ä¸Šè®¾ç½®<br>Serviceçš„åœºæ™¯ã€‚</li></ul><h3 id="34ã€ç®€è¿°Kubernetes-ingressï¼Ÿ"><a href="#34ã€ç®€è¿°Kubernetes-ingressï¼Ÿ" class="headerlink" title="34ã€ç®€è¿°Kubernetes ingressï¼Ÿ"></a>34ã€ç®€è¿°Kubernetes ingressï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesçš„Ingressèµ„æºå¯¹è±¡ï¼Œç”¨äºå°†ä¸åŒURLçš„è®¿é—®è¯·æ±‚è½¬å‘åˆ°åç«¯ä¸åŒçš„Serviceï¼Œä»¥å®ç°HTTPå±‚çš„ä¸šåŠ¡è·¯ç”±æœºåˆ¶ã€‚Kubernetesä½¿ç”¨äº†Ingressç­–ç•¥å’ŒIngress Controllerï¼Œä¸¤è€…ç»“åˆå¹¶å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„Ingressè´Ÿè½½å‡è¡¡å™¨ã€‚ä½¿ç”¨Ingressè¿›è¡Œè´Ÿè½½åˆ†å‘æ—¶ï¼ŒIngress Controller åŸºäºIngressè§„åˆ™å°†å®¢æˆ·ç«¯è¯·æ±‚ç›´æ¥è½¬å‘åˆ°Serviceå¯¹åº”çš„åç«¯Endpointï¼ˆPodï¼‰ä¸Šï¼Œä»è€Œè·³è¿‡kube-proxyçš„è½¬å‘åŠŸèƒ½ï¼Œkube-proxyä¸å†èµ·ä½œç”¨ï¼Œå…¨è¿‡ç¨‹ä¸ºï¼šingress controller + ingress è§„åˆ™ â€”-&gt; servicesã€‚åŒæ—¶å½“Ingress Controller æä¾›çš„æ˜¯å¯¹å¤–æœåŠ¡ï¼Œåˆ™å®é™…ä¸Šå®ç°çš„æ˜¯è¾¹ç¼˜è·¯ç”±å™¨çš„åŠŸèƒ½ã€‚</p><h3 id="35ã€ç®€è¿°Kubernetesé•œåƒçš„ä¸‹è½½ç­–ç•¥ï¼Ÿ"><a href="#35ã€ç®€è¿°Kubernetesé•œåƒçš„ä¸‹è½½ç­–ç•¥ï¼Ÿ" class="headerlink" title="35ã€ç®€è¿°Kubernetesé•œåƒçš„ä¸‹è½½ç­–ç•¥ï¼Ÿ"></a>35ã€ç®€è¿°Kubernetesé•œåƒçš„ä¸‹è½½ç­–ç•¥ï¼Ÿ</h3><p>ç­”ï¼š</p><p>K8sçš„é•œåƒä¸‹è½½ç­–ç•¥æœ‰ä¸‰ç§ï¼šAlwaysã€Neverã€IFNotPresentã€‚</p><ul><li>Alwaysï¼šé•œåƒæ ‡ç­¾ä¸ºlatestæ—¶ï¼Œæ€»æ˜¯ä»æŒ‡å®šçš„ä»“åº“ä¸­è·å–é•œåƒã€‚</li><li>Neverï¼šç¦æ­¢ä»ä»“åº“ä¸­ä¸‹è½½é•œåƒï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½ä½¿ç”¨æœ¬åœ°é•œåƒã€‚</li><li>IfNotPresentï¼šä»…å½“æœ¬åœ°æ²¡æœ‰å¯¹åº”é•œåƒæ—¶ï¼Œæ‰ä»ç›®æ ‡ä»“åº“ä¸­ä¸‹è½½ã€‚é»˜è®¤çš„é•œåƒä¸‹è½½ç­–ç•¥æ˜¯ï¼šå½“é•œåƒæ ‡ç­¾æ˜¯latestæ—¶ï¼Œé»˜è®¤ç­–ç•¥æ˜¯Alwaysï¼›å½“é•œåƒæ ‡ç­¾æ˜¯è‡ªå®šä¹‰æ—¶ï¼ˆä¹Ÿå°±æ˜¯æ ‡ç­¾ä¸æ˜¯latestï¼‰ï¼Œé‚£ä¹ˆé»˜è®¤ç­–ç•¥æ˜¯IfNotPresentã€‚</li></ul><h3 id="36ã€ç®€è¿°Kubernetesçš„è´Ÿè½½å‡è¡¡å™¨ï¼Ÿ"><a href="#36ã€ç®€è¿°Kubernetesçš„è´Ÿè½½å‡è¡¡å™¨ï¼Ÿ" class="headerlink" title="36ã€ç®€è¿°Kubernetesçš„è´Ÿè½½å‡è¡¡å™¨ï¼Ÿ"></a>36ã€ç®€è¿°Kubernetesçš„è´Ÿè½½å‡è¡¡å™¨ï¼Ÿ</h3><p>ç­”ï¼š</p><p>è´Ÿè½½å‡è¡¡å™¨æ˜¯æš´éœ²æœåŠ¡çš„æœ€å¸¸è§å’Œæ ‡å‡†æ–¹å¼ä¹‹ä¸€ã€‚<br>æ ¹æ®å·¥ä½œç¯å¢ƒä½¿ç”¨ä¸¤ç§ç±»å‹çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå³å†…éƒ¨è´Ÿè½½å‡è¡¡å™¨æˆ–å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚å†…éƒ¨è´Ÿè½½å‡è¡¡å™¨è‡ªåŠ¨å¹³è¡¡è´Ÿè½½å¹¶ä½¿ç”¨æ‰€éœ€é…ç½®åˆ†é…å®¹å™¨ï¼Œè€Œå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨å°†æµé‡ä»å¤–éƒ¨è´Ÿè½½å¼•å¯¼è‡³åç«¯å®¹å™¨ã€‚</p><h3 id="37ã€ç®€è¿°Kuberneteså„æ¨¡å—å¦‚ä½•ä¸API-Serveré€šä¿¡ï¼Ÿ"><a href="#37ã€ç®€è¿°Kuberneteså„æ¨¡å—å¦‚ä½•ä¸API-Serveré€šä¿¡ï¼Ÿ" class="headerlink" title="37ã€ç®€è¿°Kuberneteså„æ¨¡å—å¦‚ä½•ä¸API Serveré€šä¿¡ï¼Ÿ"></a>37ã€ç®€è¿°Kuberneteså„æ¨¡å—å¦‚ä½•ä¸API Serveré€šä¿¡ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetes API Serverä½œä¸ºé›†ç¾¤çš„æ ¸å¿ƒï¼Œè´Ÿè´£é›†ç¾¤å„åŠŸèƒ½æ¨¡å—ä¹‹é—´çš„é€šä¿¡ã€‚é›†ç¾¤å†…çš„å„ä¸ªåŠŸèƒ½æ¨¡å—é€šè¿‡API Serverå°†ä¿¡æ¯å­˜å…¥etcdï¼Œå½“éœ€è¦è·å–å’Œæ“ä½œè¿™äº›æ•°æ®<br>æ—¶ï¼Œåˆ™é€šè¿‡API Server æä¾›çš„REST æ¥å£ï¼ˆç”¨GETã€LIST æˆ–WATCH æ–¹æ³•ï¼‰æ¥å®ç°ï¼Œä»è€Œå®ç°å„æ¨¡å—ä¹‹é—´çš„ä¿¡æ¯äº¤äº’ã€‚å¦‚kubeletè¿›ç¨‹ä¸API Serverçš„äº¤äº’ï¼šæ¯ä¸ªNodeä¸Šçš„kubeletæ¯éš”ä¸€ä¸ªæ—¶é—´å‘¨æœŸï¼Œå°±ä¼šè°ƒç”¨ä¸€æ¬¡API Serverçš„RESTæ¥å£æŠ¥å‘Šè‡ªèº«çŠ¶æ€ï¼ŒAPI Serveråœ¨æ¥æ”¶åˆ°è¿™äº›ä¿¡æ¯åï¼Œä¼šå°†èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯æ›´æ–°åˆ°etcdä¸­ã€‚å¦‚kube-controller-managerè¿›ç¨‹ä¸API Serverçš„äº¤äº’ï¼škube-controllermanagerä¸­çš„Node Controller æ¨¡å—é€šè¿‡API Serveræä¾›çš„Watchæ¥å£å®æ—¶ç›‘æ§Nodeçš„ä¿¡æ¯ï¼Œå¹¶åšç›¸åº”å¤„ç†ã€‚å¦‚kube-schedulerè¿›ç¨‹ä¸API Serverçš„äº¤äº’ï¼šScheduleré€šè¿‡API Serverçš„Watchæ¥å£ç›‘å¬åˆ°æ–°å»ºPodå‰¯æœ¬çš„ä¿¡æ¯åï¼Œä¼šæ£€ç´¢æ‰€æœ‰ç¬¦åˆè¯¥Podè¦æ±‚çš„Nodeåˆ—è¡¨ï¼Œå¼€å§‹æ‰§è¡ŒPodè°ƒåº¦é€»è¾‘ï¼Œåœ¨è°ƒåº¦æˆåŠŸåå°†Podç»‘å®šåˆ°ç›®æ ‡èŠ‚ç‚¹ä¸Šã€‚</p><h3 id="38ã€ç®€è¿°Kubernetes-Schedulerä½œç”¨åŠå®ç°åŸç†ï¼Ÿ"><a href="#38ã€ç®€è¿°Kubernetes-Schedulerä½œç”¨åŠå®ç°åŸç†ï¼Ÿ" class="headerlink" title="38ã€ç®€è¿°Kubernetes Schedulerä½œç”¨åŠå®ç°åŸç†ï¼Ÿ"></a>38ã€ç®€è¿°Kubernetes Schedulerä½œç”¨åŠå®ç°åŸç†ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetes Scheduleræ˜¯è´Ÿè´£Podè°ƒåº¦çš„é‡è¦åŠŸèƒ½æ¨¡å—ï¼ŒKubernetesScheduleråœ¨æ•´ä¸ªç³»ç»Ÿä¸­æ‰¿æ‹…äº†â€œæ‰¿ä¸Šå¯ä¸‹â€çš„é‡è¦åŠŸèƒ½ï¼Œâ€œæ‰¿ä¸Šâ€æ˜¯æŒ‡å®ƒè´Ÿè´£æ¥æ”¶Controller Manageråˆ›å»ºçš„æ–°Podï¼Œä¸ºå…¶è°ƒåº¦è‡³ç›®æ ‡Nodeï¼›â€œå¯ä¸‹â€æ˜¯æŒ‡è°ƒåº¦å®Œæˆåï¼Œç›®æ ‡Nodeä¸Šçš„kubeletæœåŠ¡è¿›ç¨‹æ¥ç®¡åç»§å·¥ä½œï¼Œè´Ÿè´£Podæ¥ä¸‹æ¥ç”Ÿå‘½å‘¨æœŸã€‚Kubernetes Schedulerçš„ä½œç”¨æ˜¯å°†å¾…è°ƒåº¦çš„Podï¼ˆAPIæ–°åˆ›å»ºçš„Podã€ControllerManagerä¸ºè¡¥è¶³å‰¯æœ¬è€Œåˆ›å»ºçš„Podç­‰ï¼‰æŒ‰ç…§ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å’Œè°ƒåº¦ç­–ç•¥ç»‘å®šï¼ˆBindingï¼‰åˆ°é›†ç¾¤ä¸­æŸä¸ªåˆé€‚çš„Nodeä¸Šï¼Œå¹¶å°†ç»‘å®šä¿¡æ¯å†™å…¥etcdä¸­ã€‚åœ¨æ•´ä¸ªè°ƒåº¦è¿‡ç¨‹ä¸­æ¶‰åŠä¸‰ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯å¾…è°ƒåº¦Podåˆ—è¡¨ã€å¯ç”¨Nodeåˆ—è¡¨ï¼Œä»¥åŠè°ƒåº¦ç®—æ³•å’Œç­–ç•¥ã€‚Kubernetes Scheduleré€šè¿‡è°ƒåº¦ç®—æ³•è°ƒåº¦ä¸ºå¾…è°ƒåº¦Podåˆ—è¡¨ä¸­çš„æ¯ä¸ªPodä»Nodeåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆçš„Nodeæ¥å®ç°Podçš„è°ƒåº¦ã€‚éšåï¼Œç›®æ ‡èŠ‚ç‚¹ä¸Šçš„kubeleté€šè¿‡API Serverç›‘å¬åˆ°Kubernetes Scheduleräº§ç”Ÿçš„Podç»‘å®šäº‹ä»¶ï¼Œç„¶åè·å–å¯¹åº”çš„Podæ¸…å•ï¼Œä¸‹è½½Imageé•œåƒå¹¶å¯åŠ¨å®¹å™¨ã€‚</p><h3 id="39ã€ç®€è¿°Kubernetes-Schedulerä½¿ç”¨å“ªä¸¤ç§ç®—æ³•å°†Podç»‘å®šåˆ°workerèŠ‚ç‚¹ï¼Ÿ"><a href="#39ã€ç®€è¿°Kubernetes-Schedulerä½¿ç”¨å“ªä¸¤ç§ç®—æ³•å°†Podç»‘å®šåˆ°workerèŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="39ã€ç®€è¿°Kubernetes Schedulerä½¿ç”¨å“ªä¸¤ç§ç®—æ³•å°†Podç»‘å®šåˆ°workerèŠ‚ç‚¹ï¼Ÿ"></a>39ã€ç®€è¿°Kubernetes Schedulerä½¿ç”¨å“ªä¸¤ç§ç®—æ³•å°†Podç»‘å®šåˆ°workerèŠ‚ç‚¹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetes Scheduleræ ¹æ®å¦‚ä¸‹ä¸¤ç§è°ƒåº¦ç®—æ³•å°† Pod ç»‘å®šåˆ°æœ€åˆé€‚çš„å·¥ä½œèŠ‚ç‚¹ï¼š</p><ul><li>é¢„é€‰ï¼ˆPredicatesï¼‰ï¼šè¾“å…¥æ˜¯æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¾“å‡ºæ˜¯æ»¡è¶³é¢„é€‰æ¡ä»¶çš„èŠ‚ç‚¹ã€‚kubescheduleræ ¹æ®é¢„é€‰ç­–ç•¥è¿‡æ»¤æ‰ä¸æ»¡è¶³ç­–ç•¥çš„Nodesã€‚å¦‚æœæŸèŠ‚ç‚¹çš„èµ„æºä¸è¶³æˆ–<br>  è€…ä¸æ»¡è¶³é¢„é€‰ç­–ç•¥çš„æ¡ä»¶åˆ™æ— æ³•é€šè¿‡é¢„é€‰ã€‚å¦‚â€œNodeçš„labelå¿…é¡»ä¸Podçš„Selectorä¸€è‡´â€ã€‚</li><li>ä¼˜é€‰ï¼ˆPrioritiesï¼‰ï¼šè¾“å…¥æ˜¯é¢„é€‰é˜¶æ®µç­›é€‰å‡ºçš„èŠ‚ç‚¹ï¼Œä¼˜é€‰ä¼šæ ¹æ®ä¼˜å…ˆç­–ç•¥ä¸ºé€šè¿‡é¢„é€‰çš„Nodesè¿›è¡Œæ‰“åˆ†æ’åï¼Œé€‰æ‹©å¾—åˆ†æœ€é«˜çš„Nodeã€‚ä¾‹å¦‚ï¼Œèµ„æºè¶Šå¯Œè£•ã€è´Ÿè½½è¶Šå°çš„Nodeå¯èƒ½å…·æœ‰è¶Šé«˜çš„æ’åã€‚</li></ul><h3 id="40ã€ç®€è¿°Kubernetes-kubeletçš„ä½œç”¨ï¼Ÿ"><a href="#40ã€ç®€è¿°Kubernetes-kubeletçš„ä½œç”¨ï¼Ÿ" class="headerlink" title="40ã€ç®€è¿°Kubernetes kubeletçš„ä½œç”¨ï¼Ÿ"></a>40ã€ç®€è¿°Kubernetes kubeletçš„ä½œç”¨ï¼Ÿ</h3><p>ç­”ï¼š</p><p>åœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œåœ¨æ¯ä¸ªNodeï¼ˆåˆç§°Workerï¼‰ä¸Šéƒ½ä¼šå¯åŠ¨ä¸€ä¸ªkubeletæœåŠ¡è¿›ç¨‹ã€‚è¯¥è¿›ç¨‹ç”¨äºå¤„ç†Master ä¸‹å‘åˆ°æœ¬èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œç®¡ç†Pod åŠPod ä¸­çš„å®¹å™¨ã€‚æ¯ä¸ªkubeletè¿›ç¨‹éƒ½ä¼šåœ¨API Serverä¸Šæ³¨å†ŒèŠ‚ç‚¹è‡ªèº«çš„ä¿¡æ¯ï¼Œå®šæœŸå‘Masteræ±‡æŠ¥èŠ‚ç‚¹èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶é€šè¿‡cAdvisorç›‘æ§å®¹å™¨å’ŒèŠ‚ç‚¹èµ„æºã€‚</p><h3 id="41ã€ç®€è¿°Kubernetes-kubeletç›‘æ§WorkerèŠ‚ç‚¹èµ„æºæ˜¯ä½¿ç”¨ä»€ä¹ˆç»„ä»¶æ¥å®ç°çš„ï¼Ÿ"><a href="#41ã€ç®€è¿°Kubernetes-kubeletç›‘æ§WorkerèŠ‚ç‚¹èµ„æºæ˜¯ä½¿ç”¨ä»€ä¹ˆç»„ä»¶æ¥å®ç°çš„ï¼Ÿ" class="headerlink" title="41ã€ç®€è¿°Kubernetes kubeletç›‘æ§WorkerèŠ‚ç‚¹èµ„æºæ˜¯ä½¿ç”¨ä»€ä¹ˆç»„ä»¶æ¥å®ç°çš„ï¼Ÿ"></a>41ã€ç®€è¿°Kubernetes kubeletç›‘æ§WorkerèŠ‚ç‚¹èµ„æºæ˜¯ä½¿ç”¨ä»€ä¹ˆç»„ä»¶æ¥å®ç°çš„ï¼Ÿ</h3><p>ç­”ï¼š</p><p>kubeletä½¿ç”¨cAdvisorå¯¹workerèŠ‚ç‚¹èµ„æºè¿›è¡Œç›‘æ§ã€‚åœ¨ Kubernetes ç³»ç»Ÿä¸­ï¼ŒcAdvisor å·²è¢«é»˜è®¤é›†æˆåˆ° kubelet ç»„ä»¶å†…ï¼Œå½“ kubelet æœåŠ¡å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¯åŠ¨cAdvisor æœåŠ¡ï¼Œç„¶å cAdvisor ä¼šå®æ—¶é‡‡é›†æ‰€åœ¨èŠ‚ç‚¹çš„æ€§èƒ½æŒ‡æ ‡åŠåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®¹å™¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚</p><h3 id="42ã€ç®€è¿°Kuberneteså¦‚ä½•ä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§ï¼Ÿ"><a href="#42ã€ç®€è¿°Kuberneteså¦‚ä½•ä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§ï¼Ÿ" class="headerlink" title="42ã€ç®€è¿°Kuberneteså¦‚ä½•ä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§ï¼Ÿ"></a>42ã€ç®€è¿°Kuberneteså¦‚ä½•ä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesé€šè¿‡ä¸€ç³»åˆ—æœºåˆ¶æ¥å®ç°é›†ç¾¤çš„å®‰å…¨æ§åˆ¶ï¼Œä¸»è¦æœ‰å¦‚ä¸‹ä¸åŒçš„ç»´åº¦ï¼š</p><ul><li>åŸºç¡€è®¾æ–½æ–¹é¢ï¼šä¿è¯å®¹å™¨ä¸å…¶æ‰€åœ¨å®¿ä¸»æœºçš„éš”ç¦»ï¼›</li><li>æƒé™æ–¹é¢ï¼š<ul><li>æœ€å°æƒé™åŸåˆ™ï¼šåˆç†é™åˆ¶æ‰€æœ‰ç»„ä»¶çš„æƒé™ï¼Œç¡®ä¿ç»„ä»¶åªæ‰§è¡Œå®ƒè¢«æˆæƒçš„è¡Œä¸ºï¼Œ<br>é€šè¿‡é™åˆ¶å•ä¸ªç»„ä»¶çš„èƒ½åŠ›æ¥é™åˆ¶å®ƒçš„æƒé™èŒƒå›´ã€‚</li><li>ç”¨æˆ·æƒé™ï¼šåˆ’åˆ†æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜çš„è§’è‰²ã€‚</li></ul></li><li>é›†ç¾¤æ–¹é¢ï¼š<ul><li>API Serverçš„è®¤è¯æˆæƒï¼šKubernetesé›†ç¾¤ä¸­æ‰€æœ‰èµ„æºçš„è®¿é—®å’Œå˜æ›´éƒ½æ˜¯é€šè¿‡Kubernetes API Serveræ¥å®ç°çš„ï¼Œå› æ­¤éœ€è¦å»ºè®®é‡‡ç”¨æ›´å®‰å…¨çš„HTTPSæˆ–<br>  Tokenæ¥è¯†åˆ«å’Œè®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼ˆAuthenticationï¼‰ï¼Œä»¥åŠéšåè®¿é—®æƒé™çš„æˆæƒï¼ˆAuthorizationï¼‰ç¯èŠ‚ã€‚</li><li>API Serverçš„æˆæƒç®¡ç†ï¼šé€šè¿‡æˆæƒç­–ç•¥æ¥å†³å®šä¸€ä¸ªAPIè°ƒç”¨æ˜¯å¦åˆæ³•ã€‚å¯¹åˆæ³•ç”¨æˆ·è¿›è¡Œæˆæƒå¹¶ä¸”éšååœ¨ç”¨æˆ·è®¿é—®æ—¶è¿›è¡Œé‰´æƒï¼Œå»ºè®®é‡‡ç”¨æ›´å®‰å…¨çš„RBAC<br>æ–¹å¼æ¥æå‡é›†ç¾¤å®‰å…¨æˆæƒã€‚</li><li>æ•æ„Ÿæ•°æ®å¼•å…¥Secretæœºåˆ¶ï¼šå¯¹äºé›†ç¾¤æ•æ„Ÿæ•°æ®å»ºè®®ä½¿ç”¨Secretæ–¹å¼è¿›è¡Œä¿æŠ¤ã€‚</li><li>AdmissionControlï¼ˆå‡†å…¥æœºåˆ¶ï¼‰ï¼šå¯¹kubernetes apiçš„è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œé¡ºåºä¸ºï¼šå…ˆç»è¿‡è®¤è¯ &amp; æˆæƒï¼Œç„¶åæ‰§è¡Œå‡†å…¥æ“ä½œï¼Œæœ€åå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæ“ä½œã€‚</li></ul></li></ul><h3 id="43ã€ç®€è¿°Kuberneteså‡†å…¥æœºåˆ¶ï¼Ÿ"><a href="#43ã€ç®€è¿°Kuberneteså‡†å…¥æœºåˆ¶ï¼Ÿ" class="headerlink" title="43ã€ç®€è¿°Kuberneteså‡†å…¥æœºåˆ¶ï¼Ÿ"></a>43ã€ç®€è¿°Kuberneteså‡†å…¥æœºåˆ¶ï¼Ÿ</h3><p>ç­”ï¼š</p><p>åœ¨å¯¹é›†ç¾¤è¿›è¡Œè¯·æ±‚æ—¶ï¼Œæ¯ä¸ªå‡†å…¥æ§åˆ¶ä»£ç éƒ½æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œã€‚å¦‚æœæœ‰ä¸€ä¸ªå‡†å…¥æ§åˆ¶æ‹’ç»äº†æ­¤æ¬¡è¯·æ±‚ï¼Œé‚£ä¹ˆæ•´ä¸ªè¯·æ±‚çš„ç»“æœå°†ä¼šç«‹å³è¿”å›ï¼Œå¹¶æç¤ºç”¨æˆ·ç›¸åº”çš„errorä¿¡æ¯ã€‚</p><p>å‡†å…¥æ§åˆ¶ï¼ˆAdmissionControlï¼‰å‡†å…¥æ§åˆ¶æœ¬è´¨ä¸Šä¸ºä¸€æ®µå‡†å…¥ä»£ç ï¼Œåœ¨å¯¹kubernetesapiçš„è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œé¡ºåºä¸ºï¼šå…ˆç»è¿‡è®¤è¯ &amp; æˆæƒï¼Œç„¶åæ‰§è¡Œå‡†å…¥æ“ä½œï¼Œæœ€åå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæ“ä½œã€‚å¸¸ç”¨ç»„ä»¶ï¼ˆæ§åˆ¶ä»£ç ï¼‰å¦‚ä¸‹ï¼š</p><ul><li>AlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚</li><li>AlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œå¤šç”¨äºæµ‹è¯•ç¯å¢ƒã€‚</li><li>ServiceAccountï¼šå®ƒå°†serviceAccountså®ç°äº†è‡ªåŠ¨åŒ–ï¼Œå®ƒä¼šè¾…åŠ©serviceAccountåšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å¦‚æœpodæ²¡æœ‰serviceAccountå±æ€§ï¼Œå®ƒä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªdefaultï¼Œå¹¶ç¡®ä¿podçš„serviceAccountå§‹ç»ˆå­˜åœ¨ã€‚</li><li>LimitRangerï¼šè§‚å¯Ÿæ‰€æœ‰çš„è¯·æ±‚ï¼Œç¡®ä¿æ²¡æœ‰è¿åå·²ç»å®šä¹‰å¥½çš„çº¦æŸæ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶å®šä¹‰åœ¨namespaceä¸­LimitRangeå¯¹è±¡ä¸­ã€‚</li><li>NamespaceExistsï¼šè§‚å¯Ÿæ‰€æœ‰çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚å°è¯•åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„namespaceï¼Œåˆ™è¿™ä¸ªè¯·æ±‚è¢«æ‹’ç»ã€‚</li></ul><h3 id="44ã€ç®€è¿°Kubernetes-RBACåŠå…¶ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰ï¼Ÿ"><a href="#44ã€ç®€è¿°Kubernetes-RBACåŠå…¶ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰ï¼Ÿ" class="headerlink" title="44ã€ç®€è¿°Kubernetes RBACåŠå…¶ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰ï¼Ÿ"></a>44ã€ç®€è¿°Kubernetes RBACåŠå…¶ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰ï¼Ÿ</h3><p>ç­”ï¼š</p><p>RBACæ˜¯åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œæ˜¯ä¸€ç§åŸºäºä¸ªäººç”¨æˆ·çš„è§’è‰²æ¥ç®¡ç†å¯¹è®¡ç®—æœºæˆ–ç½‘ç»œèµ„æºçš„è®¿é—®çš„æ–¹æ³•ã€‚<br>ç›¸å¯¹äºå…¶ä»–æˆæƒæ¨¡å¼ï¼ŒRBACå…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p><ul><li>å¯¹é›†ç¾¤ä¸­çš„èµ„æºå’Œéèµ„æºæƒé™å‡æœ‰å®Œæ•´çš„è¦†ç›–ã€‚</li><li>æ•´ä¸ªRBACå®Œå…¨ç”±å‡ ä¸ªAPIå¯¹è±¡å®Œæˆï¼Œ åŒå…¶ä»–APIå¯¹è±¡ä¸€æ ·ï¼Œ å¯ä»¥ç”¨kubectlæˆ–APIè¿›è¡Œæ“ä½œã€‚</li><li>å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œæ— é¡»é‡æ–°å¯åŠ¨API Serverã€‚</li></ul><h3 id="45ã€ç®€è¿°Kubernetes-Secretä½œç”¨ï¼Ÿ"><a href="#45ã€ç®€è¿°Kubernetes-Secretä½œç”¨ï¼Ÿ" class="headerlink" title="45ã€ç®€è¿°Kubernetes Secretä½œç”¨ï¼Ÿ"></a>45ã€ç®€è¿°Kubernetes Secretä½œç”¨ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Secretå¯¹è±¡ï¼Œä¸»è¦ä½œç”¨æ˜¯ä¿ç®¡ç§å¯†æ•°æ®ï¼Œæ¯”å¦‚å¯†ç ã€OAuth Tokensã€SSH Keysç­‰ä¿¡æ¯ã€‚å°†è¿™äº›ç§å¯†ä¿¡æ¯æ”¾åœ¨Secretå¯¹è±¡ä¸­æ¯”ç›´æ¥æ”¾åœ¨Podæˆ–Docker Imageä¸­æ›´å®‰å…¨ï¼Œä¹Ÿæ›´ä¾¿äºä½¿ç”¨å’Œåˆ†å‘ã€‚</p><h3 id="46ã€ç®€è¿°Kubernetes-Secretæœ‰å“ªäº›ä½¿ç”¨æ–¹å¼ï¼Ÿ"><a href="#46ã€ç®€è¿°Kubernetes-Secretæœ‰å“ªäº›ä½¿ç”¨æ–¹å¼ï¼Ÿ" class="headerlink" title="46ã€ç®€è¿°Kubernetes Secretæœ‰å“ªäº›ä½¿ç”¨æ–¹å¼ï¼Ÿ"></a>46ã€ç®€è¿°Kubernetes Secretæœ‰å“ªäº›ä½¿ç”¨æ–¹å¼ï¼Ÿ</h3><p>ç­”ï¼š</p><p>åˆ›å»ºå®Œsecretä¹‹åï¼Œå¯é€šè¿‡å¦‚ä¸‹ä¸‰ç§æ–¹å¼ä½¿ç”¨ï¼š</p><ul><li>åœ¨åˆ›å»ºPodæ—¶ï¼Œé€šè¿‡ä¸ºPodæŒ‡å®šService Accountæ¥è‡ªåŠ¨ä½¿ç”¨è¯¥Secretã€‚</li><li>é€šè¿‡æŒ‚è½½è¯¥Secretåˆ°Podæ¥ä½¿ç”¨å®ƒã€‚</li><li>åœ¨Dockeré•œåƒä¸‹è½½æ—¶ä½¿ç”¨ï¼Œé€šè¿‡æŒ‡å®šPodçš„spc.ImagePullSecretsæ¥å¼•ç”¨å®ƒã€‚</li></ul><h3 id="47ã€ç®€è¿°Kubernetes-PodSecurityPolicyæœºåˆ¶ï¼Ÿ"><a href="#47ã€ç®€è¿°Kubernetes-PodSecurityPolicyæœºåˆ¶ï¼Ÿ" class="headerlink" title="47ã€ç®€è¿°Kubernetes PodSecurityPolicyæœºåˆ¶ï¼Ÿ"></a>47ã€ç®€è¿°Kubernetes PodSecurityPolicyæœºåˆ¶ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetes PodSecurityPolicyæ˜¯ä¸ºäº†æ›´ç²¾ç»†åœ°æ§åˆ¶Podå¯¹èµ„æºçš„ä½¿ç”¨æ–¹å¼ä»¥åŠæå‡å®‰å…¨ç­–ç•¥ã€‚åœ¨å¼€å¯PodSecurityPolicyå‡†å…¥æ§åˆ¶å™¨åï¼ŒKubernetesé»˜è®¤ä¸å…è®¸<br>åˆ›å»ºä»»ä½•Podï¼Œéœ€è¦åˆ›å»ºPodSecurityPolicyç­–ç•¥å’Œç›¸åº”çš„RBACæˆæƒç­–ç•¥ï¼ˆAuthorizing Policiesï¼‰ï¼ŒPodæ‰èƒ½åˆ›å»ºæˆåŠŸã€‚</p><h3 id="48ã€ç®€è¿°Kubernetes-PodSecurityPolicyæœºåˆ¶èƒ½å®ç°å“ªäº›å®‰å…¨ç­–ç•¥ï¼Ÿ"><a href="#48ã€ç®€è¿°Kubernetes-PodSecurityPolicyæœºåˆ¶èƒ½å®ç°å“ªäº›å®‰å…¨ç­–ç•¥ï¼Ÿ" class="headerlink" title="48ã€ç®€è¿°Kubernetes PodSecurityPolicyæœºåˆ¶èƒ½å®ç°å“ªäº›å®‰å…¨ç­–ç•¥ï¼Ÿ"></a>48ã€ç®€è¿°Kubernetes PodSecurityPolicyæœºåˆ¶èƒ½å®ç°å“ªäº›å®‰å…¨ç­–ç•¥ï¼Ÿ</h3><p>ç­”ï¼š<br>åœ¨PodSecurityPolicyå¯¹è±¡ä¸­å¯ä»¥è®¾ç½®ä¸åŒå­—æ®µæ¥æ§åˆ¶Podè¿è¡Œæ—¶çš„å„ç§å®‰å…¨ç­–ç•¥ï¼Œ<br>å¸¸è§çš„æœ‰ï¼š</p><ul><li>ç‰¹æƒæ¨¡å¼ï¼šprivilegedæ˜¯å¦å…è®¸Podä»¥ç‰¹æƒæ¨¡å¼è¿è¡Œã€‚</li><li>å®¿ä¸»æœºèµ„æºï¼šæ§åˆ¶Podå¯¹å®¿ä¸»æœºèµ„æºçš„æ§åˆ¶ï¼Œå¦‚hostPIDï¼šæ˜¯å¦å…è®¸Podå…±äº«å®¿ä¸»æœºçš„è¿›ç¨‹ç©ºé—´ã€‚</li><li>ç”¨æˆ·å’Œç»„ï¼šè®¾ç½®è¿è¡Œå®¹å™¨çš„ç”¨æˆ·IDï¼ˆèŒƒå›´ï¼‰æˆ–ç»„ï¼ˆèŒƒå›´ï¼‰ã€‚</li><li>æå‡æƒé™ï¼šAllowPrivilegeEscalationï¼šè®¾ç½®å®¹å™¨å†…çš„å­è¿›ç¨‹æ˜¯å¦å¯ä»¥æå‡æƒé™ï¼Œé€šå¸¸åœ¨è®¾ç½®érootç”¨æˆ·ï¼ˆMustRunAsNonRootï¼‰æ—¶è¿›è¡Œè®¾ç½®ã€‚</li><li>SELinuxï¼šè¿›è¡ŒSELinuxçš„ç›¸å…³é…ç½®ã€‚</li></ul><h3 id="49ã€ç®€è¿°Kubernetesç½‘ç»œæ¨¡å‹ï¼Ÿ"><a href="#49ã€ç®€è¿°Kubernetesç½‘ç»œæ¨¡å‹ï¼Ÿ" class="headerlink" title="49ã€ç®€è¿°Kubernetesç½‘ç»œæ¨¡å‹ï¼Ÿ"></a>49ã€ç®€è¿°Kubernetesç½‘ç»œæ¨¡å‹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesç½‘ç»œæ¨¡å‹ä¸­æ¯ä¸ªPodéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„IPåœ°å€ï¼Œå¹¶å‡å®šæ‰€æœ‰Podéƒ½åœ¨ä¸€ä¸ªå¯ä»¥ç›´æ¥è¿é€šçš„ã€æ‰å¹³çš„ç½‘ç»œç©ºé—´ä¸­ã€‚æ‰€ä»¥ä¸ç®¡å®ƒä»¬æ˜¯å¦è¿è¡Œåœ¨åŒä¸€ä¸ª<br>Nodeï¼ˆå®¿ä¸»æœºï¼‰ä¸­ï¼Œéƒ½è¦æ±‚å®ƒä»¬å¯ä»¥ç›´æ¥é€šè¿‡å¯¹æ–¹çš„IPè¿›è¡Œè®¿é—®ã€‚è®¾è®¡è¿™ä¸ªåŸåˆ™çš„åŸå› æ˜¯ï¼Œç”¨æˆ·ä¸éœ€è¦é¢å¤–è€ƒè™‘å¦‚ä½•å»ºç«‹Podä¹‹é—´çš„è¿æ¥ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘å¦‚ä½•å°†å®¹å™¨ç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£ç­‰é—®é¢˜ã€‚<br>åŒæ—¶ä¸ºæ¯ä¸ªPodéƒ½è®¾ç½®ä¸€ä¸ªIPåœ°å€çš„æ¨¡å‹ä½¿å¾—åŒä¸€ä¸ªPodå†…çš„ä¸åŒå®¹å™¨ä¼šå…±äº«åŒä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªLinuxç½‘ç»œåè®®æ ˆã€‚è¿™å°±æ„å‘³ç€åŒä¸€ä¸ªPodå†…çš„å®¹å™¨å¯ä»¥é€šè¿‡localhostæ¥è¿æ¥å¯¹æ–¹çš„ç«¯å£ã€‚<br>åœ¨Kubernetesçš„é›†ç¾¤é‡Œï¼ŒIPæ˜¯ä»¥Podä¸ºå•ä½è¿›è¡Œåˆ†é…çš„ã€‚ä¸€ä¸ªPodå†…éƒ¨çš„æ‰€æœ‰å®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œå †æ ˆï¼ˆç›¸å½“äºä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼Œå®ƒä»¬çš„IPåœ°å€ã€ç½‘ç»œè®¾å¤‡ã€é…ç½®ç­‰éƒ½æ˜¯å…±äº«çš„ï¼‰ã€‚</p><h3 id="50ã€ç®€è¿°Kubernetes-CNIæ¨¡å‹ï¼Ÿ"><a href="#50ã€ç®€è¿°Kubernetes-CNIæ¨¡å‹ï¼Ÿ" class="headerlink" title="50ã€ç®€è¿°Kubernetes CNIæ¨¡å‹ï¼Ÿ"></a>50ã€ç®€è¿°Kubernetes CNIæ¨¡å‹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>CNIæä¾›äº†ä¸€ç§åº”ç”¨å®¹å™¨çš„æ’ä»¶åŒ–ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œå®šä¹‰å¯¹å®¹å™¨ç½‘ç»œè¿›è¡Œæ“ä½œå’Œé…ç½®çš„è§„èŒƒï¼Œé€šè¿‡æ’ä»¶çš„å½¢å¼å¯¹CNIæ¥å£è¿›è¡Œå®ç°ã€‚CNIä»…å…³æ³¨åœ¨åˆ›å»ºå®¹å™¨æ—¶åˆ†é…ç½‘ç»œ<br>èµ„æºï¼Œå’Œåœ¨é”€æ¯å®¹å™¨æ—¶åˆ é™¤ç½‘ç»œèµ„æºã€‚</p><p>åœ¨CNIæ¨¡å‹ä¸­åªæ¶‰åŠä¸¤ä¸ªæ¦‚å¿µï¼šå®¹å™¨å’Œç½‘ç»œã€‚</p><ul><li>å®¹å™¨ï¼ˆContainerï¼‰ï¼šæ˜¯æ‹¥æœ‰ç‹¬ç«‹Linuxç½‘ç»œå‘½åç©ºé—´çš„ç¯å¢ƒï¼Œä¾‹å¦‚ä½¿ç”¨Dockeræˆ–rktåˆ›å»ºçš„å®¹å™¨ã€‚å®¹å™¨éœ€è¦æ‹¥æœ‰è‡ªå·±çš„Linuxç½‘ç»œå‘½åç©ºé—´ï¼Œè¿™æ˜¯åŠ å…¥ç½‘ç»œçš„å¿…<br>è¦æ¡ä»¶ã€‚</li><li>ç½‘ç»œï¼ˆNetworkï¼‰ï¼šè¡¨ç¤ºå¯ä»¥äº’è¿çš„ä¸€ç»„å®ä½“ï¼Œè¿™äº›å®ä½“æ‹¥æœ‰å„è‡ªç‹¬ç«‹ã€å”¯ä¸€çš„IPåœ°å€ï¼Œå¯ä»¥æ˜¯å®¹å™¨ã€ç‰©ç†æœºæˆ–è€…å…¶ä»–ç½‘ç»œè®¾å¤‡ï¼ˆæ¯”å¦‚è·¯ç”±å™¨ï¼‰ç­‰ã€‚<br>  å¯¹å®¹å™¨ç½‘ç»œçš„è®¾ç½®å’Œæ“ä½œéƒ½é€šè¿‡æ’ä»¶ï¼ˆPluginï¼‰è¿›è¡Œå…·ä½“å®ç°ï¼ŒCNIæ’ä»¶åŒ…æ‹¬ä¸¤ç§ç±»å‹ï¼šCNI Pluginå’ŒIPAMï¼ˆIP Address Managementï¼‰Pluginã€‚</li><li>CNI Pluginè´Ÿè´£ä¸ºå®¹å™¨é…ç½®ç½‘ç»œèµ„æº</li><li>IPAM Pluginè´Ÿè´£å¯¹å®¹å™¨çš„IPåœ°å€è¿›è¡Œåˆ†é…å’Œç®¡ç†ã€‚</li><li>IPAM Pluginä½œä¸ºCNI Pluginçš„ä¸€éƒ¨åˆ†ï¼Œä¸CNI PluginååŒå·¥ä½œã€‚</li></ul><h3 id="51ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥ï¼Ÿ"><a href="#51ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥ï¼Ÿ" class="headerlink" title="51ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥ï¼Ÿ"></a>51ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥ï¼Ÿ</h3><p>ç­”ï¼š</p><p>ä¸ºå®ç°ç»†ç²’åº¦çš„å®¹å™¨é—´ç½‘ç»œè®¿é—®éš”ç¦»ç­–ç•¥ï¼ŒKuberneteså¼•å…¥Network Policyã€‚</p><p>Network Policyçš„ä¸»è¦åŠŸèƒ½æ˜¯å¯¹Podé—´çš„ç½‘ç»œé€šä¿¡è¿›è¡Œé™åˆ¶å’Œå‡†å…¥æ§åˆ¶ï¼Œè®¾ç½®å…è®¸è®¿é—®æˆ–ç¦æ­¢è®¿é—®çš„å®¢æˆ·ç«¯Podåˆ—è¡¨ã€‚Network Policyå®šä¹‰ç½‘ç»œç­–ç•¥ï¼Œé…åˆç­–ç•¥æ§åˆ¶å™¨ï¼ˆPolicy Controllerï¼‰è¿›è¡Œç­–ç•¥çš„å®ç°ã€‚</p><h3 id="52ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥åŸç†ï¼Ÿ"><a href="#52ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥åŸç†ï¼Ÿ" class="headerlink" title="52ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥åŸç†ï¼Ÿ"></a>52ã€ç®€è¿°Kubernetesç½‘ç»œç­–ç•¥åŸç†ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Network Policyçš„å·¥ä½œåŸç†ä¸»è¦ä¸ºï¼špolicy controlleréœ€è¦å®ç°ä¸€ä¸ªAPIListenerï¼Œç›‘å¬ç”¨æˆ·è®¾ç½®çš„Network Policyå®šä¹‰ï¼Œå¹¶å°†ç½‘ç»œè®¿é—®è§„åˆ™é€šè¿‡å„Nodeçš„<br>Agentè¿›è¡Œå®é™…è®¾ç½®ï¼ˆAgentåˆ™éœ€è¦é€šè¿‡CNIç½‘ç»œæ’ä»¶å®ç°ï¼‰ã€‚</p><h3 id="53ã€ç®€è¿°Kubernetesä¸­flannelçš„ä½œç”¨ï¼Ÿ"><a href="#53ã€ç®€è¿°Kubernetesä¸­flannelçš„ä½œç”¨ï¼Ÿ" class="headerlink" title="53ã€ç®€è¿°Kubernetesä¸­flannelçš„ä½œç”¨ï¼Ÿ"></a>53ã€ç®€è¿°Kubernetesä¸­flannelçš„ä½œç”¨ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Flannelå¯ä»¥ç”¨äºKubernetesåº•å±‚ç½‘ç»œçš„å®ç°ï¼Œä¸»è¦ä½œç”¨æœ‰ï¼š</p><ul><li>å®ƒèƒ½ååŠ©Kubernetesï¼Œç»™æ¯ä¸€ä¸ªNodeä¸Šçš„Dockerå®¹å™¨éƒ½åˆ†é…äº’ç›¸ä¸å†²çªçš„IPåœ°å€ã€‚</li><li>å®ƒèƒ½åœ¨è¿™äº›IPåœ°å€ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¦†ç›–ç½‘ç»œï¼ˆOverlay Networkï¼‰ï¼Œé€šè¿‡è¿™ä¸ªè¦†ç›–ç½‘ç»œï¼Œå°†æ•°æ®åŒ…åŸå°ä¸åŠ¨åœ°ä¼ é€’åˆ°ç›®æ ‡å®¹å™¨å†…ã€‚</li></ul><h3 id="54ã€ç®€è¿°Kubernetes-Calicoç½‘ç»œç»„ä»¶å®ç°åŸç†ï¼Ÿ"><a href="#54ã€ç®€è¿°Kubernetes-Calicoç½‘ç»œç»„ä»¶å®ç°åŸç†ï¼Ÿ" class="headerlink" title="54ã€ç®€è¿°Kubernetes Calicoç½‘ç»œç»„ä»¶å®ç°åŸç†ï¼Ÿ"></a>54ã€ç®€è¿°Kubernetes Calicoç½‘ç»œç»„ä»¶å®ç°åŸç†ï¼Ÿ</h3><p>ç­”ï¼š<br>Calico æ˜¯ä¸€ä¸ªåŸºäºBGP çš„çº¯ä¸‰å±‚çš„ç½‘ç»œæ–¹æ¡ˆï¼Œä¸OpenStackã€Kubernetesã€AWSã€GCEç­‰äº‘å¹³å°éƒ½èƒ½å¤Ÿè‰¯å¥½åœ°é›†æˆã€‚<br>Calicoåœ¨æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹éƒ½åˆ©ç”¨Linux Kernelå®ç°äº†ä¸€ä¸ªé«˜æ•ˆçš„vRouteræ¥è´Ÿè´£æ•°æ®è½¬å‘ã€‚æ¯ä¸ªvRouteréƒ½é€šè¿‡BGPåè®®æŠŠåœ¨æœ¬èŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®¹å™¨çš„è·¯ç”±ä¿¡æ¯å‘æ•´ä¸ª<br>Calicoç½‘ç»œå¹¿æ’­ï¼Œå¹¶è‡ªåŠ¨è®¾ç½®åˆ°è¾¾å…¶ä»–èŠ‚ç‚¹çš„è·¯ç”±è½¬å‘è§„åˆ™ã€‚<br>Calicoä¿è¯æ‰€æœ‰å®¹å™¨ä¹‹é—´çš„æ•°æ®æµé‡éƒ½æ˜¯é€šè¿‡IPè·¯ç”±çš„æ–¹å¼å®Œæˆäº’è”äº’é€šçš„ã€‚CalicoèŠ‚ç‚¹ç»„ç½‘æ—¶å¯ä»¥ç›´æ¥åˆ©ç”¨æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œç»“æ„ï¼ˆL2æˆ–è€…L3ï¼‰ï¼Œä¸éœ€è¦é¢å¤–çš„NATã€éš§é“æˆ–è€…Overlay Networkï¼Œæ²¡æœ‰é¢å¤–çš„å°åŒ…è§£åŒ…ï¼Œèƒ½å¤ŸèŠ‚çº¦CPUè¿ç®—ï¼Œæé«˜ç½‘ç»œæ•ˆç‡ã€‚</p><h3 id="55ã€ç®€è¿°Kuberneteså…±äº«å­˜å‚¨çš„ä½œç”¨ï¼Ÿ"><a href="#55ã€ç®€è¿°Kuberneteså…±äº«å­˜å‚¨çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="55ã€ç®€è¿°Kuberneteså…±äº«å­˜å‚¨çš„ä½œç”¨ï¼Ÿ"></a>55ã€ç®€è¿°Kuberneteså…±äº«å­˜å‚¨çš„ä½œç”¨ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kuberneteså¯¹äºæœ‰çŠ¶æ€çš„å®¹å™¨åº”ç”¨æˆ–è€…å¯¹æ•°æ®éœ€è¦æŒä¹…åŒ–çš„åº”ç”¨ï¼Œå› æ­¤éœ€è¦æ›´åŠ å¯é çš„å­˜å‚¨æ¥ä¿å­˜åº”ç”¨äº§ç”Ÿçš„é‡è¦æ•°æ®ï¼Œä»¥ä¾¿å®¹å™¨åº”ç”¨åœ¨é‡å»ºä¹‹åä»ç„¶å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„æ•°æ®ã€‚å› æ­¤éœ€è¦ä½¿ç”¨å…±äº«å­˜å‚¨ã€‚</p><h3 id="56ã€ç®€è¿°Kubernetesæ•°æ®æŒä¹…åŒ–çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#56ã€ç®€è¿°Kubernetesæ•°æ®æŒä¹…åŒ–çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="56ã€ç®€è¿°Kubernetesæ•°æ®æŒä¹…åŒ–çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>56ã€ç®€è¿°Kubernetesæ•°æ®æŒä¹…åŒ–çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesé€šè¿‡æ•°æ®æŒä¹…åŒ–æ¥æŒä¹…åŒ–ä¿å­˜é‡è¦æ•°æ®ï¼Œå¸¸è§çš„æ–¹å¼æœ‰ï¼š</p><ul><li>EmptyDirï¼ˆç©ºç›®å½•ï¼‰ï¼šæ²¡æœ‰æŒ‡å®šè¦æŒ‚è½½å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ï¼Œç›´æ¥ç”±Podå†…ä¿éƒ¨æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šã€‚ç±»ä¼¼äºdockerä¸­çš„manager volumeã€‚<ul><li>åœºæ™¯ï¼š</li><li>åªéœ€è¦ä¸´æ—¶å°†æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œæ¯”å¦‚åœ¨åˆå¹¶&#x2F;æ’åºç®—æ³•ä¸­ï¼›</li><li>ä½œä¸ºä¸¤ä¸ªå®¹å™¨çš„å…±äº«å­˜å‚¨ã€‚</li><li>ç‰¹æ€§ï¼š</li><li>åŒä¸ªpodé‡Œé¢çš„ä¸åŒå®¹å™¨ï¼Œå…±äº«åŒä¸€ä¸ªæŒä¹…åŒ–ç›®å½•ï¼Œå½“podèŠ‚ç‚¹åˆ é™¤æ—¶ï¼Œvolumeçš„æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</li><li>emptyDirçš„æ•°æ®æŒä¹…åŒ–çš„ç”Ÿå‘½å‘¨æœŸå’Œä½¿ç”¨çš„podä¸€è‡´ï¼Œä¸€èˆ¬æ˜¯ä½œä¸ºä¸´æ—¶å­˜å‚¨ä½¿ç”¨ã€‚</li></ul></li><li>Hostpathï¼šå°†å®¿ä¸»æœºä¸Šå·²å­˜åœ¨çš„ç›®å½•æˆ–æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ã€‚ç±»ä¼¼äºdockerä¸­çš„bind mountæŒ‚è½½æ–¹å¼ã€‚<ul><li>ç‰¹æ€§ï¼šå¢åŠ äº†podä¸èŠ‚ç‚¹ä¹‹é—´çš„è€¦åˆã€‚</li></ul></li><li>PersistentVolumeï¼ˆç®€ç§°PVï¼‰ï¼šå¦‚åŸºäºNFSæœåŠ¡çš„PVï¼Œä¹Ÿå¯ä»¥åŸºäºGlusterFSçš„PVã€‚å®ƒçš„ä½œç”¨æ˜¯ç»Ÿä¸€æ•°æ®æŒä¹…åŒ–ç›®å½•ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚</li></ul><h3 id="57ã€ç®€è¿°Kubernetes-PVå’ŒPVCï¼Ÿ"><a href="#57ã€ç®€è¿°Kubernetes-PVå’ŒPVCï¼Ÿ" class="headerlink" title="57ã€ç®€è¿°Kubernetes PVå’ŒPVCï¼Ÿ"></a>57ã€ç®€è¿°Kubernetes PVå’ŒPVCï¼Ÿ</h3><p>ç­”ï¼š</p><ul><li>PVæ˜¯å¯¹åº•å±‚ç½‘ç»œå…±äº«å­˜å‚¨çš„æŠ½è±¡ï¼Œå°†å…±äº«å­˜å‚¨å®šä¹‰ä¸ºä¸€ç§â€œèµ„æºâ€ã€‚</li><li>PVCåˆ™æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„ä¸€ä¸ªâ€œç”³è¯·â€ã€‚</li></ul><h3 id="58ã€ç®€è¿°Kubernetes-PVç”Ÿå‘½å‘¨æœŸå†…çš„é˜¶æ®µï¼Ÿ"><a href="#58ã€ç®€è¿°Kubernetes-PVç”Ÿå‘½å‘¨æœŸå†…çš„é˜¶æ®µï¼Ÿ" class="headerlink" title="58ã€ç®€è¿°Kubernetes PVç”Ÿå‘½å‘¨æœŸå†…çš„é˜¶æ®µï¼Ÿ"></a>58ã€ç®€è¿°Kubernetes PVç”Ÿå‘½å‘¨æœŸå†…çš„é˜¶æ®µï¼Ÿ</h3><p>ç­”ï¼š</p><p>æŸä¸ªPVåœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¯èƒ½å¤„äºä»¥ä¸‹4ä¸ªé˜¶æ®µï¼ˆPhaesï¼‰ä¹‹ä¸€ã€‚</p><ul><li>Availableï¼šå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªä¸æŸä¸ªPVCç»‘å®šã€‚</li><li>Boundï¼šå·²ä¸æŸä¸ªPVCç»‘å®šã€‚</li><li>Releasedï¼šç»‘å®šçš„PVCå·²ç»åˆ é™¤ï¼Œèµ„æºå·²é‡Šæ”¾ï¼Œä½†æ²¡æœ‰è¢«é›†ç¾¤å›æ”¶ã€‚</li><li>Failedï¼šè‡ªåŠ¨èµ„æºå›æ”¶å¤±è´¥ã€‚</li></ul><h3 id="59ã€ç®€è¿°Kubernetesæ‰€æ”¯æŒçš„å­˜å‚¨ä¾›åº”æ¨¡å¼ï¼Ÿ"><a href="#59ã€ç®€è¿°Kubernetesæ‰€æ”¯æŒçš„å­˜å‚¨ä¾›åº”æ¨¡å¼ï¼Ÿ" class="headerlink" title="59ã€ç®€è¿°Kubernetesæ‰€æ”¯æŒçš„å­˜å‚¨ä¾›åº”æ¨¡å¼ï¼Ÿ"></a>59ã€ç®€è¿°Kubernetesæ‰€æ”¯æŒçš„å­˜å‚¨ä¾›åº”æ¨¡å¼ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesæ”¯æŒä¸¤ç§èµ„æºçš„å­˜å‚¨ä¾›åº”æ¨¡å¼ï¼šé™æ€æ¨¡å¼ï¼ˆStaticï¼‰å’ŒåŠ¨æ€æ¨¡å¼ï¼ˆDynamicï¼‰ã€‚</p><ul><li>é™æ€æ¨¡å¼ï¼šé›†ç¾¤ç®¡ç†å‘˜æ‰‹å·¥åˆ›å»ºè®¸å¤šPVï¼Œåœ¨å®šä¹‰PVæ—¶éœ€è¦å°†åç«¯å­˜å‚¨çš„ç‰¹æ€§è¿›è¡Œè®¾ç½®ã€‚</li><li>åŠ¨æ€æ¨¡å¼ï¼šé›†ç¾¤ç®¡ç†å‘˜æ— é¡»æ‰‹å·¥åˆ›å»ºPVï¼Œè€Œæ˜¯é€šè¿‡StorageClassçš„è®¾ç½®å¯¹åç«¯å­˜å‚¨è¿›è¡Œæè¿°ï¼Œæ ‡è®°ä¸ºæŸç§ç±»å‹ã€‚æ­¤æ—¶è¦æ±‚PVCå¯¹å­˜å‚¨çš„ç±»å‹è¿›è¡Œå£°æ˜ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å®ŒæˆPVçš„åˆ›å»ºåŠä¸PVCçš„ç»‘å®šã€‚</li></ul><h3 id="60ã€ç®€è¿°Kubernetes-CSIæ¨¡å‹ï¼Ÿ"><a href="#60ã€ç®€è¿°Kubernetes-CSIæ¨¡å‹ï¼Ÿ" class="headerlink" title="60ã€ç®€è¿°Kubernetes CSIæ¨¡å‹ï¼Ÿ"></a>60ã€ç®€è¿°Kubernetes CSIæ¨¡å‹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetes CSIæ˜¯Kubernetesæ¨å‡ºä¸å®¹å™¨å¯¹æ¥çš„å­˜å‚¨æ¥å£æ ‡å‡†ï¼Œå­˜å‚¨æä¾›æ–¹åªéœ€è¦åŸºäºæ ‡å‡†æ¥å£è¿›è¡Œå­˜å‚¨æ’ä»¶çš„å®ç°ï¼Œå°±èƒ½ä½¿ç”¨Kubernetesçš„åŸç”Ÿå­˜å‚¨æœºåˆ¶ä¸ºå®¹å™¨æä¾›å­˜å‚¨æœåŠ¡ã€‚CSIä½¿å¾—å­˜å‚¨æä¾›æ–¹çš„ä»£ç èƒ½å’ŒKubernetesä»£ç å½»åº•è§£è€¦ï¼Œéƒ¨ç½²ä¹Ÿä¸Kubernetesæ ¸å¿ƒç»„ä»¶åˆ†ç¦»ï¼Œæ˜¾ç„¶ï¼Œå­˜å‚¨æ’ä»¶çš„å¼€å‘ç”±æä¾›æ–¹è‡ªè¡Œç»´æŠ¤ï¼Œå°±èƒ½ä¸ºKubernetesç”¨æˆ·æä¾›æ›´å¤šçš„å­˜å‚¨åŠŸèƒ½ï¼Œä¹Ÿæ›´åŠ å®‰å…¨å¯é ã€‚</p><p>CSIåŒ…æ‹¬CSI Controllerå’ŒCSI Nodeï¼š</p><ul><li>CSI Controllerçš„ä¸»è¦åŠŸèƒ½æ˜¯æä¾›å­˜å‚¨æœåŠ¡è§†è§’å¯¹å­˜å‚¨èµ„æºå’Œå­˜å‚¨å·è¿›è¡Œç®¡ç†å’Œ<br>æ“ä½œã€‚</li><li>CSI Nodeçš„ä¸»è¦åŠŸèƒ½æ˜¯å¯¹ä¸»æœºï¼ˆNodeï¼‰ä¸Šçš„Volumeè¿›è¡Œç®¡ç†å’Œæ“ä½œã€‚</li></ul><h3 id="61ã€ç®€è¿°Kubernetes-WorkerèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹ï¼Ÿ"><a href="#61ã€ç®€è¿°Kubernetes-WorkerèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="61ã€ç®€è¿°Kubernetes WorkerèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹ï¼Ÿ"></a>61ã€ç®€è¿°Kubernetes WorkerèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¿‡ç¨‹ï¼Ÿ</h3><p>ç­”ï¼š</p><p>é€šå¸¸éœ€è¦å¯¹WorkerèŠ‚ç‚¹è¿›è¡Œæ‰©å®¹ï¼Œä»è€Œå°†åº”ç”¨ç³»ç»Ÿè¿›è¡Œæ°´å¹³æ‰©å±•ã€‚ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>1ã€åœ¨è¯¥Nodeä¸Šå®‰è£…Dockerã€kubeletå’Œkube-proxyæœåŠ¡ï¼›</li><li>2ã€ç„¶åé…ç½®kubeletå’Œkubeproxyçš„å¯åŠ¨å‚æ•°ï¼Œå°†Master URLæŒ‡å®šä¸ºå½“å‰Kubernetesé›†ç¾¤Masterçš„åœ°å€ï¼Œæœ€åå¯åŠ¨è¿™äº›æœåŠ¡ï¼›</li><li>3ã€é€šè¿‡kubeleté»˜è®¤çš„è‡ªåŠ¨æ³¨å†Œæœºåˆ¶ï¼Œæ–°çš„Workerå°†ä¼šè‡ªåŠ¨åŠ å…¥ç°æœ‰çš„Kubernetesé›†ç¾¤ä¸­ï¼›</li><li>4ã€Kubernetes Masteråœ¨æ¥å—äº†æ–°Workerçš„æ³¨å†Œä¹‹åï¼Œä¼šè‡ªåŠ¨å°†å…¶çº³å…¥å½“å‰é›†ç¾¤çš„è°ƒåº¦èŒƒå›´ã€‚</li></ul><h3 id="62ã€ç®€è¿°Kubernetes-Podå¦‚ä½•å®ç°å¯¹èŠ‚ç‚¹çš„èµ„æºæ§åˆ¶ï¼Ÿ"><a href="#62ã€ç®€è¿°Kubernetes-Podå¦‚ä½•å®ç°å¯¹èŠ‚ç‚¹çš„èµ„æºæ§åˆ¶ï¼Ÿ" class="headerlink" title="62ã€ç®€è¿°Kubernetes Podå¦‚ä½•å®ç°å¯¹èŠ‚ç‚¹çš„èµ„æºæ§åˆ¶ï¼Ÿ"></a>62ã€ç®€è¿°Kubernetes Podå¦‚ä½•å®ç°å¯¹èŠ‚ç‚¹çš„èµ„æºæ§åˆ¶ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetesé›†ç¾¤é‡Œçš„èŠ‚ç‚¹æä¾›çš„èµ„æºä¸»è¦æ˜¯è®¡ç®—èµ„æºï¼Œè®¡ç®—èµ„æºæ˜¯å¯è®¡é‡çš„èƒ½è¢«ç”³è¯·ã€åˆ†é…å’Œä½¿ç”¨çš„åŸºç¡€èµ„æºã€‚å½“å‰Kubernetesé›†ç¾¤ä¸­çš„è®¡ç®—èµ„æºä¸»è¦åŒ…æ‹¬CPUã€GPUåŠMemoryã€‚CPUä¸Memoryæ˜¯è¢«Podä½¿ç”¨çš„ï¼Œå› æ­¤åœ¨é…ç½®Podæ—¶å¯ä»¥é€šè¿‡å‚æ•°CPU RequeståŠMemory Requestä¸ºå…¶ä¸­çš„æ¯ä¸ªå®¹å™¨æŒ‡å®šæ‰€éœ€ä½¿ç”¨çš„CPUä¸Memoryé‡ï¼ŒKubernetesä¼šæ ¹æ®Requestçš„å€¼å»æŸ¥æ‰¾æœ‰è¶³å¤Ÿèµ„æºçš„Nodeæ¥è°ƒåº¦æ­¤Podã€‚é€šå¸¸ï¼Œä¸€ä¸ªç¨‹åºæ‰€ä½¿ç”¨çš„CPU ä¸Memory æ˜¯ä¸€ä¸ªåŠ¨æ€çš„é‡ï¼Œç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œè·Ÿå®ƒçš„è´Ÿè½½å¯†åˆ‡ç›¸å…³ï¼šè´Ÿè½½å¢åŠ æ—¶ï¼ŒCPUå’ŒMemoryçš„ä½¿ç”¨é‡ä¹Ÿä¼šå¢åŠ ã€‚</p><h3 id="63ã€ç®€è¿°Kubernetes-Requestså’ŒLimitså¦‚ä½•å½±å“Podçš„è°ƒåº¦ï¼Ÿ"><a href="#63ã€ç®€è¿°Kubernetes-Requestså’ŒLimitså¦‚ä½•å½±å“Podçš„è°ƒåº¦ï¼Ÿ" class="headerlink" title="63ã€ç®€è¿°Kubernetes Requestså’ŒLimitså¦‚ä½•å½±å“Podçš„è°ƒåº¦ï¼Ÿ"></a>63ã€ç®€è¿°Kubernetes Requestså’ŒLimitså¦‚ä½•å½±å“Podçš„è°ƒåº¦ï¼Ÿ</h3><p>ç­”ï¼š</p><p>å½“ä¸€ä¸ªPodåˆ›å»ºæˆåŠŸæ—¶ï¼ŒKubernetesè°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ä¼šä¸ºè¯¥Podé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æ¥æ‰§è¡Œã€‚å¯¹äºæ¯ç§è®¡ç®—èµ„æºï¼ˆCPUå’ŒMemoryï¼‰è€Œè¨€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªèƒ½ç”¨äºè¿è¡ŒPodçš„æœ€å¤§å®¹é‡å€¼ã€‚è°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶ï¼Œé¦–å…ˆè¦ç¡®ä¿è°ƒåº¦åè¯¥èŠ‚ç‚¹ä¸Šæ‰€æœ‰Podçš„CPUå’Œå†…å­˜çš„Requestsæ€»å’Œï¼Œä¸è¶…è¿‡è¯¥èŠ‚ç‚¹èƒ½æä¾›ç»™Podä½¿ç”¨çš„CPUå’ŒMemoryçš„æœ€å¤§å®¹é‡å€¼ã€‚</p><h3 id="64ã€ç®€è¿°Kubernetes-Metric-Serviceï¼Ÿ"><a href="#64ã€ç®€è¿°Kubernetes-Metric-Serviceï¼Ÿ" class="headerlink" title="64ã€ç®€è¿°Kubernetes Metric Serviceï¼Ÿ"></a>64ã€ç®€è¿°Kubernetes Metric Serviceï¼Ÿ</h3><p>ç­”ï¼š</p><p>åœ¨Kubernetesä»1.10ç‰ˆæœ¬åé‡‡ç”¨Metrics Serverä½œä¸ºé»˜è®¤çš„æ€§èƒ½æ•°æ®é‡‡é›†å’Œç›‘æ§ï¼Œä¸»è¦ç”¨äºæä¾›æ ¸å¿ƒæŒ‡æ ‡ï¼ˆCore Metricsï¼‰ï¼ŒåŒ…æ‹¬Nodeã€Podçš„CPUå’Œå†…å­˜ä½¿<br>ç”¨æŒ‡æ ‡ã€‚å¯¹å…¶ä»–è‡ªå®šä¹‰æŒ‡æ ‡ï¼ˆCustom Metricsï¼‰çš„ç›‘æ§åˆ™ç”±Prometheusç­‰ç»„ä»¶æ¥å®Œæˆã€‚</p><h3 id="65ã€ç®€è¿°Kubernetesä¸­ï¼Œå¦‚ä½•ä½¿ç”¨EFKå®ç°æ—¥å¿—çš„ç»Ÿä¸€ç®¡ç†ï¼Ÿ"><a href="#65ã€ç®€è¿°Kubernetesä¸­ï¼Œå¦‚ä½•ä½¿ç”¨EFKå®ç°æ—¥å¿—çš„ç»Ÿä¸€ç®¡ç†ï¼Ÿ" class="headerlink" title="65ã€ç®€è¿°Kubernetesä¸­ï¼Œå¦‚ä½•ä½¿ç”¨EFKå®ç°æ—¥å¿—çš„ç»Ÿä¸€ç®¡ç†ï¼Ÿ"></a>65ã€ç®€è¿°Kubernetesä¸­ï¼Œå¦‚ä½•ä½¿ç”¨EFKå®ç°æ—¥å¿—çš„ç»Ÿä¸€ç®¡ç†ï¼Ÿ</h3><p>ç­”ï¼š</p><p>åœ¨Kubernetesé›†ç¾¤ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨æˆ–æœåŠ¡æ¶‰åŠç»„ä»¶è¿‡å¤šï¼Œå»ºè®®å¯¹æ—¥å¿—ç³»ç»Ÿè¿›è¡Œé›†ä¸­åŒ–ç®¡ç†ï¼Œé€šå¸¸é‡‡ç”¨EFKå®ç°ã€‚<br>EFKæ˜¯ Elasticsearchã€Fluentd å’Œ Kibana çš„ç»„åˆï¼Œå…¶å„ç»„ä»¶åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>Elasticsearchï¼šæ˜¯ä¸€ä¸ªæœç´¢å¼•æ“ï¼Œè´Ÿè´£å­˜å‚¨æ—¥å¿—å¹¶æä¾›æŸ¥è¯¢æ¥å£ï¼›</li><li>Fluentdï¼šè´Ÿè´£ä» Kubernetes æœé›†æ—¥å¿—ï¼Œæ¯ä¸ªnodeèŠ‚ç‚¹ä¸Šé¢çš„fluentdç›‘æ§å¹¶æ”¶é›†è¯¥èŠ‚ç‚¹ä¸Šé¢çš„ç³»ç»Ÿæ—¥å¿—ï¼Œå¹¶å°†å¤„ç†è¿‡åçš„æ—¥å¿—ä¿¡æ¯å‘é€ç»™Elasticsearchï¼›</li><li>Kibanaï¼šæä¾›äº†ä¸€ä¸ª Web GUIï¼Œç”¨æˆ·å¯ä»¥æµè§ˆå’Œæœç´¢å­˜å‚¨åœ¨ Elasticsearch ä¸­çš„æ—¥å¿—ã€‚</li></ul><p>é€šè¿‡åœ¨æ¯å°nodeä¸Šéƒ¨ç½²ä¸€ä¸ªä»¥DaemonSetæ–¹å¼è¿è¡Œçš„fluentdæ¥æ”¶é›†æ¯å°nodeä¸Šçš„æ—¥å¿—ã€‚Fluentdå°†dockeræ—¥å¿—ç›®å½•&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containerså’Œ&#x2F;var&#x2F;logç›®å½•<br>æŒ‚è½½åˆ°Podä¸­ï¼Œç„¶åPodä¼šåœ¨nodeèŠ‚ç‚¹çš„&#x2F;var&#x2F;log&#x2F;podsç›®å½•ä¸­åˆ›å»ºæ–°çš„ç›®å½•ï¼Œå¯ä»¥åŒºåˆ«ä¸åŒçš„å®¹å™¨æ—¥å¿—è¾“å‡ºï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶é“¾æ¥åˆ°&#x2F;var&#x2F;lib&#x2F;docker&#x2F;contianersç›®å½•ä¸‹çš„å®¹å™¨æ—¥å¿—è¾“å‡ºã€‚</p><h3 id="66ã€ç®€è¿°Kuberneteså¦‚ä½•è¿›è¡Œä¼˜é›…çš„èŠ‚ç‚¹å…³æœºç»´æŠ¤ï¼Ÿ"><a href="#66ã€ç®€è¿°Kuberneteså¦‚ä½•è¿›è¡Œä¼˜é›…çš„èŠ‚ç‚¹å…³æœºç»´æŠ¤ï¼Ÿ" class="headerlink" title="66ã€ç®€è¿°Kuberneteså¦‚ä½•è¿›è¡Œä¼˜é›…çš„èŠ‚ç‚¹å…³æœºç»´æŠ¤ï¼Ÿ"></a>66ã€ç®€è¿°Kuberneteså¦‚ä½•è¿›è¡Œä¼˜é›…çš„èŠ‚ç‚¹å…³æœºç»´æŠ¤ï¼Ÿ</h3><p>ç­”ï¼š</p><p>ç”±äºKubernetesèŠ‚ç‚¹è¿è¡Œå¤§é‡Podï¼Œå› æ­¤åœ¨è¿›è¡Œå…³æœºç»´æŠ¤ä¹‹å‰ï¼Œå»ºè®®å…ˆä½¿ç”¨kubectl drainå°†è¯¥èŠ‚ç‚¹çš„Podè¿›è¡Œé©±é€ï¼Œç„¶åè¿›è¡Œå…³æœºç»´æŠ¤ã€‚</p><h3 id="67ã€ç®€è¿°Kubernetesé›†ç¾¤è”é‚¦ï¼Ÿ"><a href="#67ã€ç®€è¿°Kubernetesé›†ç¾¤è”é‚¦ï¼Ÿ" class="headerlink" title="67ã€ç®€è¿°Kubernetesé›†ç¾¤è”é‚¦ï¼Ÿ"></a>67ã€ç®€è¿°Kubernetesé›†ç¾¤è”é‚¦ï¼Ÿ</h3><p>ç­”ï¼š</p><p>Kubernetes é›†ç¾¤è”é‚¦å¯ä»¥å°†å¤šä¸ªKubernetes é›†ç¾¤ä½œä¸ºä¸€ä¸ªé›†ç¾¤è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ•°æ®ä¸­å¿ƒ&#x2F;äº‘ä¸­åˆ›å»ºå¤šä¸ªKubernetesé›†ç¾¤ï¼Œå¹¶ä½¿ç”¨é›†ç¾¤è”é‚¦åœ¨ä¸€ä¸ªåœ°æ–¹æ§åˆ¶&#x2F;ç®¡ç†æ‰€æœ‰é›†ç¾¤ã€‚</p><h3 id="68ã€ç®€è¿°HelmåŠå…¶ä¼˜åŠ¿ï¼Ÿ"><a href="#68ã€ç®€è¿°HelmåŠå…¶ä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="68ã€ç®€è¿°HelmåŠå…¶ä¼˜åŠ¿ï¼Ÿ"></a>68ã€ç®€è¿°HelmåŠå…¶ä¼˜åŠ¿ï¼Ÿ</h3><p>ç­”ï¼š<br>Helm æ˜¯ Kubernetes çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ã€‚ç±»ä¼¼ Ubuntu ä¸­ä½¿ç”¨çš„aptã€Centosä¸­ä½¿ç”¨çš„yum æˆ–è€…Pythonä¸­çš„ pip ä¸€æ ·ã€‚<br>Helmèƒ½å¤Ÿå°†ä¸€ç»„K8Sèµ„æºæ‰“åŒ…ç»Ÿä¸€ç®¡ç†, æ˜¯æŸ¥æ‰¾ã€å…±äº«å’Œä½¿ç”¨ä¸ºKubernetesæ„å»ºçš„è½¯ä»¶çš„æœ€ä½³æ–¹å¼ã€‚<br>Helmä¸­é€šå¸¸æ¯ä¸ªåŒ…ç§°ä¸ºä¸€ä¸ªChartï¼Œä¸€ä¸ªChartæ˜¯ä¸€ä¸ªç›®å½•ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¼šå°†ç›®å½•è¿›è¡Œæ‰“åŒ…å‹ç¼©ï¼Œå½¢æˆname-version.tgzæ ¼å¼çš„å•ä¸€æ–‡ä»¶ï¼Œæ–¹ä¾¿ä¼ è¾“å’Œå­˜å‚¨ï¼‰</p><ul><li>Helmä¼˜åŠ¿<br>  åœ¨ Kubernetesä¸­éƒ¨ç½²ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„åº”ç”¨ï¼Œéœ€è¦æ¶‰åŠåˆ°å¾ˆå¤šçš„ Kubernetes èµ„æºçš„<br>  å…±åŒåä½œã€‚ä½¿ç”¨helmåˆ™å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</li><li>ç»Ÿä¸€ç®¡ç†ã€é…ç½®å’Œæ›´æ–°è¿™äº›åˆ†æ•£çš„ k8s çš„åº”ç”¨èµ„æºæ–‡ä»¶ï¼›</li><li>åˆ†å‘å’Œå¤ç”¨ä¸€å¥—åº”ç”¨æ¨¡æ¿ï¼›</li><li>å°†åº”ç”¨çš„ä¸€ç³»åˆ—èµ„æºå½“åšä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†ã€‚<br>å¯¹äºåº”ç”¨å‘å¸ƒè€…è€Œè¨€ï¼Œå¯ä»¥é€šè¿‡ Helm æ‰“åŒ…åº”ç”¨ã€ç®¡ç†åº”ç”¨ä¾èµ–å…³ç³»ã€ç®¡ç†åº”ç”¨ç‰ˆæœ¬å¹¶å‘å¸ƒåº”ç”¨åˆ°è½¯ä»¶ä»“åº“ã€‚</li><li>å¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œä½¿ç”¨ Helm åä¸ç”¨éœ€è¦ç¼–å†™å¤æ‚çš„åº”ç”¨éƒ¨ç½²æ–‡ä»¶ï¼Œå¯ä»¥ä»¥ç®€å•<br>çš„æ–¹å¼åœ¨ Kubernetes ä¸ŠæŸ¥æ‰¾ã€å®‰è£…ã€å‡çº§ã€å›æ»šã€å¸è½½åº”ç”¨ç¨‹åºã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>job</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>prometheusè”é‚¦é›†ç¾¤é…ç½®</title>
    <link href="/2025/06/10/prometheus%E8%81%94%E9%82%A6%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/"/>
    <url>/2025/06/10/prometheus%E8%81%94%E9%82%A6%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h3><p>å¯¹äºå¤§éƒ¨åˆ†ç›‘æ§è§„æ¨¡è€Œè¨€ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ¯ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå®‰è£…ä¸€ä¸ªPrometheus Serverå®ä¾‹ï¼Œå°±å¯ä»¥åœ¨å„ä¸ªæ•°æ®ä¸­å¿ƒå¤„ç†ä¸Šåƒè§„æ¨¡çš„é›†ç¾¤ã€‚åŒæ—¶å°†Prometheus Serveréƒ¨ç½²åˆ°ä¸åŒçš„æ•°æ®ä¸­å¿ƒå¯ä»¥é¿å…ç½‘ç»œé…ç½®çš„å¤æ‚æ€§ã€‚</p><p>åœ¨æ¯ä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½²å•ç‹¬çš„Prometheus Serverï¼Œç”¨äºé‡‡é›†å½“å‰æ•°æ®ä¸­å¿ƒç›‘æ§æ•°æ®ã€‚å¹¶ç”±ä¸€ä¸ªä¸­å¿ƒçš„Prometheus Serverè´Ÿè´£èšåˆå¤šä¸ªæ•°æ®ä¸­å¿ƒçš„ç›‘æ§æ•°æ®ã€‚è¿™ä¸€ç‰¹æ€§åœ¨Promthuesä¸­ç§°ä¸ºè”é‚¦é›†ç¾¤ã€‚</p><p>è”é‚¦é›†ç¾¤çš„æ ¸å¿ƒåœ¨äºæ¯ä¸€ä¸ªPrometheus Serveréƒ½åŒ…å«ä¸€ä¸ªç”¨äºè·å–å½“å‰å®ä¾‹ä¸­ç›‘æ§æ ·æœ¬çš„æ¥å£&#x2F;federateã€‚å¯¹äºä¸­å¿ƒPrometheus Serverè€Œè¨€ï¼Œæ— è®ºæ˜¯ä»å…¶ä»–çš„Prometheuså®ä¾‹è¿˜æ˜¯Exporterå®ä¾‹ä¸­è·å–æ•°æ®å®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•å·®å¼‚ã€‚</p><h4 id="é›†ç¾¤éƒ¨ç½²æ¶æ„"><a href="#é›†ç¾¤éƒ¨ç½²æ¶æ„" class="headerlink" title="é›†ç¾¤éƒ¨ç½²æ¶æ„"></a>é›†ç¾¤éƒ¨ç½²æ¶æ„</h4><p><img src="http://cdn.882227.xyz/911490-20240924144456377-1208190196.png" alt="911490-20240924144456377-1208190196"></p><h3 id="ä¸‰ã€éƒ¨ç½²prometheusè”é‚¦é›†ç¾¤å¹¶æŠ“å–å¯¹åº”èŠ‚ç‚¹æ•°æ®"><a href="#ä¸‰ã€éƒ¨ç½²prometheusè”é‚¦é›†ç¾¤å¹¶æŠ“å–å¯¹åº”èŠ‚ç‚¹æ•°æ®" class="headerlink" title="ä¸‰ã€éƒ¨ç½²prometheusè”é‚¦é›†ç¾¤å¹¶æŠ“å–å¯¹åº”èŠ‚ç‚¹æ•°æ®"></a>ä¸‰ã€éƒ¨ç½²prometheusè”é‚¦é›†ç¾¤å¹¶æŠ“å–å¯¹åº”èŠ‚ç‚¹æ•°æ®</h3><h4 id="1-ä¸­å¿ƒåŠè”é‚¦prometheusèŠ‚ç‚¹éƒ¨ç½²prometheus"><a href="#1-ä¸­å¿ƒåŠè”é‚¦prometheusèŠ‚ç‚¹éƒ¨ç½²prometheus" class="headerlink" title="1.ä¸­å¿ƒåŠè”é‚¦prometheusèŠ‚ç‚¹éƒ¨ç½²prometheus"></a>1.ä¸­å¿ƒåŠè”é‚¦prometheusèŠ‚ç‚¹éƒ¨ç½²prometheus</h4><p>åœ¨ 100.131 100.132 100.133ä¸‰å°æœåŠ¡å™¨ä¸Šå®‰è£…prometheus,äºŒè¿›åˆ¶éƒ¨ç½²ï¼Œéƒ¨ç½²æ­¥éª¤ç•¥ï¼Œå¯å‚è€ƒï¼š<a href="https://www.cnblogs.com/panwenbin-logs/p/18370049">https://www.cnblogs.com/panwenbin-logs/p/18370049</a>  ï¼Œå„èŠ‚ç‚¹ç‰ˆæœ¬ä¿æŒä¸€è‡´</p><h4 id="2-è¢«é‡‡é›†èŠ‚ç‚¹å®‰è£…node-exporter"><a href="#2-è¢«é‡‡é›†èŠ‚ç‚¹å®‰è£…node-exporter" class="headerlink" title="2.è¢«é‡‡é›†èŠ‚ç‚¹å®‰è£…node-exporter"></a>2.è¢«é‡‡é›†èŠ‚ç‚¹å®‰è£…node-exporter</h4><p>åœ¨ 10.134 100.135 2å°æœåŠ¡å™¨ä¸ŠäºŒè¿›åˆ¶éƒ¨ç½²node-exporterï¼Œéƒ¨ç½²æ­¥éª¤ç•¥ï¼Œå‚è€ƒ:å‚è€ƒï¼š<a href="https://www.cnblogs.com/panwenbin-logs/p/18370049">https://www.cnblogs.com/panwenbin-logs/p/18370049</a></p><h4 id="3-é…ç½®prometheusè”é‚¦èŠ‚ç‚¹é‡‡é›†æ•°æ®"><a href="#3-é…ç½®prometheusè”é‚¦èŠ‚ç‚¹é‡‡é›†æ•°æ®" class="headerlink" title="3.é…ç½®prometheusè”é‚¦èŠ‚ç‚¹é‡‡é›†æ•°æ®"></a>3.é…ç½®prometheusè”é‚¦èŠ‚ç‚¹é‡‡é›†æ•°æ®</h4><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment">#è”é‚¦èŠ‚ç‚¹1</span><br><span class="hljs-params">scrape_configs:</span><br>  <span class="hljs-operator">-</span> <span class="hljs-params">job_name:</span> <span class="hljs-string">&quot;prod-app01&quot;</span><br>    <span class="hljs-params">static_configs:</span><br>      <span class="hljs-operator">-</span> <span class="hljs-params">targets:</span> [<span class="hljs-string">&quot;192.168.100.134:9100&quot;</span>]<br><br><br><span class="hljs-comment">#è”é‚¦èŠ‚ç‚¹2</span><br><span class="hljs-params">scrape_configs:</span><br>  <span class="hljs-operator">-</span> <span class="hljs-params">job_name:</span> <span class="hljs-string">&quot;prod-app02&quot;</span><br>    <span class="hljs-params">static_configs:</span><br>      <span class="hljs-operator">-</span> <span class="hljs-params">targets:</span> [<span class="hljs-string">&quot;192.168.100.135:9100&quot;</span>]<br></code></pre></td></tr></table></figure><p>æ˜¯å¦æŠ“å–æ•°æ®æ­£å¸¸</p><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/911490-20240924153302339-1297263141.png"></p><p><img src="http://cdn.882227.xyz/911490-20240924153314462-2046999070.png" alt="911490-20240924153314462-2046999070"></p><h4 id="4-é…ç½®ä¸­å¿ƒprometheus-server-æŠ“å–è”é‚¦èŠ‚ç‚¹prometheus"><a href="#4-é…ç½®ä¸­å¿ƒprometheus-server-æŠ“å–è”é‚¦èŠ‚ç‚¹prometheus" class="headerlink" title="4.é…ç½®ä¸­å¿ƒprometheus server æŠ“å–è”é‚¦èŠ‚ç‚¹prometheus"></a>4.é…ç½®ä¸­å¿ƒprometheus server æŠ“å–è”é‚¦èŠ‚ç‚¹prometheus</h4><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment">#åœ¨100.131ä¸Šæ“ä½œ</span><br>vim prometheus.yml<br> <span class="hljs-operator">-</span> <span class="hljs-params">job_name:</span> &#x27;prometheus-federate-<span class="hljs-number">100.132</span>&#x27;<br>   <span class="hljs-params">scrape_interval:</span> <span class="hljs-number">10</span>s<br>   <span class="hljs-params">honor_labels:</span> <span class="hljs-literal">true</span><br>   <span class="hljs-params">metrics_path:</span> &#x27;<span class="hljs-operator">/</span>federate&#x27;<br>   <span class="hljs-params">params:</span><br>    &#x27;match[]&#x27;:<br>      <span class="hljs-operator">-</span> &#x27;&#123;<span class="hljs-attr">job</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;prometheus&quot;</span>&#125;&#x27;  <span class="hljs-comment"># &#123;job=&quot;prometheus&quot;&#125; â†’ åŒ¹é… upï¼ˆå› ä¸ºå®ƒçš„ job æ ‡ç­¾æ˜¯ &quot;prometheus&quot;ï¼‰</span><br>      <span class="hljs-operator">-</span> &#x27;&#123;<span class="hljs-attr">__name__</span><span class="hljs-operator">=</span>~<span class="hljs-string">&quot;job:.*&quot;</span>&#125;&#x27;   <span class="hljs-comment"># &#123;__name__=\~&quot;job:.*&quot;&#125; â†’ åŒ¹é… job:api_requests</span><br>      <span class="hljs-operator">-</span> &#x27;&#123;<span class="hljs-attr">__name__</span><span class="hljs-operator">=</span>~<span class="hljs-string">&quot;node.*&quot;</span>&#125;&#x27;   <span class="hljs-comment"># &#123;__name__=\~&quot;node.*&quot;&#125; â†’ åŒ¹é… node_cpu_seconds_total</span><br>   <span class="hljs-params">static_configs:</span><br>     <span class="hljs-operator">-</span> <span class="hljs-params">targets:</span><br>       <span class="hljs-operator">-</span> &#x27;<span class="hljs-number">192.168</span>.<span class="hljs-number">100.132</span>:<span class="hljs-number">9090</span>&#x27;  <span class="hljs-comment">#ä¸‹é¢çš„ä¹Ÿå¯ä»¥ä¸å†™ï¼ŒæŠŠ133å†™åœ¨æ­¤å¤„ä¹Ÿæ˜¯å¯ä»¥çš„</span><br><br> <span class="hljs-operator">-</span> <span class="hljs-params">job_name:</span> &#x27;prometheus-federate-<span class="hljs-number">100.133</span>&#x27;<br>   <span class="hljs-params">scrape_interval:</span> <span class="hljs-number">10</span>s<br>   <span class="hljs-params">honor_labels:</span> <span class="hljs-literal">true</span><br>   <span class="hljs-params">metrics_path:</span> &#x27;<span class="hljs-operator">/</span>federate&#x27;<br>   <span class="hljs-params">params:</span><br>    &#x27;match[]&#x27;:<br>      <span class="hljs-operator">-</span> &#x27;&#123;<span class="hljs-attr">job</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;prometheus&quot;</span>&#125;&#x27;<br>      <span class="hljs-operator">-</span> &#x27;&#123;<span class="hljs-attr">__name__</span><span class="hljs-operator">=</span>~<span class="hljs-string">&quot;job:.*&quot;</span>&#125;&#x27;<br>      <span class="hljs-operator">-</span> &#x27;&#123;<span class="hljs-attr">__name__</span><span class="hljs-operator">=</span>~<span class="hljs-string">&quot;node.*&quot;</span>&#125;&#x27;<br>   <span class="hljs-params">static_configs:</span><br>     <span class="hljs-operator">-</span> <span class="hljs-params">targets:</span><br>       <span class="hljs-operator">-</span> &#x27;<span class="hljs-number">192.168</span>.<span class="hljs-number">100.133</span>:<span class="hljs-number">9090</span>&#x27;<br><br><span class="hljs-comment"># é‡å¯Prometheus</span><br>systemctl restart prometheus<br></code></pre></td></tr></table></figure><p>webç«¯éªŒè¯</p><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/911490-20240924154408692-1271488005.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/911490-20240924154934172-2143060460.png"></p><p>grafanaå›¾æ ‡éªŒè¯</p><p><img src="http://cdn.882227.xyz/911490-20240924155321767-653618831.png" alt="911490-20240924155321767-653618831"></p><p>å¯ä»¥çœ‹åˆ°æ•°æ®å¯ä»¥æ­£å¸¸æŠ“å–åŠå±•ç¤ºÂ </p><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://prometheus.io/docs/prometheus/latest/federation/">https://prometheus.io/docs/prometheus/latest/federation/</a></p><p>æœ¬æ–‡è½¬è‡ª <a href="https://www.cnblogs.com/panwenbin-logs/p/18429140">https://www.cnblogs.com/panwenbin-logs/p/18429140</a>ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>service</category>
      
    </categories>
    
    
    <tags>
      
      <tag>prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>consulæŠ¥é”™ç¦»çº¿é›†ç¾¤</title>
    <link href="/2025/05/26/consul%E6%8A%A5%E9%94%99%E7%A6%BB%E7%BA%BF%E9%9B%86%E7%BE%A4/"/>
    <url>/2025/05/26/consul%E6%8A%A5%E9%94%99%E7%A6%BB%E7%BA%BF%E9%9B%86%E7%BE%A4/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æŠ¥é”™æç¤ºï¼šagent: startup error: error&#x3D;â€refusing to rejoin cluster because server has been offline for more than the configured server_rejoin_age_max (168h0m0s) - consider wiping your data dirâ€</p><p> Consul æœåŠ¡å™¨å› ä¸ºç¦»çº¿æ—¶é—´è¶…è¿‡äº†é…ç½®çš„ <code>server_rejoin_age_max</code>ï¼ˆé»˜è®¤ä¸º168å°æ—¶&#x2F;7å¤©ï¼‰è€Œæ‹’ç»é‡æ–°åŠ å…¥é›†ç¾¤ã€‚</p><h4 id="é”™è¯¯åŸå› "><a href="#é”™è¯¯åŸå› " class="headerlink" title="é”™è¯¯åŸå› "></a>é”™è¯¯åŸå› </h4><p>Consul å‡ºäºæ•°æ®ä¸€è‡´æ€§å’Œå®‰å…¨è€ƒè™‘ï¼Œä¼šé˜»æ­¢é•¿æ—¶é—´ç¦»çº¿çš„æœåŠ¡å™¨é‡æ–°åŠ å…¥é›†ç¾¤ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p></blockquote><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><h5 id="æ–¹æ³•1ï¼šæ¸…é™¤æ•°æ®ç›®å½•ï¼ˆæ¨èç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰"><a href="#æ–¹æ³•1ï¼šæ¸…é™¤æ•°æ®ç›®å½•ï¼ˆæ¨èç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰" class="headerlink" title="æ–¹æ³•1ï¼šæ¸…é™¤æ•°æ®ç›®å½•ï¼ˆæ¨èç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰"></a>æ–¹æ³•1ï¼šæ¸…é™¤æ•°æ®ç›®å½•ï¼ˆæ¨èç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰</h5><ol><li>åœæ­¢ Consul æœåŠ¡</li><li>åˆ é™¤ Consul çš„æ•°æ®ç›®å½•ï¼ˆé»˜è®¤ä½äº <code>/var/lib/consul</code> æˆ– <code>./consul/data</code>ï¼‰</li><li>é‡æ–°å¯åŠ¨ Consul æœåŠ¡</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl stop consul<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">rm</span> -rf /var/lib/consul/*<br><span class="hljs-built_in">sudo</span> systemctl start consul<br></code></pre></td></tr></table></figure><h5 id="æ–¹æ³•2ï¼šä¸´æ—¶è°ƒæ•´é…ç½®ï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰"><a href="#æ–¹æ³•2ï¼šä¸´æ—¶è°ƒæ•´é…ç½®ï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰" class="headerlink" title="æ–¹æ³•2ï¼šä¸´æ—¶è°ƒæ•´é…ç½®ï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰"></a>æ–¹æ³•2ï¼šä¸´æ—¶è°ƒæ•´é…ç½®ï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰</h5><ol><li>ä¿®æ”¹ Consul é…ç½®æ–‡ä»¶ï¼Œå¢åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;server_rejoin_age_max&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;720h&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;rejoin_after_leave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ol><li>é‡æ–°å¯åŠ¨ Consul æœåŠ¡</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart consul<br></code></pre></td></tr></table></figure><h5 id="æ–¹æ³•3ï¼šå¼ºåˆ¶é‡æ–°åŠ å…¥ï¼ˆä¸æ¨èï¼‰"><a href="#æ–¹æ³•3ï¼šå¼ºåˆ¶é‡æ–°åŠ å…¥ï¼ˆä¸æ¨èï¼‰" class="headerlink" title="æ–¹æ³•3ï¼šå¼ºåˆ¶é‡æ–°åŠ å…¥ï¼ˆä¸æ¨èï¼‰"></a>æ–¹æ³•3ï¼šå¼ºåˆ¶é‡æ–°åŠ å…¥ï¼ˆä¸æ¨èï¼‰</h5><p>å¦‚æœå¿…é¡»ä¿ç•™åŸæœ‰æ•°æ®ï¼Œå¯ä»¥å°è¯•å¼ºåˆ¶é‡æ–°åŠ å…¥ï¼š</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">consul <span class="hljs-literal">force</span>-<span class="hljs-literal">leave</span> &lt;èŠ‚ç‚¹åç§°&gt;<br></code></pre></td></tr></table></figure><h5 id="é¢„é˜²æªæ–½"><a href="#é¢„é˜²æªæ–½" class="headerlink" title="é¢„é˜²æªæ–½"></a>é¢„é˜²æªæ–½</h5><ol><li>å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ï¼š<ul><li>è®¾ç½®ç›‘æ§ï¼ŒåŠæ—¶å‘ç°èŠ‚ç‚¹ç¦»çº¿æƒ…å†µ</li><li>å®šæœŸå¤‡ä»½ Consul æ•°æ®</li><li>è€ƒè™‘ä½¿ç”¨ Consul çš„è‡ªåŠ¨ä¿®å¤åŠŸèƒ½</li></ul></li><li>å¯¹äºé•¿æ—¶é—´ç»´æŠ¤è®¡åˆ’ï¼š<ul><li>æå‰ä½¿ç”¨ <code>consul leave</code> å‘½ä»¤ä¼˜é›…é€€å‡º</li><li>ç»´æŠ¤å®Œæˆåä½¿ç”¨ <code>consul join</code> é‡æ–°åŠ å…¥</li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>consul</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰</title>
    <link href="/2025/05/14/Kubernetes%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2%EF%BC%88Runtime%20Containerd%EF%BC%89/"/>
    <url>/2025/05/14/Kubernetes%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2%EF%BC%88Runtime%20Containerd%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime-Containerdï¼‰"><a href="#Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime-Containerdï¼‰" class="headerlink" title="Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰"></a>Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰</h1><p>Kubernetesï¼ˆç®€ç§°ä¸ºï¼šk8sï¼‰æ˜¯Googleåœ¨2014å¹´6æœˆå¼€æºçš„ä¸€ä¸ªå®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨Goè¯­è¨€å¼€å‘ï¼Œç”¨äºç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ï¼ŒKubernetesçš„ç›®æ ‡æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç®€å•å¹¶ä¸”é«˜æ•ˆ,Kubernetesæä¾›äº†èµ„æºè°ƒåº¦ã€éƒ¨ç½²ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ‰©å®¹ç¼©å®¹ã€ç›‘æ§ï¼Œç»´æŠ¤ç­‰ä¸€æ•´å¥—åŠŸèƒ½ï¼ŒåŠªåŠ›æˆä¸ºè·¨ä¸»æœºé›†ç¾¤çš„è‡ªåŠ¨éƒ¨ç½²ã€æ‰©å±•ä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºå®¹å™¨çš„å¹³å°ã€‚ å®ƒæ”¯æŒä¸€ç³»åˆ—å®¹å™¨å·¥å…·, åŒ…æ‹¬Dockerã€Containerdç­‰ã€‚</p><h1 id="ä¸€ã€é›†ç¾¤ç¯å¢ƒå‡†å¤‡"><a href="#ä¸€ã€é›†ç¾¤ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ä¸€ã€é›†ç¾¤ç¯å¢ƒå‡†å¤‡"></a>ä¸€ã€é›†ç¾¤ç¯å¢ƒå‡†å¤‡</h1><h2 id="1-1-ä¸»æœºè§„åˆ’"><a href="#1-1-ä¸»æœºè§„åˆ’" class="headerlink" title="1.1 ä¸»æœºè§„åˆ’"></a>1.1 ä¸»æœºè§„åˆ’</h2><table><thead><tr><th>ä¸»æœºIPåœ°å€</th><th>ä¸»æœºå</th><th>ä¸»æœºé…ç½®</th><th>ä¸»æœºè§’è‰²</th><th>è½¯ä»¶åˆ—è¡¨</th></tr></thead><tbody><tr><td>192.168.10.12</td><td>k8s-master1</td><td>2C4G</td><td>master</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€kubeletã€kube-proxyã€Containerdã€runc</td></tr><tr><td>192.168.10.13</td><td>k8s-master2</td><td>2C4G</td><td>master</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€kubeletã€kube-proxyã€Containerdã€runc</td></tr><tr><td>192.168.10.14</td><td>k8s-master3</td><td>2C4G</td><td>master</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€kubeletã€kube-proxyã€Containerdã€runc</td></tr><tr><td>192.168.10.15</td><td>k8s-worker1</td><td>2C4G</td><td>worker</td><td>kubeletã€kube-proxyã€Containerdã€runc</td></tr><tr><td>192.168.10.10</td><td>ha1</td><td>1C2G</td><td>LB</td><td>haproxyã€keepalived</td></tr><tr><td>192.168.10.11</td><td>ha2</td><td>1C2G</td><td>LB</td><td>haproxyã€keepalived</td></tr><tr><td>192.168.10.100</td><td>&#x2F;</td><td>&#x2F;</td><td>VIP(è™šæ‹ŸIP)</td><td></td></tr></tbody></table><h2 id="1-2-è½¯ä»¶ç‰ˆæœ¬"><a href="#1-2-è½¯ä»¶ç‰ˆæœ¬" class="headerlink" title="1.2 è½¯ä»¶ç‰ˆæœ¬"></a>1.2 è½¯ä»¶ç‰ˆæœ¬</h2><table><thead><tr><th>è½¯ä»¶åç§°</th><th>ç‰ˆæœ¬</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>CentOS7</td><td>kernelç‰ˆæœ¬ï¼š5.17</td><td></td></tr><tr><td>kubernetes</td><td>v1.21.10</td><td></td></tr><tr><td>etcd</td><td>v3.5.2</td><td>æœ€æ–°ç‰ˆæœ¬</td></tr><tr><td>calico</td><td>v3.19.4</td><td></td></tr><tr><td>coredns</td><td>v1.8.4</td><td></td></tr><tr><td>containerd</td><td>1.6.1</td><td></td></tr><tr><td>runc</td><td>1.1.0</td><td></td></tr><tr><td>haproxy</td><td>5.18</td><td>YUMæºé»˜è®¤</td></tr><tr><td>keepalived</td><td>3.5</td><td>YUMæºé»˜è®¤</td></tr></tbody></table><h2 id="1-3-ç½‘ç»œåˆ†é…"><a href="#1-3-ç½‘ç»œåˆ†é…" class="headerlink" title="1.3 ç½‘ç»œåˆ†é…"></a>1.3 ç½‘ç»œåˆ†é…</h2><table><thead><tr><th>ç½‘ç»œåç§°</th><th>ç½‘æ®µ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>Nodeç½‘ç»œ</td><td>192.168.10.0&#x2F;24</td><td></td></tr><tr><td>Serviceç½‘ç»œ</td><td>10.96.0.0&#x2F;16</td><td></td></tr><tr><td>Podç½‘ç»œ</td><td>10.244.0.0&#x2F;16</td><td></td></tr></tbody></table><h1 id="äºŒã€é›†ç¾¤éƒ¨ç½²"><a href="#äºŒã€é›†ç¾¤éƒ¨ç½²" class="headerlink" title="äºŒã€é›†ç¾¤éƒ¨ç½²"></a>äºŒã€é›†ç¾¤éƒ¨ç½²</h1><h2 id="2-1ä¸»æœºå‡†å¤‡"><a href="#2-1ä¸»æœºå‡†å¤‡" class="headerlink" title="2.1ä¸»æœºå‡†å¤‡"></a>2.1ä¸»æœºå‡†å¤‡</h2><h3 id="2-1-1-ä¸»æœºåè®¾ç½®"><a href="#2-1-1-ä¸»æœºåè®¾ç½®" class="headerlink" title="2.1.1 ä¸»æœºåè®¾ç½®"></a>2.1.1 ä¸»æœºåè®¾ç½®</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">hostnamectl <span class="hljs-built_in">set-hostname</span> xxx<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">å…³äºä¸»æœºåå‚è§<span class="hljs-number">1.1</span>å°èŠ‚ä¸»æœºè§„åˆ’è¡¨<br></code></pre></td></tr></table></figure><h3 id="2-1-2-ä¸»æœºä¸IPåœ°å€è§£æ"><a href="#2-1-2-ä¸»æœºä¸IPåœ°å€è§£æ" class="headerlink" title="2.1.2 ä¸»æœºä¸IPåœ°å€è§£æ"></a>2.1.2 ä¸»æœºä¸IPåœ°å€è§£æ</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; EOF<br><span class="hljs-number">192.168</span>.<span class="hljs-number">10.10</span> ha1<br><span class="hljs-number">192.168</span>.<span class="hljs-number">10.11</span> ha2<br><span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span> k8s<span class="hljs-literal">-master1</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span> k8s<span class="hljs-literal">-master2</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span> k8s<span class="hljs-literal">-master3</span><br><span class="hljs-number">192.168</span>.<span class="hljs-number">10.15</span> k8s<span class="hljs-literal">-worker1</span><br>EOF<br></code></pre></td></tr></table></figure><h3 id="2-1-3-ä¸»æœºå®‰å…¨è®¾ç½®"><a href="#2-1-3-ä¸»æœºå®‰å…¨è®¾ç½®" class="headerlink" title="2.1.3 ä¸»æœºå®‰å…¨è®¾ç½®"></a>2.1.3 ä¸»æœºå®‰å…¨è®¾ç½®</h3><h4 id="2-1-3-1-å…³é—­é˜²ç«å¢™"><a href="#2-1-3-1-å…³é—­é˜²ç«å¢™" class="headerlink" title="2.1.3.1 å…³é—­é˜²ç«å¢™"></a>2.1.3.1 å…³é—­é˜²ç«å¢™</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl stop firewalld<br>systmctl disable firewalld<br>firewall<span class="hljs-literal">-cmd</span> <span class="hljs-literal">--state</span><br></code></pre></td></tr></table></figure><h4 id="2-1-3-2-å…³é—­selinux"><a href="#2-1-3-2-å…³é—­selinux" class="headerlink" title="2.1.3.2 å…³é—­selinux"></a>2.1.3.2 å…³é—­selinux</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">setenforce <span class="hljs-number">0</span><br>sed <span class="hljs-literal">-ri</span> <span class="hljs-string">&#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br>sestatus<br></code></pre></td></tr></table></figure><h3 id="2-1-4-äº¤æ¢åˆ†åŒºè®¾ç½®"><a href="#2-1-4-äº¤æ¢åˆ†åŒºè®¾ç½®" class="headerlink" title="2.1.4 äº¤æ¢åˆ†åŒºè®¾ç½®"></a>2.1.4 äº¤æ¢åˆ†åŒºè®¾ç½®</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">swapoff <span class="hljs-literal">-a</span><br>sed <span class="hljs-literal">-ri</span> <span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;vm.swappiness=0&quot;</span> &gt;&gt; /etc/sysctl.conf<br>sysctl <span class="hljs-literal">-p</span><br></code></pre></td></tr></table></figure><h3 id="2-1-5-ä¸»æœºç³»ç»Ÿæ—¶é—´åŒæ­¥"><a href="#2-1-5-ä¸»æœºç³»ç»Ÿæ—¶é—´åŒæ­¥" class="headerlink" title="2.1.5 ä¸»æœºç³»ç»Ÿæ—¶é—´åŒæ­¥"></a>2.1.5 ä¸»æœºç³»ç»Ÿæ—¶é—´åŒæ­¥</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">å®‰è£…è½¯ä»¶<br>yum <span class="hljs-literal">-y</span> install ntpdate<br><br>åˆ¶å®šæ—¶é—´åŒæ­¥è®¡åˆ’ä»»åŠ¡<br>crontab <span class="hljs-literal">-e</span><br><span class="hljs-number">0</span> */<span class="hljs-number">1</span> * * * ntpdate time1.aliyun.com<br></code></pre></td></tr></table></figure><h3 id="2-1-6-ä¸»æœºç³»ç»Ÿä¼˜åŒ–"><a href="#2-1-6-ä¸»æœºç³»ç»Ÿä¼˜åŒ–" class="headerlink" title="2.1.6 ä¸»æœºç³»ç»Ÿä¼˜åŒ–"></a>2.1.6 ä¸»æœºç³»ç»Ÿä¼˜åŒ–</h3><blockquote><p>limitä¼˜åŒ–</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ulimit <span class="hljs-literal">-SHn</span> <span class="hljs-number">65535</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &lt;&lt;EOF &gt;&gt; /etc/security/limits.conf<br>* soft nofile <span class="hljs-number">655360</span><br>* hard nofile <span class="hljs-number">131072</span><br>* soft nproc <span class="hljs-number">655350</span><br>* hard nproc <span class="hljs-number">655350</span><br>* soft memlock unlimited<br>* hard memlock unlimited<br>EOF<br></code></pre></td></tr></table></figure><h3 id="2-1-7-ipvsç®¡ç†å·¥å…·å®‰è£…åŠæ¨¡å—åŠ è½½"><a href="#2-1-7-ipvsç®¡ç†å·¥å…·å®‰è£…åŠæ¨¡å—åŠ è½½" class="headerlink" title="2.1.7 ipvsç®¡ç†å·¥å…·å®‰è£…åŠæ¨¡å—åŠ è½½"></a>2.1.7 ipvsç®¡ç†å·¥å…·å®‰è£…åŠæ¨¡å—åŠ è½½</h3><blockquote><p>ä¸ºé›†ç¾¤èŠ‚ç‚¹å®‰è£…ï¼Œè´Ÿè½½å‡è¡¡èŠ‚ç‚¹ä¸ç”¨å®‰è£…</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">yum <span class="hljs-literal">-y</span> install ipvsadm ipset sysstat conntrack libseccomp<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æ‰€æœ‰èŠ‚ç‚¹é…ç½®ipvsæ¨¡å—ï¼Œåœ¨å†…æ ¸<span class="hljs-number">4.19</span>+ç‰ˆæœ¬nf_conntrack_ipv4å·²ç»æ”¹ä¸ºnf_conntrackï¼Œ <span class="hljs-number">4.18</span>ä»¥ä¸‹ä½¿ç”¨nf_conntrack_ipv4å³å¯ï¼š <br> <br>modprobe <span class="hljs-literal">--</span> ip_vs <br>modprobe <span class="hljs-literal">--</span> ip_vs_rr <br>modprobe <span class="hljs-literal">--</span> ip_vs_wrr <br>modprobe <span class="hljs-literal">--</span> ip_vs_sh <br>modprobe <span class="hljs-literal">--</span> nf_conntrack <br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs powershell">åˆ›å»º /etc/modules<span class="hljs-literal">-load</span>.d/ipvs.conf å¹¶åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š <br><span class="hljs-built_in">cat</span> &gt;/etc/modules<span class="hljs-literal">-load</span>.d/ipvs.conf &lt;&lt;EOF <br>ip_vs <br>ip_vs_lc <br>ip_vs_wlc <br>ip_vs_rr <br>ip_vs_wrr <br>ip_vs_lblc <br>ip_vs_lblcr <br>ip_vs_dh <br>ip_vs_sh <br>ip_vs_fo <br>ip_vs_nq <br>ip_vs_sed <br>ip_vs_ftp <br>ip_vs_sh <br>nf_conntrack <br>ip_tables <br>ip_set <br>xt_set <br>ipt_set <br>ipt_rpfilter <br>ipt_REJECT <br>ipip <br>EOF<br></code></pre></td></tr></table></figure><h3 id="2-1-8-åŠ è½½containerdç›¸å…³å†…æ ¸æ¨¡å—"><a href="#2-1-8-åŠ è½½containerdç›¸å…³å†…æ ¸æ¨¡å—" class="headerlink" title="2.1.8 åŠ è½½containerdç›¸å…³å†…æ ¸æ¨¡å—"></a>2.1.8 åŠ è½½containerdç›¸å…³å†…æ ¸æ¨¡å—</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ä¸´æ—¶åŠ è½½æ¨¡å—<br><br>modprobe overlay<br>modprobe br_netfilter<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æ°¸ä¹…æ€§åŠ è½½æ¨¡å—<br><br><span class="hljs-built_in">cat</span> &gt; /etc/modules<span class="hljs-literal">-load</span>.d/containerd.conf &lt;&lt; EOF<br>overlay<br>br_netfilter<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨<br>systemctl enable <span class="hljs-literal">--now</span> systemd<span class="hljs-literal">-modules-load</span>.service<br></code></pre></td></tr></table></figure><h3 id="2-1-9-Linuxå†…æ ¸å‡çº§"><a href="#2-1-9-Linuxå†…æ ¸å‡çº§" class="headerlink" title="2.1.9 Linuxå†…æ ¸å‡çº§"></a>2.1.9 Linuxå†…æ ¸å‡çº§</h3><blockquote><p>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸­å®‰è£…,éœ€è¦é‡æ–°æ“ä½œç³»ç»Ÿæ›´æ¢å†…æ ¸ã€‚</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># yum -y install perl</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># yum -y install https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm</span><br><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># yum  --enablerepo=&quot;elrepo-kernel&quot;  -y install kernel-ml.x86_64</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># grub2-set-default 0</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">localhost</span> ~]<span class="hljs-comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></code></pre></td></tr></table></figure><h3 id="2-1-10-Linuxå†…æ ¸ä¼˜åŒ–"><a href="#2-1-10-Linuxå†…æ ¸ä¼˜åŒ–" class="headerlink" title="2.1.10 Linuxå†…æ ¸ä¼˜åŒ–"></a>2.1.10 Linuxå†…æ ¸ä¼˜åŒ–</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf<br>net.ipv4.ip_forward = <span class="hljs-number">1</span><br>net.bridge.bridge<span class="hljs-literal">-nf-call-iptables</span> = <span class="hljs-number">1</span><br>net.bridge.bridge<span class="hljs-literal">-nf-call-ip6tables</span> = <span class="hljs-number">1</span><br>fs.may_detach_mounts = <span class="hljs-number">1</span><br>vm.overcommit_memory=<span class="hljs-number">1</span><br>vm.panic_on_oom=<span class="hljs-number">0</span><br>fs.inotify.max_user_watches=<span class="hljs-number">89100</span><br>fs.file<span class="hljs-literal">-max</span>=<span class="hljs-number">52706963</span><br>fs.nr_open=<span class="hljs-number">52706963</span><br>net.netfilter.nf_conntrack_max=<span class="hljs-number">2310720</span><br><br>net.ipv4.tcp_keepalive_time = <span class="hljs-number">600</span><br>net.ipv4.tcp_keepalive_probes = <span class="hljs-number">3</span><br>net.ipv4.tcp_keepalive_intvl =<span class="hljs-number">15</span><br>net.ipv4.tcp_max_tw_buckets = <span class="hljs-number">36000</span><br>net.ipv4.tcp_tw_reuse = <span class="hljs-number">1</span><br>net.ipv4.tcp_max_orphans = <span class="hljs-number">327680</span><br>net.ipv4.tcp_orphan_retries = <span class="hljs-number">3</span><br>net.ipv4.tcp_syncookies = <span class="hljs-number">1</span><br>net.ipv4.tcp_max_syn_backlog = <span class="hljs-number">16384</span><br>net.ipv4.ip_conntrack_max = <span class="hljs-number">131072</span><br>net.ipv4.tcp_max_syn_backlog = <span class="hljs-number">16384</span><br>net.ipv4.tcp_timestamps = <span class="hljs-number">0</span><br>net.core.somaxconn = <span class="hljs-number">16384</span><br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sysctl <span class="hljs-literal">--system</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æ‰€æœ‰èŠ‚ç‚¹é…ç½®å®Œå†…æ ¸åï¼Œé‡å¯æœåŠ¡å™¨ï¼Œä¿è¯é‡å¯åå†…æ ¸ä¾æ—§åŠ è½½<br>reboot <span class="hljs-literal">-h</span> now<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">é‡å¯åæŸ¥çœ‹ipvsæ¨¡å—åŠ è½½æƒ…å†µï¼š<br>lsmod | grep <span class="hljs-literal">--color</span>=auto <span class="hljs-literal">-e</span> ip_vs <span class="hljs-literal">-e</span> nf_conntrack<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">é‡å¯åæŸ¥çœ‹containerdç›¸å…³æ¨¡å—åŠ è½½æƒ…å†µï¼š<br>lsmod | egrep <span class="hljs-string">&#x27;br_netfilter | overlay&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="2-1-11-å…¶å®ƒå·¥å…·å®‰è£…-é€‰è£…"><a href="#2-1-11-å…¶å®ƒå·¥å…·å®‰è£…-é€‰è£…" class="headerlink" title="2.1.11 å…¶å®ƒå·¥å…·å®‰è£…(é€‰è£…)"></a>2.1.11 å…¶å®ƒå·¥å…·å®‰è£…(é€‰è£…)</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">yum install <span class="hljs-built_in">wget</span> jq psmisc vim net<span class="hljs-literal">-tools</span> telnet yum<span class="hljs-literal">-utils</span> device<span class="hljs-literal">-mapper-persistent-data</span> lvm2 git lrzsz <span class="hljs-literal">-y</span><br></code></pre></td></tr></table></figure><h2 id="2-2-è´Ÿè½½å‡è¡¡å™¨å‡†å¤‡"><a href="#2-2-è´Ÿè½½å‡è¡¡å™¨å‡†å¤‡" class="headerlink" title="2.2 è´Ÿè½½å‡è¡¡å™¨å‡†å¤‡"></a>2.2 è´Ÿè½½å‡è¡¡å™¨å‡†å¤‡</h2><h3 id="2-2-1-å®‰è£…haproxyä¸keepalived"><a href="#2-2-1-å®‰è£…haproxyä¸keepalived" class="headerlink" title="2.2.1 å®‰è£…haproxyä¸keepalived"></a>2.2.1 å®‰è£…haproxyä¸keepalived</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">yum <span class="hljs-literal">-y</span> install haproxy keepalived<br></code></pre></td></tr></table></figure><h3 id="2-2-2-HAProxyé…ç½®"><a href="#2-2-2-HAProxyé…ç½®" class="headerlink" title="2.2.2 HAProxyé…ç½®"></a>2.2.2 HAProxyé…ç½®</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt;/etc/haproxy/haproxy.cfg&lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br>global<br> maxconn <span class="hljs-number">2000</span><br> u<span class="hljs-built_in">limit-n</span> <span class="hljs-number">16384</span><br> log <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> local0 err<br> stats timeout <span class="hljs-number">30</span>s<br><br>defaults<br> log global<br> mode http<br> option httplog<br> timeout connect <span class="hljs-number">5000</span><br> timeout client <span class="hljs-number">50000</span><br> timeout server <span class="hljs-number">50000</span><br> timeout http<span class="hljs-literal">-request</span> <span class="hljs-number">15</span>s<br> timeout http<span class="hljs-literal">-keep-alive</span> <span class="hljs-number">15</span>s<br><br>frontend monitor<span class="hljs-operator">-in</span><br> bind *:<span class="hljs-number">33305</span><br> mode http<br> option httplog<br> monitor<span class="hljs-literal">-uri</span> /monitor<br><br>frontend k8s<span class="hljs-literal">-master</span><br> bind <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">6443</span><br> bind <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">6443</span><br> mode tcp<br> option tcplog<br> tcp<span class="hljs-literal">-request</span> inspect<span class="hljs-literal">-delay</span> <span class="hljs-number">5</span>s<br> default_backend k8s<span class="hljs-literal">-master</span><br><br>backend k8s<span class="hljs-literal">-master</span><br> mode tcp<br> option tcplog<br> option tcp<span class="hljs-literal">-check</span><br> balance roundrobin<br> default<span class="hljs-literal">-server</span> inter <span class="hljs-number">10</span>s downinter <span class="hljs-number">5</span>s rise <span class="hljs-number">2</span> fall <span class="hljs-number">2</span> slowstart <span class="hljs-number">60</span>s maxconn <span class="hljs-number">250</span> maxqueue <span class="hljs-number">256</span> weight <span class="hljs-number">100</span><br> server  k8s<span class="hljs-literal">-master1</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">6443</span> check<br> server  k8s<span class="hljs-literal">-master2</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">6443</span> check<br> server  k8s<span class="hljs-literal">-master3</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">6443</span> check<br>EOF<br></code></pre></td></tr></table></figure><h3 id="2-2-3-KeepAlived"><a href="#2-2-3-KeepAlived" class="headerlink" title="2.2.3 KeepAlived"></a>2.2.3 KeepAlived</h3><blockquote><p>ä¸»ä»é…ç½®ä¸ä¸€è‡´ï¼Œéœ€è¦æ³¨æ„ã€‚</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ha1:<br><br><span class="hljs-built_in">cat</span> &gt;/etc/keepalived/keepalived.conf&lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br>! Configuration File <span class="hljs-keyword">for</span> keepalived<br>global_defs &#123;<br>   router_id LVS_DEVEL<br>script_user root<br>   enable_script_security<br>&#125;<br>vrrp_script chk_apiserver &#123;<br>   script <span class="hljs-string">&quot;/etc/keepalived/check_apiserver.sh&quot;</span><br>   interval <span class="hljs-number">5</span><br>   weight <span class="hljs-literal">-5</span><br>   fall <span class="hljs-number">2</span> <br>rise <span class="hljs-number">1</span><br>&#125;<br>vrrp_instance VI_1 &#123;<br>   state MASTER<br>   interface ens33<br>   mcast_src_ip <span class="hljs-number">192.168</span>.<span class="hljs-number">10.10</span><br>   virtual_router_id <span class="hljs-number">51</span><br>   priority <span class="hljs-number">100</span><br>   advert_int <span class="hljs-number">2</span><br>   authentication &#123;<br>       auth_type PASS<br>       auth_pass K8SHA_KA_AUTH<br>   &#125;<br>   virtual_ipaddress &#123;<br>       <span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span><br>   &#125;<br>   track_script &#123;<br>      chk_apiserver<br>   &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ha2:<br><br><span class="hljs-built_in">cat</span> &gt;/etc/keepalived/keepalived.conf&lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br>! Configuration File <span class="hljs-keyword">for</span> keepalived<br>global_defs &#123;<br>   router_id LVS_DEVEL<br>script_user root<br>   enable_script_security<br>&#125;<br>vrrp_script chk_apiserver &#123;<br>   script <span class="hljs-string">&quot;/etc/keepalived/check_apiserver.sh&quot;</span><br>  interval <span class="hljs-number">5</span><br>   weight <span class="hljs-literal">-5</span><br>   fall <span class="hljs-number">2</span> <br>rise <span class="hljs-number">1</span><br>&#125;<br>vrrp_instance VI_1 &#123;<br>   state BACKUP<br>   interface ens33<br>   mcast_src_ip <span class="hljs-number">192.168</span>.<span class="hljs-number">10.11</span><br>   virtual_router_id <span class="hljs-number">51</span><br>   priority <span class="hljs-number">99</span><br>   advert_int <span class="hljs-number">2</span><br>   authentication &#123;<br>       auth_type PASS<br>       auth_pass K8SHA_KA_AUTH<br>   &#125;<br>   virtual_ipaddress &#123;<br>       <span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span><br>   &#125;<br>   track_script &#123;<br>      chk_apiserver<br>   &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h3 id="2-2-4-å¥åº·æ£€æŸ¥è„šæœ¬"><a href="#2-2-4-å¥åº·æ£€æŸ¥è„šæœ¬" class="headerlink" title="2.2.4 å¥åº·æ£€æŸ¥è„šæœ¬"></a>2.2.4 å¥åº·æ£€æŸ¥è„šæœ¬</h3><blockquote><p>ha1åŠha2å‡è¦é…ç½®</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; /etc/keepalived/check_apiserver.sh &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-comment">#!/bin/bash</span><br>err=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-variable">$</span>(seq <span class="hljs-number">1</span> <span class="hljs-number">3</span>)<br><span class="hljs-keyword">do</span><br>   check_code=<span class="hljs-variable">$</span>(pgrep haproxy)<br>   <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$check_code</span> == <span class="hljs-string">&quot;&quot;</span> ]]; then<br>       err=<span class="hljs-variable">$</span>(expr <span class="hljs-variable">$err</span> + <span class="hljs-number">1</span>)<br>       <span class="hljs-built_in">sleep</span> <span class="hljs-number">1</span><br>       <span class="hljs-keyword">continue</span><br>   <span class="hljs-keyword">else</span><br>       err=<span class="hljs-number">0</span><br>       <span class="hljs-keyword">break</span><br>   fi<br>done<br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$err</span> != <span class="hljs-string">&quot;0&quot;</span> ]]; then<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;systemctl stop keepalived&quot;</span><br>   /usr/bin/systemctl stop keepalived<br>   <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">else</span><br>   <span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br>fi<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">chmod +x /etc/keepalived/check_apiserver.sh<br></code></pre></td></tr></table></figure><h3 id="2-2-5-å¯åŠ¨æœåŠ¡å¹¶éªŒè¯"><a href="#2-2-5-å¯åŠ¨æœåŠ¡å¹¶éªŒè¯" class="headerlink" title="2.2.5 å¯åŠ¨æœåŠ¡å¹¶éªŒè¯"></a>2.2.5 å¯åŠ¨æœåŠ¡å¹¶éªŒè¯</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl daemon<span class="hljs-literal">-reload</span><br>systemctl enable <span class="hljs-literal">--now</span> haproxy<br>systemctl enable <span class="hljs-literal">--now</span> keepalived<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ip address show<br></code></pre></td></tr></table></figure><h2 id="2-3-é…ç½®å…å¯†ç™»å½•"><a href="#2-3-é…ç½®å…å¯†ç™»å½•" class="headerlink" title="2.3 é…ç½®å…å¯†ç™»å½•"></a>2.3 é…ç½®å…å¯†ç™»å½•</h2><blockquote><p>åœ¨k8s-master1ä¸Šæ“ä½œ</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ssh<span class="hljs-literal">-keygen</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ssh<span class="hljs-literal">-copy-id</span> root@k8s<span class="hljs-literal">-master1</span><br>ssh<span class="hljs-literal">-copy-id</span> root@k8s<span class="hljs-literal">-master2</span><br>ssh<span class="hljs-literal">-copy-id</span> root@k8s<span class="hljs-literal">-master3</span><br>ssh<span class="hljs-literal">-copy-id</span> root@k8s<span class="hljs-literal">-worker1</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ssh root@k8s<span class="hljs-literal">-master1</span><br></code></pre></td></tr></table></figure><h2 id="2-4-éƒ¨ç½²ETCDé›†ç¾¤"><a href="#2-4-éƒ¨ç½²ETCDé›†ç¾¤" class="headerlink" title="2.4 éƒ¨ç½²ETCDé›†ç¾¤"></a>2.4 éƒ¨ç½²ETCDé›†ç¾¤</h2><blockquote><p>åœ¨k8s-master1ä¸Šæ“ä½œã€‚</p></blockquote><h3 id="2-4-1-åˆ›å»ºå·¥ä½œç›®å½•"><a href="#2-4-1-åˆ›å»ºå·¥ä½œç›®å½•" class="headerlink" title="2.4.1 åˆ›å»ºå·¥ä½œç›®å½•"></a>2.4.1 åˆ›å»ºå·¥ä½œç›®å½•</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir <span class="hljs-literal">-p</span> /<span class="hljs-keyword">data</span>/k8s<span class="hljs-literal">-work</span><br></code></pre></td></tr></table></figure><h3 id="2-4-2-è·å–cfsslå·¥å…·"><a href="#2-4-2-è·å–cfsslå·¥å…·" class="headerlink" title="2.4.2 è·å–cfsslå·¥å…·"></a>2.4.2 è·å–cfsslå·¥å…·</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cd</span> /<span class="hljs-keyword">data</span>/k8s<span class="hljs-literal">-work</span><br><span class="hljs-built_in">wget</span> https://pkg.cfssl.org/R1.<span class="hljs-number">2</span>/cfssl_linux<span class="hljs-literal">-amd64</span><br><span class="hljs-built_in">wget</span> https://pkg.cfssl.org/R1.<span class="hljs-number">2</span>/cfssljson_linux<span class="hljs-literal">-amd64</span><br><span class="hljs-built_in">wget</span> https://pkg.cfssl.org/R1.<span class="hljs-number">2</span>/cfssl<span class="hljs-literal">-certinfo_linux-amd64</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br>cfsslæ˜¯ä½¿ç”¨goç¼–å†™ï¼Œç”±CloudFlareå¼€æºçš„ä¸€æ¬¾PKI/TLSå·¥å…·ã€‚ä¸»è¦ç¨‹åºæœ‰ï¼š<br><br>- cfsslï¼Œæ˜¯CFSSLçš„å‘½ä»¤è¡Œå·¥å…·<br>- cfssljsonç”¨æ¥ä»cfsslç¨‹åºè·å–JSONè¾“å‡ºï¼Œå¹¶å°†è¯ä¹¦ï¼Œå¯†é’¥ï¼ŒCSRå’Œbundleå†™å…¥æ–‡ä»¶ä¸­ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">chmod +x cfssl*<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">mv</span> cfssl_linux<span class="hljs-literal">-amd64</span> /usr/local/bin/cfssl<br><span class="hljs-built_in">mv</span> cfssljson_linux<span class="hljs-literal">-amd64</span> /usr/local/bin/cfssljson<br><span class="hljs-built_in">mv</span> cfssl<span class="hljs-literal">-certinfo_linux-amd64</span> /usr/local/bin/cfssl<span class="hljs-literal">-certinfo</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># cfssl version</span><br>Version: <span class="hljs-number">1.2</span>.<span class="hljs-number">0</span><br>Revision: dev<br>Runtime: go1.<span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h3 id="2-4-3-åˆ›å»ºCAè¯ä¹¦"><a href="#2-4-3-åˆ›å»ºCAè¯ä¹¦" class="headerlink" title="2.4.3 åˆ›å»ºCAè¯ä¹¦"></a>2.4.3 åˆ›å»ºCAè¯ä¹¦</h3><h4 id="2-4-3-1-é…ç½®caè¯ä¹¦è¯·æ±‚æ–‡ä»¶"><a href="#2-4-3-1-é…ç½®caè¯ä¹¦è¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.4.3.1 é…ç½®caè¯ä¹¦è¯·æ±‚æ–‡ä»¶"></a>2.4.3.1 é…ç½®caè¯ä¹¦è¯·æ±‚æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; ca<span class="hljs-literal">-csr</span>.json &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;kubernetes&quot;</span>,<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>      <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">2048</span><br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;kubemsb&quot;</span>,<br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span><br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;ca&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>  &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-4-3-2-åˆ›å»ºcaè¯ä¹¦"><a href="#2-4-3-2-åˆ›å»ºcaè¯ä¹¦" class="headerlink" title="2.4.3.2 åˆ›å»ºcaè¯ä¹¦"></a>2.4.3.2 åˆ›å»ºcaè¯ä¹¦</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl gencert <span class="hljs-literal">-initca</span> ca<span class="hljs-literal">-csr</span>.json | cfssljson <span class="hljs-literal">-bare</span> ca<br></code></pre></td></tr></table></figure><h4 id="2-4-3-3-é…ç½®caè¯ä¹¦ç­–ç•¥"><a href="#2-4-3-3-é…ç½®caè¯ä¹¦ç­–ç•¥" class="headerlink" title="2.4.3.3 é…ç½®caè¯ä¹¦ç­–ç•¥"></a>2.4.3.3 é…ç½®caè¯ä¹¦ç­–ç•¥</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl print<span class="hljs-literal">-defaults</span> config &gt; ca<span class="hljs-literal">-config</span>.json<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; ca<span class="hljs-literal">-config</span>.json &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>  <span class="hljs-string">&quot;signing&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;default&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>        &#125;,<br>      <span class="hljs-string">&quot;profiles&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;kubernetes&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;usages&quot;</span>: [<br>                  <span class="hljs-string">&quot;signing&quot;</span>,<br>                  <span class="hljs-string">&quot;key encipherment&quot;</span>,<br>                  <span class="hljs-string">&quot;server auth&quot;</span>,<br>                  <span class="hljs-string">&quot;client auth&quot;</span><br>              ],<br>              <span class="hljs-string">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>          &#125;<br>      &#125;<br>  &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">server auth è¡¨ç¤ºclientå¯ä»¥å¯¹ä½¿ç”¨è¯¥caå¯¹serveræä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯<br><br>client auth è¡¨ç¤ºserverå¯ä»¥ä½¿ç”¨è¯¥caå¯¹clientæä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯<br></code></pre></td></tr></table></figure><h3 id="2-4-4-åˆ›å»ºetcdè¯ä¹¦"><a href="#2-4-4-åˆ›å»ºetcdè¯ä¹¦" class="headerlink" title="2.4.4 åˆ›å»ºetcdè¯ä¹¦"></a>2.4.4 åˆ›å»ºetcdè¯ä¹¦</h3><h4 id="2-4-4-1-é…ç½®etcdè¯·æ±‚æ–‡ä»¶"><a href="#2-4-4-1-é…ç½®etcdè¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.4.4.1 é…ç½®etcdè¯·æ±‚æ–‡ä»¶"></a>2.4.4.1 é…ç½®etcdè¯·æ±‚æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; etcd<span class="hljs-literal">-csr</span>.json &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;etcd&quot;</span>,<br>  <span class="hljs-string">&quot;hosts&quot;</span>: [<br>    <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.12&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.13&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.14&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">2048</span><br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [&#123;<br>    <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>    <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>    <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>    <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;kubemsb&quot;</span>,<br>    <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span><br>  &#125;]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-4-4-2-ç”Ÿæˆetcdè¯ä¹¦"><a href="#2-4-4-2-ç”Ÿæˆetcdè¯ä¹¦" class="headerlink" title="2.4.4.2 ç”Ÿæˆetcdè¯ä¹¦"></a>2.4.4.2 ç”Ÿæˆetcdè¯ä¹¦</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl gencert <span class="hljs-literal">-ca</span>=ca.pem <span class="hljs-literal">-ca-key</span>=ca<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">-config</span>=ca<span class="hljs-literal">-config</span>.json <span class="hljs-literal">-profile</span>=kubernetes etcd<span class="hljs-literal">-csr</span>.json | cfssljson  <span class="hljs-literal">-bare</span> etcd<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># ls</span><br>è¾“å‡º<br>ca<span class="hljs-literal">-config</span>.json  ca.csr  ca<span class="hljs-literal">-csr</span>.json  ca<span class="hljs-literal">-key</span>.pem  ca.pem  etcd.csr  etcd<span class="hljs-literal">-csr</span>.json  etcd<span class="hljs-literal">-key</span>.pem  etcd.pem<br></code></pre></td></tr></table></figure><h3 id="2-4-5-éƒ¨ç½²etcdé›†ç¾¤"><a href="#2-4-5-éƒ¨ç½²etcdé›†ç¾¤" class="headerlink" title="2.4.5  éƒ¨ç½²etcdé›†ç¾¤"></a>2.4.5  éƒ¨ç½²etcdé›†ç¾¤</h3><h4 id="2-4-5-1-ä¸‹è½½etcdè½¯ä»¶åŒ…"><a href="#2-4-5-1-ä¸‹è½½etcdè½¯ä»¶åŒ…" class="headerlink" title="2.4.5.1 ä¸‹è½½etcdè½¯ä»¶åŒ…"></a>2.4.5.1 ä¸‹è½½etcdè½¯ä»¶åŒ…</h4><p>![image-20220319090935574](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220319090935574.png)</p><p>![image-20220319091008943](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220319091008943.png)</p><p>![image-20220319091037753](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220319091037753.png)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://github.com/etcd<span class="hljs-literal">-io</span>/etcd/releases/download/v3.<span class="hljs-number">5.2</span>/etcd<span class="hljs-literal">-v3</span>.<span class="hljs-number">5.2</span><span class="hljs-literal">-linux-amd64</span>.tar.gz<br></code></pre></td></tr></table></figure><h4 id="2-4-5-2-å®‰è£…etcdè½¯ä»¶"><a href="#2-4-5-2-å®‰è£…etcdè½¯ä»¶" class="headerlink" title="2.4.5.2 å®‰è£…etcdè½¯ä»¶"></a>2.4.5.2 å®‰è£…etcdè½¯ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tar <span class="hljs-literal">-xvf</span> etcd<span class="hljs-literal">-v3</span>.<span class="hljs-number">5.2</span><span class="hljs-literal">-linux-amd64</span>.tar.gz<br><span class="hljs-built_in">cp</span> <span class="hljs-literal">-p</span> etcd<span class="hljs-literal">-v3</span>.<span class="hljs-number">5.2</span><span class="hljs-literal">-linux-amd64</span>/etcd* /usr/local/bin/<br></code></pre></td></tr></table></figure><h4 id="2-4-5-3-åˆ†å‘etcdè½¯ä»¶"><a href="#2-4-5-3-åˆ†å‘etcdè½¯ä»¶" class="headerlink" title="2.4.5.3 åˆ†å‘etcdè½¯ä»¶"></a>2.4.5.3 åˆ†å‘etcdè½¯ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp etcd<span class="hljs-literal">-v3</span>.<span class="hljs-number">5.2</span><span class="hljs-literal">-linux-amd64</span>/etcd* k8s<span class="hljs-literal">-master2</span>:/usr/local/bin/<br><br>scp etcd<span class="hljs-literal">-v3</span>.<span class="hljs-number">5.2</span><span class="hljs-literal">-linux-amd64</span>/etcd* k8s<span class="hljs-literal">-master3</span>:/usr/local/bin/<br></code></pre></td></tr></table></figure><h4 id="2-4-5-4-åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#2-4-5-4-åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="2.4.5.4 åˆ›å»ºé…ç½®æ–‡ä»¶"></a>2.4.5.4 åˆ›å»ºé…ç½®æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir /etc/etcd<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt;  /etc/etcd/etcd.conf &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-comment">#[Member]</span><br>ETCD_NAME=<span class="hljs-string">&quot;etcd1&quot;</span><br>ETCD_DATA_DIR=<span class="hljs-string">&quot;/var/lib/etcd/default.etcd&quot;</span><br>ETCD_LISTEN_PEER_URLS=<span class="hljs-string">&quot;https://192.168.10.12:2380&quot;</span><br>ETCD_LISTEN_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.10.12:2379,http://127.0.0.1:2379&quot;</span><br><br><span class="hljs-comment">#[Clustering]</span><br>ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="hljs-string">&quot;https://192.168.10.12:2380&quot;</span><br>ETCD_ADVERTISE_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.10.12:2379&quot;</span><br>ETCD_INITIAL_CLUSTER=<span class="hljs-string">&quot;etcd1=https://192.168.10.12:2380,etcd2=https://192.168.10.13:2380,etcd3=https://192.168.10.14:2380&quot;</span><br>ETCD_INITIAL_CLUSTER_TOKEN=<span class="hljs-string">&quot;etcd-cluster&quot;</span><br>ETCD_INITIAL_CLUSTER_STATE=<span class="hljs-string">&quot;new&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br>ETCD_NAMEï¼šèŠ‚ç‚¹åç§°ï¼Œé›†ç¾¤ä¸­å”¯ä¸€<br>ETCD_DATA_DIRï¼šæ•°æ®ç›®å½•<br>ETCD_LISTEN_PEER_URLSï¼šé›†ç¾¤é€šä¿¡ç›‘å¬åœ°å€<br>ETCD_LISTEN_CLIENT_URLSï¼šå®¢æˆ·ç«¯è®¿é—®ç›‘å¬åœ°å€<br>ETCD_INITIAL_ADVERTISE_PEER_URLSï¼šé›†ç¾¤é€šå‘Šåœ°å€<br>ETCD_ADVERTISE_CLIENT_URLSï¼šå®¢æˆ·ç«¯é€šå‘Šåœ°å€<br>ETCD_INITIAL_CLUSTERï¼šé›†ç¾¤èŠ‚ç‚¹åœ°å€<br>ETCD_INITIAL_CLUSTER_TOKENï¼šé›†ç¾¤Token<br>ETCD_INITIAL_CLUSTER_STATEï¼šåŠ å…¥é›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼Œnewæ˜¯æ–°é›†ç¾¤ï¼Œexistingè¡¨ç¤ºåŠ å…¥å·²æœ‰é›†ç¾¤<br></code></pre></td></tr></table></figure><h4 id="2-4-5-5-åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶"><a href="#2-4-5-5-åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="2.4.5.5 åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶"></a>2.4.5.5 åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir <span class="hljs-literal">-p</span> /etc/etcd/ssl<br>mkdir <span class="hljs-literal">-p</span> /var/lib/etcd/default.etcd<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cd</span> /<span class="hljs-keyword">data</span>/k8s<span class="hljs-literal">-work</span><br><span class="hljs-built_in">cp</span> ca*.pem /etc/etcd/ssl<br><span class="hljs-built_in">cp</span> etcd*.pem /etc/etcd/ssl<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; /etc/systemd/system/etcd.service &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br>[<span class="hljs-type">Unit</span>]<br>Description=Etcd Server<br>After=network.target<br>After=network<span class="hljs-literal">-online</span>.target<br>Wants=network<span class="hljs-literal">-online</span>.target<br><br>[<span class="hljs-type">Service</span>]<br><span class="hljs-built_in">Type</span>=notify<br>EnvironmentFile=-/etc/etcd/etcd.conf<br>WorkingDirectory=/var/lib/etcd/<br>ExecStart=/usr/local/bin/etcd \<br>  <span class="hljs-literal">--cert-file</span>=/etc/etcd/ssl/etcd.pem \<br>  <span class="hljs-literal">--key-file</span>=/etc/etcd/ssl/etcd<span class="hljs-literal">-key</span>.pem \<br>  <span class="hljs-literal">--trusted-ca-file</span>=/etc/etcd/ssl/ca.pem \<br>  <span class="hljs-literal">--peer-cert-file</span>=/etc/etcd/ssl/etcd.pem \<br>  <span class="hljs-literal">--peer-key-file</span>=/etc/etcd/ssl/etcd<span class="hljs-literal">-key</span>.pem \<br>  <span class="hljs-literal">--peer-trusted-ca-file</span>=/etc/etcd/ssl/ca.pem \<br>  <span class="hljs-literal">--peer-client-cert-auth</span> \<br>  <span class="hljs-literal">--client-cert-auth</span><br>Restart=on<span class="hljs-literal">-failure</span><br>RestartSec=<span class="hljs-number">5</span><br>LimitNOFILE=<span class="hljs-number">65536</span><br><br>[<span class="hljs-type">Install</span>]<br>WantedBy=multi<span class="hljs-literal">-user</span>.target<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-4-5-6-åŒæ­¥etcdé…ç½®åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹"><a href="#2-4-5-6-åŒæ­¥etcdé…ç½®åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹" class="headerlink" title="2.4.5.6 åŒæ­¥etcdé…ç½®åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹"></a>2.4.5.6 åŒæ­¥etcdé…ç½®åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">åˆ›å»ºç›®å½•<br>mkdir <span class="hljs-literal">-p</span> /etc/etcd<br>mkdir <span class="hljs-literal">-p</span> /etc/etcd/ssl<br>mkdir <span class="hljs-literal">-p</span> /var/lib/etcd/default.etcd<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æœåŠ¡é…ç½®æ–‡ä»¶,éœ€è¦ä¿®æ”¹etcdèŠ‚ç‚¹åç§°åŠIPåœ°å€<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> \<br><span class="hljs-keyword">do</span> \<br>scp /etc/etcd/etcd.conf <span class="hljs-variable">$i:</span>/etc/etcd/ \<br>done<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">k8s<span class="hljs-literal">-master2</span>:<br><br><span class="hljs-built_in">cat</span> /etc/etcd/etcd.conf<br><span class="hljs-comment">#[Member]</span><br>ETCD_NAME=<span class="hljs-string">&quot;etcd2&quot;</span><br>ETCD_DATA_DIR=<span class="hljs-string">&quot;/var/lib/etcd/default.etcd&quot;</span><br>ETCD_LISTEN_PEER_URLS=<span class="hljs-string">&quot;https://192.168.10.13:2380&quot;</span><br>ETCD_LISTEN_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.10.13:2379,http://127.0.0.1:2379&quot;</span><br><br><span class="hljs-comment">#[Clustering]</span><br>ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="hljs-string">&quot;https://192.168.10.13:2380&quot;</span><br>ETCD_ADVERTISE_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.10.13:2379&quot;</span><br>ETCD_INITIAL_CLUSTER=<span class="hljs-string">&quot;etcd1=https://192.168.10.12:2380,etcd2=https://192.168.10.13:2380,etcd3=https://192.168.10.14:2380&quot;</span><br>ETCD_INITIAL_CLUSTER_TOKEN=<span class="hljs-string">&quot;etcd-cluster&quot;</span><br>ETCD_INITIAL_CLUSTER_STATE=<span class="hljs-string">&quot;new&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">k8s<span class="hljs-literal">-master3</span>:<br><br><span class="hljs-built_in">cat</span> /etc/etcd/etcd.conf<br><span class="hljs-comment">#[Member]</span><br>ETCD_NAME=<span class="hljs-string">&quot;etcd3&quot;</span><br>ETCD_DATA_DIR=<span class="hljs-string">&quot;/var/lib/etcd/default.etcd&quot;</span><br>ETCD_LISTEN_PEER_URLS=<span class="hljs-string">&quot;https://192.168.10.14:2380&quot;</span><br>ETCD_LISTEN_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.10.14:2379,http://127.0.0.1:2379&quot;</span><br><br><span class="hljs-comment">#[Clustering]</span><br>ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="hljs-string">&quot;https://192.168.10.14:2380&quot;</span><br>ETCD_ADVERTISE_CLIENT_URLS=<span class="hljs-string">&quot;https://192.168.10.14:2379&quot;</span><br>ETCD_INITIAL_CLUSTER=<span class="hljs-string">&quot;etcd1=https://192.168.10.12:2380,etcd2=https://192.168.10.13:2380,etcd3=https://192.168.10.14:2380&quot;</span><br>ETCD_INITIAL_CLUSTER_TOKEN=<span class="hljs-string">&quot;etcd-cluster&quot;</span><br>ETCD_INITIAL_CLUSTER_STATE=<span class="hljs-string">&quot;new&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯ä¹¦æ–‡ä»¶<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> \<br><span class="hljs-keyword">do</span> \<br>scp /etc/etcd/ssl/* <span class="hljs-variable">$i:</span>/etc/etcd/ssl \<br>done<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> \<br><span class="hljs-keyword">do</span> \<br>scp /etc/systemd/system/etcd.service <span class="hljs-variable">$i:</span>/etc/systemd/system/ \<br>done<br></code></pre></td></tr></table></figure><h4 id="2-4-5-7-å¯åŠ¨etcdé›†ç¾¤"><a href="#2-4-5-7-å¯åŠ¨etcdé›†ç¾¤" class="headerlink" title="2.4.5.7 å¯åŠ¨etcdé›†ç¾¤"></a>2.4.5.7 å¯åŠ¨etcdé›†ç¾¤</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl daemon<span class="hljs-literal">-reload</span><br>systemctl enable <span class="hljs-literal">--now</span> etcd.service<br>systemctl status etcd<br></code></pre></td></tr></table></figure><h4 id="2-4-5-8-éªŒè¯é›†ç¾¤çŠ¶æ€"><a href="#2-4-5-8-éªŒè¯é›†ç¾¤çŠ¶æ€" class="headerlink" title="2.4.5.8 éªŒè¯é›†ç¾¤çŠ¶æ€"></a>2.4.5.8 éªŒè¯é›†ç¾¤çŠ¶æ€</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ETCDCTL_API=<span class="hljs-number">3</span> /usr/local/bin/etcdctl <span class="hljs-literal">--write-out</span>=table <span class="hljs-literal">--cacert</span>=/etc/etcd/ssl/ca.pem <span class="hljs-literal">--cert</span>=/etc/etcd/ssl/etcd.pem <span class="hljs-literal">--key</span>=/etc/etcd/ssl/etcd<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">--endpoints</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2379</span> endpoint health<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">--------</span>+<span class="hljs-literal">-------------</span>+<span class="hljs-literal">-------</span>+<br>|          ENDPOINT          | HEALTH |    TOOK     | ERROR |<br>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">--------</span>+<span class="hljs-literal">-------------</span>+<span class="hljs-literal">-------</span>+<br>| https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2379</span> |   true | <span class="hljs-number">10.393062</span>ms |       |<br>| https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2379</span> |   true |  <span class="hljs-number">15.70437</span>ms |       |<br>| https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2379</span> |   true | <span class="hljs-number">15.871684</span>ms |       |<br>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">--------</span>+<span class="hljs-literal">-------------</span>+<span class="hljs-literal">-------</span>+<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æ£€æŸ¥ETCDæ•°æ®åº“æ€§èƒ½<br>ETCDCTL_API=<span class="hljs-number">3</span> /usr/local/bin/etcdctl <span class="hljs-literal">--write-out</span>=table <span class="hljs-literal">--cacert</span>=/etc/etcd/ssl/ca.pem <span class="hljs-literal">--cert</span>=/etc/etcd/ssl/etcd.pem <span class="hljs-literal">--key</span>=/etc/etcd/ssl/etcd<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">--endpoints</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2379</span> check perf<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-number">59</span> / <span class="hljs-number">60</span> Boooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooom  !  <span class="hljs-number">98.33</span>%<br>PASS: Throughput is <span class="hljs-number">151</span> writes/s<br>PASS: Slowest request took <span class="hljs-number">0.066478</span>s<br>PASS: Stddev is <span class="hljs-number">0.002354</span>s<br>PASS<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ETCDCTL_API=<span class="hljs-number">3</span> /usr/local/bin/etcdctl <span class="hljs-literal">--write-out</span>=table <span class="hljs-literal">--cacert</span>=/etc/etcd/ssl/ca.pem <span class="hljs-literal">--cert</span>=/etc/etcd/ssl/etcd.pem <span class="hljs-literal">--key</span>=/etc/etcd/ssl/etcd<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">--endpoints</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2379</span> member list<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">+<span class="hljs-literal">------------------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">-------</span>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">------------</span>+<br>|        ID        | STATUS  | NAME  |         PEER ADDRS         |        CLIENT ADDRS        | IS LEARNER |<br>+<span class="hljs-literal">------------------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">-------</span>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">------------</span>+<br>| <span class="hljs-number">9</span>b449b0ff1d4c375 | started | etcd1 | https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2380</span> | https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2379</span> |      false |<br>| d1fbb74bc6a61e5c | started | etcd2 | https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2380</span> | https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2379</span> |      false |<br>| f60b205fb02fe23c | started | etcd3 | https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2380</span> | https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2379</span> |      false |<br>+<span class="hljs-literal">------------------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">-------</span>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">------------</span>+<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ETCDCTL_API=<span class="hljs-number">3</span> /usr/local/bin/etcdctl <span class="hljs-literal">--write-out</span>=table <span class="hljs-literal">--cacert</span>=/etc/etcd/ssl/ca.pem <span class="hljs-literal">--cert</span>=/etc/etcd/ssl/etcd.pem <span class="hljs-literal">--key</span>=/etc/etcd/ssl/etcd<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">--endpoints</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2379</span>,https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2379</span> endpoint status<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">------------------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">-----------</span>+<span class="hljs-literal">------------</span>+<span class="hljs-literal">-----------</span>+<span class="hljs-literal">------------</span>+<span class="hljs-literal">--------------------</span>+<span class="hljs-literal">--------</span>+<br>|          ENDPOINT          |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">------------------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">-----------</span>+<span class="hljs-literal">------------</span>+<span class="hljs-literal">-----------</span>+<span class="hljs-literal">------------</span>+<span class="hljs-literal">--------------------</span>+<span class="hljs-literal">--------</span>+<br>| https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">2379</span> | <span class="hljs-number">9</span>b449b0ff1d4c375 |   <span class="hljs-number">3.5</span>.<span class="hljs-number">2</span> |   <span class="hljs-number">24</span> MB |      true |      false |         <span class="hljs-number">2</span> |     <span class="hljs-number">403774</span> |             <span class="hljs-number">403774</span> |        |<br>| https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">2379</span> | d1fbb74bc6a61e5c |   <span class="hljs-number">3.5</span>.<span class="hljs-number">2</span> |   <span class="hljs-number">24</span> MB |     false |      false |         <span class="hljs-number">2</span> |     <span class="hljs-number">403774</span> |             <span class="hljs-number">403774</span> |        |<br>| https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">2379</span> | f60b205fb02fe23c |   <span class="hljs-number">3.5</span>.<span class="hljs-number">2</span> |   <span class="hljs-number">24</span> MB |     false |      false |         <span class="hljs-number">2</span> |     <span class="hljs-number">403774</span> |             <span class="hljs-number">403774</span> |        |<br>+<span class="hljs-literal">----------------------------</span>+<span class="hljs-literal">------------------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">---------</span>+<span class="hljs-literal">-----------</span>+<span class="hljs-literal">------------</span>+<span class="hljs-literal">-----------</span>+<span class="hljs-literal">------------</span>+<span class="hljs-literal">--------------------</span>+<span class="hljs-literal">--------</span>+<br></code></pre></td></tr></table></figure><h2 id="2-5-Kubernetesé›†ç¾¤éƒ¨ç½²"><a href="#2-5-Kubernetesé›†ç¾¤éƒ¨ç½²" class="headerlink" title="2.5 Kubernetesé›†ç¾¤éƒ¨ç½²"></a>2.5 Kubernetesé›†ç¾¤éƒ¨ç½²</h2><h3 id="2-5-1-Kubernetesè½¯ä»¶åŒ…ä¸‹è½½"><a href="#2-5-1-Kubernetesè½¯ä»¶åŒ…ä¸‹è½½" class="headerlink" title="2.5.1 Kubernetesè½¯ä»¶åŒ…ä¸‹è½½"></a>2.5.1 Kubernetesè½¯ä»¶åŒ…ä¸‹è½½</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://dl.k8s.io/v1.<span class="hljs-number">21.10</span>/kubernetes<span class="hljs-literal">-server-linux-amd64</span>.tar.gz<br></code></pre></td></tr></table></figure><h3 id="2-5-2-Kubernetesè½¯ä»¶åŒ…å®‰è£…"><a href="#2-5-2-Kubernetesè½¯ä»¶åŒ…å®‰è£…" class="headerlink" title="2.5.2 Kubernetesè½¯ä»¶åŒ…å®‰è£…"></a>2.5.2 Kubernetesè½¯ä»¶åŒ…å®‰è£…</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tar <span class="hljs-literal">-xvf</span> kubernetes<span class="hljs-literal">-server-linux-amd64</span>.tar.gz<br><br><span class="hljs-built_in">cd</span> kubernetes/server/bin/<br><br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-apiserver</span> kube<span class="hljs-literal">-controller-manager</span> kube<span class="hljs-literal">-scheduler</span> kubectl /usr/local/bin/<br></code></pre></td></tr></table></figure><h3 id="2-5-3-Kubernetesè½¯ä»¶åˆ†å‘"><a href="#2-5-3-Kubernetesè½¯ä»¶åˆ†å‘" class="headerlink" title="2.5.3 Kubernetesè½¯ä»¶åˆ†å‘"></a>2.5.3 Kubernetesè½¯ä»¶åˆ†å‘</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp kube<span class="hljs-literal">-apiserver</span> kube<span class="hljs-literal">-controller-manager</span> kube<span class="hljs-literal">-scheduler</span> kubectl k8s<span class="hljs-literal">-master2</span>:/usr/local/bin/<br>scp kube<span class="hljs-literal">-apiserver</span> kube<span class="hljs-literal">-controller-manager</span> kube<span class="hljs-literal">-scheduler</span> kubectl k8s<span class="hljs-literal">-master3</span>:/usr/local/bin/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp kubelet kube<span class="hljs-literal">-proxy</span> k8s<span class="hljs-literal">-master1</span>:/usr/local/bin<br>scp kubelet kube<span class="hljs-literal">-proxy</span> k8s<span class="hljs-literal">-master2</span>:/usr/local/bin<br>scp kubelet kube<span class="hljs-literal">-proxy</span> k8s<span class="hljs-literal">-master3</span>:/usr/local/bin<br>scp kubelet kube<span class="hljs-literal">-proxy</span> k8s<span class="hljs-literal">-worker1</span>:/usr/local/bin<br></code></pre></td></tr></table></figure><h3 id="2-5-4-åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šåˆ›å»ºç›®å½•"><a href="#2-5-4-åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šåˆ›å»ºç›®å½•" class="headerlink" title="2.5.4 åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šåˆ›å»ºç›®å½•"></a>2.5.4 åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šåˆ›å»ºç›®å½•</h3><blockquote><p>æ‰€æœ‰èŠ‚ç‚¹</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir <span class="hljs-literal">-p</span> /etc/kubernetes/        <br>mkdir <span class="hljs-literal">-p</span> /etc/kubernetes/ssl     <br>mkdir <span class="hljs-literal">-p</span> /var/log/kubernetes <br></code></pre></td></tr></table></figure><h3 id="2-5-5-éƒ¨ç½²api-server"><a href="#2-5-5-éƒ¨ç½²api-server" class="headerlink" title="2.5.5 éƒ¨ç½²api-server"></a>2.5.5 éƒ¨ç½²api-server</h3><h4 id="2-5-5-1-åˆ›å»ºapiserverè¯ä¹¦è¯·æ±‚æ–‡ä»¶"><a href="#2-5-5-1-åˆ›å»ºapiserverè¯ä¹¦è¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.5.5.1 åˆ›å»ºapiserverè¯ä¹¦è¯·æ±‚æ–‡ä»¶"></a>2.5.5.1 åˆ›å»ºapiserverè¯ä¹¦è¯·æ±‚æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-apiserver-csr</span>.json &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br><span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;kubernetes&quot;</span>,<br>  <span class="hljs-string">&quot;hosts&quot;</span>: [<br>    <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.12&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.13&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.14&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.15&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.16&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.17&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.18&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.19&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.20&quot;</span>,<br>    <span class="hljs-string">&quot;192.168.10.100&quot;</span>,<br>    <span class="hljs-string">&quot;10.96.0.1&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default.svc&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default.svc.cluster&quot;</span>,<br>    <span class="hljs-string">&quot;kubernetes.default.svc.cluster.local&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">2048</span><br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;kubemsb&quot;</span>,<br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span><br>    &#125;<br>  ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br>å¦‚æœ hosts å­—æ®µä¸ä¸ºç©ºåˆ™éœ€è¦æŒ‡å®šæˆæƒä½¿ç”¨è¯¥è¯ä¹¦çš„ IPï¼ˆå«VIPï¼‰ æˆ–åŸŸååˆ—è¡¨ã€‚ç”±äºè¯¥è¯ä¹¦è¢« é›†ç¾¤ä½¿ç”¨ï¼Œéœ€è¦å°†èŠ‚ç‚¹çš„IPéƒ½å¡«ä¸Šï¼Œä¸ºäº†æ–¹ä¾¿åæœŸæ‰©å®¹å¯ä»¥å¤šå†™å‡ ä¸ªé¢„ç•™çš„IPã€‚<br>åŒæ—¶è¿˜éœ€è¦å¡«å†™ service ç½‘ç»œçš„é¦–ä¸ªIP(ä¸€èˆ¬æ˜¯ kube<span class="hljs-literal">-apiserver</span> æŒ‡å®šçš„ service<span class="hljs-literal">-cluster-ip-range</span> ç½‘æ®µçš„ç¬¬ä¸€ä¸ªIPï¼Œå¦‚ <span class="hljs-number">10.96</span>.<span class="hljs-number">0.1</span>)ã€‚<br></code></pre></td></tr></table></figure><h4 id="2-5-5-2-ç”Ÿæˆapiserverè¯ä¹¦åŠtokenæ–‡ä»¶"><a href="#2-5-5-2-ç”Ÿæˆapiserverè¯ä¹¦åŠtokenæ–‡ä»¶" class="headerlink" title="2.5.5.2 ç”Ÿæˆapiserverè¯ä¹¦åŠtokenæ–‡ä»¶"></a>2.5.5.2 ç”Ÿæˆapiserverè¯ä¹¦åŠtokenæ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl gencert <span class="hljs-literal">-ca</span>=ca.pem <span class="hljs-literal">-ca-key</span>=ca<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">-config</span>=ca<span class="hljs-literal">-config</span>.json <span class="hljs-literal">-profile</span>=kubernetes kube<span class="hljs-literal">-apiserver-csr</span>.json | cfssljson <span class="hljs-literal">-bare</span> kube<span class="hljs-literal">-apiserver</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; token.csv &lt;&lt; EOF<br><span class="hljs-variable">$</span>(head <span class="hljs-literal">-c</span> <span class="hljs-number">16</span> /dev/urandom | od <span class="hljs-literal">-An</span> <span class="hljs-literal">-t</span> x | tr <span class="hljs-literal">-d</span> <span class="hljs-string">&#x27; &#x27;</span>),kubelet<span class="hljs-literal">-bootstrap</span>,<span class="hljs-number">10001</span>,<span class="hljs-string">&quot;system:kubelet-bootstrap&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br>åˆ›å»ºTLSæœºåˆ¶æ‰€éœ€TOKEN<br>TLS Bootstrapingï¼šMaster apiserverå¯ç”¨TLSè®¤è¯åï¼ŒNodeèŠ‚ç‚¹kubeletå’Œkube<span class="hljs-literal">-proxy</span>ä¸kube<span class="hljs-literal">-apiserver</span>è¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨CAç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦æ‰å¯ä»¥ï¼Œå½“NodeèŠ‚ç‚¹å¾ˆå¤šæ—¶ï¼Œè¿™ç§å®¢æˆ·ç«¯è¯ä¹¦é¢å‘éœ€è¦å¤§é‡å·¥ä½œï¼ŒåŒæ ·ä¹Ÿä¼šå¢åŠ é›†ç¾¤æ‰©å±•å¤æ‚åº¦ã€‚ä¸ºäº†ç®€åŒ–æµç¨‹ï¼ŒKuberneteså¼•å…¥äº†TLS bootstrapingæœºåˆ¶æ¥è‡ªåŠ¨é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œkubeletä¼šä»¥ä¸€ä¸ªä½æƒé™ç”¨æˆ·è‡ªåŠ¨å‘apiserverç”³è¯·è¯ä¹¦ï¼Œkubeletçš„è¯ä¹¦ç”±apiserveråŠ¨æ€ç­¾ç½²ã€‚æ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨Nodeä¸Šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç›®å‰ä¸»è¦ç”¨äºkubeletï¼Œkube<span class="hljs-literal">-proxy</span>è¿˜æ˜¯ç”±æˆ‘ä»¬ç»Ÿä¸€é¢å‘ä¸€ä¸ªè¯ä¹¦ã€‚<br></code></pre></td></tr></table></figure><h4 id="2-5-5-3-åˆ›å»ºapiserveræœåŠ¡é…ç½®æ–‡ä»¶"><a href="#2-5-5-3-åˆ›å»ºapiserveræœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="2.5.5.3 åˆ›å»ºapiserveræœåŠ¡é…ç½®æ–‡ä»¶"></a>2.5.5.3 åˆ›å»ºapiserveræœåŠ¡é…ç½®æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; /etc/kubernetes/kube<span class="hljs-literal">-apiserver</span>.conf &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>KUBE_APISERVER_OPTS=<span class="hljs-string">&quot;--enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota \</span><br><span class="hljs-string">  --anonymous-auth=false \</span><br><span class="hljs-string">  --bind-address=192.168.10.12 \</span><br><span class="hljs-string">  --secure-port=6443 \</span><br><span class="hljs-string">  --advertise-address=192.168.10.12 \</span><br><span class="hljs-string">  --insecure-port=0 \</span><br><span class="hljs-string">  --authorization-mode=Node,RBAC \</span><br><span class="hljs-string">  --runtime-config=api/all=true \</span><br><span class="hljs-string">  --enable-bootstrap-token-auth \</span><br><span class="hljs-string">  --service-cluster-ip-range=10.96.0.0/16 \</span><br><span class="hljs-string">  --token-auth-file=/etc/kubernetes/token.csv \</span><br><span class="hljs-string">  --service-node-port-range=30000-32767 \</span><br><span class="hljs-string">  --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem  \</span><br><span class="hljs-string">  --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --client-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem \</span><br><span class="hljs-string">  --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --service-account-signing-key-file=/etc/kubernetes/ssl/ca-key.pem  \</span><br><span class="hljs-string">  --service-account-issuer=api \</span><br><span class="hljs-string">  --etcd-cafile=/etc/etcd/ssl/ca.pem \</span><br><span class="hljs-string">  --etcd-certfile=/etc/etcd/ssl/etcd.pem \</span><br><span class="hljs-string">  --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="hljs-string">  --etcd-servers=https://192.168.10.12:2379,https://192.168.10.13:2379,https://192.168.10.14:2379 \</span><br><span class="hljs-string">  --enable-swagger-ui=true \</span><br><span class="hljs-string">  --allow-privileged=true \</span><br><span class="hljs-string">  --apiserver-count=3 \</span><br><span class="hljs-string">  --audit-log-maxage=30 \</span><br><span class="hljs-string">  --audit-log-maxbackup=3 \</span><br><span class="hljs-string">  --audit-log-maxsize=100 \</span><br><span class="hljs-string">  --audit-log-path=/var/log/kube-apiserver-audit.log \</span><br><span class="hljs-string">  --event-ttl=1h \</span><br><span class="hljs-string">  --alsologtostderr=true \</span><br><span class="hljs-string">  --logtostderr=false \</span><br><span class="hljs-string">  --log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">  --v=4&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-5-5-4-åˆ›å»ºapiserveræœåŠ¡ç®¡ç†é…ç½®æ–‡ä»¶"><a href="#2-5-5-4-åˆ›å»ºapiserveræœåŠ¡ç®¡ç†é…ç½®æ–‡ä»¶" class="headerlink" title="2.5.5.4 åˆ›å»ºapiserveræœåŠ¡ç®¡ç†é…ç½®æ–‡ä»¶"></a>2.5.5.4 åˆ›å»ºapiserveræœåŠ¡ç®¡ç†é…ç½®æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; /etc/systemd/system/kube<span class="hljs-literal">-apiserver</span>.service &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>[<span class="hljs-type">Unit</span>]<br>Description=Kubernetes API Server<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=etcd.service<br>Wants=etcd.service<br><br>[<span class="hljs-type">Service</span>]<br>EnvironmentFile=-/etc/kubernetes/kube<span class="hljs-literal">-apiserver</span>.conf<br>ExecStart=/usr/local/bin/kube<span class="hljs-literal">-apiserver</span> <span class="hljs-variable">$KUBE_APISERVER_OPTS</span><br>Restart=on<span class="hljs-literal">-failure</span><br>RestartSec=<span class="hljs-number">5</span><br><span class="hljs-built_in">Type</span>=notify<br>LimitNOFILE=<span class="hljs-number">65536</span><br><br>[<span class="hljs-type">Install</span>]<br>WantedBy=multi<span class="hljs-literal">-user</span>.target<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-5-5-5-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹"><a href="#2-5-5-5-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹" class="headerlink" title="2.5.5.5 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹"></a>2.5.5.5 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> ca*.pem /etc/kubernetes/ssl/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-apiserver</span>*.pem /etc/kubernetes/ssl/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> token.csv /etc/kubernetes/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp /etc/kubernetes/token.csv k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes<br>scp /etc/kubernetes/token.csv k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp /etc/kubernetes/ssl/kube<span class="hljs-literal">-apiserver</span>*.pem k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes/ssl<br>scp /etc/kubernetes/ssl/kube<span class="hljs-literal">-apiserver</span>*.pem k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes/ssl<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp /etc/kubernetes/ssl/ca*.pem k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes/ssl<br>scp /etc/kubernetes/ssl/ca*.pem k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes/ssl<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp /etc/kubernetes/kube<span class="hljs-literal">-apiserver</span>.conf k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes/kube<span class="hljs-literal">-apiserver</span>.conf<br><br><span class="hljs-comment"># cat /etc/kubernetes/kube-apiserver.conf</span><br>KUBE_APISERVER_OPTS=<span class="hljs-string">&quot;--enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota \</span><br><span class="hljs-string">  --anonymous-auth=false \</span><br><span class="hljs-string">  --bind-address=192.168.10.13 \</span><br><span class="hljs-string">  --secure-port=6443 \</span><br><span class="hljs-string">  --advertise-address=192.168.10.13 \</span><br><span class="hljs-string">  --insecure-port=0 \</span><br><span class="hljs-string">  --authorization-mode=Node,RBAC \</span><br><span class="hljs-string">  --runtime-config=api/all=true \</span><br><span class="hljs-string">  --enable-bootstrap-token-auth \</span><br><span class="hljs-string">  --service-cluster-ip-range=10.96.0.0/16 \</span><br><span class="hljs-string">  --token-auth-file=/etc/kubernetes/token.csv \</span><br><span class="hljs-string">  --service-node-port-range=30000-32767 \</span><br><span class="hljs-string">  --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem  \</span><br><span class="hljs-string">  --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --client-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem \</span><br><span class="hljs-string">  --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --service-account-signing-key-file=/etc/kubernetes/ssl/ca-key.pem  \</span><br><span class="hljs-string">  --service-account-issuer=api \</span><br><span class="hljs-string">  --etcd-cafile=/etc/etcd/ssl/ca.pem \</span><br><span class="hljs-string">  --etcd-certfile=/etc/etcd/ssl/etcd.pem \</span><br><span class="hljs-string">  --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="hljs-string">  --etcd-servers=https://192.168.10.12:2379,https://192.168.10.13:2379,https://192.168.10.14:2379 \</span><br><span class="hljs-string">  --enable-swagger-ui=true \</span><br><span class="hljs-string">  --allow-privileged=true \</span><br><span class="hljs-string">  --apiserver-count=3 \</span><br><span class="hljs-string">  --audit-log-maxage=30 \</span><br><span class="hljs-string">  --audit-log-maxbackup=3 \</span><br><span class="hljs-string">  --audit-log-maxsize=100 \</span><br><span class="hljs-string">  --audit-log-path=/var/log/kube-apiserver-audit.log \</span><br><span class="hljs-string">  --event-ttl=1h \</span><br><span class="hljs-string">  --alsologtostderr=true \</span><br><span class="hljs-string">  --logtostderr=false \</span><br><span class="hljs-string">  --log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">  --v=4&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> /etc/kubernetes/kube<span class="hljs-literal">-apiserver</span>.conf k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes/kube<span class="hljs-literal">-apiserver</span>.conf<br><br><span class="hljs-comment"># cat /etc/kubernetes/kube-apiserver.conf</span><br>KUBE_APISERVER_OPTS=<span class="hljs-string">&quot;--enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota \</span><br><span class="hljs-string">  --anonymous-auth=false \</span><br><span class="hljs-string">  --bind-address=192.168.10.14 \</span><br><span class="hljs-string">  --secure-port=6443 \</span><br><span class="hljs-string">  --advertise-address=192.168.10.14 \</span><br><span class="hljs-string">  --insecure-port=0 \</span><br><span class="hljs-string">  --authorization-mode=Node,RBAC \</span><br><span class="hljs-string">  --runtime-config=api/all=true \</span><br><span class="hljs-string">  --enable-bootstrap-token-auth \</span><br><span class="hljs-string">  --service-cluster-ip-range=10.96.0.0/16 \</span><br><span class="hljs-string">  --token-auth-file=/etc/kubernetes/token.csv \</span><br><span class="hljs-string">  --service-node-port-range=30000-32767 \</span><br><span class="hljs-string">  --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem  \</span><br><span class="hljs-string">  --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --client-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem \</span><br><span class="hljs-string">  --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem \</span><br><span class="hljs-string">  --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --service-account-signing-key-file=/etc/kubernetes/ssl/ca-key.pem  \</span><br><span class="hljs-string">  --service-account-issuer=api \</span><br><span class="hljs-string">  --etcd-cafile=/etc/etcd/ssl/ca.pem \</span><br><span class="hljs-string">  --etcd-certfile=/etc/etcd/ssl/etcd.pem \</span><br><span class="hljs-string">  --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="hljs-string">  --etcd-servers=https://192.168.10.12:2379,https://192.168.10.13:2379,https://192.168.10.14:2379 \</span><br><span class="hljs-string">  --enable-swagger-ui=true \</span><br><span class="hljs-string">  --allow-privileged=true \</span><br><span class="hljs-string">  --apiserver-count=3 \</span><br><span class="hljs-string">  --audit-log-maxage=30 \</span><br><span class="hljs-string">  --audit-log-maxbackup=3 \</span><br><span class="hljs-string">  --audit-log-maxsize=100 \</span><br><span class="hljs-string">  --audit-log-path=/var/log/kube-apiserver-audit.log \</span><br><span class="hljs-string">  --event-ttl=1h \</span><br><span class="hljs-string">  --alsologtostderr=true \</span><br><span class="hljs-string">  --logtostderr=false \</span><br><span class="hljs-string">  --log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">  --v=4&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp /etc/systemd/system/kube<span class="hljs-literal">-apiserver</span>.service k8s<span class="hljs-literal">-master2</span>:/etc/systemd/system/kube<span class="hljs-literal">-apiserver</span>.service<br><br>scp /etc/systemd/system/kube<span class="hljs-literal">-apiserver</span>.service k8s<span class="hljs-literal">-master3</span>:/etc/systemd/system/kube<span class="hljs-literal">-apiserver</span>.service<br></code></pre></td></tr></table></figure><h4 id="2-5-5-6-å¯åŠ¨apiserveræœåŠ¡"><a href="#2-5-5-6-å¯åŠ¨apiserveræœåŠ¡" class="headerlink" title="2.5.5.6 å¯åŠ¨apiserveræœåŠ¡"></a>2.5.5.6 å¯åŠ¨apiserveræœåŠ¡</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl daemon<span class="hljs-literal">-reload</span><br>systemctl enable <span class="hljs-literal">--now</span> kube<span class="hljs-literal">-apiserver</span><br><br>systemctl status kube<span class="hljs-literal">-apiserver</span><br><br><span class="hljs-comment"># æµ‹è¯•</span><br><span class="hljs-built_in">curl</span> <span class="hljs-literal">--insecure</span> https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">6443</span>/<br><span class="hljs-built_in">curl</span> <span class="hljs-literal">--insecure</span> https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.13</span>:<span class="hljs-number">6443</span>/<br><span class="hljs-built_in">curl</span> <span class="hljs-literal">--insecure</span> https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.14</span>:<span class="hljs-number">6443</span>/<br><span class="hljs-built_in">curl</span> <span class="hljs-literal">--insecure</span> https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span>:<span class="hljs-number">6443</span>/<br></code></pre></td></tr></table></figure><h3 id="2-5-6-éƒ¨ç½²kubectl"><a href="#2-5-6-éƒ¨ç½²kubectl" class="headerlink" title="2.5.6 éƒ¨ç½²kubectl"></a>2.5.6 éƒ¨ç½²kubectl</h3><h4 id="2-5-6-1-åˆ›å»ºkubectlè¯ä¹¦è¯·æ±‚æ–‡ä»¶"><a href="#2-5-6-1-åˆ›å»ºkubectlè¯ä¹¦è¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.5.6.1 åˆ›å»ºkubectlè¯ä¹¦è¯·æ±‚æ–‡ä»¶"></a>2.5.6.1 åˆ›å»ºkubectlè¯ä¹¦è¯·æ±‚æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; admin<span class="hljs-literal">-csr</span>.json &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-string">&quot;hosts&quot;</span>: [],<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">2048</span><br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;system:masters&quot;</span>,             <br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>    &#125;<br>  ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br><br>åç»­ kube<span class="hljs-literal">-apiserver</span> ä½¿ç”¨ RBAC å¯¹å®¢æˆ·ç«¯(å¦‚ kubeletã€kube<span class="hljs-literal">-proxy</span>ã€Pod)è¯·æ±‚è¿›è¡Œæˆæƒï¼›<br>kube<span class="hljs-literal">-apiserver</span> é¢„å®šä¹‰äº†ä¸€äº› RBAC ä½¿ç”¨çš„ RoleBindingsï¼Œå¦‚ cluster<span class="hljs-literal">-admin</span> å°† <span class="hljs-built_in">Group</span> system:masters ä¸ Role cluster<span class="hljs-literal">-admin</span> ç»‘å®šï¼Œè¯¥ Role æˆäºˆäº†è°ƒç”¨kube<span class="hljs-literal">-apiserver</span> çš„æ‰€æœ‰ APIçš„æƒé™ï¼›<br>OæŒ‡å®šè¯¥è¯ä¹¦çš„ <span class="hljs-built_in">Group</span> ä¸º system:mastersï¼Œkubelet ä½¿ç”¨è¯¥è¯ä¹¦è®¿é—® kube<span class="hljs-literal">-apiserver</span> æ—¶ ï¼Œç”±äºè¯ä¹¦è¢« CA ç­¾åï¼Œæ‰€ä»¥è®¤è¯é€šè¿‡ï¼ŒåŒæ—¶ç”±äºè¯ä¹¦ç”¨æˆ·ç»„ä¸ºç»è¿‡é¢„æˆæƒçš„ system:mastersï¼Œæ‰€ä»¥è¢«æˆäºˆè®¿é—®æ‰€æœ‰ API çš„æƒé™ï¼›<br>æ³¨ï¼š<br>è¿™ä¸ªadmin è¯ä¹¦ï¼Œæ˜¯å°†æ¥ç”Ÿæˆç®¡ç†å‘˜ç”¨çš„kubeconfig é…ç½®æ–‡ä»¶ç”¨çš„ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èˆ¬å»ºè®®ä½¿ç”¨RBAC æ¥å¯¹kubernetes è¿›è¡Œè§’è‰²æƒé™æ§åˆ¶ï¼Œ kubernetes å°†è¯ä¹¦ä¸­çš„CN å­—æ®µ ä½œä¸ºUserï¼Œ O å­—æ®µä½œä¸º <span class="hljs-built_in">Group</span>ï¼›<br><span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;system:masters&quot;</span>, å¿…é¡»æ˜¯system:mastersï¼Œå¦åˆ™åé¢kubectl create clusterrolebindingæŠ¥é”™ã€‚<br></code></pre></td></tr></table></figure><h4 id="2-5-6-2-ç”Ÿæˆè¯ä¹¦æ–‡ä»¶"><a href="#2-5-6-2-ç”Ÿæˆè¯ä¹¦æ–‡ä»¶" class="headerlink" title="2.5.6.2 ç”Ÿæˆè¯ä¹¦æ–‡ä»¶"></a>2.5.6.2 ç”Ÿæˆè¯ä¹¦æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl gencert <span class="hljs-literal">-ca</span>=ca.pem <span class="hljs-literal">-ca-key</span>=ca<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">-config</span>=ca<span class="hljs-literal">-config</span>.json <span class="hljs-literal">-profile</span>=kubernetes admin<span class="hljs-literal">-csr</span>.json | cfssljson <span class="hljs-literal">-bare</span> admin<br></code></pre></td></tr></table></figure><h4 id="2-5-6-3-å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•"><a href="#2-5-6-3-å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•" class="headerlink" title="2.5.6.3 å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•"></a>2.5.6.3 å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> admin*.pem /etc/kubernetes/ssl/<br></code></pre></td></tr></table></figure><h4 id="2-5-6-4-ç”Ÿæˆkubeconfigé…ç½®æ–‡ä»¶"><a href="#2-5-6-4-ç”Ÿæˆkubeconfigé…ç½®æ–‡ä»¶" class="headerlink" title="2.5.6.4 ç”Ÿæˆkubeconfigé…ç½®æ–‡ä»¶"></a>2.5.6.4 ç”Ÿæˆkubeconfigé…ç½®æ–‡ä»¶</h4><p>kube.config ä¸º kubectl çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«è®¿é—® apiserver çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚ apiserver åœ°å€ã€CA è¯ä¹¦å’Œè‡ªèº«ä½¿ç”¨çš„è¯ä¹¦</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl config <span class="hljs-built_in">set-cluster</span> kubernetes <span class="hljs-literal">--certificate-authority</span>=ca.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--server</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span>:<span class="hljs-number">6443</span> <span class="hljs-literal">--kubeconfig</span>=kube.config<br><br>kubectl config <span class="hljs-built_in">set-credentials</span> admin <span class="hljs-literal">--client-certificate</span>=admin.pem <span class="hljs-literal">--client-key</span>=admin<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--kubeconfig</span>=kube.config<br><br>kubectl config <span class="hljs-built_in">set-context</span> kubernetes <span class="hljs-literal">--cluster</span>=kubernetes <span class="hljs-literal">--user</span>=admin <span class="hljs-literal">--kubeconfig</span>=kube.config<br><br>kubectl config <span class="hljs-built_in">use-context</span> kubernetes <span class="hljs-literal">--kubeconfig</span>=kube.config<br></code></pre></td></tr></table></figure><h4 id="2-5-6-5-å‡†å¤‡kubectlé…ç½®æ–‡ä»¶å¹¶è¿›è¡Œè§’è‰²ç»‘å®š"><a href="#2-5-6-5-å‡†å¤‡kubectlé…ç½®æ–‡ä»¶å¹¶è¿›è¡Œè§’è‰²ç»‘å®š" class="headerlink" title="2.5.6.5 å‡†å¤‡kubectlé…ç½®æ–‡ä»¶å¹¶è¿›è¡Œè§’è‰²ç»‘å®š"></a>2.5.6.5 å‡†å¤‡kubectlé…ç½®æ–‡ä»¶å¹¶è¿›è¡Œè§’è‰²ç»‘å®š</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir ~/.kube<br><span class="hljs-built_in">cp</span> kube.config ~/.kube/config<br>kubectl create clusterrolebinding kube<span class="hljs-literal">-apiserver</span>:kubelet<span class="hljs-literal">-apis</span> <span class="hljs-literal">--clusterrole</span>=system:kubelet<span class="hljs-literal">-api-admin</span> <span class="hljs-literal">--user</span> kubernetes <span class="hljs-literal">--kubeconfig</span>=/root/.kube/config<br></code></pre></td></tr></table></figure><h4 id="2-5-6-6-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#2-5-6-6-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="2.5.6.6 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>2.5.6.6 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">export KUBECONFIG=<span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯<br>kubectl cluster<span class="hljs-literal">-info</span><br><br>æŸ¥çœ‹é›†ç¾¤ç»„ä»¶çŠ¶æ€<br>kubectl get componentstatuses<br><br>æŸ¥çœ‹å‘½åç©ºé—´ä¸­èµ„æºå¯¹è±¡<br>kubectl get all <span class="hljs-literal">--all-namespaces</span><br></code></pre></td></tr></table></figure><h4 id="2-5-6-7-åŒæ­¥kubectlé…ç½®æ–‡ä»¶åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹"><a href="#2-5-6-7-åŒæ­¥kubectlé…ç½®æ–‡ä»¶åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹" class="headerlink" title="2.5.6.7 åŒæ­¥kubectlé…ç½®æ–‡ä»¶åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹"></a>2.5.6.7 åŒæ­¥kubectlé…ç½®æ–‡ä»¶åˆ°é›†ç¾¤å…¶å®ƒmasterèŠ‚ç‚¹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">k8s<span class="hljs-literal">-master2</span>:<br>mkdir /root/.kube<br><br>k8s<span class="hljs-literal">-master3</span>:<br>mkdir /root/.kube<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp /root/.kube/config k8s<span class="hljs-literal">-master2</span>:/root/.kube/config<br>scp /root/.kube/config k8s<span class="hljs-literal">-master3</span>:/root/.kube/config<br></code></pre></td></tr></table></figure><h4 id="2-5-6-8-é…ç½®kubectlå‘½ä»¤è¡¥å…¨-å¯é€‰"><a href="#2-5-6-8-é…ç½®kubectlå‘½ä»¤è¡¥å…¨-å¯é€‰" class="headerlink" title="2.5.6.8 é…ç½®kubectlå‘½ä»¤è¡¥å…¨(å¯é€‰)"></a>2.5.6.8 é…ç½®kubectlå‘½ä»¤è¡¥å…¨(å¯é€‰)</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">yum install <span class="hljs-literal">-y</span> bash<span class="hljs-literal">-completion</span><br>source /usr/share/bash<span class="hljs-literal">-completion</span>/bash_completion<br>source &lt;(kubectl completion bash)<br>kubectl completion bash &gt; ~/.kube/completion.bash.inc<br>source <span class="hljs-string">&#x27;/root/.kube/completion.bash.inc&#x27;</span>  <br>source <span class="hljs-variable">$HOME</span>/.bash_profile<br></code></pre></td></tr></table></figure><h3 id="2-5-7-éƒ¨ç½²kube-controller-manager"><a href="#2-5-7-éƒ¨ç½²kube-controller-manager" class="headerlink" title="2.5.7  éƒ¨ç½²kube-controller-manager"></a>2.5.7  éƒ¨ç½²kube-controller-manager</h3><h4 id="2-5-7-1-åˆ›å»ºkube-controller-managerè¯ä¹¦è¯·æ±‚æ–‡ä»¶"><a href="#2-5-7-1-åˆ›å»ºkube-controller-managerè¯ä¹¦è¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.5.7.1 åˆ›å»ºkube-controller-managerè¯ä¹¦è¯·æ±‚æ–‡ä»¶"></a>2.5.7.1 åˆ›å»ºkube-controller-managerè¯ä¹¦è¯·æ±‚æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-controller-manager-csr</span>.json &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>    <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;system:kube-controller-manager&quot;</span>,<br>    <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">2048</span><br>    &#125;,<br>    <span class="hljs-string">&quot;hosts&quot;</span>: [<br>      <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.10.12&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.10.13&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.10.14&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;names&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>        <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>        <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>        <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;system:kube-controller-manager&quot;</span>,<br>        <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>      &#125;<br>    ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br><br>hosts åˆ—è¡¨åŒ…å«æ‰€æœ‰ kube<span class="hljs-literal">-controller-manager</span> èŠ‚ç‚¹ IPï¼›<br>CN ä¸º system:kube<span class="hljs-literal">-controller-manager</span>;<br>O ä¸º system:kube<span class="hljs-literal">-controller-manager</span>ï¼Œkubernetes å†…ç½®çš„ ClusterRoleBindings system:kube<span class="hljs-literal">-controller-manager</span> èµ‹äºˆ kube<span class="hljs-literal">-controller-manager</span> å·¥ä½œæ‰€éœ€çš„æƒé™<br></code></pre></td></tr></table></figure><h4 id="2-5-7-2-åˆ›å»ºkube-controller-managerè¯ä¹¦æ–‡ä»¶"><a href="#2-5-7-2-åˆ›å»ºkube-controller-managerè¯ä¹¦æ–‡ä»¶" class="headerlink" title="2.5.7.2 åˆ›å»ºkube-controller-managerè¯ä¹¦æ–‡ä»¶"></a>2.5.7.2 åˆ›å»ºkube-controller-managerè¯ä¹¦æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl gencert <span class="hljs-literal">-ca</span>=ca.pem <span class="hljs-literal">-ca-key</span>=ca<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">-config</span>=ca<span class="hljs-literal">-config</span>.json <span class="hljs-literal">-profile</span>=kubernetes kube<span class="hljs-literal">-controller-manager-csr</span>.json | cfssljson <span class="hljs-literal">-bare</span> kube<span class="hljs-literal">-controller-manager</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># ls</span><br><br>kube<span class="hljs-literal">-controller-manager</span>.csr     <br>kube<span class="hljs-literal">-controller-manager-csr</span>.json<br>kube<span class="hljs-literal">-controller-manager-key</span>.pem<br>kube<span class="hljs-literal">-controller-manager</span>.pem<br></code></pre></td></tr></table></figure><h4 id="2-5-7-3-åˆ›å»ºkube-controller-managerçš„kube-controller-manager-kubeconfig"><a href="#2-5-7-3-åˆ›å»ºkube-controller-managerçš„kube-controller-manager-kubeconfig" class="headerlink" title="2.5.7.3  åˆ›å»ºkube-controller-managerçš„kube-controller-manager.kubeconfig"></a>2.5.7.3  åˆ›å»ºkube-controller-managerçš„kube-controller-manager.kubeconfig</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl config <span class="hljs-built_in">set-cluster</span> kubernetes <span class="hljs-literal">--certificate-authority</span>=ca.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--server</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span>:<span class="hljs-number">6443</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-controller-manager</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-credentials</span> system:kube<span class="hljs-literal">-controller-manager</span> <span class="hljs-literal">--client-certificate</span>=kube<span class="hljs-literal">-controller-manager</span>.pem <span class="hljs-literal">--client-key</span>=kube<span class="hljs-literal">-controller-manager-key</span>.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-controller-manager</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-context</span> system:kube<span class="hljs-literal">-controller-manager</span> <span class="hljs-literal">--cluster</span>=kubernetes <span class="hljs-literal">--user</span>=system:kube<span class="hljs-literal">-controller-manager</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-controller-manager</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">use-context</span> system:kube<span class="hljs-literal">-controller-manager</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-controller-manager</span>.kubeconfig<br></code></pre></td></tr></table></figure><h4 id="2-5-7-4-åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶"><a href="#2-5-7-4-åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶" class="headerlink" title="2.5.7.4 åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶"></a>2.5.7.4 åˆ›å»ºkube-controller-manageré…ç½®æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-controller-manager</span>.conf &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>KUBE_CONTROLLER_MANAGER_OPTS=<span class="hljs-string">&quot;--port=10252 \</span><br><span class="hljs-string">  --secure-port=10257 \</span><br><span class="hljs-string">  --bind-address=127.0.0.1 \</span><br><span class="hljs-string">  --kubeconfig=/etc/kubernetes/kube-controller-manager.kubeconfig \</span><br><span class="hljs-string">  --service-cluster-ip-range=10.96.0.0/16 \</span><br><span class="hljs-string">  --cluster-name=kubernetes \</span><br><span class="hljs-string">  --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --allocate-node-cidrs=true \</span><br><span class="hljs-string">  --cluster-cidr=10.244.0.0/16 \</span><br><span class="hljs-string">  --experimental-cluster-signing-duration=87600h \</span><br><span class="hljs-string">  --root-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="hljs-string">  --service-account-private-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="hljs-string">  --leader-elect=true \</span><br><span class="hljs-string">  --feature-gates=RotateKubeletServerCertificate=true \</span><br><span class="hljs-string">  --controllers=*,bootstrapsigner,tokencleaner \</span><br><span class="hljs-string">  --horizontal-pod-autoscaler-use-rest-clients=true \</span><br><span class="hljs-string">  --horizontal-pod-autoscaler-sync-period=10s \</span><br><span class="hljs-string">  --tls-cert-file=/etc/kubernetes/ssl/kube-controller-manager.pem \</span><br><span class="hljs-string">  --tls-private-key-file=/etc/kubernetes/ssl/kube-controller-manager-key.pem \</span><br><span class="hljs-string">  --use-service-account-credentials=true \</span><br><span class="hljs-string">  --alsologtostderr=true \</span><br><span class="hljs-string">  --logtostderr=false \</span><br><span class="hljs-string">  --log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">  --v=2&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-5-7-5-åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"><a href="#2-5-7-5-åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶" class="headerlink" title="2.5.7.5 åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶"></a>2.5.7.5 åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-controller-manager</span>.service &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>[<span class="hljs-type">Unit</span>]<br>Description=Kubernetes Controller Manager<br>Documentation=https://github.com/kubernetes/kubernetes<br><br>[<span class="hljs-type">Service</span>]<br>EnvironmentFile=-/etc/kubernetes/kube<span class="hljs-literal">-controller-manager</span>.conf<br>ExecStart=/usr/local/bin/kube<span class="hljs-literal">-controller-manager</span> <span class="hljs-variable">$KUBE_CONTROLLER_MANAGER_OPTS</span><br>Restart=on<span class="hljs-literal">-failure</span><br>RestartSec=<span class="hljs-number">5</span><br><br>[<span class="hljs-type">Install</span>]<br>WantedBy=multi<span class="hljs-literal">-user</span>.target<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-5-7-6-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹"><a href="#2-5-7-6-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹" class="headerlink" title="2.5.7.6 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹"></a>2.5.7.6 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤masterèŠ‚ç‚¹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-controller-manager</span>*.pem /etc/kubernetes/ssl/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-controller-manager</span>.kubeconfig /etc/kubernetes/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-controller-manager</span>.conf /etc/kubernetes/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-controller-manager</span>.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp  kube<span class="hljs-literal">-controller-manager</span>*.pem k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes/ssl/<br>scp  kube<span class="hljs-literal">-controller-manager</span>*.pem k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes/ssl/<br>scp  kube<span class="hljs-literal">-controller-manager</span>.kubeconfig kube<span class="hljs-literal">-controller-manager</span>.conf k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes/<br>scp  kube<span class="hljs-literal">-controller-manager</span>.kubeconfig kube<span class="hljs-literal">-controller-manager</span>.conf k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes/<br>scp  kube<span class="hljs-literal">-controller-manager</span>.service k8s<span class="hljs-literal">-master2</span>:/usr/lib/systemd/system/<br>scp  kube<span class="hljs-literal">-controller-manager</span>.service k8s<span class="hljs-literal">-master3</span>:/usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#æŸ¥çœ‹è¯ä¹¦</span><br>openssl x509 <span class="hljs-operator">-in</span> /etc/kubernetes/ssl/kube<span class="hljs-literal">-controller-manager</span>.pem <span class="hljs-literal">-noout</span> <span class="hljs-literal">-text</span><br></code></pre></td></tr></table></figure><h4 id="2-5-7-7-å¯åŠ¨æœåŠ¡"><a href="#2-5-7-7-å¯åŠ¨æœåŠ¡" class="headerlink" title="2.5.7.7 å¯åŠ¨æœåŠ¡"></a>2.5.7.7 å¯åŠ¨æœåŠ¡</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl daemon<span class="hljs-literal">-reload</span> <br>systemctl enable <span class="hljs-literal">--now</span> kube<span class="hljs-literal">-controller-manager</span><br>systemctl status kube<span class="hljs-literal">-controller-manager</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl get componentstatuses<br></code></pre></td></tr></table></figure><h3 id="2-5-8-éƒ¨ç½²kube-scheduler"><a href="#2-5-8-éƒ¨ç½²kube-scheduler" class="headerlink" title="2.5.8 éƒ¨ç½²kube-scheduler"></a>2.5.8 éƒ¨ç½²kube-scheduler</h3><h4 id="2-5-8-1-åˆ›å»ºkube-schedulerè¯ä¹¦è¯·æ±‚æ–‡ä»¶"><a href="#2-5-8-1-åˆ›å»ºkube-schedulerè¯ä¹¦è¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.5.8.1 åˆ›å»ºkube-schedulerè¯ä¹¦è¯·æ±‚æ–‡ä»¶"></a>2.5.8.1 åˆ›å»ºkube-schedulerè¯ä¹¦è¯·æ±‚æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-scheduler-csr</span>.json &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>    <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;system:kube-scheduler&quot;</span>,<br>    <span class="hljs-string">&quot;hosts&quot;</span>: [<br>      <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.10.12&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.10.13&quot;</span>,<br>      <span class="hljs-string">&quot;192.168.10.14&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">2048</span><br>    &#125;,<br>    <span class="hljs-string">&quot;names&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>        <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>        <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>        <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;system:kube-scheduler&quot;</span>,<br>        <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;system&quot;</span><br>      &#125;<br>    ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-5-8-2-ç”Ÿæˆkube-schedulerè¯ä¹¦"><a href="#2-5-8-2-ç”Ÿæˆkube-schedulerè¯ä¹¦" class="headerlink" title="2.5.8.2 ç”Ÿæˆkube-schedulerè¯ä¹¦"></a>2.5.8.2 ç”Ÿæˆkube-schedulerè¯ä¹¦</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl gencert <span class="hljs-literal">-ca</span>=ca.pem <span class="hljs-literal">-ca-key</span>=ca<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">-config</span>=ca<span class="hljs-literal">-config</span>.json <span class="hljs-literal">-profile</span>=kubernetes kube<span class="hljs-literal">-scheduler-csr</span>.json | cfssljson <span class="hljs-literal">-bare</span> kube<span class="hljs-literal">-scheduler</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># ls</span><br>kube<span class="hljs-literal">-scheduler</span>.csr<br>kube<span class="hljs-literal">-scheduler-csr</span>.json<br>kube<span class="hljs-literal">-scheduler-key</span>.pem<br>kube<span class="hljs-literal">-scheduler</span>.pem<br></code></pre></td></tr></table></figure><h4 id="2-5-8-3-åˆ›å»ºkube-schedulerçš„kubeconfig"><a href="#2-5-8-3-åˆ›å»ºkube-schedulerçš„kubeconfig" class="headerlink" title="2.5.8.3 åˆ›å»ºkube-schedulerçš„kubeconfig"></a>2.5.8.3 åˆ›å»ºkube-schedulerçš„kubeconfig</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl config <span class="hljs-built_in">set-cluster</span> kubernetes <span class="hljs-literal">--certificate-authority</span>=ca.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--server</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span>:<span class="hljs-number">6443</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-scheduler</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-credentials</span> system:kube<span class="hljs-literal">-scheduler</span> <span class="hljs-literal">--client-certificate</span>=kube<span class="hljs-literal">-scheduler</span>.pem <span class="hljs-literal">--client-key</span>=kube<span class="hljs-literal">-scheduler-key</span>.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-scheduler</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-context</span> system:kube<span class="hljs-literal">-scheduler</span> <span class="hljs-literal">--cluster</span>=kubernetes <span class="hljs-literal">--user</span>=system:kube<span class="hljs-literal">-scheduler</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-scheduler</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">use-context</span> system:kube<span class="hljs-literal">-scheduler</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-scheduler</span>.kubeconfig<br></code></pre></td></tr></table></figure><h4 id="2-5-8-4-åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶"><a href="#2-5-8-4-åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="2.5.8.4 åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶"></a>2.5.8.4 åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-scheduler</span>.conf &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>KUBE_SCHEDULER_OPTS=<span class="hljs-string">&quot;--address=127.0.0.1 \</span><br><span class="hljs-string">--kubeconfig=/etc/kubernetes/kube-scheduler.kubeconfig \</span><br><span class="hljs-string">--leader-elect=true \</span><br><span class="hljs-string">--alsologtostderr=true \</span><br><span class="hljs-string">--logtostderr=false \</span><br><span class="hljs-string">--log-dir=/var/log/kubernetes \</span><br><span class="hljs-string">--v=2&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-5-8-5åˆ›å»ºæœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶"><a href="#2-5-8-5åˆ›å»ºæœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶" class="headerlink" title="2.5.8.5åˆ›å»ºæœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶"></a>2.5.8.5åˆ›å»ºæœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-scheduler</span>.service &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>[<span class="hljs-type">Unit</span>]<br>Description=Kubernetes Scheduler<br>Documentation=https://github.com/kubernetes/kubernetes<br><br>[<span class="hljs-type">Service</span>]<br>EnvironmentFile=-/etc/kubernetes/kube<span class="hljs-literal">-scheduler</span>.conf<br>ExecStart=/usr/local/bin/kube<span class="hljs-literal">-scheduler</span> <span class="hljs-variable">$KUBE_SCHEDULER_OPTS</span><br>Restart=on<span class="hljs-literal">-failure</span><br>RestartSec=<span class="hljs-number">5</span><br><br>[<span class="hljs-type">Install</span>]<br>WantedBy=multi<span class="hljs-literal">-user</span>.target<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-5-8-6-åŒæ­¥æ–‡ä»¶è‡³é›†ç¾¤masterèŠ‚ç‚¹"><a href="#2-5-8-6-åŒæ­¥æ–‡ä»¶è‡³é›†ç¾¤masterèŠ‚ç‚¹" class="headerlink" title="2.5.8.6 åŒæ­¥æ–‡ä»¶è‡³é›†ç¾¤masterèŠ‚ç‚¹"></a>2.5.8.6 åŒæ­¥æ–‡ä»¶è‡³é›†ç¾¤masterèŠ‚ç‚¹</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-scheduler</span>*.pem /etc/kubernetes/ssl/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-scheduler</span>.kubeconfig /etc/kubernetes/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-scheduler</span>.conf /etc/kubernetes/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-scheduler</span>.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scp  kube<span class="hljs-literal">-scheduler</span>*.pem k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes/ssl/<br>scp  kube<span class="hljs-literal">-scheduler</span>*.pem k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes/ssl/<br>scp  kube<span class="hljs-literal">-scheduler</span>.kubeconfig kube<span class="hljs-literal">-scheduler</span>.conf k8s<span class="hljs-literal">-master2</span>:/etc/kubernetes/<br>scp  kube<span class="hljs-literal">-scheduler</span>.kubeconfig kube<span class="hljs-literal">-scheduler</span>.conf k8s<span class="hljs-literal">-master3</span>:/etc/kubernetes/<br>scp  kube<span class="hljs-literal">-scheduler</span>.service k8s<span class="hljs-literal">-master2</span>:/usr/lib/systemd/system/<br>scp  kube<span class="hljs-literal">-scheduler</span>.service k8s<span class="hljs-literal">-master3</span>:/usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><h4 id="2-5-8-7-å¯åŠ¨æœåŠ¡"><a href="#2-5-8-7-å¯åŠ¨æœåŠ¡" class="headerlink" title="2.5.8.7 å¯åŠ¨æœåŠ¡"></a>2.5.8.7 å¯åŠ¨æœåŠ¡</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl daemon<span class="hljs-literal">-reload</span><br>systemctl enable <span class="hljs-literal">--now</span> kube<span class="hljs-literal">-scheduler</span><br>systemctl status kube<span class="hljs-literal">-scheduler</span><br></code></pre></td></tr></table></figure><h3 id="2-5-9-å·¥ä½œèŠ‚ç‚¹ï¼ˆworker-nodeï¼‰éƒ¨ç½²"><a href="#2-5-9-å·¥ä½œèŠ‚ç‚¹ï¼ˆworker-nodeï¼‰éƒ¨ç½²" class="headerlink" title="2.5.9 å·¥ä½œèŠ‚ç‚¹ï¼ˆworker nodeï¼‰éƒ¨ç½²"></a>2.5.9 å·¥ä½œèŠ‚ç‚¹ï¼ˆworker nodeï¼‰éƒ¨ç½²</h3><h4 id="2-5-9-1-Containerdå®‰è£…åŠé…ç½®"><a href="#2-5-9-1-Containerdå®‰è£…åŠé…ç½®" class="headerlink" title="2.5.9.1 Containerdå®‰è£…åŠé…ç½®"></a>2.5.9.1 Containerdå®‰è£…åŠé…ç½®</h4><h5 id="2-5-9-1-1-è·å–è½¯ä»¶åŒ…"><a href="#2-5-9-1-1-è·å–è½¯ä»¶åŒ…" class="headerlink" title="2.5.9.1.1 è·å–è½¯ä»¶åŒ…"></a>2.5.9.1.1 è·å–è½¯ä»¶åŒ…</h5><p>![image-20220321233643232](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220321233643232.png)</p><p>![image-20220321233718744](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220321233718744.png)</p><p>![image-20220321233751488](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220321233751488.png)</p><p>![image-20220321233903747](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220321233903747.png)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://github.com/containerd/containerd/releases/download/v1.<span class="hljs-number">6.1</span>/cri<span class="hljs-literal">-containerd-cni-1</span>.<span class="hljs-number">6.1</span><span class="hljs-literal">-linux-amd64</span>.tar.gz<br></code></pre></td></tr></table></figure><h5 id="2-5-9-1-2-å®‰è£…containerd"><a href="#2-5-9-1-2-å®‰è£…containerd" class="headerlink" title="2.5.9.1.2 å®‰è£…containerd"></a>2.5.9.1.2 å®‰è£…containerd</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tar <span class="hljs-literal">-xf</span> cri<span class="hljs-literal">-containerd-cni-1</span>.<span class="hljs-number">6.1</span><span class="hljs-literal">-linux-amd64</span>.tar.gz <span class="hljs-literal">-C</span> /<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">é»˜è®¤è§£å‹åä¼šæœ‰å¦‚ä¸‹ç›®å½•ï¼š<br>etc<br>opt<br>usr<br>ä¼šæŠŠå¯¹åº”çš„ç›®è§£å‹åˆ°/ä¸‹å¯¹åº”ç›®å½•ä¸­ï¼Œè¿™æ ·å°±çœå»å¤åˆ¶æ–‡ä»¶æ­¥éª¤ã€‚<br></code></pre></td></tr></table></figure><h5 id="2-5-9-1-3-ç”Ÿæˆé…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹"><a href="#2-5-9-1-3-ç”Ÿæˆé…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹" class="headerlink" title="2.5.9.1.3 ç”Ÿæˆé…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹"></a>2.5.9.1.3 ç”Ÿæˆé…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir /etc/containerd<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">containerd config default &gt;/etc/containerd/config.toml<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># ls /etc/containerd/</span><br>config.toml<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ä¸‹é¢çš„é…ç½®æ–‡ä»¶ä¸­å·²ä¿®æ”¹ï¼Œå¯ä¸æ‰§è¡Œï¼Œä»…ä¿®æ”¹é»˜è®¤æ—¶æ‰§è¡Œã€‚<br>sed <span class="hljs-literal">-i</span> <span class="hljs-string">&#x27;s@systemd_cgroup = false@systemd_cgroup = true@&#x27;</span> /etc/containerd/config.toml<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ä¸‹é¢çš„é…ç½®æ–‡ä»¶ä¸­å·²ä¿®æ”¹ï¼Œå¯ä¸æ‰§è¡Œï¼Œä»…ä¿®æ”¹é»˜è®¤æ—¶æ‰§è¡Œã€‚<br>sed <span class="hljs-literal">-i</span> <span class="hljs-string">&#x27;s@k8s.gcr.io/pause:3.6@registry.aliyuncs.com/google_containers/pause:3.6@&#x27;</span> /etc/containerd/config.toml<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># cat &gt;/etc/containerd/config.toml&lt;&lt;EOF</span><br>root = <span class="hljs-string">&quot;/var/lib/containerd&quot;</span><br>state = <span class="hljs-string">&quot;/run/containerd&quot;</span><br>oom_score = <span class="hljs-literal">-999</span><br><br>[<span class="hljs-type">grpc</span>]<br>  address = <span class="hljs-string">&quot;/run/containerd/containerd.sock&quot;</span><br>  uid = <span class="hljs-number">0</span><br>  gid = <span class="hljs-number">0</span><br>  max_recv_message_size = <span class="hljs-number">16777216</span><br>  max_send_message_size = <span class="hljs-number">16777216</span><br><br>[<span class="hljs-type">debug</span>]<br>  address = <span class="hljs-string">&quot;&quot;</span><br>  uid = <span class="hljs-number">0</span><br>  gid = <span class="hljs-number">0</span><br>  level = <span class="hljs-string">&quot;&quot;</span><br><br>[<span class="hljs-type">metrics</span>]<br>  address = <span class="hljs-string">&quot;&quot;</span><br>  grpc_histogram = false<br><br>[<span class="hljs-type">cgroup</span>]<br>  path = <span class="hljs-string">&quot;&quot;</span><br><br>[<span class="hljs-type">plugins</span>]<br>  [<span class="hljs-type">plugins.cgroups</span>]<br>    no_prometheus = false<br>  [<span class="hljs-type">plugins.cri</span>]<br>    stream_server_address = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    stream_server_port = <span class="hljs-string">&quot;0&quot;</span><br>    enable_selinux = false<br>    sandbox_image = <span class="hljs-string">&quot;registry.aliyuncs.com/google_containers/pause:3.6&quot;</span><br>    stats_collect_period = <span class="hljs-number">10</span><br>    systemd_cgroup = true<br>    enable_tls_streaming = false<br>    max_container_log_line_size = <span class="hljs-number">16384</span><br>    [<span class="hljs-type">plugins.cri.containerd</span>]<br>      snapshotter = <span class="hljs-string">&quot;overlayfs&quot;</span><br>      no_pivot = false<br>      [<span class="hljs-type">plugins.cri.containerd.default_runtime</span>]<br>        runtime_type = <span class="hljs-string">&quot;io.containerd.runtime.v1.linux&quot;</span><br>        runtime_engine = <span class="hljs-string">&quot;&quot;</span><br>        runtime_root = <span class="hljs-string">&quot;&quot;</span><br>      [<span class="hljs-type">plugins.cri.containerd.untrusted_workload_runtime</span>]<br>        runtime_type = <span class="hljs-string">&quot;&quot;</span><br>        runtime_engine = <span class="hljs-string">&quot;&quot;</span><br>        runtime_root = <span class="hljs-string">&quot;&quot;</span><br>    [<span class="hljs-type">plugins.cri.cni</span>]<br>      bin_dir = <span class="hljs-string">&quot;/opt/cni/bin&quot;</span><br>      conf_dir = <span class="hljs-string">&quot;/etc/cni/net.d&quot;</span><br>      conf_template = <span class="hljs-string">&quot;/etc/cni/net.d/10-default.conf&quot;</span><br>    [<span class="hljs-type">plugins.cri.registry</span>]<br>      [<span class="hljs-type">plugins.cri.registry.mirrors</span>]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;docker.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,<br>            <span class="hljs-string">&quot;http://hub-mirror.c.163.com&quot;</span><br>          ]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;gcr.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://gcr.mirrors.ustc.edu.cn&quot;</span><br>          ]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;k8s.gcr.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://gcr.mirrors.ustc.edu.cn/google-containers/&quot;</span><br>          ]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;quay.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://quay.mirrors.ustc.edu.cn&quot;</span><br>          ]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;harbor.kubemsb.com&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;http://harbor.kubemsb.com&quot;</span><br>          ]<br>    [<span class="hljs-type">plugins.cri.x509_key_pair_streaming</span>]<br>      tls_cert_file = <span class="hljs-string">&quot;&quot;</span><br>      tls_key_file = <span class="hljs-string">&quot;&quot;</span><br>  [<span class="hljs-type">plugins.diff</span>-<span class="hljs-type">service</span>]<br>    default = [<span class="hljs-string">&quot;walking&quot;</span>]<br>  [<span class="hljs-type">plugins.linux</span>]<br>    shim = <span class="hljs-string">&quot;containerd-shim&quot;</span><br>    runtime = <span class="hljs-string">&quot;runc&quot;</span><br>    runtime_root = <span class="hljs-string">&quot;&quot;</span><br>    no_shim = false<br>    shim_debug = false<br>  [<span class="hljs-type">plugins.opt</span>]<br>    path = <span class="hljs-string">&quot;/opt/containerd&quot;</span><br>  [<span class="hljs-type">plugins.restart</span>]<br>    interval = <span class="hljs-string">&quot;10s&quot;</span><br>  [<span class="hljs-type">plugins.scheduler</span>]<br>    pause_threshold = <span class="hljs-number">0.02</span><br>    deletion_threshold = <span class="hljs-number">0</span><br>    mutation_threshold = <span class="hljs-number">100</span><br>    schedule_delay = <span class="hljs-string">&quot;0s&quot;</span><br>    startup_delay = <span class="hljs-string">&quot;100ms&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><h5 id="2-5-9-1-4-å®‰è£…runc"><a href="#2-5-9-1-4-å®‰è£…runc" class="headerlink" title="2.5.9.1.4 å®‰è£…runc"></a>2.5.9.1.4 å®‰è£…runc</h5><blockquote><p>ç”±äºä¸Šè¿°è½¯ä»¶åŒ…ä¸­åŒ…å«çš„runcå¯¹ç³»ç»Ÿä¾èµ–è¿‡å¤šï¼Œæ‰€ä»¥å»ºè®®å•ç‹¬ä¸‹è½½å®‰è£…ã€‚</p><p>é»˜è®¤runcæ‰§è¡Œæ—¶æç¤ºï¼šrunc: symbol lookup error: runc: undefined symbol: seccomp_notify_respond</p></blockquote><p>![image-20220322003721996](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220322003721996.png)</p><p>![image-20220322003759560](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220322003759560.png)</p><p>![image-20220322003823362](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220322003823362.png)</p><p>![image-20220322003942106](Kubernetesé«˜å¯ç”¨é›†ç¾¤äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆRuntime Containerdï¼‰.assets&#x2F;image-20220322003942106.png)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://github.com/opencontainers/runc/releases/download/v1.<span class="hljs-number">1.0</span>/runc.amd64<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">chmod +x runc.amd64<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æ›¿æ¢æ‰åŸè½¯ä»¶åŒ…ä¸­çš„runc<br><br><span class="hljs-built_in">mv</span> runc.amd64 /usr/local/sbin/runc<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># runc -v</span><br>runc version <span class="hljs-number">1.1</span>.<span class="hljs-number">0</span><br>commit: v1.<span class="hljs-number">1.0</span><span class="hljs-literal">-0-g067aaf85</span><br>spec: <span class="hljs-number">1.0</span>.<span class="hljs-number">2</span><span class="hljs-literal">-dev</span><br>go: go1.<span class="hljs-number">17.6</span><br>libseccomp: <span class="hljs-number">2.5</span>.<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl enable containerd<br>systemctl <span class="hljs-built_in">start</span> containerd<br></code></pre></td></tr></table></figure><h4 id="2-5-9-2-éƒ¨ç½²kubelet"><a href="#2-5-9-2-éƒ¨ç½²kubelet" class="headerlink" title="2.5.9.2 éƒ¨ç½²kubelet"></a>2.5.9.2 éƒ¨ç½²kubelet</h4><blockquote><p>åœ¨k8s-master1ä¸Šæ“ä½œ</p></blockquote><h5 id="2-5-9-2-1-åˆ›å»ºkubelet-bootstrap-kubeconfig"><a href="#2-5-9-2-1-åˆ›å»ºkubelet-bootstrap-kubeconfig" class="headerlink" title="2.5.9.2.1 åˆ›å»ºkubelet-bootstrap.kubeconfig"></a>2.5.9.2.1 åˆ›å»ºkubelet-bootstrap.kubeconfig</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell">BOOTSTRAP_TOKEN=<span class="hljs-variable">$</span>(awk <span class="hljs-operator">-F</span> <span class="hljs-string">&quot;,&quot;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/kubernetes/token.csv)<br><br>kubectl config <span class="hljs-built_in">set-cluster</span> kubernetes <span class="hljs-literal">--certificate-authority</span>=ca.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--server</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span>:<span class="hljs-number">6443</span> <span class="hljs-literal">--kubeconfig</span>=kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-credentials</span> kubelet<span class="hljs-literal">-bootstrap</span> <span class="hljs-literal">--token</span>=<span class="hljs-variable">$</span>&#123;BOOTSTRAP_TOKEN&#125; <span class="hljs-literal">--kubeconfig</span>=kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-context</span> default <span class="hljs-literal">--cluster</span>=kubernetes <span class="hljs-literal">--user</span>=kubelet<span class="hljs-literal">-bootstrap</span> <span class="hljs-literal">--kubeconfig</span>=kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">use-context</span> default <span class="hljs-literal">--kubeconfig</span>=kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl create clusterrolebinding cluster<span class="hljs-literal">-system-anonymous</span> <span class="hljs-literal">--clusterrole</span>=cluster<span class="hljs-literal">-admin</span> <span class="hljs-literal">--user</span>=kubelet<span class="hljs-literal">-bootstrap</span><br><br>kubectl create clusterrolebinding kubelet<span class="hljs-literal">-bootstrap</span> <span class="hljs-literal">--clusterrole</span>=system:node<span class="hljs-literal">-bootstrapper</span> <span class="hljs-literal">--user</span>=kubelet<span class="hljs-literal">-bootstrap</span> <span class="hljs-literal">--kubeconfig</span>=kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl describe clusterrolebinding cluster<span class="hljs-literal">-system-anonymous</span><br><br>kubectl describe clusterrolebinding kubelet<span class="hljs-literal">-bootstrap</span><br></code></pre></td></tr></table></figure><h5 id="2-5-9-2-2-åˆ›å»ºkubeleté…ç½®æ–‡ä»¶"><a href="#2-5-9-2-2-åˆ›å»ºkubeleté…ç½®æ–‡ä»¶" class="headerlink" title="2.5.9.2.2 åˆ›å»ºkubeleté…ç½®æ–‡ä»¶"></a>2.5.9.2.2 åˆ›å»ºkubeleté…ç½®æ–‡ä»¶</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kubelet.json &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>  <span class="hljs-string">&quot;kind&quot;</span>: <span class="hljs-string">&quot;KubeletConfiguration&quot;</span>,<br>  <span class="hljs-string">&quot;apiVersion&quot;</span>: <span class="hljs-string">&quot;kubelet.config.k8s.io/v1beta1&quot;</span>,<br>  <span class="hljs-string">&quot;authentication&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;x509&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;clientCAFile&quot;</span>: <span class="hljs-string">&quot;/etc/kubernetes/ssl/ca.pem&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;webhook&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;enabled&quot;</span>: true,<br>      <span class="hljs-string">&quot;cacheTTL&quot;</span>: <span class="hljs-string">&quot;2m0s&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;anonymous&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;enabled&quot;</span>: false<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;authorization&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;Webhook&quot;</span>,<br>    <span class="hljs-string">&quot;webhook&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;cacheAuthorizedTTL&quot;</span>: <span class="hljs-string">&quot;5m0s&quot;</span>,<br>      <span class="hljs-string">&quot;cacheUnauthorizedTTL&quot;</span>: <span class="hljs-string">&quot;30s&quot;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">&quot;192.168.10.12&quot;</span>,<br>  <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-number">10250</span>,<br>  <span class="hljs-string">&quot;readOnlyPort&quot;</span>: <span class="hljs-number">10255</span>,<br>  <span class="hljs-string">&quot;cgroupDriver&quot;</span>: <span class="hljs-string">&quot;systemd&quot;</span>,                    <br>  <span class="hljs-string">&quot;hairpinMode&quot;</span>: <span class="hljs-string">&quot;promiscuous-bridge&quot;</span>,<br>  <span class="hljs-string">&quot;serializeImagePulls&quot;</span>: false,<br>  <span class="hljs-string">&quot;clusterDomain&quot;</span>: <span class="hljs-string">&quot;cluster.local.&quot;</span>,<br>  <span class="hljs-string">&quot;clusterDNS&quot;</span>: [<span class="hljs-string">&quot;10.96.0.2&quot;</span>]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h5 id="2-5-9-2-3-åˆ›å»ºkubeletæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶"><a href="#2-5-9-2-3-åˆ›å»ºkubeletæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶" class="headerlink" title="2.5.9.2.3 åˆ›å»ºkubeletæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶"></a>2.5.9.2.3 åˆ›å»ºkubeletæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kubelet.service &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>[<span class="hljs-type">Unit</span>]<br>Description=Kubernetes Kubelet<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=docker.service<br>Requires=docker.service<br><br>[<span class="hljs-type">Service</span>]<br>WorkingDirectory=/var/lib/kubelet<br>ExecStart=/usr/local/bin/kubelet \<br>  <span class="hljs-literal">--bootstrap-kubeconfig</span>=/etc/kubernetes/kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig \<br>  <span class="hljs-literal">--cert-dir</span>=/etc/kubernetes/ssl \<br>  <span class="hljs-literal">--kubeconfig</span>=/etc/kubernetes/kubelet.kubeconfig \<br>  <span class="hljs-literal">--config</span>=/etc/kubernetes/kubelet.json \<br>  <span class="hljs-literal">--cni-bin-dir</span>=/opt/cni/bin \<br>  <span class="hljs-literal">--cni-conf-dir</span>=/etc/cni/net.d \<br>  <span class="hljs-literal">--container-runtime</span>=remote \<br>  <span class="hljs-literal">--container-runtime-endpoint</span>=unix:///run/containerd/containerd.sock \<br>  <span class="hljs-literal">--network-plugin</span>=cni \<br>  <span class="hljs-literal">--rotate-certificates</span> \<br>  <span class="hljs-literal">--pod-infra-container-image</span>=registry.aliyuncs.com/google_containers/pause:<span class="hljs-number">3.2</span> \<br>  <span class="hljs-literal">--root-dir</span>=/etc/cni/net.d \<br>  <span class="hljs-literal">--alsologtostderr</span>=true \<br>  <span class="hljs-literal">--logtostderr</span>=false \<br>  <span class="hljs-literal">--log-dir</span>=/var/log/kubernetes \<br>  <span class="hljs-literal">--v</span>=<span class="hljs-number">2</span><br>Restart=on<span class="hljs-literal">-failure</span><br>RestartSec=<span class="hljs-number">5</span><br><br>[<span class="hljs-type">Install</span>]<br>WantedBy=multi<span class="hljs-literal">-user</span>.target<br>EOF<br></code></pre></td></tr></table></figure><h5 id="2-5-9-2-4-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤èŠ‚ç‚¹"><a href="#2-5-9-2-4-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="2.5.9.2.4 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤èŠ‚ç‚¹"></a>2.5.9.2.4 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤èŠ‚ç‚¹</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig /etc/kubernetes/<br><span class="hljs-built_in">cp</span> kubelet.json /etc/kubernetes/<br><span class="hljs-built_in">cp</span> kubelet.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span>  k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> k8s<span class="hljs-literal">-worker1</span>;<span class="hljs-keyword">do</span> scp kubelet<span class="hljs-literal">-bootstrap</span>.kubeconfig kubelet.json <span class="hljs-variable">$i:</span>/etc/kubernetes/;done<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span>  k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> k8s<span class="hljs-literal">-worker1</span>;<span class="hljs-keyword">do</span> scp ca.pem <span class="hljs-variable">$i:</span>/etc/kubernetes/ssl/;done<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> k8s<span class="hljs-literal">-worker1</span>;<span class="hljs-keyword">do</span> scp kubelet.service <span class="hljs-variable">$i:</span>/usr/lib/systemd/system/;done<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br>kubelet.jsonä¸­addresséœ€è¦ä¿®æ”¹ä¸ºå½“å‰ä¸»æœºIPåœ°å€ã€‚<br></code></pre></td></tr></table></figure><h5 id="2-5-9-2-5-åˆ›å»ºç›®å½•åŠå¯åŠ¨æœåŠ¡"><a href="#2-5-9-2-5-åˆ›å»ºç›®å½•åŠå¯åŠ¨æœåŠ¡" class="headerlink" title="2.5.9.2.5 åˆ›å»ºç›®å½•åŠå¯åŠ¨æœåŠ¡"></a>2.5.9.2.5 åˆ›å»ºç›®å½•åŠå¯åŠ¨æœåŠ¡</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir <span class="hljs-literal">-p</span> /var/lib/kubelet<br>mkdir <span class="hljs-literal">-p</span> /var/log/kubernetes<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl daemon<span class="hljs-literal">-reload</span><br>systemctl enable <span class="hljs-literal">--now</span> kubelet<br><br>systemctl status kubelet<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get nodes</span><br>NAME          STATUS     ROLES    AGE     VERSION<br>k8s<span class="hljs-literal">-master1</span>   NotReady   &lt;none&gt;   <span class="hljs-number">2</span>m55s   v1.<span class="hljs-number">21.10</span><br>k8s<span class="hljs-literal">-master2</span>   NotReady   &lt;none&gt;   <span class="hljs-number">45</span>s     v1.<span class="hljs-number">21.10</span><br>k8s<span class="hljs-literal">-master3</span>   NotReady   &lt;none&gt;   <span class="hljs-number">39</span>s     v1.<span class="hljs-number">21.10</span><br>k8s<span class="hljs-literal">-worker1</span>   NotReady   &lt;none&gt;   <span class="hljs-number">5</span>m1s    v1.<span class="hljs-number">21.10</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get csr</span><br>NAME        AGE     SIGNERNAME                                    REQUESTOR           CONDITION<br>csr<span class="hljs-literal">-b949p</span>   <span class="hljs-number">7</span>m55s   kubernetes.io/kube<span class="hljs-literal">-apiserver-client-kubelet</span>   kubelet<span class="hljs-literal">-bootstrap</span>   Approved,Issued<br>csr<span class="hljs-literal">-c9hs4</span>   <span class="hljs-number">3</span>m34s   kubernetes.io/kube<span class="hljs-literal">-apiserver-client-kubelet</span>   kubelet<span class="hljs-literal">-bootstrap</span>   Approved,Issued<br>csr<span class="hljs-literal">-r8vhp</span>   <span class="hljs-number">5</span>m50s   kubernetes.io/kube<span class="hljs-literal">-apiserver-client-kubelet</span>   kubelet<span class="hljs-literal">-bootstrap</span>   Approved,Issued<br>csr<span class="hljs-literal">-zb4sr</span>   <span class="hljs-number">3</span>m40s   kubernetes.io/kube<span class="hljs-literal">-apiserver-client-kubelet</span>   kubelet<span class="hljs-literal">-bootstrap</span>   Approved,Issued<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br>ç¡®è®¤kubeletæœåŠ¡å¯åŠ¨æˆåŠŸåï¼Œæ¥ç€åˆ°masterä¸ŠApproveä¸€ä¸‹bootstrapè¯·æ±‚ã€‚<br></code></pre></td></tr></table></figure><h4 id="2-5-9-3-éƒ¨ç½²kube-proxy"><a href="#2-5-9-3-éƒ¨ç½²kube-proxy" class="headerlink" title="2.5.9.3 éƒ¨ç½²kube-proxy"></a>2.5.9.3 éƒ¨ç½²kube-proxy</h4><h5 id="2-5-9-3-1-åˆ›å»ºkube-proxyè¯ä¹¦è¯·æ±‚æ–‡ä»¶"><a href="#2-5-9-3-1-åˆ›å»ºkube-proxyè¯ä¹¦è¯·æ±‚æ–‡ä»¶" class="headerlink" title="2.5.9.3.1 åˆ›å»ºkube-proxyè¯ä¹¦è¯·æ±‚æ–‡ä»¶"></a>2.5.9.3.1 åˆ›å»ºkube-proxyè¯ä¹¦è¯·æ±‚æ–‡ä»¶</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-proxy-csr</span>.json &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>&#123;<br>  <span class="hljs-string">&quot;CN&quot;</span>: <span class="hljs-string">&quot;system:kube-proxy&quot;</span>,<br>  <span class="hljs-string">&quot;key&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;algo&quot;</span>: <span class="hljs-string">&quot;rsa&quot;</span>,<br>    <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">2048</span><br>  &#125;,<br>  <span class="hljs-string">&quot;names&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;C&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span>,<br>      <span class="hljs-string">&quot;ST&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;L&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>      <span class="hljs-string">&quot;O&quot;</span>: <span class="hljs-string">&quot;kubemsb&quot;</span>,<br>      <span class="hljs-string">&quot;OU&quot;</span>: <span class="hljs-string">&quot;CN&quot;</span><br>    &#125;<br>  ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h5 id="2-5-9-3-2-ç”Ÿæˆè¯ä¹¦"><a href="#2-5-9-3-2-ç”Ÿæˆè¯ä¹¦" class="headerlink" title="2.5.9.3.2 ç”Ÿæˆè¯ä¹¦"></a>2.5.9.3.2 ç”Ÿæˆè¯ä¹¦</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cfssl gencert <span class="hljs-literal">-ca</span>=ca.pem <span class="hljs-literal">-ca-key</span>=ca<span class="hljs-literal">-key</span>.pem <span class="hljs-literal">-config</span>=ca<span class="hljs-literal">-config</span>.json <span class="hljs-literal">-profile</span>=kubernetes kube<span class="hljs-literal">-proxy-csr</span>.json | cfssljson <span class="hljs-literal">-bare</span> kube<span class="hljs-literal">-proxy</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># ls kube-proxy*</span><br>kube<span class="hljs-literal">-proxy</span>.csr  kube<span class="hljs-literal">-proxy-csr</span>.json  kube<span class="hljs-literal">-proxy-key</span>.pem  kube<span class="hljs-literal">-proxy</span>.pem<br></code></pre></td></tr></table></figure><h5 id="2-5-9-3-3-åˆ›å»ºkubeconfigæ–‡ä»¶"><a href="#2-5-9-3-3-åˆ›å»ºkubeconfigæ–‡ä»¶" class="headerlink" title="2.5.9.3.3 åˆ›å»ºkubeconfigæ–‡ä»¶"></a>2.5.9.3.3 åˆ›å»ºkubeconfigæ–‡ä»¶</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl config <span class="hljs-built_in">set-cluster</span> kubernetes <span class="hljs-literal">--certificate-authority</span>=ca.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--server</span>=https://<span class="hljs-number">192.168</span>.<span class="hljs-number">10.100</span>:<span class="hljs-number">6443</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-proxy</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-credentials</span> kube<span class="hljs-literal">-proxy</span> <span class="hljs-literal">--client-certificate</span>=kube<span class="hljs-literal">-proxy</span>.pem <span class="hljs-literal">--client-key</span>=kube<span class="hljs-literal">-proxy-key</span>.pem <span class="hljs-literal">--embed-certs</span>=true <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-proxy</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">set-context</span> default <span class="hljs-literal">--cluster</span>=kubernetes <span class="hljs-literal">--user</span>=kube<span class="hljs-literal">-proxy</span> <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-proxy</span>.kubeconfig<br><br>kubectl config <span class="hljs-built_in">use-context</span> default <span class="hljs-literal">--kubeconfig</span>=kube<span class="hljs-literal">-proxy</span>.kubeconfig<br></code></pre></td></tr></table></figure><h5 id="2-5-9-3-4-åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶"><a href="#2-5-9-3-4-åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="2.5.9.3.4 åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶"></a>2.5.9.3.4 åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt; kube<span class="hljs-literal">-proxy</span>.yaml &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>apiVersion: kubeproxy.config.k8s.io/v1alpha1<br>bindAddress: <span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span><br>clientConnection:<br>  kubeconfig: /etc/kubernetes/kube<span class="hljs-literal">-proxy</span>.kubeconfig<br>clusterCIDR: <span class="hljs-number">10.244</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span><br>healthzBindAddress: <span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">10256</span><br>kind: KubeProxyConfiguration<br>metricsBindAddress: <span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span>:<span class="hljs-number">10249</span><br>mode: <span class="hljs-string">&quot;ipvs&quot;</span><br>EOF<br></code></pre></td></tr></table></figure><h5 id="2-5-9-3-5-åˆ›å»ºæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶"><a href="#2-5-9-3-5-åˆ›å»ºæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶" class="headerlink" title="2.5.9.3.5 åˆ›å»ºæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶"></a>2.5.9.3.5 åˆ›å»ºæœåŠ¡å¯åŠ¨ç®¡ç†æ–‡ä»¶</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt;  kube<span class="hljs-literal">-proxy</span>.service &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>[<span class="hljs-type">Unit</span>]<br>Description=Kubernetes Kube<span class="hljs-literal">-Proxy</span> Server<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=network.target<br><br>[<span class="hljs-type">Service</span>]<br>WorkingDirectory=/var/lib/kube<span class="hljs-literal">-proxy</span><br>ExecStart=/usr/local/bin/kube<span class="hljs-literal">-proxy</span> \<br>  <span class="hljs-literal">--config</span>=/etc/kubernetes/kube<span class="hljs-literal">-proxy</span>.yaml \<br>  <span class="hljs-literal">--alsologtostderr</span>=true \<br>  <span class="hljs-literal">--logtostderr</span>=false \<br>  <span class="hljs-literal">--log-dir</span>=/var/log/kubernetes \<br>  <span class="hljs-literal">--v</span>=<span class="hljs-number">2</span><br>Restart=on<span class="hljs-literal">-failure</span><br>RestartSec=<span class="hljs-number">5</span><br>LimitNOFILE=<span class="hljs-number">65536</span><br><br>[<span class="hljs-type">Install</span>]<br>WantedBy=multi<span class="hljs-literal">-user</span>.target<br>EOF<br></code></pre></td></tr></table></figure><h5 id="2-5-9-3-6-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤å·¥ä½œèŠ‚ç‚¹ä¸»æœº"><a href="#2-5-9-3-6-åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤å·¥ä½œèŠ‚ç‚¹ä¸»æœº" class="headerlink" title="2.5.9.3.6 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤å·¥ä½œèŠ‚ç‚¹ä¸»æœº"></a>2.5.9.3.6 åŒæ­¥æ–‡ä»¶åˆ°é›†ç¾¤å·¥ä½œèŠ‚ç‚¹ä¸»æœº</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-proxy</span>*.pem /etc/kubernetes/ssl/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-proxy</span>.kubeconfig kube<span class="hljs-literal">-proxy</span>.yaml /etc/kubernetes/<br><span class="hljs-built_in">cp</span> kube<span class="hljs-literal">-proxy</span>.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> k8s<span class="hljs-literal">-worker1</span>;<span class="hljs-keyword">do</span> scp kube<span class="hljs-literal">-proxy</span>.kubeconfig kube<span class="hljs-literal">-proxy</span>.yaml <span class="hljs-variable">$i:</span>/etc/kubernetes/;done<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> k8s<span class="hljs-literal">-master2</span> k8s<span class="hljs-literal">-master3</span> k8s<span class="hljs-literal">-worker1</span>;<span class="hljs-keyword">do</span> scp  kube<span class="hljs-literal">-proxy</span>.service <span class="hljs-variable">$i:</span>/usr/lib/systemd/system/;done<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¯´æ˜ï¼š<br>ä¿®æ”¹kube<span class="hljs-literal">-proxy</span>.yamlä¸­IPåœ°å€ä¸ºå½“å‰ä¸»æœºIP.<br></code></pre></td></tr></table></figure><h5 id="2-5-9-3-7-æœåŠ¡å¯åŠ¨"><a href="#2-5-9-3-7-æœåŠ¡å¯åŠ¨" class="headerlink" title="2.5.9.3.7 æœåŠ¡å¯åŠ¨"></a>2.5.9.3.7 æœåŠ¡å¯åŠ¨</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mkdir <span class="hljs-literal">-p</span> /var/lib/kube<span class="hljs-literal">-proxy</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systemctl daemon<span class="hljs-literal">-reload</span><br>systemctl enable <span class="hljs-literal">--now</span> kube<span class="hljs-literal">-proxy</span><br><br>systemctl status kube<span class="hljs-literal">-proxy</span><br></code></pre></td></tr></table></figure><h3 id="2-5-10-ç½‘ç»œç»„ä»¶éƒ¨ç½²-Calico"><a href="#2-5-10-ç½‘ç»œç»„ä»¶éƒ¨ç½²-Calico" class="headerlink" title="2.5.10 ç½‘ç»œç»„ä»¶éƒ¨ç½² Calico"></a>2.5.10 ç½‘ç»œç»„ä»¶éƒ¨ç½² Calico</h3><h4 id="2-5-10-1-ä¸‹è½½"><a href="#2-5-10-1-ä¸‹è½½" class="headerlink" title="2.5.10.1 ä¸‹è½½"></a>2.5.10.1 ä¸‹è½½</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://docs.projectcalico.org/v3.<span class="hljs-number">19</span>/manifests/calico.yaml<br></code></pre></td></tr></table></figure><h4 id="2-5-10-2-ä¿®æ”¹æ–‡ä»¶"><a href="#2-5-10-2-ä¿®æ”¹æ–‡ä»¶" class="headerlink" title="2.5.10.2 ä¿®æ”¹æ–‡ä»¶"></a>2.5.10.2 ä¿®æ”¹æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-number">3683</span>             - name: CALICO_IPV4POOL_CIDR<br><span class="hljs-number">3684</span>               value: <span class="hljs-string">&quot;10.244.0.0/16&quot;</span><br></code></pre></td></tr></table></figure><h4 id="2-5-10-3-åº”ç”¨æ–‡ä»¶"><a href="#2-5-10-3-åº”ç”¨æ–‡ä»¶" class="headerlink" title="2.5.10.3 åº”ç”¨æ–‡ä»¶"></a>2.5.10.3 åº”ç”¨æ–‡ä»¶</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl apply <span class="hljs-operator">-f</span> calico.yaml<br></code></pre></td></tr></table></figure><h4 id="2-5-10-4-éªŒè¯åº”ç”¨ç»“æœ"><a href="#2-5-10-4-éªŒè¯åº”ç”¨ç»“æœ" class="headerlink" title="2.5.10.4 éªŒè¯åº”ç”¨ç»“æœ"></a>2.5.10.4 éªŒè¯åº”ç”¨ç»“æœ</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get pods -A</span><br>NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-kube-controllers-7cc8dd57d9-tf2m5</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">72</span>s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-llw5w</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">72</span>s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-mhh6g</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">72</span>s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-twj99</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">72</span>s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-zh6xl</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">72</span>s<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get nodes</span><br>NAME          STATUS   ROLES    AGE   VERSION<br>k8s<span class="hljs-literal">-master1</span>   Ready    &lt;none&gt;   <span class="hljs-number">55</span>m   v1.<span class="hljs-number">21.10</span><br>k8s<span class="hljs-literal">-master2</span>   Ready    &lt;none&gt;   <span class="hljs-number">53</span>m   v1.<span class="hljs-number">21.10</span><br>k8s<span class="hljs-literal">-master3</span>   Ready    &lt;none&gt;   <span class="hljs-number">53</span>m   v1.<span class="hljs-number">21.10</span><br>k8s<span class="hljs-literal">-worker1</span>   Ready    &lt;none&gt;   <span class="hljs-number">57</span>m   v1.<span class="hljs-number">21.10</span><br></code></pre></td></tr></table></figure><h3 id="2-5-10-éƒ¨ç½²CoreDNS"><a href="#2-5-10-éƒ¨ç½²CoreDNS" class="headerlink" title="2.5.10 éƒ¨ç½²CoreDNS"></a>2.5.10 éƒ¨ç½²CoreDNS</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt;  coredns.yaml &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: coredns<br>  namespace: kube<span class="hljs-literal">-system</span><br><span class="hljs-literal">---</span><br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRole<br>metadata:<br>  labels:<br>    kubernetes.io/bootstrapping: rbac<span class="hljs-literal">-defaults</span><br>  name: system:coredns<br>rules:<br>  - apiGroups:<br>    - <span class="hljs-string">&quot;&quot;</span><br>    resources:<br>    - endpoints<br>    - services<br>    - pods<br>    - namespaces<br>    verbs:<br>    - list<br>    - watch<br>  - apiGroups:<br>    - discovery.k8s.io<br>    resources:<br>    - endpointslices<br>    verbs:<br>    - list<br>    - watch<br><span class="hljs-literal">---</span><br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  annotations:<br>    rbac.authorization.kubernetes.io/autoupdate: <span class="hljs-string">&quot;true&quot;</span><br>  labels:<br>    kubernetes.io/bootstrapping: rbac<span class="hljs-literal">-defaults</span><br>  name: system:coredns<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: system:coredns<br>subjects:<br>- kind: ServiceAccount<br>  name: coredns<br>  namespace: kube<span class="hljs-literal">-system</span><br><span class="hljs-literal">---</span><br>apiVersion: v1<br>kind: ConfigMap<br>metadata:<br>  name: coredns<br>  namespace: kube<span class="hljs-literal">-system</span><br><span class="hljs-keyword">data</span>:<br>  Corefile: |<br>    .:<span class="hljs-number">53</span> &#123;<br>        errors<br>        health &#123;<br>          lameduck <span class="hljs-number">5</span>s<br>        &#125;<br>        ready<br>        kubernetes cluster.local  <span class="hljs-keyword">in</span><span class="hljs-literal">-addr</span>.arpa ip6.arpa &#123;<br>          fallthrough <span class="hljs-keyword">in</span><span class="hljs-literal">-addr</span>.arpa ip6.arpa<br>        &#125;<br>        prometheus :<span class="hljs-number">9153</span><br>        forward . /etc/resolv.conf &#123;<br>          max_concurrent <span class="hljs-number">1000</span><br>        &#125;<br>        cache <span class="hljs-number">30</span><br>        loop<br>        reload<br>        loadbalance<br>    &#125;<br><span class="hljs-literal">---</span><br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: coredns<br>  namespace: kube<span class="hljs-literal">-system</span><br>  labels:<br>    k8s<span class="hljs-literal">-app</span>: kube<span class="hljs-literal">-dns</span><br>    kubernetes.io/name: <span class="hljs-string">&quot;CoreDNS&quot;</span><br>spec:<br>  <span class="hljs-comment"># replicas: not specified here:</span><br>  <span class="hljs-comment"># 1. Default is 1.</span><br>  <span class="hljs-comment"># 2. Will be tuned in real time if DNS horizontal auto-scaling is turned on.</span><br>  strategy:<br>    <span class="hljs-built_in">type</span>: RollingUpdate<br>    rollingUpdate:<br>      maxUnavailable: <span class="hljs-number">1</span><br>  selector:<br>    matchLabels:<br>      k8s<span class="hljs-literal">-app</span>: kube<span class="hljs-literal">-dns</span><br>  template:<br>    metadata:<br>      labels:<br>        k8s<span class="hljs-literal">-app</span>: kube<span class="hljs-literal">-dns</span><br>    spec:<br>      priorityClassName: system<span class="hljs-literal">-cluster-critical</span><br>      serviceAccountName: coredns<br>      tolerations:<br>        - key: <span class="hljs-string">&quot;CriticalAddonsOnly&quot;</span><br>          operator: <span class="hljs-string">&quot;Exists&quot;</span><br>      nodeSelector:<br>        kubernetes.io/os: linux<br>      affinity:<br>         podAntiAffinity:<br>           preferredDuringSchedulingIgnoredDuringExecution:<br>           - weight: <span class="hljs-number">100</span><br>             podAffinityTerm:<br>               labelSelector:<br>                 matchExpressions:<br>                   - key: k8s<span class="hljs-literal">-app</span><br>                     operator: <span class="hljs-keyword">In</span><br>                     values: [<span class="hljs-string">&quot;kube-dns&quot;</span>]<br>               topologyKey: kubernetes.io/hostname<br>      containers:<br>      - name: coredns<br>        image: coredns/coredns:<span class="hljs-number">1.8</span>.<span class="hljs-number">4</span><br>        imagePullPolicy: IfNotPresent<br>        resources:<br>          limits:<br>            memory: <span class="hljs-number">170</span><span class="hljs-built_in">Mi</span><br>          requests:<br>            cpu: <span class="hljs-number">100</span>m<br>            memory: <span class="hljs-number">70</span><span class="hljs-built_in">Mi</span><br>        args: [ <span class="hljs-string">&quot;-conf&quot;</span>, <span class="hljs-string">&quot;/etc/coredns/Corefile&quot;</span> ]<br>        volumeMounts:<br>        - name: config<span class="hljs-literal">-volume</span><br>          mountPath: /etc/coredns<br>          readOnly: true<br>        ports:<br>        - containerPort: <span class="hljs-number">53</span><br>          name: dns<br>          protocol: UDP<br>        - containerPort: <span class="hljs-number">53</span><br>          name: dns<span class="hljs-literal">-tcp</span><br>          protocol: TCP<br>        - containerPort: <span class="hljs-number">9153</span><br>          name: metrics<br>          protocol: TCP<br>        securityContext:<br>          allowPrivilegeEscalation: false<br>          capabilities:<br>            add:<br>            - NET_BIND_SERVICE<br>            drop:<br>            - all<br>          readOnlyRootFilesystem: true<br>        livenessProbe:<br>          httpGet:<br>            path: /health<br>            port: <span class="hljs-number">8080</span><br>            scheme: HTTP<br>          initialDelaySeconds: <span class="hljs-number">60</span><br>          timeoutSeconds: <span class="hljs-number">5</span><br>          successThreshold: <span class="hljs-number">1</span><br>          failureThreshold: <span class="hljs-number">5</span><br>        readinessProbe:<br>          httpGet:<br>            path: /ready<br>            port: <span class="hljs-number">8181</span><br>            scheme: HTTP<br>      dnsPolicy: Default<br>      volumes:<br>        - name: config<span class="hljs-literal">-volume</span><br>          configMap:<br>            name: coredns<br>            items:<br>            - key: Corefile<br>              path: Corefile<br><span class="hljs-literal">---</span><br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: kube<span class="hljs-literal">-dns</span><br>  namespace: kube<span class="hljs-literal">-system</span><br>  annotations:<br>    prometheus.io/port: <span class="hljs-string">&quot;9153&quot;</span><br>    prometheus.io/scrape: <span class="hljs-string">&quot;true&quot;</span><br>  labels:<br>    k8s<span class="hljs-literal">-app</span>: kube<span class="hljs-literal">-dns</span><br>    kubernetes.io/cluster<span class="hljs-literal">-service</span>: <span class="hljs-string">&quot;true&quot;</span><br>    kubernetes.io/name: <span class="hljs-string">&quot;CoreDNS&quot;</span><br>spec:<br>  selector:<br>    k8s<span class="hljs-literal">-app</span>: kube<span class="hljs-literal">-dns</span><br>  clusterIP: <span class="hljs-number">10.96</span>.<span class="hljs-number">0.2</span><br>  ports:<br>  - name: dns<br>    port: <span class="hljs-number">53</span><br>    protocol: UDP<br>  - name: dns<span class="hljs-literal">-tcp</span><br>    port: <span class="hljs-number">53</span><br>    protocol: TCP<br>  - name: metrics<br>    port: <span class="hljs-number">9153</span><br>    protocol: TCP<br> <br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl apply <span class="hljs-operator">-f</span> coredns.yaml<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get pods -A</span><br>NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-kube-controllers-7cc8dd57d9-tf2m5</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m7s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-llw5w</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m7s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-mhh6g</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m7s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-twj99</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m7s<br>kube<span class="hljs-literal">-system</span>   calico<span class="hljs-literal">-node-zh6xl</span>                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">4</span>m7s<br>kube<span class="hljs-literal">-system</span>   coredns<span class="hljs-literal">-675db8b7cc-ncnf6</span>                   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">26</span>s<br></code></pre></td></tr></table></figure><h3 id="2-5-11-éƒ¨ç½²åº”ç”¨éªŒè¯"><a href="#2-5-11-éƒ¨ç½²åº”ç”¨éªŒè¯" class="headerlink" title="2.5.11 éƒ¨ç½²åº”ç”¨éªŒè¯"></a>2.5.11 éƒ¨ç½²åº”ç”¨éªŒè¯</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> &gt;  nginx.yaml  &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-literal">---</span><br>apiVersion: v1<br>kind: ReplicationController<br>metadata:<br>  name: nginx<span class="hljs-literal">-web</span><br>spec:<br>  replicas: <span class="hljs-number">2</span><br>  selector:<br>    name: nginx<br>  template:<br>    metadata:<br>      labels:<br>        name: nginx<br>    spec:<br>      containers:<br>        - name: nginx<br>          image: nginx:<span class="hljs-number">1.19</span>.<span class="hljs-number">6</span><br>          ports:<br>            - containerPort: <span class="hljs-number">80</span><br><span class="hljs-literal">---</span><br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: nginx<span class="hljs-literal">-service-nodeport</span><br>spec:<br>  ports:<br>    - port: <span class="hljs-number">80</span><br>      targetPort: <span class="hljs-number">80</span><br>      nodePort: <span class="hljs-number">30001</span><br>      protocol: TCP<br>  <span class="hljs-built_in">type</span>: NodePort<br>  selector:<br>    name: nginx<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl apply <span class="hljs-operator">-f</span> nginx.yaml<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get pods -o wide</span><br>NAME                     READY   STATUS    RESTARTS   AGE   IP              NODE          NOMINATED NODE   READINESS GATES<br>nginx<span class="hljs-literal">-web-qzvw4</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">58</span>s   <span class="hljs-number">10.244</span>.<span class="hljs-number">194.65</span>   k8s<span class="hljs-literal">-worker1</span>   &lt;none&gt;           &lt;none&gt;<br>nginx<span class="hljs-literal">-web-spw5t</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">58</span>s   <span class="hljs-number">10.244</span>.<span class="hljs-number">224.1</span>    k8s<span class="hljs-literal">-master2</span>   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get all</span><br>NAME                         READY   STATUS    RESTARTS   AGE<br>pod/nginx<span class="hljs-literal">-web-qzvw4</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m2s<br>pod/nginx<span class="hljs-literal">-web-spw5t</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m2s<br><br>NAME                                     DESIRED   CURRENT   READY   AGE<br>replicationcontroller/nginx<span class="hljs-literal">-web</span>   <span class="hljs-number">2</span>         <span class="hljs-number">2</span>         <span class="hljs-number">2</span>       <span class="hljs-number">2</span>m2s<br><br>NAME                             <span class="hljs-built_in">TYPE</span>        CLUSTER<span class="hljs-literal">-IP</span>      EXTERNAL<span class="hljs-literal">-IP</span>   PORT(S)        AGE<br>service/kubernetes               ClusterIP   <span class="hljs-number">10.96</span>.<span class="hljs-number">0.1</span>       &lt;none&gt;        <span class="hljs-number">443</span>/TCP        <span class="hljs-number">3</span>h37m<br>service/nginx<span class="hljs-literal">-service-nodeport</span>   NodePort    <span class="hljs-number">10.96</span>.<span class="hljs-number">165.114</span>   &lt;none&gt;        <span class="hljs-number">80</span>:<span class="hljs-number">30001</span>/TCP   <span class="hljs-number">2</span>m2s<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>consul1.21å®‰è£…</title>
    <link href="/2025/05/14/consul-1-21%E5%8D%95%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85/"/>
    <url>/2025/05/14/consul-1-21%E5%8D%95%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># Consul 1.21.0 å•èŠ‚ç‚¹å®‰è£…ç¬”è®°</span><br><br><span class="hljs-comment">## ä¸€ã€ç¯å¢ƒå‡†å¤‡</span><br>- **æ“ä½œç³»ç»Ÿ**ï¼šCentOS <span class="hljs-number">7</span>/<span class="hljs-number">8</span> æˆ– Ubuntu <span class="hljs-number">20.04</span> LTS<br>- **ä¾èµ–é¡¹**ï¼š<br>  ```bash<br>  sudo yum install <span class="hljs-literal">-y</span> <span class="hljs-built_in">wget</span> unzip <span class="hljs-built_in">curl</span>    <span class="hljs-comment"># CentOS</span><br>  sudo apt install <span class="hljs-literal">-y</span> <span class="hljs-built_in">wget</span> unzip <span class="hljs-built_in">curl</span>    <span class="hljs-comment"># Ubuntu</span><br></code></pre></td></tr></table></figure><h2 id="äºŒã€å®‰è£…æ­¥éª¤"><a href="#äºŒã€å®‰è£…æ­¥éª¤" class="headerlink" title="äºŒã€å®‰è£…æ­¥éª¤"></a>äºŒã€å®‰è£…æ­¥éª¤</h2><h3 id="1-ä¸‹è½½å¹¶å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#1-ä¸‹è½½å¹¶å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="1. ä¸‹è½½å¹¶å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶"></a>1. ä¸‹è½½å¹¶å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://releases.hashicorp.com/consul/1.21.0/consul_1.21.0_linux_amd64.zip<br>unzip consul_1.21.0_linux_amd64.zip<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> consul /usr/local/bin/<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> +x /usr/local/bin/consul<br></code></pre></td></tr></table></figure><h3 id="2-åˆ›å»ºç³»ç»Ÿç”¨æˆ·å’Œç›®å½•"><a href="#2-åˆ›å»ºç³»ç»Ÿç”¨æˆ·å’Œç›®å½•" class="headerlink" title="2. åˆ›å»ºç³»ç»Ÿç”¨æˆ·å’Œç›®å½•"></a>2. åˆ›å»ºç³»ç»Ÿç”¨æˆ·å’Œç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> useradd --system --home /etc/consul.d --shell /bin/false consul<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /etc/consul.d /var/lib/consul<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> -R consul:consul /etc/consul.d /var/lib/consul<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> -R 750 /etc/consul.d /var/lib/consul<br></code></pre></td></tr></table></figure><h3 id="3-é…ç½®æ–‡ä»¶-etc-consul-d-consul-hcl"><a href="#3-é…ç½®æ–‡ä»¶-etc-consul-d-consul-hcl" class="headerlink" title="3. é…ç½®æ–‡ä»¶ (/etc/consul.d/consul.hcl)"></a>3. é…ç½®æ–‡ä»¶ (<code>/etc/consul.d/consul.hcl</code>)</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">datacenter</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dc1&quot;</span><br>data_dir <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/var/lib/consul&quot;</span><br>node_name <span class="hljs-operator">=</span> <span class="hljs-string">&quot;consul-server-1&quot;</span><br>log_level <span class="hljs-operator">=</span> <span class="hljs-string">&quot;INFO&quot;</span><br><br><span class="hljs-attribute">server</span> <span class="hljs-operator">=</span> true<br>bootstrap_expect <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><br>ui_config &#123;<br>  enabled <span class="hljs-operator">=</span> true<br>&#125;<br><br>bind_addr <span class="hljs-operator">=</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>client_addr <span class="hljs-operator">=</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><br><br>ports &#123;<br>  http <span class="hljs-operator">=</span> <span class="hljs-number">8500</span><br>  grpc <span class="hljs-operator">=</span> <span class="hljs-number">8502</span><br>&#125;<br><br>enable_local_script_checks <span class="hljs-operator">=</span> true<br></code></pre></td></tr></table></figure><h3 id="4-Systemd-æœåŠ¡é…ç½®-etc-systemd-system-consul-service"><a href="#4-Systemd-æœåŠ¡é…ç½®-etc-systemd-system-consul-service" class="headerlink" title="4. Systemd æœåŠ¡é…ç½® (/etc/systemd/system/consul.service)"></a>4. Systemd æœåŠ¡é…ç½® (<code>/etc/systemd/system/consul.service</code>)</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=<span class="hljs-string">&quot;HashiCorp Consul 1.21 Service Mesh&quot;</span><br><span class="hljs-attr">Documentation</span>=https://www.consul.io/docs/<span class="hljs-number">1.21</span><br><span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">User</span>=consul<br><span class="hljs-attr">Group</span>=consul<br><span class="hljs-attr">ExecStart</span>=/usr/local/bin/consul agent -config-dir=/etc/consul.d/<br><span class="hljs-attr">ExecReload</span>=/bin/kill -HUP <span class="hljs-variable">$MAINPID</span><br><span class="hljs-attr">KillMode</span>=process<br><span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure<br><span class="hljs-attr">RestartSec</span>=<span class="hljs-number">5</span>s<br><span class="hljs-attr">LimitNOFILE</span>=<span class="hljs-number">65536</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><h3 id="5-å¯åŠ¨æœåŠ¡"><a href="#5-å¯åŠ¨æœåŠ¡" class="headerlink" title="5. å¯åŠ¨æœåŠ¡"></a>5. å¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl daemon-reload<br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> consul<br><span class="hljs-built_in">sudo</span> systemctl start consul<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€éªŒè¯å®‰è£…"><a href="#ä¸‰ã€éªŒè¯å®‰è£…" class="headerlink" title="ä¸‰ã€éªŒè¯å®‰è£…"></a>ä¸‰ã€éªŒè¯å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span><br><span class="hljs-built_in">sudo</span> systemctl status consul<br><br><span class="hljs-comment"># æ£€æŸ¥æˆå‘˜åˆ—è¡¨</span><br>consul members<br><br><span class="hljs-comment"># éªŒè¯HTTP API</span><br>curl http://localhost:8500/v1/agent/self | jq<br><br><span class="hljs-comment"># è®¿é—®Web UI</span><br>http://&lt;SERVER_IP&gt;:8500/ui<br></code></pre></td></tr></table></figure><h2 id="å››ã€é˜²ç«å¢™é…ç½®"><a href="#å››ã€é˜²ç«å¢™é…ç½®" class="headerlink" title="å››ã€é˜²ç«å¢™é…ç½®"></a>å››ã€é˜²ç«å¢™é…ç½®</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># CentOS</span><br><span class="hljs-attribute">sudo</span> firewall-cmd --permanent --add-port=&#123;<span class="hljs-number">8300</span>,<span class="hljs-number">8301</span>,<span class="hljs-number">8302</span>,<span class="hljs-number">8500</span>,<span class="hljs-number">8600</span>&#125;/tcp<br><span class="hljs-attribute">sudo</span> firewall-cmd --permanent --add-port=&#123;<span class="hljs-number">8301</span>,<span class="hljs-number">8302</span>,<span class="hljs-number">8600</span>&#125;/udp<br><span class="hljs-attribute">sudo</span> firewall-cmd --reload<br><br><span class="hljs-comment"># Ubuntu</span><br><span class="hljs-attribute">sudo</span> ufw <span class="hljs-literal">allow</span> <span class="hljs-number">8300</span>,<span class="hljs-number">8301</span>,<span class="hljs-number">8302</span>,<span class="hljs-number">8500</span>,<span class="hljs-number">8600</span>/tcp<br><span class="hljs-attribute">sudo</span> ufw <span class="hljs-literal">allow</span> <span class="hljs-number">8301</span>,<span class="hljs-number">8302</span>,<span class="hljs-number">8600</span>/udp<br><span class="hljs-attribute">sudo</span> ufw reload<br></code></pre></td></tr></table></figure><h2 id="äº”ã€å¸¸è§é—®é¢˜è§£å†³"><a href="#äº”ã€å¸¸è§é—®é¢˜è§£å†³" class="headerlink" title="äº”ã€å¸¸è§é—®é¢˜è§£å†³"></a>äº”ã€å¸¸è§é—®é¢˜è§£å†³</h2><h3 id="1-å¯åŠ¨å¤±è´¥æ£€æŸ¥"><a href="#1-å¯åŠ¨å¤±è´¥æ£€æŸ¥" class="headerlink" title="1. å¯åŠ¨å¤±è´¥æ£€æŸ¥"></a>1. å¯åŠ¨å¤±è´¥æ£€æŸ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</span><br><span class="hljs-built_in">sudo</span> journalctl -u consul -f<br><br><span class="hljs-comment"># éªŒè¯é…ç½®æ–‡ä»¶</span><br>consul validate /etc/consul.d/<br></code></pre></td></tr></table></figure><h3 id="2-ç«¯å£å†²çªå¤„ç†"><a href="#2-ç«¯å£å†²çªå¤„ç†" class="headerlink" title="2. ç«¯å£å†²çªå¤„ç†"></a>2. ç«¯å£å†²çªå¤„ç†</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> netstat -tulnp | grep -E &#x27;<span class="hljs-number">8500</span>|<span class="hljs-number">8300</span>&#x27;<br><span class="hljs-comment"># å¦‚æœå†²çªï¼Œä¿®æ”¹consul.hclä¸­çš„portsé…ç½®</span><br></code></pre></td></tr></table></figure><h3 id="3-æ•°æ®é‡ç½®"><a href="#3-æ•°æ®é‡ç½®" class="headerlink" title="3. æ•°æ®é‡ç½®"></a>3. æ•°æ®é‡ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl stop consul<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">rm</span> -rf /var/lib/consul/*<br><span class="hljs-built_in">sudo</span> systemctl start consul<br></code></pre></td></tr></table></figure><h2 id="å…­ã€å¤‡ä»½å»ºè®®"><a href="#å…­ã€å¤‡ä»½å»ºè®®" class="headerlink" title="å…­ã€å¤‡ä»½å»ºè®®"></a>å…­ã€å¤‡ä»½å»ºè®®</h2><ol><li>å®šæœŸå¤‡ä»½ <code>/etc/consul.d/</code> ç›®å½•</li><li>é‡è¦æ•°æ®ç›®å½• <code>/var/lib/consul/</code> å»ºè®®åšå¿«ç…§</li></ol><blockquote><p>æ³¨æ„ï¼šå•èŠ‚ç‚¹éƒ¨ç½²ä»…é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®è‡³å°‘3ä¸ªèŠ‚ç‚¹ç»„æˆé›†ç¾¤</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>consul</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>prometheusç›‘æ§k8sé›†ç¾¤</title>
    <link href="/2025/05/12/prometheus%E7%9B%91%E6%8E%A7k8s%E9%9B%86%E7%BE%A4/"/>
    <url>/2025/05/12/prometheus%E7%9B%91%E6%8E%A7k8s%E9%9B%86%E7%BE%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="k8sé›†ç¾¤ç›‘æ§ä¹‹prometheus"><a href="#k8sé›†ç¾¤ç›‘æ§ä¹‹prometheus" class="headerlink" title="k8sé›†ç¾¤ç›‘æ§ä¹‹prometheus"></a>k8sé›†ç¾¤ç›‘æ§ä¹‹prometheus</h1><p>prometheuså®˜ç½‘ï¼š<a href="https://prometheus.io/">å®˜ç½‘åœ°å€</a></p><h4 id="1-1-Prometheusçš„ç‰¹ç‚¹"><a href="#1-1-Prometheusçš„ç‰¹ç‚¹" class="headerlink" title="1.1 Prometheusçš„ç‰¹ç‚¹"></a>1.1 Prometheusçš„ç‰¹ç‚¹</h4><ul><li><p>å¤šç»´åº¦æ•°æ®æ¨¡å‹,ä½¿ç”¨æ—¶é—´åºåˆ—æ•°æ®åº“TSDBè€Œä¸ä½¿ç”¨mysqlã€‚</p></li><li><p>çµæ´»çš„æŸ¥è¯¢è¯­è¨€PromQLã€‚</p></li><li><p>ä¸ä¾èµ–åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå•ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹æ˜¯è‡ªä¸»çš„ã€‚</p></li><li><p>ä¸»è¦åŸºäºHTTPçš„pullæ–¹å¼ä¸»åŠ¨é‡‡é›†æ—¶åºæ•°æ®ã€‚</p></li><li><p>ä¹Ÿå¯é€šè¿‡pushgatewayè·å–ä¸»åŠ¨æ¨é€åˆ°ç½‘å…³çš„æ•°æ®ã€‚</p></li><li><p>é€šè¿‡æœåŠ¡å‘ç°æˆ–è€…é™æ€é…ç½®æ¥å‘ç°ç›®æ ‡æœåŠ¡å¯¹è±¡ã€‚</p></li><li><p>æ”¯æŒå¤šç§å¤šæ ·çš„å›¾è¡¨å’Œç•Œé¢å±•ç¤ºï¼Œæ¯”å¦‚Grafanaç­‰ã€‚</p></li></ul><h3 id="1-2-åŸºæœ¬åŸç†"><a href="#1-2-åŸºæœ¬åŸç†" class="headerlink" title="1.2 åŸºæœ¬åŸç†"></a>1.2 åŸºæœ¬åŸç†</h3><h4 id="1-2-1-åŸç†è¯´æ˜"><a href="#1-2-1-åŸç†è¯´æ˜" class="headerlink" title="1.2.1 åŸç†è¯´æ˜"></a>1.2.1 åŸç†è¯´æ˜</h4><p>Prometheusçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡å„ç§exporteræä¾›çš„HTTPåè®®æ¥å£</p><p>å‘¨æœŸæ€§æŠ“å–è¢«ç›‘æ§ç»„ä»¶çš„çŠ¶æ€ï¼Œä»»æ„ç»„ä»¶åªè¦æä¾›å¯¹åº”çš„HTTPæ¥å£å°±å¯ä»¥æ¥å…¥ç›‘æ§ã€‚</p><p>ä¸éœ€è¦ä»»ä½•SDKæˆ–è€…å…¶ä»–çš„é›†æˆè¿‡ç¨‹,éå¸¸é€‚åˆåšè™šæ‹ŸåŒ–ç¯å¢ƒç›‘æ§ç³»ç»Ÿï¼Œæ¯”å¦‚VMã€Dockerã€Kubernetesç­‰ã€‚</p><p>äº’è”ç½‘å…¬å¸å¸¸ç”¨çš„ç»„ä»¶å¤§éƒ¨åˆ†éƒ½æœ‰exporterå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¦‚Nginxã€MySQLã€Linuxç³»ç»Ÿä¿¡æ¯ç­‰ã€‚</p><h4 id="1-2-2-æ¶æ„å›¾"><a href="#1-2-2-æ¶æ„å›¾" class="headerlink" title="1.2.2 æ¶æ„å›¾:"></a>1.2.2 æ¶æ„å›¾:</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2511954/1601219938866-fc30fe28-f729-49eb-a4b9-8cfeaa83ecb5.png" alt="img"></p><h4 id="1-2-3-ä¸‰å¤§ç»„ä»¶"><a href="#1-2-3-ä¸‰å¤§ç»„ä»¶" class="headerlink" title="1.2.3 ä¸‰å¤§ç»„ä»¶"></a>1.2.3 ä¸‰å¤§ç»„ä»¶</h4><ul><li><p>Server ä¸»è¦è´Ÿè´£æ•°æ®é‡‡é›†å’Œå­˜å‚¨ï¼Œæä¾›PromQLæŸ¥è¯¢è¯­è¨€çš„æ”¯æŒã€‚</p></li><li><p>Alertmanager è­¦å‘Šç®¡ç†å™¨ï¼Œç”¨æ¥è¿›è¡ŒæŠ¥è­¦ã€‚</p></li><li><p>Push Gateway æ”¯æŒä¸´æ—¶æ€§Jobä¸»åŠ¨æ¨é€æŒ‡æ ‡çš„ä¸­é—´ç½‘å…³ã€‚</p></li></ul><h4 id="1-2-4-æ¶æ„æœåŠ¡è¿‡ç¨‹"><a href="#1-2-4-æ¶æ„æœåŠ¡è¿‡ç¨‹" class="headerlink" title="1.2.4 æ¶æ„æœåŠ¡è¿‡ç¨‹"></a>1.2.4 æ¶æ„æœåŠ¡è¿‡ç¨‹</h4><blockquote><p>Prometheus Daemonè´Ÿè´£å®šæ—¶å»ç›®æ ‡ä¸ŠæŠ“å–metrics(æŒ‡æ ‡)æ•°æ®<br>æ¯ä¸ªæŠ“å–ç›®æ ‡éœ€è¦æš´éœ²ä¸€ä¸ªhttpæœåŠ¡çš„æ¥å£ç»™å®ƒå®šæ—¶æŠ“å–ã€‚<br>æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶ã€æ–‡æœ¬æ–‡ä»¶ã€Zookeeperã€DNS SRV Lookupç­‰æ–¹å¼æŒ‡å®šæŠ“å–ç›®æ ‡ã€‚</p><p>PushGatewayç”¨äºClientä¸»åŠ¨æ¨é€metricsåˆ°PushGateway<br>è€ŒPrometheusåªæ˜¯å®šæ—¶å»Gatewayä¸ŠæŠ“å–æ•°æ®ã€‚<br>é€‚åˆä¸€æ¬¡æ€§ã€çŸ­ç”Ÿå‘½å‘¨æœŸçš„æœåŠ¡ã€‚</p><p>Prometheusåœ¨TSDBæ•°æ®åº“å­˜å‚¨æŠ“å–çš„æ‰€æœ‰æ•°æ®<br>é€šè¿‡ä¸€å®šè§„åˆ™è¿›è¡Œæ¸…ç†å’Œæ•´ç†æ•°æ®ï¼Œå¹¶æŠŠå¾—åˆ°çš„ç»“æœå­˜å‚¨åˆ°æ–°çš„æ—¶é—´åºåˆ—ä¸­ã€‚</p><p>Prometheusé€šè¿‡PromQLå’Œå…¶ä»–APIå¯è§†åŒ–åœ°å±•ç¤ºæ”¶é›†çš„æ•°æ®ã€‚<br>æ”¯æŒGrafanaã€Promdashç­‰æ–¹å¼çš„å›¾è¡¨æ•°æ®å¯è§†åŒ–ã€‚<br>Prometheusè¿˜æä¾›HTTP APIçš„æŸ¥è¯¢æ–¹å¼ï¼Œè‡ªå®šä¹‰æ‰€éœ€è¦çš„è¾“å‡ºã€‚</p><p>Alertmanageræ˜¯ç‹¬ç«‹äºPrometheusçš„ä¸€ä¸ªæŠ¥è­¦ç»„ä»¶<br>æ”¯æŒPrometheusçš„æŸ¥è¯¢è¯­å¥ï¼Œæä¾›ååˆ†çµæ´»çš„æŠ¥è­¦æ–¹å¼ã€‚</p></blockquote><h4 id="1-2-5-å¸¸ç”¨çš„exporter"><a href="#1-2-5-å¸¸ç”¨çš„exporter" class="headerlink" title="1.2.5 å¸¸ç”¨çš„exporter"></a>1.2.5 å¸¸ç”¨çš„exporter</h4><p>prometheusä¸åŒäºzabbixï¼Œæ²¡æœ‰agentï¼Œä½¿ç”¨çš„æ˜¯é’ˆå¯¹ä¸åŒæœåŠ¡çš„exporter</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œç›‘æ§k8sé›†ç¾¤åŠnodeï¼Œpodï¼Œå¸¸ç”¨çš„exporteræœ‰å››ä¸ªï¼š</p><h5 id="1-éƒ¨ç½²kube-state-metrics"><a href="#1-éƒ¨ç½²kube-state-metrics" class="headerlink" title="1.éƒ¨ç½²kube-state-metrics"></a>1.éƒ¨ç½²kube-state-metrics</h5><pre><code class="hljs">æˆ‘è°ƒåº¦äº†å¤šå°‘ä¸ª replicasï¼Ÿç°åœ¨å¯ç”¨çš„æœ‰å‡ ä¸ªï¼Ÿå¤šå°‘ä¸ª Pod æ˜¯ running/stopped/terminated çŠ¶æ€ï¼ŸPod é‡å¯äº†å¤šå°‘æ¬¡ï¼Ÿæˆ‘æœ‰å¤šå°‘ job åœ¨è¿è¡Œä¸­?è€Œè¿™äº›åˆ™æ˜¯ kube-state-metrics æä¾›çš„å†…å®¹ï¼Œå®ƒåŸºäº client-go å¼€å‘ï¼Œè½®è¯¢ Kubernetes APIï¼Œå¹¶å°† Kubernetesçš„ç»“æ„åŒ–ä¿¡æ¯è½¬æ¢ä¸ºmetricsã€‚</code></pre><p>â€‹<br>â€‹<br>â€‹    #1.å®˜ç½‘ï¼šæˆ‘ä»¬k8sé›†ç¾¤æ˜¯1.22.xç‰ˆæœ¬ï¼Œæ‰€ä»¥é€‰æ‹©v2.2.4ï¼Œå…·ä½“ç‰ˆæœ¬å¯¹åº”çœ‹å®˜ç½‘<br>â€‹    <a href="https://github.com/kubernetes/kube-state-metrics">https://github.com/kubernetes/kube-state-metrics</a><br>â€‹    <a href="https://github.com/kubernetes/kube-state-metrics/tree/v2.2.4/examples/standard">https://github.com/kubernetes/kube-state-metrics/tree/v2.2.4/examples/standard</a><br>â€‹    </p><pre><code class="hljs">#æ³¨æ„ï¼šé‡Œé¢å­˜æ”¾çš„æ˜¯æˆ‘ä»¬çš„yamlæ–‡ä»¶ï¼Œè‡ªå·±å»ä¸‹è½½å®‰è£…</code></pre><p>â€‹<br>â€‹<br>â€‹    #2.ä¸‹è½½å¹¶æ¨é€åˆ°æˆ‘ä»¬ç§æœ‰é•œåƒä»“åº“harborä¸Š<br>â€‹    [root@k8s-node01 ~]# mkdir &#x2F;k8s-yaml&#x2F;kube-state-metrics -p<br>â€‹    [root@k8s-node01 ~]# cd &#x2F;k8s-yaml&#x2F;kube-state-metrics<br>â€‹    [root@k8s-master01 kube-state-metrics]# ls<br>â€‹    cluster-role-binding.yaml  cluster-role.yaml  deployment.yaml  service-account.yaml service.yaml<br>â€‹    #è¿™é‡Œéœ€è¦ä¸Šä¼ æˆ–è€…ä¸‹è½½éœ€è¦çš„é•œåƒåˆ°æ¯ä¸ªèŠ‚ç‚¹<br>â€‹    #3.åˆ›å»ºèµ„æº<br>â€‹    [root@k8s-master01 kube-state-metrics]# kubectl create -f .<br>â€‹    </p><pre><code class="hljs">#4.éªŒè¯æµ‹è¯•[root@k8s-master01 ~]# kubectl get pod -n kube-system -o wide |grep kube-state-metrics[root@k8s-master01 kube-state-metrics]# curl 172.161.125.55:8080/healthzOK</code></pre><h5 id="2-éƒ¨ç½²node-exporter"><a href="#2-éƒ¨ç½²node-exporter" class="headerlink" title="2.éƒ¨ç½²node-exporter"></a>2.éƒ¨ç½²node-exporter</h5><pre><code class="hljs">node-exporteræ˜¯ç›‘æ§nodeçš„ï¼Œéœ€è¦æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ªï¼Œæ‰€ä»¥ä½¿ç”¨dsæ§åˆ¶å™¨# å®˜ç½‘åœ°å€ï¼šhttps://github.com/prometheus/node_exporterä½œç”¨ï¼šå°†å®¿ä¸»æœºçš„/proc   system  ç›®å½•æŒ‚è½½ç»™å®¹å™¨,æ˜¯å®¹å™¨èƒ½è·å–nodeèŠ‚ç‚¹å®¿ä¸»æœºä¿¡æ¯[root@k8s-master01 ~]# docker pull prom/node-exporter:latest[root@k8s-master01 ~]# mkdir -p /k8s-yaml/node-exporter/[root@k8s-master01 ~]# cd /k8s-yaml/node-exporter/[root@k8s-master01 node-exporter]# vim node-exporter-ds.yaml [root@k8s-master01 node-exporter]# cat node-exporter-ds.yaml kind: DaemonSetapiVersion: apps/v1metadata:  name: node-exporter  namespace: kube-system  labels:    daemon: &quot;node-exporter&quot;    grafanak8sapp: &quot;true&quot;spec:  selector:    matchLabels:      daemon: &quot;node-exporter&quot;      grafanak8sapp: &quot;true&quot;  template:    metadata:      name: node-exporter      labels:        daemon: &quot;node-exporter&quot;        grafanak8sapp: &quot;true&quot;    spec:      containers:      - name: node-exporter        image: prom/node-exporter:latest        imagePullPolicy: IfNotPresent        args:        - --path.procfs=/host_proc        - --path.sysfs=/host_sys        ports:        - name: node-exporter          hostPort: 9100          containerPort: 9100          protocol: TCP        volumeMounts:        - name: sys          readOnly: true          mountPath: /host_sys        - name: proc          readOnly: true          mountPath: /host_proc      imagePullSecrets:      - name: harbor      restartPolicy: Always      hostNetwork: true      volumes:      - name: proc        hostPath:           path: /proc          type: &quot;&quot;      - name: sys        hostPath:          path: /sys          type: &quot;[root@k8s-master01 node-exporter]# kubectl apply -f node-exporter-ds.yaml </code></pre><h5 id="3-éƒ¨ç½²cadvisor"><a href="#3-éƒ¨ç½²cadvisor" class="headerlink" title="3. éƒ¨ç½²cadvisor"></a>3. éƒ¨ç½²cadvisor</h5><p>æ”¶é›†k8sé›†ç¾¤dockerå®¹å™¨å†…éƒ¨ä½¿ç”¨èµ„æºä¿¡æ¯ blackbox-exporte<br>æ”¶é›†k8sé›†ç¾¤dockerå®¹å™¨æœåŠ¡æ˜¯å¦å­˜æ´»</p><blockquote><p>è¯¥exporteræ˜¯é€šè¿‡å’Œkubeletäº¤äº’ï¼Œå–åˆ°Podè¿è¡Œæ—¶çš„èµ„æºæ¶ˆè€—æƒ…å†µï¼Œå¹¶å°†æ¥å£æš´éœ²ç»™Prometheusã€‚</p><ul><li><p>cadvisorç”±äºè¦è·å–æ¯ä¸ªnodeä¸Šçš„podä¿¡æ¯ï¼Œå› æ­¤ä¹Ÿéœ€è¦ä½¿ç”¨daemonsetæ–¹å¼è¿è¡Œ</p></li><li><p>cadvisoré‡‡ç”¨daemonsetæ–¹å¼è¿è¡Œåœ¨nodeèŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡æ±¡ç‚¹çš„æ–¹å¼æ’é™¤master</p></li><li><p>åŒæ—¶å°†éƒ¨åˆ†å®¿ä¸»æœºç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ï¼Œå¦‚dockerçš„æ•°æ®ç›®å½•</p></li></ul></blockquote><p>â€‹    #å®˜ç½‘åœ°å€ï¼š<a href="https://github.com/google/cadvisor">https://github.com/google/cadvisor</a><br>â€‹    <a href="https://github.com/google/cadvisor/tree/v0.42.0/deploy/kubernetes/base">https://github.com/google/cadvisor/tree/v0.42.0/deploy/kubernetes/base</a><br>â€‹    [root@k8s-master01 ~]# mkdir &#x2F;k8s-yaml&#x2F;cadvisor &amp;&amp; cd &#x2F;k8s-yaml&#x2F;cadvisor<br>â€‹    [root@k8s-master01 cadvisor]# cat ds.yaml </p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br> <span class="hljs-attr">kind:</span> <span class="hljs-string">DaemonSet</span><br> <span class="hljs-attr">metadata:</span><br>   <span class="hljs-attr">name:</span> <span class="hljs-string">cadvisor</span><br>   <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>   <span class="hljs-attr">labels:</span><br>     <span class="hljs-attr">app:</span> <span class="hljs-string">cadvisor</span><br> <span class="hljs-attr">spec:</span><br>   <span class="hljs-attr">selector:</span><br>     <span class="hljs-attr">matchLabels:</span><br>       <span class="hljs-attr">name:</span> <span class="hljs-string">cadvisor</span><br>   <span class="hljs-attr">template:</span><br>     <span class="hljs-attr">metadata:</span><br>       <span class="hljs-attr">labels:</span><br>         <span class="hljs-attr">name:</span> <span class="hljs-string">cadvisor</span><br>     <span class="hljs-attr">spec:</span><br>       <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">true</span><br> <span class="hljs-comment">#------podçš„tolerationsä¸nodeçš„Taintsé…åˆ,åšPODæŒ‡å®šè°ƒåº¦----</span><br>       <span class="hljs-attr">tolerations:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">node-role.kubernetes.io/master</span><br>         <span class="hljs-attr">effect:</span> <span class="hljs-string">NoSchedule</span><br> <span class="hljs-comment">#-------------------------------------</span><br>       <span class="hljs-attr">containers:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cadvisor</span><br>         <span class="hljs-attr">image:</span> <span class="hljs-string">gcr.io/cadvisor/cadvisor:v0.39.0</span><br>         <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>         <span class="hljs-attr">volumeMounts:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rootfs</span><br>           <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/rootfs</span><br>           <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">var-run</span><br>           <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/run</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sys</span><br>           <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/sys</span><br>           <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">docker</span><br>           <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/docker</span><br>           <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span><br>         <span class="hljs-attr">ports:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>             <span class="hljs-attr">containerPort:</span> <span class="hljs-number">4194</span><br>             <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>         <span class="hljs-attr">readinessProbe:</span><br>           <span class="hljs-attr">tcpSocket:</span><br>             <span class="hljs-attr">port:</span> <span class="hljs-number">4194</span><br>           <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span><br>           <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span><br>         <span class="hljs-attr">args:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">--housekeeping_interval=10s</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">--port=4194</span><br>       <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">30</span><br>       <span class="hljs-attr">volumes:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rootfs</span><br>         <span class="hljs-attr">hostPath:</span><br>           <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">var-run</span><br>         <span class="hljs-attr">hostPath:</span><br>           <span class="hljs-attr">path:</span> <span class="hljs-string">/var/run</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sys</span><br>         <span class="hljs-attr">hostPath:</span><br>           <span class="hljs-attr">path:</span> <span class="hljs-string">/sys</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">docker</span><br>         <span class="hljs-attr">hostPath:</span><br>           <span class="hljs-attr">path:</span> <span class="hljs-string">/data/docker</span><br> <br></code></pre></td></tr></table></figure><pre><code class="hljs">#ä¿®æ”¹è¿ç®—èŠ‚ç‚¹è½¯è¿æ¥ ï¼ˆæ‰€æœ‰nodeèŠ‚ç‚¹ï¼‰#1.node01ä¿®æ”¹[root@k8s-node01 ~]# mount -o remount,rw /sys/fs/cgroup/[root@k8s-node01 ~]# ln -s /sys/fs/cgroup/cpu,cpuacct/ /sys/fs/cgroup/cpuacct,cpu[root@k8s-node01 ~]# ll /sys/fs/cgroup/ | grep cpu#2.node02ä¿®æ”¹[root@k8s-node02 ~]# mount -o remount,rw /sys/fs/cgroup/[root@k8s-node02 ~]# ln -s /sys/fs/cgroup/cpu,cpuacct/ /sys/fs/cgroup/cpuacct,cpu[root@k8s-node02 ~]# ll /sys/fs/cgroup/ | grep cpulrwxrwxrwx 1 root root 11 Nov 17 13:41 cpu -&gt; cpu,cpuacctlrwxrwxrwx 1 root root 11 Nov 17 13:41 cpuacct -&gt; cpu,cpuacctlrwxrwxrwx 1 root root 27 Dec 19 01:52 cpuacct,cpu -&gt; /sys/fs/cgroup/cpu,cpuacct/dr-xr-xr-x 5 root root  0 Nov 17 13:41 cpu,cpuacctdr-xr-xr-x 3 root root  0 Nov 17 13:41 cpuset#æ³¨ï¼šè¿™ä¸€æ­¥åªæ˜¯å°†åŸæœ¬çš„å¯è¯»æ›´æ”¹ä¸ºäº†å¯è¯»ï¼Œå¯å†™[root@k8s-master01 cadvisor]# kubectl apply -f daemonset.yaml daemonset.apps/cadvisor created#é•œåƒéœ€è¦è·å¾—ï¼Œè¯¾ç¨‹ä¸­å·²ç»é…ç½®äº†é•œåƒåœ°å€ç›´æ¥ä¸‹è½½å°±å¥½[root@k8s-master01 cadvisor]# kubectl -n kube-system get pod -o wide|grep cadvisorcadvisor-29nv5  1/1     Running   0  2m17s   192.168.1.112    k8s-master02   cadvisor-lnpwj  1/1     Running   0  2m17s   192.168.1.114    k8s-node01     cadvisor-wmr57  1/1     Running   0  2m17s   192.168.1.111    k8s-master01   cadvisor-zcz78  1/1     Running   0  2m17s   192.168.1.115    k8s-node02[root@k8s-master01 ~]# netstat -luntp|grep 4194tcp6       0      0 :::4194 </code></pre><h5 id="4-éƒ¨ç½²blackbox-exporter-é»‘ç›’ç›‘æ§"><a href="#4-éƒ¨ç½²blackbox-exporter-é»‘ç›’ç›‘æ§" class="headerlink" title="4 éƒ¨ç½²blackbox-exporter é»‘ç›’ç›‘æ§"></a>4 éƒ¨ç½²blackbox-exporter é»‘ç›’ç›‘æ§</h5><blockquote><p>Prometheus å®˜æ–¹æä¾›çš„ exporter ä¹‹ä¸€ï¼Œå¯ä»¥æä¾› httpã€dnsã€tcpã€icmp çš„ç›‘æ§æ•°æ®é‡‡é›†</p></blockquote><pre><code class="hljs">å®˜æ–¹githubåœ°å€ï¼šhttps://github.com/prometheus/blackbox_exporterhttps://github.com/prometheus/blackbox_exporter/tree/v0.18.0/config/testdata</code></pre><ul><li>å‡†å¤‡å·¥ä½œç›®å½•</li></ul><p>â€‹<br>â€‹<br>â€‹    [root@k8s-master01 ~]# docker pull prom&#x2F;blackbox-exporter:v0.18.0<br>â€‹    [root@k8s-master01 ~]# mkdir -p &#x2F;k8s-yaml&#x2F;blackbox-exporter &amp;&amp; cd &#x2F;k8s-yaml&#x2F;blackbox-exporter  </p><ul><li>èµ„æºæ¸…å•åˆ›å»º</li></ul><p>â€‹<br>â€‹    [root@k8s-master01 blackbox-exporter]# vim blackbox-exporter-configmap.yaml</p>   <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br>   <span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br>   <span class="hljs-attr">metadata:</span><br>     <span class="hljs-attr">labels:</span><br>       <span class="hljs-attr">app:</span> <span class="hljs-string">blackbox-exporter</span><br>     <span class="hljs-attr">name:</span> <span class="hljs-string">blackbox-exporter</span><br>     <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>   <span class="hljs-attr">data:</span><br>     <span class="hljs-attr">blackbox.yml:</span> <span class="hljs-string">|-</span><br><span class="hljs-string">       modules:</span><br><span class="hljs-string">         http_2xx:</span><br><span class="hljs-string">           prober: http</span><br><span class="hljs-string">           timeout: 2s</span><br><span class="hljs-string">           http:</span><br><span class="hljs-string">             valid_http_versions: [&quot;HTTP/1.1&quot;, &quot;HTTP/2&quot;]</span><br><span class="hljs-string">             valid_status_codes: [200,301,302,404]</span><br><span class="hljs-string">             method: GET</span><br><span class="hljs-string">             preferred_ip_protocol: &quot;ip4&quot;</span><br><span class="hljs-string">         tcp_connect:</span><br><span class="hljs-string">           prober: tcp</span><br><span class="hljs-string">           timeout: 2s</span><br></code></pre></td></tr></table></figure><p>â€‹            </p><pre><code class="hljs">[root@k8s-master01 blackbox-exporter]# vim blackbox-exporter-deployment.yamlkind: DeploymentapiVersion: apps/v1metadata:  name: blackbox-exporter  namespace: kube-system  labels:    app: blackbox-exporter  annotations:    kubernetes.io/replicationcontroller: Deploymentspec:  replicas: 1  selector:    matchLabels:      app: blackbox-exporter  template:    metadata:      labels:        app: blackbox-exporter    spec:      volumes:      - name: config        configMap:          name: blackbox-exporter          defaultMode: 420      containers:      - name: blackbox-exporter        image: prom/blackbox-exporter:v0.18.0        imagePullPolicy: IfNotPresent        args:        - --config.file=/etc/blackbox_exporter/blackbox.yml        - --log.level=info        - --web.listen-address=:9115        ports:        - name: blackbox-port          containerPort: 9115          protocol: TCP        resources:          limits:            cpu: 200m            memory: 256Mi          requests:            cpu: 100m            memory: 50Mi        volumeMounts:        - name: config          mountPath: /etc/blackbox_exporter        readinessProbe:          tcpSocket:            port: 9115          initialDelaySeconds: 5          timeoutSeconds: 5          periodSeconds: 10          successThreshold: 1          failureThreshold: 3[root@k8s-master01 blackbox-exporter]# vim blackbox-exporter-service.yamlkind: ServiceapiVersion: v1metadata:  name: blackbox-exporter  namespace: kube-systemspec:  type: NodePort  selector:    app: blackbox-exporter  ports:    - name: blackbox-port      port: 9115      targetPort: 9115      nodePort: 10015      protocol: TCP#è¯´æ˜ï¼šè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ingress-nginxè¿›è¡Œè½¬å‘[root@k8s-master01 blackbox-exporter]# kubectl create -f .configmap/blackbox-exporter createddeployment.apps/blackbox-exporter createdservice/blackbox-exporter created[root@k8s-master01 blackbox-exporter]# kubectl get pod -n kube-systemNAME                                       READY   STATUS    RESTARTS        AGEblackbox-exporter-59fd868bfc-j4nfv         1/1     Running   0               2m37s[root@k8s-master01 blackbox-exporter]# kubectl get svc -n kube-systemNAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                 blackbox-exporter    NodePort    10.100.192.71   &lt;none&gt;        9115:10015/TCP          #å¦‚æœåœ¨åˆ›å»ºçš„æ—¶å€™æç¤ºç«¯å£åŒºé—´åˆ™å»ä¿®æ”¹é›†ç¾¤ç«¯å£æˆ–è€…æ›´æ”¹æˆ30000ä»¥ä¸Šçš„ç«¯å£æ¯”å¦‚è¯´30015#ç„¶åæµè§ˆå™¨å»è®¿é—®æˆ‘ä»¬çš„IP:10015[root@k8s-master01 blackbox-exporter]# curl 192.168.1.114:10015..........    &lt;h1&gt;Blackbox Exporter&lt;/h1&gt;..........[root@k8s-master01 blackbox-exporter]#</code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="2ã€éƒ¨ç½²prometheus-server"><a href="#2ã€éƒ¨ç½²prometheus-server" class="headerlink" title="2ã€éƒ¨ç½²prometheus server"></a>2ã€éƒ¨ç½²prometheus server</h4><h5 id="2-1-å‡†å¤‡prometheus-serverç¯å¢ƒ"><a href="#2-1-å‡†å¤‡prometheus-serverç¯å¢ƒ" class="headerlink" title="2.1 å‡†å¤‡prometheus serverç¯å¢ƒ"></a>2.1 å‡†å¤‡prometheus serverç¯å¢ƒ</h5><pre><code class="hljs">å®˜æ–¹dockerhubåœ°å€ï¼šhttps://hub.docker.com/r/prom/prometheuså®˜æ–¹githubåœ°å€ï¼šhttps://github.com/prometheus/prometheushttps://github.com/prometheus/prometheus/tree/v2.32.0/config/testdataå½“å‰æœ€æ–°ç‰ˆï¼š2.32.0#1.å‡†å¤‡ç›®å½•[root@k8s-master01 ~]# mkdir /k8s-yaml/prometheus-server &amp;&amp; cd /k8s-yaml/prometheus-server</code></pre><ul><li>1.èµ„æºæ¸…å•rabc</li></ul><p>â€‹<br>â€‹    [root@k8s-master01 prometheus-server]# vim rbac.yaml</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">addonmanager.kubernetes.io/mode:</span> <span class="hljs-string">Reconcile</span><br>      <span class="hljs-attr">kubernetes.io/cluster-service:</span> <span class="hljs-string">&quot;true&quot;</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-string">---</span><br>  <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">addonmanager.kubernetes.io/mode:</span> <span class="hljs-string">Reconcile</span><br>      <span class="hljs-attr">kubernetes.io/cluster-service:</span> <span class="hljs-string">&quot;true&quot;</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span><br>  <span class="hljs-attr">rules:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">nodes</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">nodes/metrics</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">services</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">endpoints</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">pods</span><br>    <span class="hljs-attr">verbs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">configmaps</span><br>    <span class="hljs-attr">verbs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">nonResourceURLs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/metrics</span><br>    <span class="hljs-attr">verbs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-string">---</span><br>  <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br>  <span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">addonmanager.kubernetes.io/mode:</span> <span class="hljs-string">Reconcile</span><br>      <span class="hljs-attr">kubernetes.io/cluster-service:</span> <span class="hljs-string">&quot;true&quot;</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span><br>  <span class="hljs-attr">roleRef:</span><br>    <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span><br>  <span class="hljs-attr">subjects:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br></code></pre></td></tr></table></figure><h5 id="2-2-å‡†å¤‡deplomentèµ„æºæ¸…å•"><a href="#2-2-å‡†å¤‡deplomentèµ„æºæ¸…å•" class="headerlink" title="2.2.å‡†å¤‡deplomentèµ„æºæ¸…å•"></a>2.2.å‡†å¤‡deplomentèµ„æºæ¸…å•</h5><blockquote><p>--web.enable-lifecycle å¯ç”¨è¿œç¨‹çƒ­åŠ è½½é…ç½®æ–‡ä»¶,é…ç½®æ–‡ä»¶æ”¹å˜åä¸ç”¨é‡å¯prometheus</p><p>curl -X POST <a href="http://localhost:9090/-/reload">http://localhost:9090/-/reload</a></p><p>storage.tsdb.min-block-duration&#x3D;10m åªåŠ è½½10åˆ†é’Ÿæ•°æ®</p><p>storage.tsdb.retention&#x3D;72h ä¿ç•™72å°æ—¶æ•°æ®</p></blockquote><pre><code class="hljs">[root@k8s-master01 prometheus-server]# vim depoyment.yamlapiVersion: apps/v1kind: Deploymentmetadata:  annotations:    deployment.kubernetes.io/revision: &quot;5&quot;  labels:    name: prometheus  name: prometheus  namespace: kube-systemspec:  progressDeadlineSeconds: 600  replicas: 1  revisionHistoryLimit: 7  selector:    matchLabels:      app: prometheus  strategy:    rollingUpdate:      maxSurge: 1      maxUnavailable: 1    type: RollingUpdate  template:    metadata:      labels:        app: prometheus    spec:      hostAliases:      - ip: &quot;192.168.1.111&quot;        hostnames:        - &quot;k8s-master01&quot;      - ip: &quot;192.168.1.112&quot;        hostnames:        - &quot;k8s-master02&quot;      - ip: &quot;192.168.1.114&quot;        hostnames:        - &quot;k8s-node01&quot;        hostnames:      - ip: &quot;192.168.1.115&quot;        hostnames:        - &quot;k8s-node02&quot;      containers:      - name: prometheus        image: prom/prometheus:v2.32.0        imagePullPolicy: IfNotPresent        command:        - /bin/prometheus        args:        - --config.file=/data/etc/prometheus.yaml        #- --storage.tsdb.path=/data/prom-db        - --storage.tsdb.min-block-duration=10m        - --storage.tsdb.retention=72h        - --web.enable-lifecycle        ports:        - containerPort: 9090          protocol: TCP        volumeMounts:        - mountPath: /data/          name: data        resources:          requests:            cpu: &quot;1000m&quot;            memory: &quot;1.5Gi&quot;          limits:            cpu: &quot;2000m&quot;            memory: &quot;3Gi&quot;      imagePullSecrets:      - name: harbor      securityContext:        runAsUser: 0      serviceAccountName: prometheus      volumes:      - name: data        nfs:          path: /data/nfs-volume/prometheus/          server: 192.168.1.115#æ³¨æ„è¿™é‡Œè¦åœ¨æŸä¸€å°æœºå™¨ä¸Šåˆ›å»ºnfså­˜å‚¨ï¼Œè¿™é‡Œæˆ‘æ˜¯åœ¨192.168.1.115  k8s-node02åˆ›å»ºçš„(ç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨å…¶å®ƒæ¯”å¦‚è¯´glusterfså­˜å‚¨éƒ½å¯ä»¥)[root@k8s-node02 ~]# yum install nfs-utils -y[root@k8s-node02 ~]# mkdir -p /data/nfs-volume/prometheus/[root@k8s-node02 ~]# mkdir -p /data/nfs-volume/prometheus/etc[root@k8s-node02 ~]# mkdir -p /data/nfs-volume/prometheus/prom-db[root@k8s-node02 ~]# cat /etc/exports/data/nfs-volume/prometheus/ * (rw,fsid=0,sync)[root@k8s-node02 ~]# systemctl start nfs-server[root@k8s-node02 ~]# systemctl enable nfs-server</code></pre><ul><li>å‡†å¤‡svcèµ„æºæ¸…å•(å‡†å¤‡å®Œäº†serviceä¹Ÿå¯ä»¥ä½¿ç”¨ingress-nginxçš„æ–¹å¼é…ç½®åŸŸåè®¿é—®ï¼Œè¿™é‡Œæˆ‘æ²¡é…ç½®)</li></ul><p>â€‹<br>â€‹    [root@k8s-master01 prometheus-server]# vim service.yaml</p>   <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br>   <span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br>   <span class="hljs-attr">metadata:</span><br>     <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span><br>     <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>   <span class="hljs-attr">spec:</span><br>     <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>     <span class="hljs-attr">ports:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">9090</span><br>       <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>       <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9090</span><br>       <span class="hljs-attr">nodePort:</span> <span class="hljs-number">10090</span><br>     <span class="hljs-attr">selector:</span><br>       <span class="hljs-attr">app:</span> <span class="hljs-string">prometheus</span><br></code></pre></td></tr></table></figure><p>â€‹    </p><pre><code class="hljs">#åœ¨masteråˆ›å»ºèµ„æºæ–‡ä»¶[root@k8s-master01 prometheus-server]# kubectl create -f .</code></pre><ul><li>åˆ›å»ºprometheusé…ç½®æ–‡ä»¶ æ³¨æ„ï¼šå› ä¸ºè®¾ç½®äº†å…±äº«ï¼Œæ‰€ä»¥æ–‡ä»¶åˆ›å»ºåœ¨nfs 192.168.1.115è¿™å°æœºå™¨</li></ul><p>é…ç½®æ–‡ä»¶:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@k8s-node02</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># cd /data/nfs-volume/prometheus/etc/</span><br>[<span class="hljs-string">root@k8s-node02</span> <span class="hljs-string">etc</span>]<span class="hljs-comment"># cat prometheus.yaml </span><br><span class="hljs-attr">global:</span><br>  <span class="hljs-attr">scrape_interval:</span>     <span class="hljs-string">15s</span><br>  <span class="hljs-attr">evaluation_interval:</span> <span class="hljs-string">15s</span><br><span class="hljs-attr">scrape_configs:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;kubernetes-apiservers&#x27;</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">endpoints</span><br>  <span class="hljs-attr">scheme:</span> <span class="hljs-string">https</span><br>  <span class="hljs-attr">tls_config:</span><br>    <span class="hljs-attr">ca_file:</span> <span class="hljs-string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><br>  <span class="hljs-attr">bearer_token_file:</span> <span class="hljs-string">/var/run/secrets/kubernetes.io/serviceaccount/token</span><br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_namespace</span>, <span class="hljs-string">__meta_kubernetes_service_name</span>, <span class="hljs-string">__meta_kubernetes_endpoint_port_name</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">default;kubernetes;https</span><br>    <br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;kubernetes-pods&#x27;</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">pod</span><br>  <span class="hljs-comment"># ç›‘å¬ Kubernetes é›†ç¾¤ä¸­çš„æ‰€æœ‰ Podï¼ˆå…¶ä»–å¯é€‰è§’è‰²å¦‚ nodeã€service ç­‰ï¼‰ã€‚</span><br>  <br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_annotation_prometheus_io_scrape</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-string">ä½œç”¨:</span> <span class="hljs-string">ä»…ä¿ç•™å¸¦æœ‰æ³¨è§£</span> <span class="hljs-attr">prometheus.io/scrape:</span> <span class="hljs-string">&quot;true&quot;</span> <span class="hljs-string">çš„</span> <span class="hljs-string">Podã€‚</span><br>    <span class="hljs-string">é€»è¾‘:</span><br>        <span class="hljs-string">æ£€æŸ¥</span> <span class="hljs-string">Pod</span> <span class="hljs-string">çš„æ³¨è§£</span> <span class="hljs-string">prometheus.io/scrape</span> <span class="hljs-string">çš„å€¼ã€‚</span><br>        <span class="hljs-string">è‹¥å€¼ä¸º</span> <span class="hljs-literal">true</span><span class="hljs-string">ï¼Œåˆ™ä¿ç•™è¯¥ç›®æ ‡ï¼›å¦åˆ™ä¸¢å¼ƒã€‚</span><br>        <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_annotation_prometheus_io_path</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__metrics_path__</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">(.+)</span><br>    <span class="hljs-string">å°†</span> <span class="hljs-string">Pod</span> <span class="hljs-string">æ³¨è§£</span> <span class="hljs-string">prometheus.io/path</span> <span class="hljs-string">çš„å€¼ä½œä¸ºæŒ‡æ ‡è·¯å¾„ã€‚</span><br>    <span class="hljs-string">è‹¥æ³¨è§£ä¸º</span> <span class="hljs-attr">prometheus.io/path:</span> <span class="hljs-string">&quot;/metrics&quot;</span><span class="hljs-string">ï¼Œåˆ™ç›®æ ‡çš„æŒ‡æ ‡è·¯å¾„å˜ä¸º</span> <span class="hljs-string">http://&lt;pod_ip&gt;:&lt;port&gt;/metricsã€‚</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__address__</span>, <span class="hljs-string">__meta_kubernetes_pod_annotation_prometheus_io_port</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">([^:]+)(?::\d+)?;(\d+)</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">$1:$2</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span><br>    <span class="hljs-string">ç»„åˆ</span> <span class="hljs-string">Pod</span> <span class="hljs-string">IP</span> <span class="hljs-string">å’Œæ³¨è§£</span> <span class="hljs-string">prometheus.io/port</span> <span class="hljs-string">çš„ç«¯å£ï¼Œç”Ÿæˆå®Œæ•´çš„ç›‘æ§åœ°å€ã€‚</span><br>    <span class="hljs-string">é€»è¾‘:</span><br>        <span class="hljs-string">__address__</span> <span class="hljs-string">é»˜è®¤æ˜¯</span> <span class="hljs-string">pod_ip:container_portï¼Œä½†å¯èƒ½ä¸ç¬¦åˆå®é™…ç›‘æ§ç«¯å£ã€‚</span><br>        <span class="hljs-string">é€šè¿‡æ­£åˆ™</span> <span class="hljs-string">([^:]+)(?::\d+)?;(\d+)</span> <span class="hljs-string">æå–</span> <span class="hljs-string">Pod</span> <span class="hljs-string">IP</span> <span class="hljs-string">å’Œæ³¨è§£ä¸­çš„ç«¯å£ï¼Œæ ¼å¼åŒ–ä¸º</span> <span class="hljs-string">pod_ip:portã€‚</span><br>        <span class="hljs-string">ç¤ºä¾‹:</span> <span class="hljs-string">è‹¥</span> <span class="hljs-string">__address__</span> <span class="hljs-string">ä¸º</span> <span class="hljs-number">10.1</span><span class="hljs-number">.2</span><span class="hljs-number">.3</span><span class="hljs-string">ï¼Œæ³¨è§£</span> <span class="hljs-string">prometheus.io/port</span> <span class="hljs-string">ä¸º</span> <span class="hljs-number">8080</span><span class="hljs-string">ï¼Œåˆ™æœ€ç»ˆåœ°å€ä¸º</span> <span class="hljs-number">10.1</span><span class="hljs-number">.2</span><span class="hljs-number">.3</span><span class="hljs-string">:8080ã€‚</span><br>    <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">labelmap</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">__meta_kubernetes_pod_label_(.+)</span><br>    <span class="hljs-string">å°†</span> <span class="hljs-string">Pod</span> <span class="hljs-string">çš„æ‰€æœ‰æ ‡ç­¾ï¼ˆLabelsï¼‰ä½œä¸ºç›‘æ§ç›®æ ‡çš„æ ‡ç­¾</span><br>    <span class="hljs-string">é€»è¾‘:</span><br>        <span class="hljs-string">åŒ¹é…</span> <span class="hljs-string">__meta_kubernetes_pod_label_&lt;label_name&gt;</span> <span class="hljs-string">çš„å…ƒæ ‡ç­¾ï¼Œå°†å…¶è½¬æ¢ä¸º</span> <span class="hljs-string">&lt;label_name&gt;:</span> <span class="hljs-string">&lt;label_value&gt;ã€‚</span><br>        <span class="hljs-string">ç¤ºä¾‹:</span> <span class="hljs-string">Pod</span> <span class="hljs-string">æ ‡ç­¾</span> <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span> <span class="hljs-string">ä¼šå˜ä¸ºç›®æ ‡çš„æ ‡ç­¾</span> <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>        <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_namespace</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_namespace</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_name</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_pod_name</span><br> <span class="hljs-string">æ˜¾å¼æ·»åŠ </span> <span class="hljs-string">kubernetes_namespace</span> <span class="hljs-string">å’Œ</span> <span class="hljs-string">kubernetes_pod_name</span> <span class="hljs-string">æ ‡ç­¾ï¼Œä¾¿äºç­›é€‰</span><br>    <span class="hljs-string">é€»è¾‘:</span><br><span class="hljs-string">å°†å…ƒæ ‡ç­¾</span> <span class="hljs-string">__meta_kubernetes_namespace</span> <span class="hljs-string">å’Œ</span> <span class="hljs-string">__meta_kubernetes_pod_name</span> <span class="hljs-string">çš„å€¼åˆ†åˆ«æ˜ å°„åˆ°è‡ªå®šä¹‰æ ‡ç­¾ã€‚</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;kubernetes-kubelet&#x27;</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">node</span><br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">labelmap</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">__meta_kubernetes_node_label_(.+)</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_node_name</span>]<br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">(.+)</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">$&#123;1&#125;:10015</span><br>    <br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;kubernetes-cadvisor&#x27;</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">node</span><br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">labelmap</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">__meta_kubernetes_node_label_(.+)</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_node_name</span>]<br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">(.+)</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">$&#123;1&#125;:4194</span><br>    <br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;kubernetes-kube-state&#x27;</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">pod</span><br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">labelmap</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">__meta_kubernetes_pod_label_(.+)</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_namespace</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_namespace</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_name</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_pod_name</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_label_grafanak8sapp</span>]<br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">.*true.*</span><br>    <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">&#x27;__meta_kubernetes_pod_label_daemon&#x27;</span>, <span class="hljs-string">&#x27;__meta_kubernetes_pod_node_name&#x27;</span>]<br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">&#x27;node-exporter;(.*)&#x27;</span><br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">nodename</span><br>    <br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;blackbox_http_pod_probe&#x27;</span><br>  <span class="hljs-attr">metrics_path:</span> <span class="hljs-string">/probe</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">pod</span><br>  <span class="hljs-attr">params:</span><br>    <span class="hljs-attr">module:</span> [<span class="hljs-string">http_2xx</span>]<br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_annotation_blackbox_scheme</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">http</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__address__</span>, <span class="hljs-string">__meta_kubernetes_pod_annotation_blackbox_port</span>,  <span class="hljs-string">__meta_kubernetes_pod_annotation_blackbox_path</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">([^:]+)(?::\d+)?;(\d+);(.+)</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">$1:$2$3</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__param_target</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">blackbox-exporter.kube-system:9115</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__param_target</span>]<br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">instance</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">labelmap</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">__meta_kubernetes_pod_label_(.+)</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_namespace</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_namespace</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_name</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_pod_name</span><br>    <br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;blackbox_tcp_pod_probe&#x27;</span><br>  <span class="hljs-attr">metrics_path:</span> <span class="hljs-string">/probe</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">pod</span><br>  <span class="hljs-attr">params:</span><br>    <span class="hljs-attr">module:</span> [<span class="hljs-string">tcp_connect</span>]<br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_annotation_blackbox_scheme</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">tcp</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__address__</span>, <span class="hljs-string">__meta_kubernetes_pod_annotation_blackbox_port</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">([^:]+)(?::\d+)?;(\d+)</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">$1:$2</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__param_target</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">blackbox-exporter.kube-system:9115</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__param_target</span>]<br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">instance</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">labelmap</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">__meta_kubernetes_pod_label_(.+)</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_namespace</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_namespace</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_name</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_pod_name</span><br>    <br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;traefik&#x27;</span><br>  <span class="hljs-attr">kubernetes_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">role:</span> <span class="hljs-string">pod</span><br>  <span class="hljs-attr">relabel_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_annotation_prometheus_io_scheme</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">traefik</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_annotation_prometheus_io_path</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__metrics_path__</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">(.+)</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__address__</span>, <span class="hljs-string">__meta_kubernetes_pod_annotation_prometheus_io_port</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">([^:]+)(?::\d+)?;(\d+)</span><br>    <span class="hljs-attr">replacement:</span> <span class="hljs-string">$1:$2</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">labelmap</span><br>    <span class="hljs-attr">regex:</span> <span class="hljs-string">__meta_kubernetes_pod_label_(.+)</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_namespace</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_namespace</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_kubernetes_pod_name</span>]<br>    <span class="hljs-attr">action:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-attr">target_label:</span> <span class="hljs-string">kubernetes_pod_name</span><br></code></pre></td></tr></table></figure><ul><li>å¯åŠ¨Prometheus</li></ul><p>â€‹<br>â€‹<br>â€‹    [root@k8s-master01 prometheus-server]# ls<br>â€‹    depoyment.yaml  rbac.yaml  service.yaml<br>â€‹    [root@k8s-master01 prometheus-server]# kubectl apply -f .</p><h5 id="2-3-æµè§ˆå™¨éªŒè¯"><a href="#2-3-æµè§ˆå™¨éªŒè¯" class="headerlink" title="2.3 æµè§ˆå™¨éªŒè¯"></a>2.3 æµè§ˆå™¨éªŒè¯</h5><p>è®¿é—®192.168.1.114:10090 ,å¦‚æœèƒ½æˆåŠŸè®¿é—®çš„è¯,è¡¨ç¤ºå¯åŠ¨æˆåŠŸ</p><p>ç‚¹å‡» <strong>status- &gt;configuration</strong>å°±æ˜¯æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/1601219938865-a380d765-1bde-4948-9878-46528803c465.png" alt="img"></p><ul><li>2.4ä½¿æœåŠ¡èƒ½è¢«prometheusè‡ªåŠ¨ç›‘æ§</li></ul><p>ç‚¹å‡» <strong>status- &gt;targets</strong>ï¼Œå±•ç¤ºçš„å°±æ˜¯æˆ‘ä»¬åœ¨prometheus.ymlä¸­é…ç½®çš„job-nameï¼Œè¿™äº›targetsåŸºæœ¬å¯ä»¥æ»¡è¶³æˆ‘ä»¬æ”¶é›†æ•°æ®çš„éœ€æ±‚ã€‚</p><p>4ä¸ªç¼–å·çš„job-nameå·²ç»è¢«å‘ç°å¹¶è·å–æ•°æ®ã€‚</p><blockquote><p>æ€è€ƒï¼šå¦‚ä½•å°†åº”ç”¨podç­‰ç›‘æ§è¿›æ¥</p></blockquote><h4 id="3-grafanaéƒ¨ç½²"><a href="#3-grafanaéƒ¨ç½²" class="headerlink" title="3.grafanaéƒ¨ç½²"></a>3.grafanaéƒ¨ç½²</h4><pre><code class="hljs">å®˜æ–¹dockerhubåœ°å€ï¼šhttps://hub.docker.com/r/grafana/grafanaå®˜æ–¹githubåœ°å€ï¼šhttps://github.com/grafana/grafanagrafanaå®˜ç½‘ï¼šhttps://grafana.com/</code></pre><p>â€‹<br>â€‹<br>â€‹    #é¦–å…ˆéœ€è¦åˆ›å»ºå…±äº«å­˜å‚¨ç›®å½• 192.168.1.115<br>â€‹    [root@k8s-node02 grafana]# cat &#x2F;etc&#x2F;exports<br>â€‹    &#x2F;data&#x2F;nfs-volume&#x2F;prometheus&#x2F; * (rw,fsid&#x3D;0,sync)<br>â€‹    &#x2F;data&#x2F;nfs&#x2F;grafana&#x2F; * (rw,sync)<br>â€‹    [root@k8s-node02 grafana]# mkdir &#x2F;data&#x2F;nfs&#x2F;grafana&#x2F; -p<br>â€‹    [root@k8s-node02 grafana]# systemctl restart nfs<br>â€‹    </p><pre><code class="hljs">#åˆ›å»ºgrafanaéœ€è¦çš„yamlæ–‡ä»¶[root@k8s-master01 ~]# mkdir /k8s-yaml/grafana &amp;&amp; cd /k8s-yaml/grafana[root@k8s-master01 grafana]# vim grafana.yaml[root@k8s-master01 grafana]# cat grafana.yaml apiVersion: apps/v1kind: Deploymentmetadata:  name: grafana  namespace: kube-system  labels:    app: grafanaspec:  replicas: 1  selector:    matchLabels:      app: grafana  template:    metadata:      labels:        app: grafana    spec:      containers:      - name: grafana        image: grafana/grafana:latest        ports:        - containerPort: 3000        volumeMounts:---apiVersion: v1kind: Servicemetadata:  name: grafana-svc  namespace: kube-systemspec:  ports:  - port: 3000    targetPort: 3000    nodePort: 3303  type: NodePort  selector:    app: grafana    [root@k8s-master01 grafana]# kubectl create -f grafana.yaml deployment.apps/grafana createdservice/grafana-svc created[root@k8s-master01 grafana]# kubectl get pod -n kube-system |grep grafanagrafana-6dc6566c6b-44wsw                   1/1     Running       0               22s11074 11670   8588  </code></pre>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos8å¿˜è®°rootç”¨æˆ·å¯†ç </title>
    <link href="/2025/03/19/Centos8%E5%BF%98%E8%AE%B0root%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81/"/>
    <url>/2025/03/19/Centos8%E5%BF%98%E8%AE%B0root%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h2 id="1-å¯åŠ¨centos8ç³»ç»Ÿ-åœ¨å¼€æœºç•Œé¢é€‰æ‹©ç¬¬ä¸€è¡Œï¼ŒæŒ‰e"><a href="#1-å¯åŠ¨centos8ç³»ç»Ÿ-åœ¨å¼€æœºç•Œé¢é€‰æ‹©ç¬¬ä¸€è¡Œï¼ŒæŒ‰e" class="headerlink" title="1.å¯åŠ¨centos8ç³»ç»Ÿ,åœ¨å¼€æœºç•Œé¢é€‰æ‹©ç¬¬ä¸€è¡Œï¼ŒæŒ‰e"></a>1.å¯åŠ¨centos8ç³»ç»Ÿ,åœ¨å¼€æœºç•Œé¢é€‰æ‹©ç¬¬ä¸€è¡Œï¼ŒæŒ‰e</h2><p><img src="https://www.ttgogogo.cn/usr/uploads/2022/02/3353281327.jpg" alt="10.jpg"></p><h2 id="2-è¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œæ‰¾åˆ°roå¹¶å°†å…¶ä¿®æ”¹ä¸ºrw-init-sysroot-bin-bash"><a href="#2-è¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œæ‰¾åˆ°roå¹¶å°†å…¶ä¿®æ”¹ä¸ºrw-init-sysroot-bin-bash" class="headerlink" title="2.è¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œæ‰¾åˆ°roå¹¶å°†å…¶ä¿®æ”¹ä¸ºrw init&#x3D;&#x2F;sysroot&#x2F;bin&#x2F;bash"></a>2.è¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œæ‰¾åˆ°roå¹¶å°†å…¶ä¿®æ”¹ä¸ºrw init&#x3D;&#x2F;sysroot&#x2F;bin&#x2F;bash</h2><p><img src="https://www.ttgogogo.cn/usr/uploads/2022/02/1320728506.png" alt="11.png"></p><h2 id="3-åŒæ—¶æŒ‰ä½ctrlå’Œxé”®ï¼Œç³»ç»Ÿè¿›å…¥ä»¥ä¸‹ç•Œé¢"><a href="#3-åŒæ—¶æŒ‰ä½ctrlå’Œxé”®ï¼Œç³»ç»Ÿè¿›å…¥ä»¥ä¸‹ç•Œé¢" class="headerlink" title="3.åŒæ—¶æŒ‰ä½ctrlå’Œxé”®ï¼Œç³»ç»Ÿè¿›å…¥ä»¥ä¸‹ç•Œé¢"></a>3.åŒæ—¶æŒ‰ä½ctrlå’Œxé”®ï¼Œç³»ç»Ÿè¿›å…¥ä»¥ä¸‹ç•Œé¢</h2><p> <img src="https://www.ttgogogo.cn/usr/uploads/2022/02/269935157.png" alt="12.png"></p><h2 id="4-è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹å¯†ç "><a href="#4-è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹å¯†ç " class="headerlink" title="4.è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹å¯†ç "></a>4.è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹å¯†ç </h2><p>&#x2F;# chroot &#x2F;sysroot&#x2F;      &#x2F;åˆ‡æ¢å›åŸå§‹ç³»ç»Ÿ&#x2F;</p><p>&#x2F;# LANG&#x3D;en           &#x2F;æŠŠè¯­è¨€æ”¹ä¸ºè‹±æ–‡&#x2F;</p><p>&#x2F;# passwd            &#x2F;è®¾ç½®æ–°å¯†ç &#x2F;</p><p>&#x2F;# touch &#x2F;.autorelabel    &#x2F;ä½¿å¯†ç ç”Ÿæ•ˆ&#x2F;</p><p><img src="https://www.ttgogogo.cn/usr/uploads/2022/02/794660917.png" alt="1.png"></p><h2 id="5-åŒæ—¶æŒ‰ä½Ctrlå’Œdé”®ï¼Œè¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œè¾“å…¥rebootï¼Œé‡å¯ç³»ç»Ÿ"><a href="#5-åŒæ—¶æŒ‰ä½Ctrlå’Œdé”®ï¼Œè¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œè¾“å…¥rebootï¼Œé‡å¯ç³»ç»Ÿ" class="headerlink" title="5.åŒæ—¶æŒ‰ä½Ctrlå’Œdé”®ï¼Œè¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œè¾“å…¥rebootï¼Œé‡å¯ç³»ç»Ÿ"></a>5.åŒæ—¶æŒ‰ä½Ctrlå’Œdé”®ï¼Œè¿›å…¥ä»¥ä¸‹ç•Œé¢ï¼Œè¾“å…¥rebootï¼Œé‡å¯ç³»ç»Ÿ</h2><p><img src="https://www.ttgogogo.cn/usr/uploads/2022/02/4091631669.png" alt="14.png"></p><h2 id="6-ç³»ç»Ÿé‡å¯æˆåŠŸåï¼Œè¾“å…¥æ–°è®¾ç½®çš„å¯†ç å³å¯æ­£å¸¸ç™»å½•"><a href="#6-ç³»ç»Ÿé‡å¯æˆåŠŸåï¼Œè¾“å…¥æ–°è®¾ç½®çš„å¯†ç å³å¯æ­£å¸¸ç™»å½•" class="headerlink" title="6.ç³»ç»Ÿé‡å¯æˆåŠŸåï¼Œè¾“å…¥æ–°è®¾ç½®çš„å¯†ç å³å¯æ­£å¸¸ç™»å½•"></a>6.ç³»ç»Ÿé‡å¯æˆåŠŸåï¼Œè¾“å…¥æ–°è®¾ç½®çš„å¯†ç å³å¯æ­£å¸¸ç™»å½•</h2><p>åŸæ–‡æ¥è‡ªï¼š<a href="https://www.cnblogs.com/canyezhizi/p/13574958.html">Cnblog</a></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7å¿˜è®°rootè´¦æˆ·å¯†ç </title>
    <link href="/2025/03/19/Centos7%E5%BF%98%E8%AE%B0root%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81/"/>
    <url>/2025/03/19/Centos7%E5%BF%98%E8%AE%B0root%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h4 id="ç¬¬ä¸€æ­¥ï¼šå¼€å¯æœåŠ¡å™¨ï¼Œåœ¨å¦‚ä¸‹ç•Œé¢é”®å…¥â€eâ€è¿›å…¥ç¼–è¾‘"><a href="#ç¬¬ä¸€æ­¥ï¼šå¼€å¯æœåŠ¡å™¨ï¼Œåœ¨å¦‚ä¸‹ç•Œé¢é”®å…¥â€eâ€è¿›å…¥ç¼–è¾‘" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå¼€å¯æœåŠ¡å™¨ï¼Œåœ¨å¦‚ä¸‹ç•Œé¢é”®å…¥â€eâ€è¿›å…¥ç¼–è¾‘"></a>ç¬¬ä¸€æ­¥ï¼šå¼€å¯æœåŠ¡å™¨ï¼Œåœ¨å¦‚ä¸‹ç•Œé¢é”®å…¥â€eâ€è¿›å…¥ç¼–è¾‘</h4><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319171617009.png" alt="image-20250319171617009"></p><h4 id="ç¬¬äºŒæ­¥ï¼šæ‰¾åˆ°ä»¥linux16å¼€å¤´çš„ä¸€è¡Œï¼Œåœ¨æœ¬è¡Œè¡Œå°¾é”®å…¥â€rd-breakâ€"><a href="#ç¬¬äºŒæ­¥ï¼šæ‰¾åˆ°ä»¥linux16å¼€å¤´çš„ä¸€è¡Œï¼Œåœ¨æœ¬è¡Œè¡Œå°¾é”®å…¥â€rd-breakâ€" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šæ‰¾åˆ°ä»¥linux16å¼€å¤´çš„ä¸€è¡Œï¼Œåœ¨æœ¬è¡Œè¡Œå°¾é”®å…¥â€rd.breakâ€"></a>ç¬¬äºŒæ­¥ï¼šæ‰¾åˆ°ä»¥linux16å¼€å¤´çš„ä¸€è¡Œï¼Œåœ¨æœ¬è¡Œè¡Œå°¾é”®å…¥â€rd.breakâ€</h4><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319171636219.png" alt="image-20250319171636219"></p><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319171654534.png" alt="image-20250319171654534"></p><h4 id="ç¬¬ä¸‰æ­¥ï¼šè¾“å…¥å®Œæˆåï¼ŒæŒ‰â€œCtrl-xâ€è¿è¡Œ"><a href="#ç¬¬ä¸‰æ­¥ï¼šè¾“å…¥å®Œæˆåï¼ŒæŒ‰â€œCtrl-xâ€è¿è¡Œ" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šè¾“å…¥å®Œæˆåï¼ŒæŒ‰â€œCtrl+xâ€è¿è¡Œ"></a>ç¬¬ä¸‰æ­¥ï¼šè¾“å…¥å®Œæˆåï¼ŒæŒ‰â€œCtrl+xâ€è¿è¡Œ</h4><h4 id="ç¬¬å››æ­¥ï¼šç°åœ¨çš„æ ¹ä¸ºåªè¯»çŠ¶æ€ï¼Œéœ€è¦æŒ‚è½½ä¸ºè¯»å†™çŠ¶æ€ä»¥ä¾¿è¿›è¡Œä¿®æ”¹ï¼›è¾“å…¥â€œmount-o-remount-rw-sysrootâ€"><a href="#ç¬¬å››æ­¥ï¼šç°åœ¨çš„æ ¹ä¸ºåªè¯»çŠ¶æ€ï¼Œéœ€è¦æŒ‚è½½ä¸ºè¯»å†™çŠ¶æ€ä»¥ä¾¿è¿›è¡Œä¿®æ”¹ï¼›è¾“å…¥â€œmount-o-remount-rw-sysrootâ€" class="headerlink" title="ç¬¬å››æ­¥ï¼šç°åœ¨çš„æ ¹ä¸ºåªè¯»çŠ¶æ€ï¼Œéœ€è¦æŒ‚è½½ä¸ºè¯»å†™çŠ¶æ€ä»¥ä¾¿è¿›è¡Œä¿®æ”¹ï¼›è¾“å…¥â€œmount -o remount,rw &#x2F;sysrootâ€"></a>ç¬¬å››æ­¥ï¼šç°åœ¨çš„æ ¹ä¸ºåªè¯»çŠ¶æ€ï¼Œéœ€è¦æŒ‚è½½ä¸ºè¯»å†™çŠ¶æ€ä»¥ä¾¿è¿›è¡Œä¿®æ”¹ï¼›è¾“å…¥â€œmount -o remount,rw &#x2F;sysrootâ€</h4><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319172132380.png" alt="image-20250319172132380"></p><h4 id="ç¬¬å…­æ­¥ï¼šåˆ‡æ¢æ ¹ï¼Œè¿›å…¥åˆ°sh"><a href="#ç¬¬å…­æ­¥ï¼šåˆ‡æ¢æ ¹ï¼Œè¿›å…¥åˆ°sh" class="headerlink" title="ç¬¬å…­æ­¥ï¼šåˆ‡æ¢æ ¹ï¼Œè¿›å…¥åˆ°sh"></a>ç¬¬å…­æ­¥ï¼šåˆ‡æ¢æ ¹ï¼Œè¿›å…¥åˆ°sh</h4><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319172627511.png" alt="image-20250319172627511"></p><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319172647504.png" alt="image-20250319172647504"></p><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319172709327.png" alt="image-20250319172709327"></p><h4 id="ç¬¬å…«æ­¥ï¼šé€€å‡ºå¹¶é‡å¯"><a href="#ç¬¬å…«æ­¥ï¼šé€€å‡ºå¹¶é‡å¯" class="headerlink" title="ç¬¬å…«æ­¥ï¼šé€€å‡ºå¹¶é‡å¯"></a>ç¬¬å…«æ­¥ï¼šé€€å‡ºå¹¶é‡å¯</h4><p><img src="https://cdn.jsdelivr.net/gh/Tis-FYI/img@main/image-20250319172726698.png" alt="image-20250319172726698"></p><h4 id="ç¬¬ä¹æ­¥ï¼šä½¿ç”¨æ–°å¯†ç è¿›è¡Œç™»å½•"><a href="#ç¬¬ä¹æ­¥ï¼šä½¿ç”¨æ–°å¯†ç è¿›è¡Œç™»å½•" class="headerlink" title="ç¬¬ä¹æ­¥ï¼šä½¿ç”¨æ–°å¯†ç è¿›è¡Œç™»å½•"></a>ç¬¬ä¹æ­¥ï¼šä½¿ç”¨æ–°å¯†ç è¿›è¡Œç™»å½•</h4>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ€ä¹ˆè·å–ç£ç›˜é…é¢çš„sid</title>
    <link href="/2025/03/19/%E6%80%8E%E4%B9%88%E8%8E%B7%E5%8F%96%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9D%E7%9A%84sid/"/>
    <url>/2025/03/19/%E6%80%8E%E4%B9%88%E8%8E%B7%E5%8F%96%E7%A3%81%E7%9B%98%E9%85%8D%E9%A2%9D%E7%9A%84sid/</url>
    
    <content type="html"><![CDATA[<h1 id="å¯¼å‡ºå¯¹åº”çš„sidä¿¡æ¯åˆ°æ–‡æœ¬"><a href="#å¯¼å‡ºå¯¹åº”çš„sidä¿¡æ¯åˆ°æ–‡æœ¬" class="headerlink" title="å¯¼å‡ºå¯¹åº”çš„sidä¿¡æ¯åˆ°æ–‡æœ¬"></a>å¯¼å‡ºå¯¹åº”çš„sidä¿¡æ¯åˆ°æ–‡æœ¬</h1><p>sutil.exe quota query D: &gt; 1.txt</p><h1 id="æŸ¥è¯¢ç‰¹å®šçš„sid"><a href="#æŸ¥è¯¢ç‰¹å®šçš„sid" class="headerlink" title="æŸ¥è¯¢ç‰¹å®šçš„sid"></a>æŸ¥è¯¢ç‰¹å®šçš„sid</h1><p>wmic useraccount get name,sid |findstr ftpç”¨æˆ·å</p>]]></content>
    
    
    <categories>
      
      <category>windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LinuxæŸ¥çœ‹ç™»å½•æ—¥å¿—</title>
    <link href="/2025/03/19/Linux%E6%9F%A5%E7%9C%8B%E7%99%BB%E5%BD%95%E6%97%A5%E5%BF%97/"/>
    <url>/2025/03/19/Linux%E6%9F%A5%E7%9C%8B%E7%99%BB%E5%BD%95%E6%97%A5%E5%BF%97/</url>
    
    <content type="html"><![CDATA[<p>####&#x2F;var&#x2F;run&#x2F;utmp</p><blockquote><p>(ç”¨äºè®°å½•å½“å‰æ‰“å¼€çš„ä¼šè¯)è¢«<code>who</code>å’Œ<code>w</code>ç”¨æ¥è®°å½•å½“å‰æœ‰è°ç™»å½•ä»¥åŠä»–ä»¬æ­£åœ¨åšä»€ä¹ˆï¼Œuptimeç”¨æ¥è®°å½•ç³»ç»Ÿå¯åŠ¨æ—¶é—´ã€‚</p></blockquote><p>####&#x2F;var&#x2F;log&#x2F;wtmp</p><blockquote><p>(ç”¨äºå­˜å‚¨ç³»ç»Ÿè¿æ¥å†å²è®°å½•)è¢«lastå·¥å…·ç”¨æ¥è®°å½•æœ€åç™»å½•çš„ç”¨æˆ·çš„åˆ—è¡¨ã€‚</p></blockquote><p>####&#x2F;var&#x2F;log&#x2F;btmp</p><blockquote><p>(è®°å½•å¤±è´¥çš„ç™»å½•å°è¯•)è¢«lastbå·¥å…·ç”¨æ¥è®°å½•æœ€åå¤±è´¥çš„ç™»å½•å°è¯•çš„åˆ—è¡¨ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windowsä½¿ç”¨APPCMDå¯¼å‡ºå¯¹åº”çš„é…ç½®å†…å®¹</title>
    <link href="/2025/03/19/windows%E4%BD%BF%E7%94%A8APPCMD%E5%AF%BC%E5%87%BA%E5%AF%B9%E5%BA%94%E7%9A%84%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9/"/>
    <url>/2025/03/19/windows%E4%BD%BF%E7%94%A8APPCMD%E5%AF%BC%E5%87%BA%E5%AF%B9%E5%BA%94%E7%9A%84%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<h4 id="å¯¼å‡ºæ‰€æœ‰åº”ç”¨ç¨‹åºæ± "><a href="#å¯¼å‡ºæ‰€æœ‰åº”ç”¨ç¨‹åºæ± " class="headerlink" title="å¯¼å‡ºæ‰€æœ‰åº”ç”¨ç¨‹åºæ± "></a>å¯¼å‡ºæ‰€æœ‰åº”ç”¨ç¨‹åºæ± </h4><blockquote><p>%windir%\system32\inetsrv\appcmd list apppool &#x2F;config &#x2F;xml &gt; c:\apppools.xml</p></blockquote><h4 id="å¯¼å…¥æ‰€æœ‰åº”ç”¨ç¨‹åºæ± "><a href="#å¯¼å…¥æ‰€æœ‰åº”ç”¨ç¨‹åºæ± " class="headerlink" title="å¯¼å…¥æ‰€æœ‰åº”ç”¨ç¨‹åºæ± "></a>å¯¼å…¥æ‰€æœ‰åº”ç”¨ç¨‹åºæ± </h4><blockquote><p>%windir%\system32\inetsrv\appcmd add apppool &#x2F;in &lt; c:\apppools.xml</p></blockquote><h4 id="å¯¼å‡ºæ‰€æœ‰ç«™ç‚¹"><a href="#å¯¼å‡ºæ‰€æœ‰ç«™ç‚¹" class="headerlink" title="å¯¼å‡ºæ‰€æœ‰ç«™ç‚¹"></a>å¯¼å‡ºæ‰€æœ‰ç«™ç‚¹</h4><blockquote><p>%windir%\system32\inetsrv\appcmd list site &#x2F;config &#x2F;xml &gt; c:\sites.xml</p></blockquote><h4 id="å¯¼å…¥æ‰€æœ‰ç«™ç‚¹"><a href="#å¯¼å…¥æ‰€æœ‰ç«™ç‚¹" class="headerlink" title="å¯¼å…¥æ‰€æœ‰ç«™ç‚¹"></a>å¯¼å…¥æ‰€æœ‰ç«™ç‚¹</h4><blockquote><p>%windir%\system32\inetsrv\appcmd add site &#x2F;in &lt; c:\sites.xml</p></blockquote><h4 id="å¯¼å‡ºå•ç‹¬çš„åº”ç”¨ç¨‹åºæ± "><a href="#å¯¼å‡ºå•ç‹¬çš„åº”ç”¨ç¨‹åºæ± " class="headerlink" title="å¯¼å‡ºå•ç‹¬çš„åº”ç”¨ç¨‹åºæ± "></a>å¯¼å‡ºå•ç‹¬çš„åº”ç”¨ç¨‹åºæ± </h4><blockquote><p>%windir%\system32\inetsrv\appcmd list apppool â€œåº”ç”¨ç¨‹åºæ± åç§°â€ &#x2F;config &#x2F;xml &gt; c:\myapppool.xml</p></blockquote><h4 id="å¯¼å…¥å•ç‹¬çš„åº”ç”¨ç¨‹åºæ± "><a href="#å¯¼å…¥å•ç‹¬çš„åº”ç”¨ç¨‹åºæ± " class="headerlink" title="å¯¼å…¥å•ç‹¬çš„åº”ç”¨ç¨‹åºæ± "></a>å¯¼å…¥å•ç‹¬çš„åº”ç”¨ç¨‹åºæ± </h4><blockquote><p>%windir%\system32\inetsrv\appcmd add apppool &#x2F;in &lt; c:\myapppool.xml</p></blockquote><h1 id="å¯¼å‡ºå•ç‹¬ç«™ç‚¹"><a href="#å¯¼å‡ºå•ç‹¬ç«™ç‚¹" class="headerlink" title="å¯¼å‡ºå•ç‹¬ç«™ç‚¹"></a>å¯¼å‡ºå•ç‹¬ç«™ç‚¹</h1><blockquote><p>%windir%\system32\inetsrv\appcmd list site â€œç«™ç‚¹åç§°â€ &#x2F;config &#x2F;xml &gt; c:\mywebsite.xml</p></blockquote><h1 id="å¯¼å…¥å•ç‹¬ç«™ç‚¹"><a href="#å¯¼å…¥å•ç‹¬ç«™ç‚¹" class="headerlink" title="å¯¼å…¥å•ç‹¬ç«™ç‚¹"></a>å¯¼å…¥å•ç‹¬ç«™ç‚¹</h1><blockquote><p>%windir%\system32\inetsrv\appcmd add site &#x2F;in &lt; c:\mywebsite.xml</p></blockquote><p><a href="https://www.cnblogs.com/fanful/p/13061783.html">åŸæ¥æ¥è‡ª</a>ï¼š<a href="https://www.cnblogs.com/fanful/p/13061783.html">https://www.cnblogs.com/fanful/p/13061783.html</a></p>]]></content>
    
    
    <categories>
      
      <category>windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®°</title>
    <link href="/2025/03/19/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2025/03/19/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h4 id="ä¸€-Redisç®€ä»‹"><a href="#ä¸€-Redisç®€ä»‹" class="headerlink" title="ä¸€.Redisç®€ä»‹"></a>ä¸€.Redisç®€ä»‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSD è®¸å¯ï¼‰çš„å†…å­˜ä¸­æ•°æ®ç»“æ„å­˜å‚¨ï¼Œç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯ä»£ç†å’Œæµå¼•æ“ã€‚Redis æä¾›æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†ã€å¸¦æœ‰èŒƒå›´æŸ¥è¯¢çš„æ’åºé›†ã€ä½å›¾ã€hyperloglogã€åœ°ç†ç©ºé—´ç´¢å¼•å’Œæµã€‚Redis å…·æœ‰å†…ç½®å¤åˆ¶ã€Lua è„šæœ¬ã€LRU é€å‡ºã€äº‹åŠ¡å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…æ€§ï¼Œå¹¶é€šè¿‡ Redis Sentinel æä¾›é«˜å¯ç”¨æ€§ï¼Œå¹¶ä½¿ç”¨ Redis Cluster è¿›è¡Œè‡ªåŠ¨åˆ†åŒºã€‚<br>å¯ä»¥å¯¹è¿™äº›ç±»å‹è¿è¡ŒåŸå­æ“ä½œï¼Œä¾‹å¦‚è¿½åŠ åˆ°å­—ç¬¦ä¸²;é€’å¢å“ˆå¸Œä¸­çš„å€¼;å°†å…ƒç´ æ¨é€åˆ°åˆ—è¡¨;è®¡ç®—é›†äº¤é›†ã€å¹¶é›†å’Œå·®åˆ†;æˆ–è€…åœ¨æ’åºé›†ä¸­è·å¾—æ’åæœ€é«˜çš„æˆå‘˜ã€‚<br>Redis å¯ä»¥é€šè¿‡å®šæœŸå°†æ•°æ®é›†è½¬å‚¨åˆ°ç£ç›˜æˆ–å°†æ¯ä¸ªå‘½ä»¤é™„åŠ åˆ°åŸºäºç£ç›˜çš„æ—¥å¿—æ¥æŒä¹…ä¿å­˜æ•°æ®ã€‚<br>Redis æ”¯æŒå¼‚æ­¥å¤åˆ¶ï¼Œå…·æœ‰å¿«é€Ÿæ— é˜»å¡åŒæ­¥å’Œè‡ªåŠ¨é‡æ–°è¿æ¥ï¼Œå¹¶åœ¨ç½‘ç»œæ‹†åˆ†æ—¶è¿›è¡Œéƒ¨åˆ†é‡æ–°åŒæ­¥ã€‚<br></code></pre></td></tr></table></figure><h4 id="äºŒ-åœ¨linuxä¸Šå®‰è£…redis"><a href="#äºŒ-åœ¨linuxä¸Šå®‰è£…redis" class="headerlink" title="äºŒ.åœ¨linuxä¸Šå®‰è£…redis"></a>äºŒ.åœ¨linuxä¸Šå®‰è£…redis</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ubuntu/Debianå®‰è£…æ–¹æ³•</span><br>curl -fsSL https://packages.redis.io/gpg | <span class="hljs-built_in">sudo</span> gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg <span class="hljs-comment"># ä¸‹è½½å¯†é’¥</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb <span class="hljs-subst">$(lsb_release -cs)</span> main&quot;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/redis.list<br><br><span class="hljs-built_in">sudo</span> apt-get update<br><span class="hljs-built_in">sudo</span> apt-get install redis<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># centos yum æ–¹å¼å®‰è£…redis</span><br><span class="hljs-built_in">sudo</span> yum install epel-release<br><span class="hljs-built_in">sudo</span> yum update<br><br>ç„¶åå®‰è£…Redisæ•°æ®åº“ï¼š<br><span class="hljs-built_in">sudo</span> yum -y install redis<br><br>å®‰è£…å¥½åå¯åŠ¨RedisæœåŠ¡å³å¯ï¼š<br><span class="hljs-built_in">sudo</span> systemctl start redis<br>è¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨redis-cliè¿›å…¥Rediså‘½ä»¤è¡Œæ¨¡å¼æ“ä½œã€‚<br><br>éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè·¯å¾„ä¸º/etc/redis.conf<br><br>vi /etc/redis.conf<br>éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š<br><br>é¦–å…ˆï¼Œæ³¨é‡Šè¿™ä¸€è¡Œï¼š#<span class="hljs-built_in">bind</span> 127.0.0.1<br><br>å¦å¤–ï¼Œæ¨èç»™Redisè®¾ç½®å¯†ç ï¼Œå–æ¶ˆæ³¨é‡Šè¿™ä¸€è¡Œå¹¶è®¾ç½®å¯†ç ï¼š#requirepass foobared<br><br>ç„¶åé‡å¯RedisæœåŠ¡ï¼Œä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š<br><br><span class="hljs-built_in">sudo</span> systemctl restart redis<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æºç ç¼–è¯‘redis</span><br>https://redis.io/download/ <span class="hljs-comment"># ä¸‹è½½åœ°å€</span><br><br>tar -zxvf redis-xxxx.tar.gz  <span class="hljs-comment"># è§£å‹ä¸‹è½½çš„rediså‹ç¼©åŒ…</span><br><br>yum install gcc-c++ -y <span class="hljs-comment"># å®‰è£…ç¼–è¯‘å·¥å…·</span><br><br>gcc -v  <span class="hljs-comment">#æŸ¥çœ‹GCCç‰ˆæœ¬</span><br><br><span class="hljs-built_in">cd</span> redis-x.x.x  &amp;&amp; make &amp;&amp; make install  <span class="hljs-comment"># åˆ‡æ¢åˆ°æºç è·¯å¾„ä¸‹è¿›è¡Œç¼–è¯‘  ï¼Œæˆ–è€…æ˜¯å¯ä»¥æŒ‡å®šä½ å‘è¦å­˜æ”¾redisçš„è·¯å¾„  make install PREFIX=/usr/local/redis/</span><br><br><span class="hljs-comment"># å¦‚æœæ˜¯ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°å¯¹åº”çš„binç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥  redis-server å¯åŠ¨å¯¹åº”çš„redis</span><br><br><span class="hljs-comment"># åå°æ¨¡å¼å¯åŠ¨redisï¼Œéœ€è¦ä¿®æ”¹redisé…ç½®æ–‡ä»¶å½“ä¸­çš„daemonizeå­—æ®µä¸ºyesï¼Œä¿®æ”¹å®Œæˆä¹‹åé‡æ–°å¯åŠ¨æœåŠ¡</span><br><br><span class="hljs-comment"># ç™»å½•redis</span><br>redis-cli -h 192.168.10.20 -p 6379  <span class="hljs-comment"># è¿œç¨‹è¿æ¥redisï¼Œè¿›å…¥ä¹‹åï¼Œå¦‚æœæ˜¯ä¹‹å‰è®¾ç½®è¿‡redisçš„å¯†ç ï¼Œé‚£ä¹ˆä½¿ç”¨auth  å¯†ç   è¿›è¡Œè®¤è¯</span><br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># windows ä¸Šå®‰è£…redisï¼Œå®˜æ–¹æ˜¯ä¸æ”¯æŒwindowsçš„ï¼Œä½†æ˜¯å¯ä»¥å®‰è£…WSL2æ¥è¿è¡Œlinuxçš„äºŒè¿›åˆ¶åŒ…</span><br><br>To install Redis on Windows, you<span class="hljs-string">&#x27;ll first need to enable WSL2 (Windows Subsystem for Linux). WSL2 lets you run Linux binaries natively on Windows. For this method to work, you&#x27;</span>ll need to be running Windows 10 version 2004 and higher or Windows 11<br><br></code></pre></td></tr></table></figure><h4 id="ä¸‰-æ€ä¹ˆå‡çº§redis"><a href="#ä¸‰-æ€ä¹ˆå‡çº§redis" class="headerlink" title="ä¸‰.æ€ä¹ˆå‡çº§redis"></a>ä¸‰.æ€ä¹ˆå‡çº§redis</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">æ³¨æ„ï¼Œåœ¨çœ‹æœ¬æ•™ç¨‹å‰ï¼Œè¯·å…ˆè‡ªè¡Œå¤‡ä»½é…ç½®æ–‡ä»¶ä»¥åŠæ•°æ®ã€‚<br>å¦‚æœæŒä¹…åŒ–ç”¨çš„æ˜¯rdbï¼Œå¤‡ä»½<span class="hljs-string">.rdb</span>æ–‡ä»¶ï¼Œé»˜è®¤å«dump.rdbï¼Œå¦‚æœä½ æ›´æ”¹ä¸ºå…¶ä»–åå­—ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹é…ç½®ï¼Œä½ çš„<span class="hljs-string">.rdb</span>å«ä»€ä¹ˆã€‚å®Œæˆæœ¬æ•™ç¨‹åï¼ŒæŠŠ<span class="hljs-string">.rdb</span>æ–‡ä»¶æ”¾å…¥redisçš„å¯åŠ¨ç›®å½•å³å¯ã€‚ä¸çŸ¥é“å¯åŠ¨ç›®å½•ï¼Œå°±åœ¨redis-cil å‘½ä»¤è¡Œè¾“å…¥config get diræŸ¥çœ‹<br>å¦‚æœæŒä¹…åŒ–ç”¨çš„æ˜¯aofï¼Œå¤‡ä»½<span class="hljs-string">.aof</span>æ–‡ä»¶ï¼Œé»˜è®¤å«appendonly.aof<br>æœ¬æ•™ç¨‹å†™çš„æ—¶å€™æ˜¯redisç‰ˆæœ¬æ˜¯ redis-6.0.9 ï¼Œå¦‚æœé«˜äºæ­¤ç‰ˆæœ¬æˆ–è€…ä½äºæ­¤ç‰ˆæœ¬ï¼Œç›®å½•ç»“æœä¸ä¸€æ ·ï¼Œè¯·å®‰è£…redis-6.0.9 ç‰ˆæœ¬ï¼ŒæŠŠæ–‡ä¸­çš„ redis-X.X.X æ›¿æ¢ä¸º redis-6.0.9<br>ç³»ç»Ÿç‰ˆæœ¬<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh">å¦‚æœæ˜¯é€šè¿‡ apt-get install redis-server æ–¹å¼å®‰è£…çš„ redis ï¼Œå¯ä»¥è¾“å…¥ apt-get remove --purge redis-server è¿›è¡Œredisçš„å¸è½½æ“ä½œï¼Œè¾“å…¥æ­¤å‘½ä»¤ä¼šé—®ä½ æ˜¯å¦å¸è½½ï¼Œè¾“å…¥ Y ç¡®è®¤å¸è½½ redis ã€‚<br>ç„¶åè¾“å…¥ redis-server -v æŸ¥çœ‹æ˜¯å¦å¸è½½å®Œæˆï¼Œå¦‚æœå‡ºç°æç¤º Command <span class="hljs-string">&#x27;redis-server&#x27;</span> not found è¯´æ˜å¸è½½æˆåŠŸã€‚<br><br><span class="hljs-comment"># å¸è½½redis</span><br>apt-get remove --purge redis-server<br><span class="hljs-comment"># å¸è½½ä¹‹åæŸ¥çœ‹redisç‰ˆæœ¬ä¿¡æ¯</span><br>redis-server -v<br><br><span class="hljs-comment"># å®‰è£…ç¼–è¯‘å·¥å…·gcc</span><br>æ£€æŸ¥æ˜¯å¦å®‰è£…äº† gcc ï¼Œè¾“å…¥ gcc --version è¿›è¡ŒæŸ¥çœ‹æ˜¯å¦å®‰è£…äº† gcc ï¼Œå¦‚æœå‡ºç° Command <span class="hljs-string">&#x27;gcc&#x27;</span> not found,but can be installed with: apt install gcc ï¼Œåˆ™è¯´æ˜æ²¡ç”¨å®‰è£… gccï¼Œéœ€è¦è¾“å…¥ apt install gcc è¿›è¡Œå®‰è£…ã€‚ç„¶åå†æ¬¡è¾“å…¥ gcc --version æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ<br><br><br><br>ç„¶åè¿›å…¥ /usr/local ç›®å½•ä¸‹è½½ redis æœ€æ–°å®‰è£…å‹ç¼©åŒ…ï¼Œå®‰è£…å®Œæˆåè¾“å…¥ <span class="hljs-built_in">ls</span> å¯ä»¥æŸ¥çœ‹åˆ°ä¸‹è½½æˆåŠŸçš„æ–‡ä»¶ redis-x.x.x.taz.gzã€‚å» rediså®˜ç½‘ æŸ¥çœ‹ä¸‹è½½é“¾æ¥ä»¥åŠæœ€æ–°ç‰ˆæœ¬ã€‚<br><br><span class="hljs-built_in">cd</span> /usr/local<br><br><span class="hljs-comment"># è¿›å…¥ /usr/local ç›®å½•</span><br><br>wget https://download.redis.io/releases/redis-X.X.X.tar.gz<br><br><span class="hljs-comment"># ä¸‹è½½æœ€æ–°çš„ redis ï¼Œæ­¤å¤„æˆ‘ç”¨ X.X.X ä»£æ›¿ï¼Œå› ä¸º redis æ˜¯ä¸€ç›´åœ¨æ›´æ–°çš„ï¼Œæ‰€ä»¥ä½ è‡ªå·±å»å®˜æ–¹æŸ¥çœ‹</span><br><br><span class="hljs-built_in">ls</span>  <span class="hljs-comment"># çœ‹åˆ°æœ‰ redis-x.x.x.taz.gz ï¼Œè¯´æ˜ä¸‹è½½æˆåŠŸ</span><br></code></pre></td></tr></table></figure><h4 id="è§£å‹å®‰è£…redis"><a href="#è§£å‹å®‰è£…redis" class="headerlink" title="è§£å‹å®‰è£…redis"></a>è§£å‹å®‰è£…redis</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">ç„¶åè§£å‹ redis-x.x.x.taz.gz ï¼Œè¾“å…¥ <span class="hljs-built_in">ls</span> æŸ¥çœ‹è§£å‹åçš„ç›®å½• redis-x.x.x ï¼Œç„¶åè¿›å…¥ redis-x.x.x ç›®å½•ï¼Œè¾“å…¥ make è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘å®Œæˆå è¿›å…¥ src ç›®å½•ï¼Œè¾“å…¥ make install è¿›è¡Œå®‰è£…<br><br>tar xzf redis-x.x.x.taz.gz<br><br><span class="hljs-comment"># è§£å‹å‹ç¼©åŒ…</span><br><br><span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># æŸ¥çœ‹è§£å‹åçš„ç›®å½• redis-x.x.x</span><br><br><span class="hljs-built_in">cd</span> redis-x.x.x<br><br><span class="hljs-comment"># è¿›å…¥è§£å‹åçš„ redis-x.x.x ç›®å½•</span><br><br>make<br><br><span class="hljs-comment"># è¿›è¡Œç¼–è¯‘,æ­¤å¤„æ—¶é—´å¯èƒ½ä¼šæœ‰ç‚¹ä¹…</span><br><br><span class="hljs-built_in">cd</span> src &amp;&amp; make install  <span class="hljs-comment"># è‡ªè¡Œåˆ‡æ¢ä¸‹è½½çš„æºç è·¯å¾„</span><br><br><span class="hljs-comment"># è¿›å…¥src ç›®å½•å¹¶è¿›è¡Œå®‰è£…</span><br><br><span class="hljs-comment"># å‡ºç°ä¸‹é¢æ˜¾ç¤ºï¼Œè¯´æ˜å®‰è£…æˆåŠŸ</span><br></code></pre></td></tr></table></figure><h4 id="å¤åˆ¶é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯æœ‰åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œè®°å¾—ä¿å­˜ä¸€ä»½-ä¸‹é¢æ˜¯å¯¹é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨è„šæœ¬åšè°ƒæ•´ï¼‰"><a href="#å¤åˆ¶é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯æœ‰åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œè®°å¾—ä¿å­˜ä¸€ä»½-ä¸‹é¢æ˜¯å¯¹é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨è„šæœ¬åšè°ƒæ•´ï¼‰" class="headerlink" title="å¤åˆ¶é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯æœ‰åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œè®°å¾—ä¿å­˜ä¸€ä»½,ä¸‹é¢æ˜¯å¯¹é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨è„šæœ¬åšè°ƒæ•´ï¼‰"></a>å¤åˆ¶é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯æœ‰åŸæ¥çš„é…ç½®æ–‡ä»¶ï¼Œè®°å¾—ä¿å­˜ä¸€ä»½,ä¸‹é¢æ˜¯å¯¹é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨è„šæœ¬åšè°ƒæ•´ï¼‰</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs sh">ç„¶ååˆ›å»º /etc/redis ç›®å½•ï¼ŒæŠŠ /usr/local/redis-X.X.X/redis.conf æ–‡ä»¶å¤åˆ¶åˆ° /etc/redis/redis.conf ï¼Œå¤åˆ¶å®Œæˆåï¼Œå†æŠŠ /usr/local/redis-.X.X.X/utils/redis_init_script æ–‡ä»¶å¤åˆ¶åˆ° /etc/init.d/redis<br><br><span class="hljs-built_in">mkdir</span> -p /etc/redis<br><br><span class="hljs-comment"># åˆ›å»º /etc/redis ç›®å½•</span><br><br><span class="hljs-built_in">cp</span> /usr/local/redis-X.X.X/redis.conf /etc/redis/redis.conf<br><br><span class="hljs-comment"># æŠŠé…ç½®æ–‡ä»¶å¤åˆ¶åˆ° /etc/redis ç›®å½•ä¸‹</span><br><br><span class="hljs-built_in">cp</span> /usr/local/redis-.X.X.X/utils/redis_init_script /etc/init.d/redis<br><br><span class="hljs-comment"># æŠŠå¯åŠ¨è„šæœ¬å¤åˆ¶åˆ° /etc/init.d ç›®å½•ä¸‹ï¼Œé€šå¸¸éƒ½ä»¥dç»“å°¾è¡¨ç¤ºæ˜¯åå°è‡ªå¯åŠ¨æœåŠ¡</span><br><br>ç„¶åè¿›è¡Œ redisé…ç½®æ–‡ä»¶è®¾ç½®<br><br><span class="hljs-comment"># æŠŠ daemonize è®¾ç½®ä¸º yes ï¼Œå› ä¸ºredis é»˜è®¤ä¸å¼€å¯å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼</span><br>sed -i <span class="hljs-string">&#x27;s/daemonize no/daemonize yes/g&#x27;</span> /etc/redis/redis.conf<br><br><br><span class="hljs-comment"># å¦‚æœè¦å¼€å¯è¿œç¨‹è®¿é—®ï¼Œå°±è¿›è¡Œä¿®æ”¹ï¼Œ* ä»£è¡¨ä»»ä½•åœ°å€éƒ½èƒ½è®¿é—®ï¼Œredis é»˜è®¤æ˜¯</span><br><br><span class="hljs-comment"># åªèƒ½æœ¬åœ°è®¿é—®ï¼Œä¸è¿‡ä¸æƒ³ä»»ä½•åœ°å€éƒ½èƒ½è®¿é—®ï¼Œå°±æŠŠ * æ”¹æˆä½ çš„IPåœ°å€</span><br>sed -i <span class="hljs-string">&#x27;s/bind 127.0.0.1/bind */g&#x27;</span> /etc/redis/redis.conf<br><br><br><span class="hljs-comment"># æ­¤å‘½ä»¤æ˜¯è®¾ç½®rediså¯†ç è®¾ç½®æˆ123456ï¼Œredisé»˜è®¤æ˜¯æ²¡æœ‰å¯†ç çš„ã€‚</span><br><span class="hljs-comment"># å¦‚æœä½ ä¸æƒ³è®¾ç½®å¯†ç ï¼Œå¯ä»¥ä¸è¾“å…¥æ­¤å‘½ä»¤è®¾ç½®å¯†ç ï¼ˆé˜²æ­¢äº”è®¤è¯ç™»å½•redisï¼Œå»ºè®®è¿˜æ˜¯è®¾ç½®å¯†ç è®¤è¯ï¼‰</span><br>sed -i <span class="hljs-string">&#x27;s/# requirepass foobared/requirepass 123456/g&#x27;</span> /etc/redis.conf<br><br><span class="hljs-comment">#æœ€åè®¾ç½®å¼€æœºè‡ªå¯redisä»¥åŠå¯åŠ¨redisæœåŠ¡</span><br><br>update-rc.d -f redis defaults<br><br><span class="hljs-comment"># è®¾ç½®å¼€æœºæ‰§è¡Œè„šæœ¬ï¼Œä¹Ÿå°±æ˜¯æ·»åŠ å¼€æœºè‡ªå¯</span><br><br>service redis start<br><br><span class="hljs-comment"># å¯åŠ¨redisæœåŠ¡</span><br><br>redis-server -v<br><br><span class="hljs-comment"># æŸ¥çœ‹redisç‰ˆæœ¬å·ï¼ŒéªŒè¯ä¸€ä¸‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</span><br><br>ps -ef | grep redis<br><br><span class="hljs-comment"># ä¹Ÿå¯ä»¥è¾“å…¥æ­¤å‘½ä»¤æŸ¥çœ‹redisæ˜¯å¦å¯åŠ¨æˆåŠŸ</span><br><br><br></code></pre></td></tr></table></figure><h4 id="é”™è¯¯ä¸è§£å†³åŠæ³•"><a href="#é”™è¯¯ä¸è§£å†³åŠæ³•" class="headerlink" title="é”™è¯¯ä¸è§£å†³åŠæ³•"></a>é”™è¯¯ä¸è§£å†³åŠæ³•</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">é‡åˆ°çš„é”™è¯¯è§£å†³æ–¹æ¡ˆï¼š<br>å¦‚æœé‡åˆ°æƒé™ä¸è¶³ï¼Œåˆ‡æ¢æˆ root ç”¨æˆ·æˆ–è€…å‘½ä»¤åŠ ä¸Š <span class="hljs-built_in">sudo</span><br><br>è¾“å…¥ redis-server æŠ¥é”™ bash: /usr/bin/redis-server: No such file or directory<br>è§£å†³æ–¹æ¡ˆ<br>1ã€é‡å¯ä¸€ä¸‹æœåŠ¡å™¨ã€‚<br>2ã€æˆ–è€…å»ºç«‹è½¯è¿æ¥<br><span class="hljs-built_in">ln</span> -s /usr/bin/redis-server /usr/local/bin/redis-server<br>3ã€æˆ–è€…æ·»åŠ ç¯å¢ƒå˜é‡path<br></code></pre></td></tr></table></figure><h4 id="å››-redis-cliå½“ä¸­çš„ä¸€äº›åŸºç¡€å‘½ä»¤"><a href="#å››-redis-cliå½“ä¸­çš„ä¸€äº›åŸºç¡€å‘½ä»¤" class="headerlink" title="å››.redis-cliå½“ä¸­çš„ä¸€äº›åŸºç¡€å‘½ä»¤"></a>å››.redis-cliå½“ä¸­çš„ä¸€äº›åŸºç¡€å‘½ä»¤</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å°†æ ‡å‡†è¾“å‡ºå†…å®¹è¾“å‡ºåˆ°æ–‡ä»¶å½“ä¸­</span><br>redis-cli --raw INCR mycounter<br><br><span class="hljs-comment"># è¿œç¨‹è¿æ¥redisæœåŠ¡å™¨å¹¶æ‰§è¡Œå‘½ä»¤ï¼Œç±»ä¼¼äºmysqlå¤–éƒ¨æ‰§è¡Œå‘½ä»¤</span><br>$ redis-cli -h redis15.localnet.org -p 6390 PING<br><br><span class="hljs-comment"># å¯¹äºæœ‰å¯†ç çš„æƒ…å†µï¼Œéœ€è¦ä½¿ç”¨-aå‚æ•°æŒ‡å®šå¯¹åº”çš„å¯†ç </span><br>$ redis-cli -a myUnguessablePazzzzzword123 PING<br><br><span class="hljs-comment"># it&#x27;s possible to send a command that operates on a database number other than the default number zero by using the option </span><br><span class="hljs-comment"># redis-clié»˜è®¤æ“ä½œçš„æ˜¯0å·æ•°æ®åº“ï¼Œå¦‚æœæ˜¯éœ€è¦æ“ä½œå…¶ä»–æ•°æ®åº“ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ -n &lt;dbnum&gt; æŒ‡å®šå¯¹åº”æ‰§è¡Œçš„æ•°æ®åº“</span><br>$ redis-cli FLUSHALL<br>OK<br>$ redis-cli -n 1 INCR a<br>(<span class="hljs-built_in">integer</span>) 1<br>$ redis-cli -n 1 INCR a<br>(<span class="hljs-built_in">integer</span>) 2<br><br><span class="hljs-comment"># ä½¿ç”¨ç‰¹å®šçš„æ ¼å¼å»è¿æ¥redisæ•°æ®åº“ -u &lt;uri&gt;redis://user:password@host:port/dbnum</span><br>$ redis-cli -u redis://LJenkins:p%40ssw0rd@redis-16379.hosted.com:16379/0 PING<br>PONG<br><br><span class="hljs-comment"># redis é»˜è®¤æ˜¯ä½¿ç”¨ TCPè¿›è¡Œè¿æ¥ï¼Œå¦‚æœæ˜¯ä½¿ç”¨SSLæˆ–è€…æ˜¯TLSçš„æ–¹å¼è¿›è¡Œè¿æ¥ï¼Œå¯ä»¥è®¾ç½®å¯¹åº”çš„è¯ä¹¦</span><br><span class="hljs-comment"># By default, uses a plain TCP connection to connect to Redis. You may enable SSL/TLS using the option, along with or to configure a trusted root certificate bundle or directory.redis-cli--tls--cacert--cacertdir</span><br><br><br><span class="hljs-comment"># redis-cli æ‰§è¡Œæ–‡ä»¶å½“ä¸­çš„å†…å®¹</span><br>$ <span class="hljs-built_in">cat</span> /tmp/commands.txt | redis-cli<br>OK<br><br><span class="hljs-comment"># åœ¨redis-cli å½“ä¸­è¿æ¥å…¶ä»–çš„æ•°æ®åº“</span><br><br>127.0.0.1:6379&gt; CONNECT metal 6379<br>metal:6379&gt; PING<br>PONG<br><br><br><span class="hljs-comment"># ä½¿ç”¨tabé”®è¡¥é½å¯¹åº”çš„å‘½ä»¤</span><br>127.0.0.1:6379&gt; Z&lt;TAB&gt;<br>127.0.0.1:6379&gt; ZADD&lt;TAB&gt;<br>127.0.0.1:6379&gt; ZCARD&lt;TAB&gt;<br></code></pre></td></tr></table></figure><h4 id="äº”-å…³äºå‘½ä»¤çš„å­¦ä¹ ï¼Œå¯ä»¥å‚ç…§rediså®˜æ–¹æ–‡æ¡£"><a href="#äº”-å…³äºå‘½ä»¤çš„å­¦ä¹ ï¼Œå¯ä»¥å‚ç…§rediså®˜æ–¹æ–‡æ¡£" class="headerlink" title="äº”.å…³äºå‘½ä»¤çš„å­¦ä¹ ï¼Œå¯ä»¥å‚ç…§rediså®˜æ–¹æ–‡æ¡£"></a>äº”.å…³äºå‘½ä»¤çš„å­¦ä¹ ï¼Œå¯ä»¥å‚ç…§rediså®˜æ–¹æ–‡æ¡£</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ä¸­æ–‡æ–‡æ¡£</span><br>http://redis.cn/commands<br><br><span class="hljs-comment"># è‹±æ–‡æ–‡æ¡£</span><br>https://redis.io/docs/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8sè¡¥å…¨å‘½ä»¤å®‰è£…</title>
    <link href="/2025/03/19/k8s%E8%A1%A5%E5%85%A8%E5%91%BD%E4%BB%A4%E5%AE%89%E8%A3%85/"/>
    <url>/2025/03/19/k8s%E8%A1%A5%E5%85%A8%E5%91%BD%E4%BB%A4%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h4 id="è‡ªåŠ¨è¡¥å…¨å®‰è£…"><a href="#è‡ªåŠ¨è¡¥å…¨å®‰è£…" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨å®‰è£…"></a>è‡ªåŠ¨è¡¥å…¨å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs BASH">yum install bash-completion -y<br><span class="hljs-built_in">source</span> /usr/share/bash-completion/bash_completion<br><span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><h4 id="è¡¥å…¨å®‰è£…å®Œæˆåæ‰§è¡ŒæŠ¥é”™"><a href="#è¡¥å…¨å®‰è£…å®Œæˆåæ‰§è¡ŒæŠ¥é”™" class="headerlink" title="è¡¥å…¨å®‰è£…å®Œæˆåæ‰§è¡ŒæŠ¥é”™"></a>è¡¥å…¨å®‰è£…å®Œæˆåæ‰§è¡ŒæŠ¥é”™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿è¡Œkubectl tabæ—¶å‡ºç°ä»¥ä¸‹æŠ¥é”™</span><br>[root@k8s-node ~]# kubectl desc-bash: _get_comp_words_by_ref: <span class="hljs-built_in">command</span> not found <br></code></pre></td></tr></table></figure><h5 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#1ã€æ‰§è¡Œbash_completion</span><br>[root@k8s-node ~]# <span class="hljs-built_in">source</span> /usr/share/bash-completion/bash_completion<br><br><span class="hljs-comment">#2ã€é‡æ–°åŠ è½½kubectl completion</span><br>[root@k8s-node ~]# <span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br><br><span class="hljs-comment">#3ã€åˆèƒ½ç”¨tabäº†</span><br>[root@k8s-node ~]# kubectl describe pod<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰‹åŠ¨æ¸…ç†Linuxçš„ç¼“å­˜</title>
    <link href="/2025/03/19/%E6%89%8B%E5%8A%A8%E6%B8%85%E7%90%86Linux%E7%9A%84%E7%BC%93%E5%AD%98/"/>
    <url>/2025/03/19/%E6%89%8B%E5%8A%A8%E6%B8%85%E7%90%86Linux%E7%9A%84%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h6 id="1ï¼‰æ¸…ç†pagecacheï¼ˆé¡µé¢ç¼“å­˜ï¼‰"><a href="#1ï¼‰æ¸…ç†pagecacheï¼ˆé¡µé¢ç¼“å­˜ï¼‰" class="headerlink" title="1ï¼‰æ¸…ç†pagecacheï¼ˆé¡µé¢ç¼“å­˜ï¼‰"></a>1ï¼‰æ¸…ç†pagecacheï¼ˆé¡µé¢ç¼“å­˜ï¼‰</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@backup ~]# <span class="hljs-built_in">echo</span> 1 &gt; /proc/sys/vm/drop_caches   æˆ–è€… <span class="hljs-comment"># sysctl -w vm.drop_caches=1</span><br></code></pre></td></tr></table></figure><h6 id="2ï¼‰æ¸…ç†dentriesï¼ˆç›®å½•ç¼“å­˜ï¼‰å’Œinodes"><a href="#2ï¼‰æ¸…ç†dentriesï¼ˆç›®å½•ç¼“å­˜ï¼‰å’Œinodes" class="headerlink" title="2ï¼‰æ¸…ç†dentriesï¼ˆç›®å½•ç¼“å­˜ï¼‰å’Œinodes"></a>2ï¼‰æ¸…ç†dentriesï¼ˆç›®å½•ç¼“å­˜ï¼‰å’Œinodes</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@backup ~]# <span class="hljs-built_in">echo</span> 2 &gt; /proc/sys/vm/drop_caches   æˆ–è€… <span class="hljs-comment"># sysctl -w vm.drop_caches=2</span><br></code></pre></td></tr></table></figure><h6 id="3ï¼‰æ¸…ç†pagecacheã€dentrieså’Œinodes"><a href="#3ï¼‰æ¸…ç†pagecacheã€dentrieså’Œinodes" class="headerlink" title="3ï¼‰æ¸…ç†pagecacheã€dentrieså’Œinodes"></a>3ï¼‰æ¸…ç†pagecacheã€dentrieså’Œinodes</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@backup ~]# <span class="hljs-built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches   æˆ–è€… <span class="hljs-comment"># sysctl -w vm.drop_caches=3 </span><br></code></pre></td></tr></table></figure><p><strong>ä¸Šé¢ä¸‰ç§æ–¹å¼éƒ½æ˜¯ä¸´æ—¶é‡Šæ”¾ç¼“å­˜çš„æ–¹æ³•ï¼Œè¦æƒ³æ°¸ä¹…é‡Šæ”¾ç¼“å­˜ï¼Œéœ€è¦åœ¨&#x2F;etc&#x2F;sysctl.confæ–‡ä»¶ä¸­é…ç½®ï¼švm.drop_caches&#x3D;1&#x2F;2&#x2F;3ï¼Œç„¶åsysctl -pç”Ÿæ•ˆå³å¯ï¼</strong></p><blockquote><p>å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨syncå‘½ä»¤æ¥æ¸…ç†æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œè¿˜ä¼šæ¸…ç†åƒµå°¸(zombie)å¯¹è±¡å’Œå®ƒä»¬å ç”¨çš„å†…å­˜</p><p>[root@backup ~]# sync</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºEOFå’Œ-EOFè¯­å¥çš„æ„æ€</title>
    <link href="/2025/03/19/%E5%85%B3%E4%BA%8EEOF%E5%92%8C-EOF%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%84%8F%E6%80%9D/"/>
    <url>/2025/03/19/%E5%85%B3%E4%BA%8EEOF%E5%92%8C-EOF%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%84%8F%E6%80%9D/</url>
    
    <content type="html"><![CDATA[<p>åœ¨linux shellè„šæœ¬ä¸­<code>cat &lt;&lt; EOF</code>çš„è¯­å¥ï¼Œèµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ</p><p>EOFåœ¨è¿™é‡Œ<code>æ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨FOEæˆ–OOOç­‰ï¼ˆå½“ç„¶ä¹Ÿä¸é™åˆ¶åœ¨ä¸‰ä¸ªå­—ç¬¦æˆ–å¤§å†™å­—ç¬¦ï¼‰,EOFåªæ˜¯ä¹ æƒ¯æ€§çš„ç”¨æ¥ä½œä¸ºå¼€å¤´å’Œç»“å°¾</p><p>æ¥ä¸‹æ¥ï¼Œç®€å•æè¿°ä¸€ä¸‹å‡ ç§å¸¸è§çš„ä½¿ç”¨æ–¹å¼åŠå…¶ä½œç”¨ï¼š</p><blockquote><p>1ã€cat&lt;&lt;EOFï¼Œä»¥EOFè¾“å…¥å­—ç¬¦ä¸ºæ ‡å‡†è¾“å…¥ç»“æŸ;</p></blockquote><blockquote><p>2ã€cat&gt;filenameï¼Œåˆ›å»ºæ–‡ä»¶ï¼Œå¹¶<code>æŠŠæ ‡å‡†è¾“å…¥è¾“å‡ºåˆ°filenameæ–‡ä»¶ä¸­</code>ï¼Œä»¥ctrl+dä½œä¸ºè¾“å…¥ç»“æŸ;</p></blockquote><blockquote><p>3ã€cat&gt;filename&lt;&lt;EOFï¼Œä»¥<code>EOFä½œä¸ºè¾“å…¥ç»“æŸ</code>ï¼Œå’Œctrl+dçš„ä½œç”¨ä¸€æ ·;</p></blockquote><blockquote><p>cat &lt;<EOF>&gt;&#x2F;var&#x2F;spool&#x2F;cron&#x2F;root     # ä»¥EOFä¸ºç»“æŸç¬¦å·ï¼Œå°†æ ‡å‡†è¾“å…¥çš„å†…å®¹è¿½åŠ åˆ°&#x2F;var&#x2F;spool&#x2F;cron&#x2F;rootå†…ã€‚å¯ä»¥ç†è§£ä¸º&gt;&gt;è¿˜æ˜¯è¿½åŠ åˆ°æ–‡ä»¶å½“ä¸­ï¼Œåªæ˜¯å¤šäº†&lt;&lt;EOFä½œä¸ºè¾“å…¥ç»“æŸç¬¦æ ‡å¿—ã€‚</p></blockquote><hr><p>cat &lt;&lt;EOFä¸cat &lt;&lt;-EOFçš„åŒºåˆ«ï¼ˆåŸæ–‡ï¼š<a href="http://blog.csdn.net/apache0554/article/details/45508631%EF%BC%89">http://blog.csdn.net/apache0554/article/details/45508631ï¼‰</a></p><p>ä¸¤ä¸ªéƒ½æ˜¯è·å–stdin,å¹¶åœ¨EOFå¤„ç»“æŸstdin(æ ‡å‡†è¾“å…¥)ï¼Œè¾“å‡ºstdout(æ ‡å‡†è¾“å‡º)ã€‚</p><blockquote><p>manä¸­çš„è¯´æ˜ï¼š</p></blockquote><blockquote><p>If the redirection operator is &lt;&lt;-, then all leading tab characters are stripped from input lines and the line containing delimiter.  </p></blockquote><p>ç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯ï¼šå¦‚æœé‡å®šå‘çš„æ“ä½œç¬¦æ˜¯&lt;&lt;-ï¼Œé‚£ä¹ˆ<code>åˆ†ç•Œç¬¦ï¼ˆEOFï¼‰æ‰€åœ¨è¡Œçš„å¼€å¤´éƒ¨åˆ†çš„åˆ¶è¡¨ç¬¦ï¼ˆTabï¼‰éƒ½å°†è¢«å»é™¤</code>ã€‚</p><p>è¿™å¯ä»¥è§£å†³ç”±äºè„šæœ¬ä¸­çš„è‡ªç„¶ç¼©è¿›äº§ç”Ÿçš„åˆ¶è¡¨ç¬¦ã€‚</p><blockquote><p>é€šä¿—ä¸€ç‚¹çš„è§£é‡Šï¼š</p></blockquote><p>åœ¨æˆ‘ä»¬ä½¿ç”¨cat &lt;&lt;EOFæ—¶ï¼Œæˆ‘ä»¬è¾“å…¥å®Œæˆåï¼Œéœ€è¦åœ¨ä¸€ä¸ªæ–°çš„ä¸€è¡Œè¾“å…¥EOFç»“æŸstdinçš„è¾“å…¥ã€‚EOFå¿…é¡»é¡¶è¡Œå†™ï¼Œå‰é¢ä¸èƒ½ç”¨åˆ¶è¡¨ç¬¦æˆ–è€…ç©ºæ ¼ã€‚</p><p>æ¯”å¦‚,ä¸‹é¢çš„è¯­å¥å°±ä¸ä¼šå‡ºé”™ï¼š</p><p>cat &lt;&lt;EOF </p><p>Hello,world! </p><p>EOF </p><p><code>å¦‚æœç»“æŸåˆ†è§£ç¬¦EOFå‰æœ‰åˆ¶è¡¨ç¬¦æˆ–è€…ç©ºæ ¼ï¼Œåˆ™EOFä¸ä¼šè¢«å½“åšç»“æŸåˆ†ç•Œç¬¦ï¼Œåªä¼šç»§ç»­è¢«å½“åšstdinæ¥è¾“å…¥ã€‚</code></p><p>è€Œ<code>&lt;&lt;-</code>å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼š</p><p>cat &lt;&lt;-EOF </p><p>Hello,world! </p><p>   EOF </p><p><code>ä¸Šé¢çš„å†™æ³•ï¼Œè™½ç„¶æœ€åçš„EOFå‰é¢æœ‰å¤šä¸ªåˆ¶è¡¨ç¬¦å’Œç©ºæ ¼ï¼Œä½†ä»ç„¶ä¼šè¢«å½“åšç»“æŸåˆ†ç•Œç¬¦ï¼Œè¡¨ç¤ºstdinçš„ç»“æŸã€‚</code></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Debianç³»ç»Ÿä¸Šæºç ç¼–è¯‘Redis7.0</title>
    <link href="/2025/03/19/Debian%E7%B3%BB%E7%BB%9F%E4%B8%8A%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91Redis7-0/"/>
    <url>/2025/03/19/Debian%E7%B3%BB%E7%BB%9F%E4%B8%8A%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91Redis7-0/</url>
    
    <content type="html"><![CDATA[<ol><li><p><strong>å®‰è£…ç¼–è¯‘å·¥å…·å’Œä¾èµ–é¡¹ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install build-essential tcl<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¸‹è½½å¹¶è§£å‹ Redis 7.0 æºä»£ç ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://download.redis.io/releases/redis-7.0.0.tar.gz<br>tar xzf redis-7.0.0.tar.gz<br><span class="hljs-built_in">cd</span> redis-7.0.0<br></code></pre></td></tr></table></figure></li><li><p><strong>è¿›è¡Œç¼–è¯‘ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make<br></code></pre></td></tr></table></figure></li><li><p><strong>è¿è¡Œæµ‹è¯•ï¼ˆå¯é€‰ï¼‰ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure></li><li><p><strong>å®‰è£… Redis 7.0ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> make install  <span class="hljs-comment"># è¿™ä¸€æ­¥ä¼šå°†redisé»˜è®¤å®‰è£…åˆ°/usr/local/bin/ä¸‹</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æ‹·è´redis.conf é…ç½®æ–‡ä»¶</strong></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">åœ¨æºç ï¼ˆredis-7.0.0ï¼‰æ–‡ä»¶å¤¹çš„è·¯å¾„ä¸‹ï¼Œæœ‰ä¸€ä¸ªåä¸ºredis.confçš„æ–‡ä»¶ï¼Œè¿™ä¸ªå¯ä»¥æ‹·è´åˆ°ä½ æƒ³è¦å­˜æ”¾çš„è·¯å¾„ï¼Œæ¨è/etc/redis/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CephOSDç£ç›˜æ›´æ¢çš„ä¸‰ç§æ–¹æ³•ï¼ˆæ•°æ®å‘ç”Ÿè¿ç§»çš„æ—¶é—´ä¸åŒï¼‰</title>
    <link href="/2025/03/19/CephOSD%E7%A3%81%E7%9B%98%E6%9B%B4%E6%8D%A2%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%88%E6%95%B0%E6%8D%AE%E5%8F%91%E7%94%9F%E8%BF%81%E7%A7%BB%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%8D%E5%90%8C%EF%BC%89/"/>
    <url>/2025/03/19/CephOSD%E7%A3%81%E7%9B%98%E6%9B%B4%E6%8D%A2%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%88%E6%95%B0%E6%8D%AE%E5%8F%91%E7%94%9F%E8%BF%81%E7%A7%BB%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%8D%E5%90%8C%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">æ›´æ¢æ–¹å¼1ï¼š<br><br>    1åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Šï¼Œåœæ­¢æŒ‡å®šçš„osdè¿›ç¨‹ systemctl stop ceph-osd@id<br><br>    2 å°†ç§»é™¤OSDèŠ‚ç‚¹çŠ¶æ€æ ‡è®°ä¸º  ceph osd out ceph-osd@id<br><br>    3ä»crushä¸­ç§»é™¤OsDèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸ä½œä¸ºæ•°æ®çš„è½½ä½“ ceph osd crush remove id<br><br>    4 åˆ é™¤OSDèŠ‚ç‚¹å’Œå¯¹åº”çš„è®¤è¯ä¿¡æ¯ ceph osd rm id /ceph auth del id<br><br>    5 å¢åŠ ä¸€ä¸ªæ–°çš„ OSD(zapæ“¦é™¤ç£ç›˜æ•°æ®ï¼Œcreate åˆ›å»ºç£ç›˜)<br><br>    æ³¨æ„ï¼š1ã€2ã€3ã€4ã€5 è¿™å‡ æ­¥éƒ½ä¼šå‘ç”Ÿæ•°æ®è¿ç§»çš„åŠ¨ä½œ<br>    <br>å¦‚æœæ˜¯åŸå§‹ç£ç›˜å ç”¨ï¼Œæ— æ³•æ ¼å¼åŒ–åˆ é™¤ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤<br>æŸ¥çœ‹ç£ç›˜çš„å½“å‰çŠ¶æ€ï¼šdmsetup status<br>æŸ¥çœ‹ç£ç›˜çš„å”¯ä¸€æ ‡è¯†ï¼šcat /var/lib/ceph/osd/ceph-1/fsid  <br>æ¸…ç†ç£ç›˜çš„å ç”¨ï¼šdmsetup remove ceph-1çš„id <br>æ ¼å¼åŒ–ç£ç›˜ï¼ˆæ–°çš„ç£ç›˜ä¸ç”¨ï¼‰ï¼šmkfs.ext4 /dev/sdc<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">æ›´æ¢æ–¹å¼2:<br>1 ä¿®æ”¹osdçš„æ•°æ®æ“ä½œæƒé‡å€¼ï¼Œè®©æ•°æ®ä¸åˆ†å¸ƒåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Š<br>2 åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Šï¼Œåœæ­¢æŒ‡å®šçš„osdè¿›ç¨‹<br>3 å°†ç§»é™¤OSDèŠ‚ç‚¹çŠ¶æ€æ ‡è®°ä¸ºout<br>4 ä»crushä¸­ç§»é™¤OSDèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸ä½œä¸ºæ•°æ®çš„è½½ä½“  # å¯ä»¥é€šè¿‡ä¸¤æ¬¡ ceph pg dump pgs &gt; file.txt æŸ¥çœ‹ä¸¤æ¬¡pgçš„å˜åŒ–ï¼Œç„¶åé€šè¿‡ diffå‘½ä»¤æ¯”å¯¹<br>5 åˆ é™¤OSDèŠ‚ç‚¹å’Œå¯¹åº”çš„è®¤è¯ä¿¡æ¯<br>6 å¢åŠ ä¸€ä¸ªæ–°çš„ OSD<br><br>æ³¨æ„ï¼š1ã€5ã€6è¿™å‡ æ­¥ä¼šå‘ç”Ÿæ•°æ®è¿ç§»åŠ¨ä½œ<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">æ›´æ¢æ–¹å¼3:<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æœ€ä¸»è¦çš„å°±æ˜¯è®¾ç½®æ ‡è®°å’Œæ¸…é™¤æ ‡è®°ä¸­é—´è¿™æ®µæ“ä½œå½“ä¸­ï¼Œåªæ˜¯çœ‹åˆ°ä¸€ä¸ªæ•°æ®è¿ç§»çš„ç°è±¡ï¼Œä½†æ˜¯å¹¶æœªå‘ç”ŸçœŸæ­£çš„æ•°æ®è¿ç§»</span><br>1 å¯¹cephé›†ç¾¤çš„osdè®¾ç½®ç¦æ­¢æ•°æ®è¿ç§»çš„æ ‡è®°<br>2 ä¿®æ”¹osdçš„æ•°æ®æ“ä½œæƒé‡å€¼ï¼Œè®©æ•°æ®ä¸åˆ†å¸ƒåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Š<br>3 åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Šï¼Œåœæ­¢æŒ‡å®šçš„osdè¿›ç¨‹<br>4 ä»crushä¸­ç§»é™¤osDèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸ä½œä¸ºæ•°æ®çš„è½½ä½“<br>5 åˆ é™¤OSDèŠ‚ç‚¹å’Œå¯¹åº”çš„è®¤è¯ä¿¡æ¯<br>6 å¢åŠ ä¸€ä¸ªæ–°çš„OSDä¸æ ·å¼2ä¸€è‡´<br>7 ç§»é™¤cephé›†ç¾¤çš„osdç¦æ­¢æ•°æ®è¿ç§»æ ‡è®°é›†<br><br>æ³¨æ„ï¼šå› ä¸ºæ·»åŠ äº†æ ‡è®°ï¼Œæ‰€ä»¥1-6è¿™å‡ æ­¥çš„æ•°æ®è¿ç§»éƒ½ä¸ä¼šæ‰§è¡Œï¼Œåªæœ‰7è¿™ä¸€æ­¥ä¼šå‘ç”Ÿæ•°æ®è¿ç§»åŠ¨ä½œã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ceph</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨kubeadm1.23.xç‰ˆæœ¬éƒ¨ç½²kubernetesï¼ˆä¸€ä¸»ä¸¤ä»ï¼‰</title>
    <link href="/2025/03/19/%E4%BD%BF%E7%94%A8kubeadm1-23-x%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2kubernetes%EF%BC%88%E4%B8%80%E4%B8%BB%E4%B8%A4%E4%BB%8E%EF%BC%89/"/>
    <url>/2025/03/19/%E4%BD%BF%E7%94%A8kubeadm1-23-x%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2kubernetes%EF%BC%88%E4%B8%80%E4%B8%BB%E4%B8%A4%E4%BB%8E%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h3 id="é…ç½®ç³»ç»Ÿç¯å¢ƒ"><a href="#é…ç½®ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="é…ç½®ç³»ç»Ÿç¯å¢ƒ"></a>é…ç½®ç³»ç»Ÿç¯å¢ƒ</h3><h5 id="æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬"></a><strong>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">[root@localhost]# </span><span class="language-bash"><span class="hljs-built_in">cat</span> /etc/centos-release</span><br></code></pre></td></tr></table></figure><h5 id="é…ç½®ç½‘ç»œ-æ ¹æ®è‡ªå·±æœ¬åœ°çš„ç½‘ç»œç¯å¢ƒè®¾ç½®ä¸»æœºIPåœ°å€"><a href="#é…ç½®ç½‘ç»œ-æ ¹æ®è‡ªå·±æœ¬åœ°çš„ç½‘ç»œç¯å¢ƒè®¾ç½®ä¸»æœºIPåœ°å€" class="headerlink" title="é…ç½®ç½‘ç»œ(æ ¹æ®è‡ªå·±æœ¬åœ°çš„ç½‘ç»œç¯å¢ƒè®¾ç½®ä¸»æœºIPåœ°å€)"></a><strong>é…ç½®ç½‘ç»œ(æ ¹æ®è‡ªå·±æœ¬åœ°çš„ç½‘ç»œç¯å¢ƒè®¾ç½®ä¸»æœºIPåœ°å€)</strong></h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[root@localhost ~]</span><span class="hljs-comment"># cat /etc/sysconfig/network-scripts/ifcfg-enp0s3</span><br><span class="hljs-attr">TYPE</span>=Ethernet<br><span class="hljs-attr">PROXY_METHOD</span>=none<br><span class="hljs-attr">BROWSER_ONLY</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">BOOTPROTO</span>=static<br><span class="hljs-attr">DEFROUTE</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV4_FAILURE_FATAL</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">IPV6INIT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV6_AUTOCONF</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV6_DEFROUTE</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPV6_FAILURE_FATAL</span>=<span class="hljs-literal">no</span><br><span class="hljs-attr">IPV6_ADDR_GEN_MODE</span>=stable-privacy<br><span class="hljs-attr">NAME</span>=enp0s3<br><span class="hljs-attr">UUID</span>=<span class="hljs-number">039303</span>a5-c70d-<span class="hljs-number">4973</span>-<span class="hljs-number">8</span>c91-<span class="hljs-number">97</span>eaa071c23d<br><span class="hljs-attr">DEVICE</span>=enp0s3<br><span class="hljs-attr">ONBOOT</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">IPADDR</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">1.31</span><br><span class="hljs-attr">NETMASK</span>=<span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-attr">GATEWAY</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span><br><span class="hljs-attr">DNS1</span>=<span class="hljs-number">223.5</span>.<span class="hljs-number">5.5</span><br></code></pre></td></tr></table></figure><h5 id="è®¾ç½®ä¸»æœºå"><a href="#è®¾ç½®ä¸»æœºå" class="headerlink" title="è®¾ç½®ä¸»æœºå"></a><strong>è®¾ç½®ä¸»æœºå</strong></h5><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">k8s-master01</span><br><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">k8s-node01</span><br><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">k8s-node02</span><br></code></pre></td></tr></table></figure><h5 id="æ·»åŠ å¹¶å¯åŠ¨æº"><a href="#æ·»åŠ å¹¶å¯åŠ¨æº" class="headerlink" title="æ·»åŠ å¹¶å¯åŠ¨æº"></a><strong>æ·»åŠ å¹¶å¯åŠ¨æº</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span><br><br><span class="hljs-comment"># ä¸º RHEL-8æˆ– CentOS-8é…ç½®æº</span><br>yum install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm -y <br>sed -i <span class="hljs-string">&quot;s@mirrorlist@#mirrorlist@g&quot;</span> /etc/yum.repos.d/elrepo.repo <br>sed -i <span class="hljs-string">&quot;s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g&quot;</span> /etc/yum.repos.d/elrepo.repo <br><br><span class="hljs-comment"># ä¸º RHEL-7 SL-7 æˆ– CentOS-7 å®‰è£… ELRepo </span><br>yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm -y <br>sed -i <span class="hljs-string">&quot;s@mirrorlist@#mirrorlist@g&quot;</span> /etc/yum.repos.d/elrepo.repo <br>sed -i <span class="hljs-string">&quot;s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g&quot;</span> /etc/yum.repos.d/elrepo.repo <br><br><span class="hljs-comment"># æŸ¥çœ‹å¯ç”¨å®‰è£…åŒ…</span><br>yum  --disablerepo=<span class="hljs-string">&quot;*&quot;</span>  --enablerepo=<span class="hljs-string">&quot;elrepo-kernel&quot;</span>  list  available<br></code></pre></td></tr></table></figure><h5 id="é…ç½®yumæº"><a href="#é…ç½®yumæº" class="headerlink" title="é…ç½®yumæº"></a><strong>é…ç½®yumæº</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å…¶ä»–ç³»ç»Ÿçš„æºåœ°å€</span><br><span class="hljs-comment"># https://mirrors.tuna.tsinghua.edu.cn/help/</span><br><br><span class="hljs-comment"># å¯¹äº Ubuntu</span><br>sed -i <span class="hljs-string">&#x27;s/cn.archive.ubuntu.com/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list<br><br><span class="hljs-comment"># å¯¹äº CentOS 7</span><br><span class="hljs-built_in">sudo</span> sed -e <span class="hljs-string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \<br>         -e <span class="hljs-string">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos|g&#x27;</span> \<br>         -i.bak \<br>         /etc/yum.repos.d/CentOS-*.repo<br><br><span class="hljs-comment"># å¯¹äº CentOS 8</span><br><span class="hljs-built_in">sudo</span> sed -e <span class="hljs-string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \<br>         -e <span class="hljs-string">&#x27;s|^#baseurl=http://mirror.centos.org/$contentdir|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos|g&#x27;</span> \<br>         -i.bak \<br>         /etc/yum.repos.d/CentOS-*.repo<br><br><span class="hljs-comment"># å¯¹äºç§æœ‰ä»“åº“</span><br>sed -e <span class="hljs-string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> -e <span class="hljs-string">&#x27;s|^#baseurl=http://mirror.centos.org/\$contentdir|baseurl=http://192.168.1.123/centos|g&#x27;</span> -i.bak  /etc/yum.repos.d/CentOS-*.repo<br></code></pre></td></tr></table></figure><h5 id="å®‰è£…ä¸€äº›å¿…å¤‡å·¥å…·"><a href="#å®‰è£…ä¸€äº›å¿…å¤‡å·¥å…·" class="headerlink" title="å®‰è£…ä¸€äº›å¿…å¤‡å·¥å…·"></a><strong>å®‰è£…ä¸€äº›å¿…å¤‡å·¥å…·</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯¹äº Ubuntu</span><br>apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install -y wget psmisc vim net-tools nfs-kernel-server telnet lvm2 git tar curl<br><br><span class="hljs-comment"># å¯¹äº CentOS 7</span><br>yum update -y &amp;&amp; yum -y install  wget psmisc vim net-tools nfs-utils telnet yum-utils device-mapper-persistent-data lvm2 git tar curl<br>yum install -y bash-completion net-tools gcc<br><br><span class="hljs-comment"># å¯¹äº CentOS 8</span><br>yum update -y &amp;&amp; yum -y install wget psmisc vim net-tools nfs-utils telnet yum-utils device-mapper-persistent-data lvm2 git network-scripts tar curl<br></code></pre></td></tr></table></figure><h5 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span><br>systemctl <span class="hljs-built_in">disable</span> --now firewalld<br></code></pre></td></tr></table></figure><h5 id="å…³é—­selinuxï¼ˆè®°å¾—å‡çº§å†…æ ¸åé‡å¯ï¼‰"><a href="#å…³é—­selinuxï¼ˆè®°å¾—å‡çº§å†…æ ¸åé‡å¯ï¼‰" class="headerlink" title="å…³é—­selinuxï¼ˆè®°å¾—å‡çº§å†…æ ¸åé‡å¯ï¼‰"></a>å…³é—­selinuxï¼ˆè®°å¾—å‡çº§å†…æ ¸åé‡å¯ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span><br>setenforce 0<br>sed -i <span class="hljs-string">&#x27;s#SELINUX=enforcing#SELINUX=disabled#g&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment"># å‚æ•°è§£é‡Š</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># setenforce 0</span><br><span class="hljs-comment"># æ­¤å‘½ä»¤ç”¨äºè®¾ç½® SELinux çš„æ‰§è¡Œæ¨¡å¼ã€‚0 è¡¨ç¤ºå…³é—­ SELinuxã€‚</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># sed -i &#x27;s#SELINUX=enforcing#SELINUX=disabled#g&#x27; /etc/selinux/config</span><br><span class="hljs-comment"># è¯¥å‘½ä»¤ä½¿ç”¨ sed å·¥å…·æ¥ç¼–è¾‘ /etc/selinux/config æ–‡ä»¶ã€‚å…¶ä¸­ &#x27;-i&#x27; å‚æ•°è¡¨ç¤ºç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è¾“å‡ºåˆ°ç»ˆç«¯æˆ–å¦ä¸€ä¸ªæ–‡ä»¶ã€‚&#x27;s#SELINUX=enforcing#SELINUX=disabled#g&#x27; æ˜¯ sed çš„æ›¿æ¢å‘½ä»¤ï¼Œå®ƒå°†æ–‡ä»¶ä¸­æ‰€æœ‰çš„ &quot;SELINUX=enforcing&quot; æ›¿æ¢ä¸º &quot;SELINUX=disabled&quot;ã€‚è¿™é‡Œçš„ &#x27;#&#x27; æ˜¯åˆ†éš”ç¬¦ï¼Œç”¨äºæ›¿ä»£ä¼ ç»Ÿçš„ &#x27;/&#x27; åˆ†éš”ç¬¦ï¼Œä»¥é¿å…ä¸è·¯å¾„ä¸­çš„ &#x27;/&#x27; å†²çªã€‚</span><br></code></pre></td></tr></table></figure><h5 id="å…³é—­äº¤æ¢åˆ†åŒº"><a href="#å…³é—­äº¤æ¢åˆ†åŒº" class="headerlink" title="å…³é—­äº¤æ¢åˆ†åŒº"></a>å…³é—­äº¤æ¢åˆ†åŒº</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab<br>swapoff -a &amp;&amp; sysctl -w vm.swappiness=0<br><br>cat /etc/fstab<br><span class="hljs-meta prompt_"># </span><span class="language-bash">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‚æ•°è§£é‡Šï¼š</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># -ri: è¿™ä¸ªå‚æ•°ç”¨äºåœ¨åŸæ–‡ä»¶ä¸­æ›¿æ¢åŒ¹é…çš„æ¨¡å¼ã€‚-rè¡¨ç¤ºæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ï¼Œ-iå…è®¸ç›´æ¥ä¿®æ”¹æ–‡ä»¶ã€‚</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span>: è¿™æ˜¯ä¸€ä¸ªsedå‘½ä»¤ï¼Œç”¨äºåœ¨æ–‡ä»¶/etc/fstabä¸­æ‰¾åˆ°åŒ…å«swapçš„è¡Œï¼Œå¹¶åœ¨è¡Œé¦–æ·»åŠ #æ¥æ³¨é‡Šæ‰è¯¥è¡Œã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">/etc/fstab: è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå³/etc/fstabæ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿè¡¨ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">swapoff -a: è¿™ä¸ªå‘½ä»¤ç”¨äºå…³é—­æ‰€æœ‰å¯ç”¨çš„äº¤æ¢åˆ†åŒºã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">sysctl -w vm.swappiness=0: è¿™ä¸ªå‘½ä»¤ç”¨äºä¿®æ”¹vm.swappinesså‚æ•°çš„å€¼ä¸º0ï¼Œè¡¨ç¤ºç³»ç»Ÿåœ¨ç‰©ç†å†…å­˜å……è¶³æ—¶æ›´å€¾å‘äºä½¿ç”¨ç‰©ç†å†…å­˜è€Œéäº¤æ¢åˆ†åŒºã€‚</span><br></code></pre></td></tr></table></figure><h5 id="ç½‘ç»œé…ç½®ï¼ˆä¿©ç§æ–¹å¼äºŒé€‰ä¸€ï¼‰"><a href="#ç½‘ç»œé…ç½®ï¼ˆä¿©ç§æ–¹å¼äºŒé€‰ä¸€ï¼‰" class="headerlink" title="ç½‘ç»œé…ç½®ï¼ˆä¿©ç§æ–¹å¼äºŒé€‰ä¸€ï¼‰"></a>ç½‘ç»œé…ç½®ï¼ˆä¿©ç§æ–¹å¼äºŒé€‰ä¸€ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–¹å¼ä¸€</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">disable</span> --now NetworkManager</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl start network &amp;&amp; systemctl <span class="hljs-built_in">enable</span> network</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–¹å¼äºŒ</span><br>cat &gt; /etc/NetworkManager/conf.d/calico.conf &lt;&lt; EOF <br>[keyfile]<br>unmanaged-devices=interface-name:cali*;interface-name:tunl*<br>EOF<br>systemctl restart NetworkManager<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‚æ•°è§£é‡Š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># è¿™ä¸ªå‚æ•°ç”¨äºæŒ‡å®šä¸ç”± NetworkManager ç®¡ç†çš„è®¾å¤‡ã€‚å®ƒç”±ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># interface-name:cali*</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¡¨ç¤ºä»¥ <span class="hljs-string">&quot;cali&quot;</span> å¼€å¤´çš„æ¥å£åç§°è¢«æ’é™¤åœ¨ NetworkManager ç®¡ç†ä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œ<span class="hljs-string">&quot;cali0&quot;</span>, <span class="hljs-string">&quot;cali1&quot;</span> ç­‰æ¥å£ä¸å— NetworkManager ç®¡ç†ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># interface-name:tunl*</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¡¨ç¤ºä»¥ <span class="hljs-string">&quot;tunl&quot;</span> å¼€å¤´çš„æ¥å£åç§°è¢«æ’é™¤åœ¨ NetworkManager ç®¡ç†ä¹‹å¤–ã€‚ä¾‹å¦‚ï¼Œ<span class="hljs-string">&quot;tunl0&quot;</span>, <span class="hljs-string">&quot;tunl1&quot;</span> ç­‰æ¥å£ä¸å— NetworkManager ç®¡ç†ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># é€šè¿‡ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥å°†ç‰¹å®šçš„æ¥å£æ’é™¤åœ¨ NetworkManager çš„ç®¡ç†èŒƒå›´ä¹‹å¤–ï¼Œä»¥ä¾¿å…¶ä»–å·¥å…·æˆ–è¿›ç¨‹å¯ä»¥ç‹¬ç«‹åœ°ç®¡ç†å’Œé…ç½®è¿™äº›æ¥å£ã€‚</span></span><br></code></pre></td></tr></table></figure><h5 id="è¿›è¡Œæ—¶é—´åŒæ­¥"><a href="#è¿›è¡Œæ—¶é—´åŒæ­¥" class="headerlink" title="è¿›è¡Œæ—¶é—´åŒæ­¥"></a>è¿›è¡Œæ—¶é—´åŒæ­¥</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æœåŠ¡ç«¯</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">apt install chrony -y</span><br>yum install chrony -y<br>cat &gt; /etc/chrony.conf &lt;&lt; EOF <br>pool ntp.aliyun.com iburst<br>driftfile /var/lib/chrony/drift<br>makestep 1.0 3<br>rtcsync<br>allow 192.168.101.0/24<br>local stratum 10<br>keyfile /etc/chrony.keys<br>leapsectz right/UTC<br>logdir /var/log/chrony<br>EOF<br><br>systemctl restart chronyd ; systemctl enable chronyd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®¢æˆ·ç«¯</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">apt install chrony -y</span><br>yum install chrony -y<br>cat &gt; /etc/chrony.conf &lt;&lt; EOF <br>pool 192.168.1.31 iburst<br>driftfile /var/lib/chrony/drift<br>makestep 1.0 3<br>rtcsync<br>keyfile /etc/chrony.keys<br>leapsectz right/UTC<br>logdir /var/log/chrony<br>EOF<br><br>systemctl restart chronyd ; systemctl enable chronyd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯</span><br>chronyc sources -v<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‚æ•°è§£é‡Š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># pool ntp.aliyun.com iburst</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŒ‡å®šä½¿ç”¨ntp.aliyun.comä½œä¸ºæ—¶é—´æœåŠ¡å™¨æ± ï¼Œibursté€‰é¡¹è¡¨ç¤ºåœ¨åˆå§‹åŒæ­¥æ—¶ä¼šå‘é€å¤šä¸ªè¯·æ±‚ä»¥åŠ å¿«åŒæ­¥é€Ÿåº¦ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># driftfile /var/lib/chrony/drift</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŒ‡å®šç”¨äºä¿å­˜æ—¶é’Ÿæ¼‚ç§»ä¿¡æ¯çš„æ–‡ä»¶è·¯å¾„ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># makestep 1.0 3</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®å½“ç³»ç»Ÿæ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´åå·®å¤§äº1ç§’æ—¶ï¼Œä¼šä»¥1ç§’çš„æ­¥é•¿è¿›è¡Œè°ƒæ•´ã€‚å¦‚æœåå·®è¶…è¿‡3ç§’ï¼Œåˆ™ç«‹å³è¿›è¡Œæ—¶é—´è°ƒæ•´ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># rtcsync</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯ç”¨ç¡¬ä»¶æ—¶é’ŸåŒæ­¥åŠŸèƒ½ï¼Œå¯ä»¥æé«˜æ—¶é’Ÿçš„å‡†ç¡®æ€§ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># allow 192.168.0.0/24</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å…è®¸192.168.0.0/24ç½‘æ®µèŒƒå›´å†…çš„ä¸»æœºä¸chronyè¿›è¡Œæ—¶é—´åŒæ­¥ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># local stratum 10</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°†æœ¬åœ°æ—¶é’Ÿè®¾ä¸ºstratum 10ï¼Œstratumå€¼è¡¨ç¤ºæ—¶é’Ÿçš„å‡†ç¡®åº¦ï¼Œå€¼è¶Šå°è¡¨ç¤ºå‡†ç¡®åº¦è¶Šé«˜ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># keyfile /etc/chrony.keys</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŒ‡å®šä½¿ç”¨çš„å¯†é’¥æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºå¯¹æ—¶é—´åŒæ­¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># leapsectz right/UTC</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŒ‡å®šæ—¶åŒºä¸ºUTCã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># logdir /var/log/chrony</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŒ‡å®šæ—¥å¿—æ–‡ä»¶å­˜æ”¾ç›®å½•ã€‚</span><br></code></pre></td></tr></table></figure><h5 id="é…ç½®ulimit-æ ¹æ®è‡ªå·±æœåŠ¡å™¨æ€§èƒ½è®¾ç½®"><a href="#é…ç½®ulimit-æ ¹æ®è‡ªå·±æœåŠ¡å™¨æ€§èƒ½è®¾ç½®" class="headerlink" title="é…ç½®ulimit(æ ¹æ®è‡ªå·±æœåŠ¡å™¨æ€§èƒ½è®¾ç½®)"></a>é…ç½®ulimit(æ ¹æ®è‡ªå·±æœåŠ¡å™¨æ€§èƒ½è®¾ç½®)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">ulimit -SHn 65535<br>cat &gt;&gt; /etc/security/limits.conf &lt;&lt;EOF<br>* soft nofile 655360<br>* hard nofile 131072<br>* soft nproc 655350<br>* hard nproc 655350<br>* soft memlock unlimited<br>* hard memlock unlimited<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‚æ•°è§£é‡Š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># soft nofile 655360</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">softè¡¨ç¤ºè½¯é™åˆ¶ï¼Œnofileè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œé»˜è®¤å€¼ä¸º1024ã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸º655360ï¼Œå³ä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ä¸º655360ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># hard nofile 131072</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">hardè¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚nofileè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œé»˜è®¤å€¼ä¸º4096ã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸º131072ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§æ–‡ä»¶æ•°ä¸º131072ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># soft nproc 655350</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">softè¡¨ç¤ºè½¯é™åˆ¶ï¼Œ<span class="hljs-built_in">nproc</span>è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º30720ã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸º655350ï¼Œå³ä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ä¸º655350ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># hard nproc 655350</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">hardè¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚<span class="hljs-built_in">nproc</span>è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·å¯åˆ›å»ºçš„æœ€å¤§è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼ä¸º4096ã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸º655350ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§è¿›ç¨‹æ•°ä¸º655350ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># soft memlock unlimited</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">softè¡¨ç¤ºè½¯é™åˆ¶ï¼Œmemlockè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯é”å®šåœ¨RAMä¸­çš„æœ€å¤§å†…å­˜ï¼Œé»˜è®¤å€¼ä¸º64 KBã€‚è¿™é‡Œçš„è½¯é™åˆ¶è®¾ç½®ä¸ºunlimitedï¼Œå³ä¸€ä¸ªè¿›ç¨‹å¯é”å®šçš„æœ€å¤§å†…å­˜ä¸ºæ— é™åˆ¶ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># hard memlock unlimited</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">hardè¡¨ç¤ºç¡¬é™åˆ¶ï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å€¼ã€‚memlockè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯é”å®šåœ¨RAMä¸­çš„æœ€å¤§å†…å­˜ï¼Œé»˜è®¤å€¼ä¸º64 KBã€‚è¿™é‡Œçš„ç¡¬é™åˆ¶è®¾ç½®ä¸ºunlimitedï¼Œå³ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å†…å­˜é”å®šä¸ºæ— é™åˆ¶ã€‚</span><br></code></pre></td></tr></table></figure><h5 id="é…ç½®å…å¯†ç™»å½•"><a href="#é…ç½®å…å¯†ç™»å½•" class="headerlink" title="é…ç½®å…å¯†ç™»å½•"></a>é…ç½®å…å¯†ç™»å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">apt install -y sshpass</span><br>yum install -y sshpass<br>ssh-keygen -f /root/.ssh/id_rsa -P &#x27;&#x27;<br>export IP=&quot;192.168.1.31 192.168.1.32 192.168.1.33 192.168.1.34 192.168.1.35&quot;<br>export SSHPASS=123123<br>for HOST in $IP;do<br>     sshpass -e ssh-copy-id -o StrictHostKeyChecking=no $HOST<br>done<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿™æ®µè„šæœ¬çš„ä½œç”¨æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šå®‰è£…sshpasså·¥å…·ï¼Œå¹¶é€šè¿‡sshpassè‡ªåŠ¨å°†æœ¬æœºçš„SSHå…¬é’¥å¤åˆ¶åˆ°å¤šä¸ªè¿œç¨‹ä¸»æœºä¸Šï¼Œä»¥å®ç°æ— éœ€æ‰‹åŠ¨è¾“å…¥å¯†ç çš„SSHç™»å½•ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 1. `apt install -y sshpass` æˆ– `yum install -y sshpass`ï¼šé€šè¿‡åŒ…ç®¡ç†å™¨ï¼ˆaptæˆ–yumï¼‰å®‰è£…sshpasså·¥å…·ï¼Œä½¿å¾—åç»­å¯ä»¥ä½¿ç”¨sshpasså‘½ä»¤ã€‚</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 2. `ssh-keygen -f /root/.ssh/id_rsa -P &#x27;&#x27;`ï¼šç”ŸæˆSSHå¯†é’¥å¯¹ã€‚è¯¥å‘½ä»¤ä¼šåœ¨/root/.sshç›®å½•ä¸‹ç”Ÿæˆç§é’¥æ–‡ä»¶id_rsaå’Œå…¬é’¥æ–‡ä»¶id_rsa.pubï¼ŒåŒæ—¶ä¸è®¾ç½®å¯†ç ï¼ˆå³-På‚æ•°åé¢ä¸ºç©ºï¼‰ï¼Œæ–¹ä¾¿åç»­é€šè¿‡ssh-copy-idå‘½ä»¤è‡ªåŠ¨å¤åˆ¶å…¬é’¥ã€‚</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 3. `export IP=&quot;192.168.1.31 192.168.1.32 192.168.1.33 192.168.1.34 192.168.1.35&quot;`ï¼šè®¾ç½®ä¸€ä¸ªåŒ…å«å¤šä¸ªè¿œç¨‹ä¸»æœºIPåœ°å€çš„ç¯å¢ƒå˜é‡IPï¼Œç”¨ç©ºæ ¼åˆ†éš”å¼€ï¼Œè¡¨ç¤ºè¦å°†SSHå…¬é’¥å¤åˆ¶åˆ°è¿™äº›è¿œç¨‹ä¸»æœºä¸Šã€‚</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 4. `export SSHPASS=123123`ï¼šè®¾ç½®ç¯å¢ƒå˜é‡SSHPASSï¼Œå°†sshpassæ‰€éœ€çš„SSHå¯†ç ï¼ˆåœ¨è¿™é‡Œæ˜¯&quot;123123&quot;ï¼‰èµ‹å€¼ç»™å®ƒï¼Œè¿™æ ·sshpasså‘½ä»¤å¯ä»¥è‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªå¯†ç è¿›è¡Œç™»å½•ã€‚</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 5. `for HOST in $IP;do`ï¼šéå†ç¯å¢ƒå˜é‡IPä¸­çš„æ¯ä¸ªIPåœ°å€ï¼Œå¹¶å°†å½“å‰IPåœ°å€èµ‹å€¼ç»™å˜é‡HOSTã€‚</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 6. `sshpass -e ssh-copy-id -o StrictHostKeyChecking=no $HOST`ï¼šä½¿ç”¨sshpasså·¥å…·å¤åˆ¶æœ¬æœºçš„SSHå…¬é’¥åˆ°è¿œç¨‹ä¸»æœºã€‚å…¶ä¸­ï¼Œ-eé€‰é¡¹è¡¨ç¤ºä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„å¯†ç ï¼ˆå³SSHPASSï¼‰è¿›è¡Œç™»å½•ï¼Œ-o StrictHostKeyChecking=noé€‰é¡¹è¡¨ç¤ºè¿æ¥æ—¶ä¸æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„å…¬é’¥ï¼Œä»¥é¿å…äº¤äº’å¼ç¡®è®¤ã€‚</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># é€šè¿‡è¿™æ®µè„šæœ¬ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†æœ¬æœºçš„SSHå…¬é’¥å¤åˆ¶åˆ°å¤šä¸ªè¿œç¨‹ä¸»æœºä¸Šï¼Œå®ç°æ— éœ€æ‰‹åŠ¨è¾“å…¥å¯†ç çš„SSHç™»å½•ã€‚</span></span><br></code></pre></td></tr></table></figure><h5 id="å‡çº§å†…æ ¸è‡³4-18ç‰ˆæœ¬ä»¥ä¸Š"><a href="#å‡çº§å†…æ ¸è‡³4-18ç‰ˆæœ¬ä»¥ä¸Š" class="headerlink" title="å‡çº§å†…æ ¸è‡³4.18ç‰ˆæœ¬ä»¥ä¸Š"></a>å‡çº§å†…æ ¸è‡³4.18ç‰ˆæœ¬ä»¥ä¸Š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…æœ€æ–°çš„å†…æ ¸</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ç¨³å®šç‰ˆkernel-ml   å¦‚éœ€æ›´æ–°é•¿æœŸç»´æŠ¤ç‰ˆæœ¬kernel-lt</span>  <br>yum -y --enablerepo=elrepo-kernel  install  kernel-ml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å·²å®‰è£…é‚£äº›å†…æ ¸</span><br>rpm -qa | grep kernel<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é»˜è®¤å†…æ ¸</span><br>grubby --default-kernel<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‹¥ä¸æ˜¯æœ€æ–°çš„ä½¿ç”¨å‘½ä»¤è®¾ç½®</span><br>grubby --set-default $(ls /boot/vmlinuz-* | grep elrepo)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å¯ç”Ÿæ•ˆ</span><br>reboot<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">v8 æ•´åˆå‘½ä»¤ä¸ºï¼š</span><br>yum install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm -y ; sed -i &quot;s@mirrorlist@#mirrorlist@g&quot; /etc/yum.repos.d/elrepo.repo ; sed -i &quot;s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g&quot; /etc/yum.repos.d/elrepo.repo ; yum  --disablerepo=&quot;*&quot;  --enablerepo=&quot;elrepo-kernel&quot;  list  available -y ; yum  --enablerepo=elrepo-kernel  install kernel-lt -y ; grubby --default-kernel ; reboot <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">v7 æ•´åˆå‘½ä»¤ä¸ºï¼š</span><br>yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm -y ; sed -i &quot;s@mirrorlist@#mirrorlist@g&quot; /etc/yum.repos.d/elrepo.repo ; sed -i &quot;s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g&quot; /etc/yum.repos.d/elrepo.repo ; yum  --disablerepo=&quot;*&quot;  --enablerepo=&quot;elrepo-kernel&quot;  list  available -y ; yum  --enablerepo=elrepo-kernel  install  kernel-lt -y ; grubby --set-default $(ls /boot/vmlinuz-* | grep elrepo) ; grubby --default-kernel ; reboot <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¦»çº¿ç‰ˆæœ¬</span> <br>yum install -y /root/cby/kernel-lt-*-1.el7.elrepo.x86_64.rpm ; grubby --set-default $(ls /boot/vmlinuz-* | grep elrepo) ; grubby --default-kernel ; reboot <br></code></pre></td></tr></table></figure><h5 id="ä¿®æ”¹å†…æ ¸å‚æ•°"><a href="#ä¿®æ”¹å†…æ ¸å‚æ•°" class="headerlink" title="ä¿®æ”¹å†…æ ¸å‚æ•°"></a>ä¿®æ”¹å†…æ ¸å‚æ•°</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf<br>net.ipv4.ip_forward = 1<br>net.bridge.bridge-nf-call-iptables = 1<br>fs.may_detach_mounts = 1<br>vm.overcommit_memory=1<br>vm.panic_on_oom=0<br>fs.inotify.max_user_watches=89100<br>fs.file-max=52706963<br>fs.nr_open=52706963<br>net.netfilter.nf_conntrack_max=2310720<br><br>net.ipv4.tcp_keepalive_time = 600<br>net.ipv4.tcp_keepalive_probes = 3<br>net.ipv4.tcp_keepalive_intvl =15<br>net.ipv4.tcp_max_tw_buckets = 36000<br>net.ipv4.tcp_tw_reuse = 1<br>net.ipv4.tcp_max_orphans = 327680<br>net.ipv4.tcp_orphan_retries = 3<br>net.ipv4.tcp_syncookies = 1<br>net.ipv4.tcp_max_syn_backlog = 16384<br>net.ipv4.ip_conntrack_max = 65536<br>net.ipv4.tcp_max_syn_backlog = 16384<br>net.ipv4.tcp_timestamps = 0<br>net.core.somaxconn = 16384<br><br>net.ipv6.conf.all.disable_ipv6 = 0<br>net.ipv6.conf.default.disable_ipv6 = 0<br>net.ipv6.conf.lo.disable_ipv6 = 0<br>net.ipv6.conf.all.forwarding = 1<br>EOF<br><br>sysctl --system<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿™äº›æ˜¯Linuxç³»ç»Ÿçš„ä¸€äº›å‚æ•°è®¾ç½®ï¼Œç”¨äºé…ç½®å’Œä¼˜åŒ–ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿå’Œè™šæ‹Ÿå†…å­˜ç­‰æ–¹é¢çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 1. net.ipv4.ip_forward = 1</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - è¿™ä¸ªå‚æ•°å¯ç”¨äº†IPv4çš„IPè½¬å‘åŠŸèƒ½ï¼Œå…è®¸æœåŠ¡å™¨ä½œä¸ºç½‘ç»œè·¯ç”±å™¨è½¬å‘æ•°æ®åŒ…ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 2. net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - å½“ä½¿ç”¨ç½‘ç»œæ¡¥æ¥æŠ€æœ¯æ—¶ï¼Œå°†æ•°æ®åŒ…ä¼ é€’åˆ°iptablesè¿›è¡Œå¤„ç†ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> </span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">3. fs.may_detach_mounts = 1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - å…è®¸åœ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå…è®¸è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> </span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">4. vm.overcommit_memory=1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - è¯¥è®¾ç½®å…è®¸åŸå§‹çš„å†…å­˜è¿‡é‡åˆ†é…ç­–ç•¥ï¼Œå½“ç³»ç»Ÿçš„å†…å­˜å·²ç»è¢«å®Œå…¨ä½¿ç”¨æ—¶ï¼Œç³»ç»Ÿä»ç„¶ä¼šåˆ†é…é¢å¤–çš„å†…å­˜ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 5. vm.panic_on_oom=0</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - å½“ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼ˆOOMï¼‰æ—¶ï¼Œç¦ç”¨ç³»ç»Ÿå´©æºƒå’Œé‡å¯ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> </span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">6. fs.inotify.max_user_watches=89100</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»Ÿå…è®¸ä¸€ä¸ªç”¨æˆ·çš„inotifyå®ä¾‹å¯ä»¥ç›‘æ§çš„æ–‡ä»¶æ•°ç›®çš„ä¸Šé™ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 7. fs.file-max=52706963</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»ŸåŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°çš„ä¸Šé™ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 8. fs.nr_open=52706963</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»ŸåŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°çš„ä¸Šé™ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 9. net.netfilter.nf_conntrack_max=2310720</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   - è®¾ç½®ç³»ç»Ÿå¯ä»¥åˆ›å»ºçš„ç½‘ç»œè¿æ¥è·Ÿè¸ªè¡¨é¡¹çš„æœ€å¤§æ•°é‡ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 10. net.ipv4.tcp_keepalive_time = 600</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®TCPå¥—æ¥å­—çš„ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…è¿‡è¯¥æ—¶é—´æ²¡æœ‰æ´»åŠ¨æ•°æ®æ—¶ï¼Œå†…æ ¸ä¼šå‘é€å¿ƒè·³åŒ…ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 11. net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®æœªæ”¶åˆ°å“åº”çš„TCPå¿ƒè·³æ¢æµ‹æ¬¡æ•°ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 12. net.ipv4.tcp_keepalive_intvl = 15</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®TCPå¿ƒè·³æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 13. net.ipv4.tcp_max_tw_buckets = 36000</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯ä»¥ä½¿ç”¨çš„TIME_WAITå¥—æ¥å­—çš„æœ€å¤§æ•°é‡ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 14. net.ipv4.tcp_tw_reuse = 1</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - å¯ç”¨TIME_WAITå¥—æ¥å­—çš„é‡æ–°åˆ©ç”¨ï¼Œå…è®¸æ–°çš„å¥—æ¥å­—ä½¿ç”¨æ—§çš„TIME_WAITå¥—æ¥å­—ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 15. net.ipv4.tcp_max_orphans = 327680</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯ä»¥åŒæ—¶å­˜åœ¨çš„TCPå¥—æ¥å­—åƒåœ¾å›æ”¶åŒ…è£¹æ•°çš„æœ€å¤§æ•°é‡ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 16. net.ipv4.tcp_orphan_retries = 3</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯¹äºå­¤ç«‹çš„TCPå¥—æ¥å­—çš„é‡è¯•æ¬¡æ•°ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 17. net.ipv4.tcp_syncookies = 1</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - å¯ç”¨TCP SYN cookiesä¿æŠ¤ï¼Œç”¨äºé˜²æ­¢SYNæ´ªæ³›æ”»å‡»ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 18. net.ipv4.tcp_max_syn_backlog = 16384</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®æ–°çš„TCPè¿æ¥çš„åŠè¿æ¥æ•°ï¼ˆåŠè¿æ¥é˜Ÿåˆ—ï¼‰çš„æœ€å¤§é•¿åº¦ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 19. net.ipv4.ip_conntrack_max = 65536</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿå¯ä»¥åˆ›å»ºçš„ç½‘ç»œè¿æ¥è·Ÿè¸ªè¡¨é¡¹çš„æœ€å¤§æ•°é‡ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 20. net.ipv4.tcp_timestamps = 0</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - å…³é—­TCPæ—¶é—´æˆ³åŠŸèƒ½ï¼Œç”¨äºæä¾›æ›´å¥½çš„å®‰å…¨æ€§ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 21. net.core.somaxconn = 16384</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - è®¾ç½®ç³»ç»Ÿæ ¸å¿ƒå±‚çš„è¿æ¥é˜Ÿåˆ—çš„æœ€å¤§å€¼ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 22. net.ipv6.conf.all.disable_ipv6 = 0</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - å¯ç”¨IPv6åè®®ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 23. net.ipv6.conf.default.disable_ipv6 = 0</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - å¯ç”¨IPv6åè®®ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 24. net.ipv6.conf.lo.disable_ipv6 = 0</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - å¯ç”¨IPv6åè®®ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># 25. net.ipv6.conf.all.forwarding = 1</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">    - å…è®¸IPv6æ•°æ®åŒ…è½¬å‘ã€‚</span><br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨aliyunæºå®‰è£…docker-ce"><a href="#ä½¿ç”¨aliyunæºå®‰è£…docker-ce" class="headerlink" title="ä½¿ç”¨aliyunæºå®‰è£…docker-ce"></a>ä½¿ç”¨aliyunæºå®‰è£…docker-ce</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åº•å±‚æ˜¯ç”¨dockerè¿è¡Œï¼Œæ‰€ä»¥æ¯å°ä¸»æœºéƒ½éœ€è¦å®‰è£…docker</span><br>yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br>yum -y install docker-ce<br></code></pre></td></tr></table></figure><p>Kubernetesæ˜¯ä¸€ä¸ªå¼€æºç³»ç»Ÿï¼Œç”¨äºå®¹å™¨åŒ–åº”ç”¨çš„è‡ªåŠ¨éƒ¨ç½²ã€æ‰©ç¼©å’Œç®¡ç†ã€‚å®ƒå°†æ„æˆåº”ç”¨çš„å®¹å™¨æŒ‰é€»è¾‘å•ä½è¿›è¡Œåˆ†ç»„ä»¥ä¾¿äºç®¡ç†å’Œå‘ç°ã€‚</p><p>ç”±äº Kubernetes å®˜æ–¹å˜æ›´äº†ä»“åº“çš„å­˜å‚¨è·¯å¾„ä»¥åŠä½¿ç”¨æ–¹å¼ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ 1.28 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨ æ–°ç‰ˆé…ç½®æ–¹æ³• è¿›è¡Œé…ç½®ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://mirrors.aliyun.com/kubernetes/">https://mirrors.aliyun.com/kubernetes/</a></p><p>æ–°ç‰ˆä¸‹è½½åœ°å€ï¼š<a href="https://mirrors.aliyun.com/kubernetes-new/">https://mirrors.aliyun.com/kubernetes-new/</a></p><h4 id="k8sç»„ä»¶å®‰è£…é…ç½®æ–¹æ³•"><a href="#k8sç»„ä»¶å®‰è£…é…ç½®æ–¹æ³•" class="headerlink" title="k8sç»„ä»¶å®‰è£…é…ç½®æ–¹æ³•"></a>k8sç»„ä»¶å®‰è£…é…ç½®æ–¹æ³•</h4><h5 id="æ–°ç‰ˆé…ç½®æ–¹æ³•"><a href="#æ–°ç‰ˆé…ç½®æ–¹æ³•" class="headerlink" title="æ–°ç‰ˆé…ç½®æ–¹æ³•"></a>æ–°ç‰ˆé…ç½®æ–¹æ³•</h5><p>æ–°ç‰ˆ kubernetes æºä½¿ç”¨æ–¹æ³•å’Œä¹‹å‰æœ‰ä¸€å®šåŒºåˆ«ï¼Œè¯·æ±‚æŒ‰ç…§å¦‚ä¸‹é…ç½®æ–¹æ³•é…ç½®ä½¿ç”¨ã€‚</p><p>å…¶ä¸­æ–°ç‰ˆ kubernetes æºæŒ‰ç…§å®‰è£…ç‰ˆæœ¬åŒºåˆ†ä¸åŒä»“åº“ï¼Œè¯¥æ–‡æ¡£ç¤ºä¾‹ä¸ºé…ç½® 1.30 ç‰ˆæœ¬ï¼Œå¦‚éœ€å…¶ä»–ç‰ˆæœ¬è¯·åœ¨å¯¹åº”ä½ç½®å­—ç¬¦ä¸²æ›¿æ¢å³å¯ã€‚</p><h6 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian &#x2F; Ubuntu"></a>Debian &#x2F; Ubuntu</h6><ol><li>åœ¨é…ç½®ä¸­æ·»åŠ é•œåƒï¼ˆæ³¨æ„ä¿®æ”¹ä¸ºè‡ªå·±éœ€è¦çš„ç‰ˆæœ¬å·ï¼‰ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get update &amp;&amp; apt-get install -y apt-transport-https<br>curl -fsSL https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/deb/Release.key |<br>    gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg<br>echo &quot;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/deb/ /&quot; |<br>    tee /etc/apt/sources.list.d/kubernetes.list<br></code></pre></td></tr></table></figure><ol start="2"><li>å®‰è£…å¿…è¦åº”ç”¨ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get update<br>apt-get install -y kubelet kubeadm kubectl<br>systemctl enable kubelet &amp;&amp; systemctl start kubelet<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚å®‰è£…æŒ‡å®šç‰ˆæœ¬</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">apt install kubelet=1.28.2-00 kubeadm=1.28.2-00 kubectl=1.28.2-00</span><br></code></pre></td></tr></table></figure><h6 id="CentOS-RHEL-Fedora"><a href="#CentOS-RHEL-Fedora" class="headerlink" title="CentOS &#x2F; RHEL &#x2F; Fedora"></a>CentOS &#x2F; RHEL &#x2F; Fedora</h6><ol><li>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆæ³¨æ„ä¿®æ”¹ä¸ºè‡ªå·±éœ€è¦çš„ç‰ˆæœ¬å·ï¼‰ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &lt;&lt;EOF | tee /etc/yum.repos.d/kubernetes.repo<br>[kubernetes]<br>name=Kubernetes<br>baseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/<br>enabled=1<br>gpgcheck=1<br>gpgkey=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/repodata/repomd.xml.key<br>EOF<br></code></pre></td></tr></table></figure><ol start="2"><li>å®‰è£…å¿…è¦åº”ç”¨ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹kubeletçš„ç‰ˆæœ¬ï¼Œæ–¹ä¾¿åœ¨å®‰è£…çš„æ—¶å€™ä½¿ç”¨k8s 1.23çš„æ–°ç‰ˆæœ¬</span><br>yum search kubelet --showduplicates <br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ ¹æ®æŸ¥è¯¢å‡ºæ¥çš„kubeletï¼Œé€‰æ‹©å¯¹åº”çš„å®‰è£…ç‰ˆæœ¬ï¼Œè¿™é‡Œä»¥1.23.9ä¸ºä¾‹</span><br>yum install kubelet-1.23.9-0 kubeadm-1.23.9-0 kubectl-1.23.9-0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é…ç½®kubeletè‡ªåŠ¨å¯åŠ¨ï¼Œä½†æ˜¯æŸ¥çœ‹çŠ¶æ€çš„æ—¶å€™æ˜¯æ²¡æœ‰å¯åŠ¨çš„ï¼Œåœ¨kubeadmåˆå§‹åŒ–é›†ç¾¤çš„æ—¶å€™ä¼šè‡ªåŠ¨å¯åŠ¨</span><br>systemctl enable kubelet &amp;&amp; systemctl start kubelet<br><br></code></pre></td></tr></table></figure><p>ps: ç”±äºå®˜ç½‘æœªå¼€æ”¾åŒæ­¥æ–¹å¼, å¯èƒ½ä¼šæœ‰ç´¢å¼•gpgæ£€æŸ¥å¤±è´¥çš„æƒ…å†µ, è¿™æ—¶è¯·ç”¨ <code>yum install -y --nogpgcheck kubelet kubeadm kubectl</code> å®‰è£…</p><h5 id="æ—§ç‰ˆé…ç½®æ–¹æ³•"><a href="#æ—§ç‰ˆé…ç½®æ–¹æ³•" class="headerlink" title="æ—§ç‰ˆé…ç½®æ–¹æ³•"></a>æ—§ç‰ˆé…ç½®æ–¹æ³•</h5><p>ç›®å‰ç”±äºkuberneteså®˜æ–¹å˜æ›´äº†ä»“åº“çš„å­˜å‚¨è·¯å¾„ä»¥åŠä½¿ç”¨æ–¹å¼ï¼Œæ—§ç‰ˆ kubernetes æºåªæ›´æ–°åˆ° 1.28 éƒ¨åˆ†ç‰ˆæœ¬ï¼Œåç»­æ›´æ–°ç‰ˆæœ¬è¯·ä½¿ç”¨ æ–°æºé…ç½®æ–¹æ³• è¿›è¡Œé…ç½®ã€‚</p><h6 id="Debian-Ubuntu-1"><a href="#Debian-Ubuntu-1" class="headerlink" title="Debian &#x2F; Ubuntu"></a>Debian &#x2F; Ubuntu</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get update &amp;&amp; apt-get install -y apt-transport-https<br>curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - <br>cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list<br>deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main<br>EOF<br>apt-get update<br>apt-get install -y kubelet kubeadm kubectl<br></code></pre></td></tr></table></figure><h6 id="CentOS-RHEL-Fedora-1"><a href="#CentOS-RHEL-Fedora-1" class="headerlink" title="CentOS &#x2F; RHEL &#x2F; Fedora"></a>CentOS &#x2F; RHEL &#x2F; Fedora</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo<br>[kubernetes]<br>name=Kubernetes<br>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/<br>enabled=1<br>gpgcheck=1<br>repo_gpgcheck=1<br>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹kubeletçš„ç‰ˆæœ¬ï¼Œæ–¹ä¾¿åœ¨å®‰è£…çš„æ—¶å€™ä½¿ç”¨k8s 1.23çš„æ–°ç‰ˆæœ¬</span><br>yum search kubelet --showduplicates <br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ ¹æ®æŸ¥è¯¢å‡ºæ¥çš„kubeletï¼Œé€‰æ‹©å¯¹åº”çš„å®‰è£…ç‰ˆæœ¬ï¼Œè¿™é‡Œä»¥1.23.9ä¸ºä¾‹</span><br>yum install kubelet-1.23.9-0 kubeadm-1.23.9-0 kubectl-1.23.9-0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é…ç½®kubeletè‡ªåŠ¨å¯åŠ¨ï¼Œä½†æ˜¯æŸ¥çœ‹çŠ¶æ€çš„æ—¶å€™æ˜¯æ²¡æœ‰å¯åŠ¨çš„ï¼Œåœ¨kubeadmåˆå§‹åŒ–é›†ç¾¤çš„æ—¶å€™ä¼šè‡ªåŠ¨å¯åŠ¨</span><br>systemctl enable kubelet &amp;&amp; systemctl start kubelet<br></code></pre></td></tr></table></figure><p>ps: ç”±äºå®˜ç½‘æœªå¼€æ”¾åŒæ­¥æ–¹å¼, å¯èƒ½ä¼šæœ‰ç´¢å¼•gpgæ£€æŸ¥å¤±è´¥çš„æƒ…å†µ, è¿™æ—¶è¯·ç”¨ <code>yum install -y --nogpgcheck kubelet kubeadm kubectl</code> å®‰è£…</p><h4 id="ä½¿ç”¨kubeadmåˆå§‹åŒ–å®‰è£…"><a href="#ä½¿ç”¨kubeadmåˆå§‹åŒ–å®‰è£…" class="headerlink" title="ä½¿ç”¨kubeadmåˆå§‹åŒ–å®‰è£…"></a>ä½¿ç”¨kubeadmåˆå§‹åŒ–å®‰è£…</h4><h5 id="é…ç½®k8sä½¿ç”¨é˜¿é‡Œäº‘æº"><a href="#é…ç½®k8sä½¿ç”¨é˜¿é‡Œäº‘æº" class="headerlink" title="é…ç½®k8sä½¿ç”¨é˜¿é‡Œäº‘æº"></a>é…ç½®k8sä½¿ç”¨é˜¿é‡Œäº‘æº</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@master01 ~]# <span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">repo_gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹k8sç‰ˆæœ¬ä½¿ç”¨çš„é•œåƒï¼ˆå¯ä»¥å…ˆæ‹‰å–ä¸‹æ¥è¿™æ ·æ¯”è¾ƒå¿«ä¸€ç‚¹ï¼‰"><a href="#æŸ¥çœ‹k8sç‰ˆæœ¬ä½¿ç”¨çš„é•œåƒï¼ˆå¯ä»¥å…ˆæ‹‰å–ä¸‹æ¥è¿™æ ·æ¯”è¾ƒå¿«ä¸€ç‚¹ï¼‰" class="headerlink" title="æŸ¥çœ‹k8sç‰ˆæœ¬ä½¿ç”¨çš„é•œåƒï¼ˆå¯ä»¥å…ˆæ‹‰å–ä¸‹æ¥è¿™æ ·æ¯”è¾ƒå¿«ä¸€ç‚¹ï¼‰"></a>æŸ¥çœ‹k8sç‰ˆæœ¬ä½¿ç”¨çš„é•œåƒï¼ˆå¯ä»¥å…ˆæ‹‰å–ä¸‹æ¥è¿™æ ·æ¯”è¾ƒå¿«ä¸€ç‚¹ï¼‰</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬æœ‰é‚£äº›é•œåƒ</span><br>[root@k8s-master01 ~]# kubeadm config images list --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers<br><br><span class="hljs-comment"># å¦‚æœæƒ³è¦æŸ¥çœ‹é»˜è®¤é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤å°†é…ç½®é‡å®šå‘åˆ°æ–‡ä»¶å½“ä¸­ï¼Œåé¢è‡ªè¡Œä¿®æ”¹</span><br>[root@k8s-master01 ~]# kubeadm config <span class="hljs-built_in">print</span> init-defaults &gt; kubeadm-init.yaml<br><br><span class="hljs-comment"># ä¸Šé¢çš„é…ç½®æ–‡ä»¶é…ç½®å®Œæˆäº†ä¹‹åï¼Œä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–¹å¼åˆå§‹åŒ–é›†ç¾¤</span><br>[root@k8s-master01 ~]# kubeadm init --config=kubeadm.yaml<br><br><span class="hljs-comment"># å¦‚æœå®‰è£…å¤±è´¥ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</span><br><span class="hljs-comment"># é‡æ–°åˆå§‹åŒ–</span><br>[root@k8s-master01 ~]# kubeadm reset<br><br><span class="hljs-comment"># ä½¿ç”¨å‚æ•°çš„å½¢å¼åˆå§‹åŒ–</span><br>[root@k8s-master01 ~]# kubeadminit--kubernetes-version=1.23.9 --apiserver-advertise-address=10.0.0.19       --image-repository registry.aliyuncs.com/google_containers --service-cidr=10.96.0.0/12 --pod-network-cidr=10.244.0.0/16 <br><br><span class="hljs-comment"># è¿™ä¸ªå‚æ•°å¯åŠ å¯ä¸åŠ ï¼ˆå› ä¸ºå‰é¢å…³é—­äº†swapï¼Œå¹¶é‡å¯äº†æœºå™¨ï¼‰</span><br>--ignore-preflight-errors=Swap<br></code></pre></td></tr></table></figure><h5 id="å®‰è£…å®Œæˆå"><a href="#å®‰è£…å®Œæˆå" class="headerlink" title="å®‰è£…å®Œæˆå"></a>å®‰è£…å®Œæˆå</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@k8s-master01 ~]#  <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>[root@k8s-master01 ~]#  <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>[root@k8s-master01 ~]#  <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h5 id="æŠŠå…¶ä»–èŠ‚ç‚¹ä»¥nodeæ–¹å¼åŠ å…¥k8s"><a href="#æŠŠå…¶ä»–èŠ‚ç‚¹ä»¥nodeæ–¹å¼åŠ å…¥k8s" class="headerlink" title="æŠŠå…¶ä»–èŠ‚ç‚¹ä»¥nodeæ–¹å¼åŠ å…¥k8s"></a>æŠŠå…¶ä»–èŠ‚ç‚¹ä»¥nodeæ–¹å¼åŠ å…¥k8s</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŠŠå…¶ä»–çš„èŠ‚ç‚¹ä½œä¸ºmasterï¼ˆcontrol-plane ï¼‰åŠ å…¥</span><br><span class="hljs-comment"># ä½†æ˜¯ä¸‹é¢çš„å‘½ä»¤ä¸è¦å¤åˆ¶è¿™é‡Œçš„ï¼Œkubeadmå®‰è£…å®Œæˆåä¼šè‡ªå·±è¾“å‡ºåœ¨ç»ˆç«¯å†…</span><br>You can now <span class="hljs-built_in">join</span> any number of control-plane nodes by copying certificate authorities<br>and service account keys on each node and <span class="hljs-keyword">then</span> running the following as root:<br><br>  kubeadm <span class="hljs-built_in">join</span> 192.168.1.36:9443 --token abcdef.0123456789abcdef \<br>--discovery-token-ca-cert-hash sha256:583ddadd1318dae447c3890aa3a2469c5b00c6775e87102458db07e691c724be \<br>--control-plane <br><br><span class="hljs-comment"># æŠŠå…¶ä»–èŠ‚ç‚¹ä½œä¸ºworkèŠ‚ç‚¹åŠ å…¥</span><br>Then you can <span class="hljs-built_in">join</span> any number of worker nodes by running the following on each as root:<br><br>kubeadm <span class="hljs-built_in">join</span> 192.168.1.36:9443 --token abcdef.0123456789abcdef \<br>--discovery-token-ca-cert-hash sha256:583ddadd1318dae447c3890aa3a2469c5b00c6775e87102458db07e691c724be <br></code></pre></td></tr></table></figure><h4 id="å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶"></a>å®‰è£…ç½‘ç»œæ’ä»¶</h4><h5 id="æ‰“å¼€k8så®˜ç½‘ç½‘å€æä¾›çš„ç½‘ç»œæ’ä»¶"><a href="#æ‰“å¼€k8så®˜ç½‘ç½‘å€æä¾›çš„ç½‘ç»œæ’ä»¶" class="headerlink" title="æ‰“å¼€k8så®˜ç½‘ç½‘å€æä¾›çš„ç½‘ç»œæ’ä»¶"></a>æ‰“å¼€k8så®˜ç½‘ç½‘å€æä¾›çš„ç½‘ç»œæ’ä»¶</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://kubernetes.io/docs/concepts/cluster-administration/addons/<br><span class="hljs-comment"># æ‰¾åˆ°Networking and Network Policy  è¿™ä¸ªéƒ¨åˆ†ï¼Œæ ¹æ®éœ€è¦å®‰è£…ç½‘ç»œæ’ä»¶</span><br><span class="hljs-comment"># è¿™é‡Œé€‰æ‹©çš„æ˜¯flannelç½‘ç»œæ’ä»¶ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶è¿™é‡Œçš„åœ°å€æ‰“å¼€githubä¸Šçš„åœ°å€ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰“å¼€ä¸Šé¢çš„k8sé¡µé¢ï¼Œè‡ªå·±æ‰¾åˆ°å¯¹åº”çš„ç½‘å€ï¼Œå»ºè®®è¿˜æ˜¯æ‰“å¼€çœ‹ä¸€ä¸‹</span><br>https://github.com/flannel-io/flannel#deploying-flannel-manually<br><br><span class="hljs-comment"># For Kubernetes v1.17+ Deploying Flannel with kubectl</span><br>[root@master01 ~]# kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml<br><br><span class="hljs-comment"># å¦‚æœæƒ³ç”¨calicoç½‘ç»œæ’ä»¶</span><br>[root@master01 ~]# kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml<br><br><span class="hljs-comment"># ç­‰å¾…kube-flannelå‘½åç©ºé—´å†…çš„podå®¹å™¨å¯åŠ¨å®Œæˆ</span><br><span class="hljs-comment"># å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç›‘è§†</span><br>watch -n 1 kubectl get po  -n kube-flannel<br></code></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹k8sé›†ç¾¤çŠ¶æ€"><a href="#æŸ¥çœ‹k8sé›†ç¾¤çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹k8sé›†ç¾¤çŠ¶æ€"></a>æŸ¥çœ‹k8sé›†ç¾¤çŠ¶æ€</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@k8s-master01 ~]# kubectl get nodes<br>NAME           STATUS     ROLES           AGE     VERSION<br>k8s-master01   NotReady   control-plane   2m14s   v1.23.9<br>k8s-node01     NotReady   &lt;none&gt;          19s     v1.23.9<br>k8s-node02     NotReady   &lt;none&gt;          9s      v1.23.9<br></code></pre></td></tr></table></figure><h4 id="å®‰è£…åå®Œå–„"><a href="#å®‰è£…åå®Œå–„" class="headerlink" title="å®‰è£…åå®Œå–„"></a>å®‰è£…åå®Œå–„</h4><h5 id="æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œä½¿kubectlå¯ä»¥è‡ªåŠ¨è¡¥å……"><a href="#æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œä½¿kubectlå¯ä»¥è‡ªåŠ¨è¡¥å……" class="headerlink" title="æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œä½¿kubectlå¯ä»¥è‡ªåŠ¨è¡¥å……"></a>æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œä½¿kubectlå¯ä»¥è‡ªåŠ¨è¡¥å……</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@master01 ~]# <span class="hljs-built_in">source</span> &lt;(kubectl completion bash)<br>[root@master01 ~]# <span class="hljs-built_in">source</span> &lt;(kubeadm completion bash)<br></code></pre></td></tr></table></figure><h4 id="å®‰è£…kubernetes-dashboard"><a href="#å®‰è£…kubernetes-dashboard" class="headerlink" title="å®‰è£…kubernetes-dashboard"></a>å®‰è£…kubernetes-dashboard</h4><h5 id="ä¸ºdashboardé…ç½®nodeportç«¯å£"><a href="#ä¸ºdashboardé…ç½®nodeportç«¯å£" class="headerlink" title="ä¸ºdashboardé…ç½®nodeportç«¯å£"></a>ä¸ºdashboardé…ç½®nodeportç«¯å£</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®˜æ–¹éƒ¨ç½²`dashboard`çš„æœåŠ¡æ²¡ä½¿ç”¨`nodeport`ï¼Œå°†yamlæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œåœ¨serviceé‡Œæ·»åŠ nodeport</span><br>[root@master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-rc7/aio/deploy/recommended.yaml<br>[root@master01 ~]# vim recommended.yaml<br>kind: Service<br>apiVersion: v1<br>metadata:<br>  labels:<br>    k8s-app: kubernetes-dashboard<br>  name: kubernetes-dashboard<br>  namespace: kubernetes-dashboard<br>spec:<br>  <span class="hljs-built_in">type</span>: NodePort<br>  ports:<br>    - port: 443<br>      targetPort: 8443<br>      nodePort: 30000<br>  selector:<br>    k8s-app: kubernetes-dashboard<br><br>[root@master01 ~]# kubectl create -f recommended.yaml<br>namespace/kubernetes-dashboard created<br>serviceaccount/kubernetes-dashboard created<br>service/kubernetes-dashboard created<br>secret/kubernetes-dashboard-certs created<br>secret/kubernetes-dashboard-csrf created<br>secret/kubernetes-dashboard-key-holder created<br>configmap/kubernetes-dashboard-settings created<br>role.rbac.authorization.k8s.io/kubernetes-dashboard created<br>clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created<br>rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created<br>clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created<br>deployment.apps/kubernetes-dashboard created<br>service/dashboard-metrics-scraper created<br>deployment.apps/dashboard-metrics-scraper created<br></code></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹podï¼Œservice"><a href="#æŸ¥çœ‹podï¼Œservice" class="headerlink" title="æŸ¥çœ‹podï¼Œservice"></a>æŸ¥çœ‹podï¼Œservice</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">NAME</span>                                        READY   STATUS    RESTARTS   AGE<br><span class="hljs-attribute">dashboard</span>-metrics-scraper-dc6947fbf-<span class="hljs-number">869</span>kf   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">37</span>s<br><span class="hljs-attribute">kubernetes</span>-dashboard-<span class="hljs-number">5</span>d4dc8b976-sdxxt       <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">37</span>s<span class="hljs-meta"></span><br><span class="hljs-meta">[root@master01 ~]# kubectl get svc -n kubernetes-dashboard</span><br><span class="hljs-meta">NAME                        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)         AGE</span><br><span class="hljs-meta">dashboard-metrics-scraper   ClusterIP   10.10.58.93    &lt;none&gt;        8000/TCP        44s</span><br><span class="hljs-meta">kubernetes-dashboard        NodePort    10.10.132.66   &lt;none&gt;        443:30000/TCP   44s</span><br></code></pre></td></tr></table></figure><h5 id="é€šè¿‡é¡µé¢è®¿é—®ï¼Œæ¨èä½¿ç”¨firefoxæµè§ˆå™¨"><a href="#é€šè¿‡é¡µé¢è®¿é—®ï¼Œæ¨èä½¿ç”¨firefoxæµè§ˆå™¨" class="headerlink" title="é€šè¿‡é¡µé¢è®¿é—®ï¼Œæ¨èä½¿ç”¨firefoxæµè§ˆå™¨"></a>é€šè¿‡é¡µé¢è®¿é—®ï¼Œæ¨èä½¿ç”¨firefoxæµè§ˆå™¨</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ ¹æ®è‡ªå·±çš„ç½‘ç»œç¯å¢ƒæ‰“å¼€å¯¹åº”çš„ç½‘å€</span><br>æ‰“å¼€æµè§ˆå™¨è¾“å…¥https://192.168.1.30000  <br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨tokenè¿›è¡Œç™»å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤è·å–token"><a href="#ä½¿ç”¨tokenè¿›è¡Œç™»å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤è·å–token" class="headerlink" title="ä½¿ç”¨tokenè¿›è¡Œç™»å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤è·å–token"></a>ä½¿ç”¨tokenè¿›è¡Œç™»å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤è·å–token</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@master01 ~]# kubectl describe secrets -n kubernetes-dashboard kubernetes-dashboard-token-t4hxz  | grep token | awk <span class="hljs-string">&#x27;NR==3&#123;print $2&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>ç™»å½•åï¼Œå¦‚æœæ²¡æœ‰namespaceå¯é€‰ï¼Œå¹¶ä¸”æç¤ºæ‰¾ä¸åˆ°èµ„æº ï¼Œé‚£ä¹ˆå°±æ˜¯æƒé™é—®é¢˜ã€‚</p><p>é€šè¿‡æŸ¥çœ‹dashboardæ—¥å¿—ï¼Œå¾—åˆ°å¦‚ä¸‹ ä¿¡æ¯ï¼Œå‡ºç°ä»¥ä¸‹ä¿¡æ¯çš„åŸå› æ˜¯ï¼Œç™»å½•dashboardçš„æƒé™ä¸å¤Ÿï¼Œä¸èƒ½è·å–åˆ°å†…å®¹</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">2023/04/08 01:54:31 Non-critical <span class="hljs-built_in">error</span> occurred during<span class="hljs-built_in"> resource </span>retrieval: jobs.batch is forbidden:<span class="hljs-built_in"> User </span><span class="hljs-string">&quot;system:serviceaccount:kubernetes-dashboard:kubernetes-dashboard&quot;</span> cannot list<span class="hljs-built_in"> resource </span><span class="hljs-string">&quot;jobs&quot;</span> <span class="hljs-keyword">in</span> API<span class="hljs-built_in"> group </span><span class="hljs-string">&quot;batch&quot;</span> <span class="hljs-keyword">in</span> the namespace <span class="hljs-string">&quot;default&quot;</span><br></code></pre></td></tr></table></figure><h5 id="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"><a href="#åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š" class="headerlink" title="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"></a>åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è§£å†³åŠæ³•å°±æ˜¯åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®šï¼Œä»¥é›†ç¾¤ç®¡ç†å‘˜çš„æ–¹å¼ï¼Œç®¡ç†dashboard</span><br>[root@master01 ~]# kubectl create clusterrolebinding serviceaccount-cluster-admin --clusterrole=cluster-admin --group=system:serviceaccount <br>clusterrolebinding.rbac.authorization.k8s.io/serviceaccount-cluster-admin created<br></code></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹dashboardæ—¥å¿—"><a href="#æŸ¥çœ‹dashboardæ—¥å¿—" class="headerlink" title="æŸ¥çœ‹dashboardæ—¥å¿—"></a>æŸ¥çœ‹dashboardæ—¥å¿—</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@master01 ~]# kubectl logs -f -n kubernetes-dashboard kubernetes-dashboard-5d4dc8b976-sdxx<br></code></pre></td></tr></table></figure><h5 id="æ­¤æ—¶å†æŸ¥çœ‹dashboardï¼Œå³å¯çœ‹åˆ°æœ‰èµ„æºå±•ç¤º"><a href="#æ­¤æ—¶å†æŸ¥çœ‹dashboardï¼Œå³å¯çœ‹åˆ°æœ‰èµ„æºå±•ç¤º" class="headerlink" title="æ­¤æ—¶å†æŸ¥çœ‹dashboardï¼Œå³å¯çœ‹åˆ°æœ‰èµ„æºå±•ç¤º"></a>æ­¤æ—¶å†æŸ¥çœ‹dashboardï¼Œå³å¯çœ‹åˆ°æœ‰èµ„æºå±•ç¤º</h5>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8sã€äº‘åŸç”Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetesé›†ç¾¤åŒ…ç®¡ç†è§£å†³æ–¹æ¡ˆ-helm</title>
    <link href="/2025/03/19/Kubernetes%E9%9B%86%E7%BE%A4%E5%8C%85%E7%AE%A1%E7%90%86%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-helm/"/>
    <url>/2025/03/19/Kubernetes%E9%9B%86%E7%BE%A4%E5%8C%85%E7%AE%A1%E7%90%86%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-helm/</url>
    
    <content type="html"><![CDATA[<h5 id="ä¸€ã€å¼•å…¥helmåŸå› "><a href="#ä¸€ã€å¼•å…¥helmåŸå› " class="headerlink" title="ä¸€ã€å¼•å…¥helmåŸå› "></a>ä¸€ã€å¼•å…¥helmåŸå› </h5><pre><code class="hljs">å½“ä»Šçš„è½¯ä»¶å¼€å‘ï¼Œéšç€äº‘åŸç”ŸæŠ€æœ¯çš„æ™®åŠï¼Œæˆ‘ä»¬çš„å·¥ç¨‹åº”ç”¨è¿›è¡Œå¾®æœåŠ¡åŒ–å’Œå®¹å™¨åŒ–çš„ç°è±¡ä¹Ÿå˜å¾—è¶Šæ¥è¶Šæ™®éã€‚è€ŒKuberneteså‡ ä¹å·²ç»æˆäº†äº‘åŸç”ŸæœåŠ¡ç¼–æ’ç»•ä¸å¼€çš„æ ‡å‡†å’ŒæŠ€æœ¯ã€‚å®é™…ç”Ÿäº§ä¸­ï¼Œå¾®æœåŠ¡é¡¹ç›®å¯èƒ½æœ‰åå‡ ä¸ªæ¨¡å—ï¼Œè‹¥è¿˜éœ€è¦è¿›è¡Œå®‰å…¨è®¿é—®å’Œæ§åˆ¶ï¼Œé‚£ä¹ˆéœ€è¦åˆ›å»ºè¯¸å¦‚Roleã€ServiceAccountç­‰èµ„æºã€‚éƒ¨ç½²å’Œç‰ˆæœ¬å‡çº§æ—¶ä¹Ÿå¾€å¾€éœ€è¦ä¿®æ”¹æˆ–æ·»åŠ é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›å‚æ•°ï¼ˆä¾‹å¦‚ï¼šæœåŠ¡å ç”¨çš„CPUã€å†…å­˜ã€å‰¯æœ¬æ•°ã€ç«¯å£ç­‰ï¼‰ï¼Œç»´æŠ¤å¤§é‡çš„yamlæ–‡ä»¶æä¸ºä¸ä¾¿ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›YAMLæ–‡ä»¶ä½œä¸ºä¸€ä¸ª**æ•´ä½“**ç®¡ç†ï¼Œå¹¶é«˜æ•ˆå¤ç”¨ã€‚</code></pre><ul><li>åœ¨Linuxæ“ä½œç³»ç»Ÿè½¯ä»¶éƒ¨ç½²ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰¹é‡ç®¡ç†å·¥å…·å®Œæˆè½¯ä»¶çš„æ‰¹é‡ç®¡ç†ç­‰ï¼Œä¾‹å¦‚yumã€dnfç­‰ï¼›</li><li>åœ¨å®¹å™¨åº”ç”¨ä¸­Dockerä½¿ç”¨Dockerfileæ–‡ä»¶è§£å†³äº†å®¹å™¨é•œåƒåˆ¶ä½œéš¾é¢˜ï¼›</li><li>åœ¨kubernetesåº”ç”¨ä¸­ï¼Œé€šè¿‡YAMLæ ¼å¼æ–‡ä»¶è§£å†³å®¹å™¨ç¼–æ’éƒ¨ç½²éš¾é¢˜ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡YAMLæ ¼å¼çš„èµ„æºæ¸…å•æ–‡ä»¶ï¼Œéå¸¸æ–¹ä¾¿éƒ¨ç½²ä¸åŒæ§åˆ¶å™¨ç±»å‹çš„åº”ç”¨;ä½†æ˜¯å¦‚ä½•ç»´æŠ¤å¤§é‡çš„ï¼Œç³»ç»Ÿæ€§çš„YAMLæ–‡ä»¶ï¼Œéœ€è¦æˆ‘ä»¬æ‹¥æœ‰æ›´å¥½çš„å·¥å…·ï¼Œä¸èƒ½ç®€å•ä½¿ç”¨YAMLèµ„æºæ¸…å•æ‰˜ç®¡æœåŠ¡å™¨å°±å¯ä»¥è§£å†³çš„ã€‚</li></ul><h5 id="äºŒã€helmæ˜¯ä»€ä¹ˆ"><a href="#äºŒã€helmæ˜¯ä»€ä¹ˆ" class="headerlink" title="äºŒã€helmæ˜¯ä»€ä¹ˆ"></a>äºŒã€helmæ˜¯ä»€ä¹ˆ</h5><ul><li><p>å®˜æ–¹: <a href="https://helm.sh/">https://helm.sh/</a></p></li><li><p>ä½œä¸ºCNCFçš„æ¯•ä¸šé¡¹ç›®ã€‚å®ƒçš„å®˜æ–¹çš„å®šä¹‰æ˜¯ï¼šHelmæ˜¯ä¸€ä¸ªä¸ºK8sè¿›è¡ŒåŒ…ç®¡ç†çš„å·¥å…·</p></li></ul><ul><li>Helm(èˆµæŸ„; èˆµè½®)æ˜¯ä¸€ä¸ªKubernetesçš„åŒ…ç®¡ç†å·¥å…·ï¼Œå°±åƒLinuxä¸‹çš„åŒ…ç®¡ç†å™¨ï¼Œå¦‚yum&#x2F;aptç­‰ã€‚</li><li>helmä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œä¸»è¦ç”¨äºKubernetesåº”ç”¨chartçš„åˆ›å»ºã€æ‰“åŒ…ã€å‘å¸ƒå’Œç®¡ç†ã€‚</li><li>é€šè¿‡helmå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„yamlæ–‡ä»¶éƒ¨ç½²åˆ°kubernetesä¸Šã€‚</li><li>å¯¹äºåº”ç”¨å‘å¸ƒè€…è€Œè¨€ï¼Œå¯ä»¥é€šè¿‡Helmæ‰“åŒ…åº”ç”¨ï¼Œç®¡ç†åº”ç”¨ä¾èµ–å…³ç³»ï¼Œç®¡ç†åº”ç”¨ç‰ˆæœ¬å¹¶å‘å¸ƒåº”ç”¨åˆ°è½¯ä»¶ä»“åº“ã€‚</li><li>å¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œä½¿ç”¨Helmåä¸ç”¨éœ€è¦äº†è§£Kubernetesçš„Yamlè¯­æ³•å¹¶ç¼–å†™åº”ç”¨éƒ¨ç½²æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡Helmä¸‹è½½å¹¶åœ¨kubernetesä¸Šå®‰è£…éœ€è¦çš„åº”ç”¨ã€‚</li><li>é™¤æ­¤ä»¥å¤–ï¼ŒHelmè¿˜æä¾›äº†kubernetesä¸Šçš„è½¯ä»¶éƒ¨ç½²ï¼Œåˆ é™¤ï¼Œå‡çº§ï¼Œå›æ»šåº”ç”¨çš„å¼ºå¤§åŠŸèƒ½ã€‚</li><li>Helm ç¤¾åŒºå·²ç»ç»´æŠ¤äº†ä¸€ä¸ªå®˜æ–¹ Helm Hubï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç»åšå¥½çš„ Helm Chartï¼Œéƒ¨ç½²å’Œç®¡ç†æ¯”è¾ƒå¤æ‚çš„åº”ç”¨ç¨‹åº</li><li>æ—©æœŸçš„hub.helm.devè½¬ç§»åˆ°äº†<a href="https://artifacthub.io/%E3%80%82">https://artifacthub.io/ã€‚</a></li></ul><h5 id="ä¸‰ã€helmä½œç”¨åŠæ ¸å¿ƒæ¦‚å¿µ"><a href="#ä¸‰ã€helmä½œç”¨åŠæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ä¸‰ã€helmä½œç”¨åŠæ ¸å¿ƒæ¦‚å¿µ"></a>ä¸‰ã€helmä½œç”¨åŠæ ¸å¿ƒæ¦‚å¿µ</h5><pre><code class="hljs">HelmåŸºäºgoæ¨¡æ¿è¯­è¨€ï¼Œç”¨æˆ·åªè¦æä¾›è§„å®šçš„ç›®å½•ç»“æ„å’Œæ¨¡æ¿æ–‡ä»¶ã€‚åœ¨çœŸæ­£éƒ¨ç½²æ—¶Helmæ¨¡æ¿å¼•æ“ä¾¿å¯ä»¥å°†å…¶æ¸²æŸ“æˆçœŸæ­£çš„K8sèµ„æºé…ç½®æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§æ­£ç¡®çš„é¡ºåºå°†å®ƒä»¬éƒ¨ç½²åˆ°èŠ‚ç‚¹ä¸Šã€‚</code></pre><h6 id="Helmä¸­æœ‰ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼Œåˆ†åˆ«ä¸ºChartã€Repositoryå’ŒReleaseã€‚"><a href="#Helmä¸­æœ‰ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼Œåˆ†åˆ«ä¸ºChartã€Repositoryå’ŒReleaseã€‚" class="headerlink" title="Helmä¸­æœ‰ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼Œåˆ†åˆ«ä¸ºChartã€Repositoryå’ŒReleaseã€‚"></a><strong>Helmä¸­æœ‰ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼Œåˆ†åˆ«ä¸ºChartã€Repositoryå’ŒReleaseã€‚</strong></h6><ul><li><p>Chartä»£è¡¨ä¸­HelmåŒ…ã€‚å®ƒåŒ…å«åœ¨K8sé›†ç¾¤å†…éƒ¨è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå·¥å…·æˆ–æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰ï¼Œä¸ºæ‰€æœ‰é¡¹ç›®èµ„æºæ¸…å•yamlæ–‡ä»¶çš„é›†åˆï¼Œé‡‡ç”¨TARæ ¼å¼ï¼Œå¯ä»¥ç±»æ¯”æˆyumä¸­çš„RPMã€‚</p></li><li><p>Repositoryå°±æ˜¯ç”¨æ¥å­˜æ”¾å’Œå…±äº«Chartçš„åœ°æ–¹ï¼Œå¯ä»¥ç±»æ¯”æˆYUMä»“åº“ã€‚</p></li><li><p>Releaseæ˜¯è¿è¡Œåœ¨K8sé›†ç¾¤ä¸­çš„Chartçš„å®ä¾‹(<strong>éƒ¨ç½²æ—¶å€™èµ·çš„åå­—)</strong>ï¼Œä¸€ä¸ªChartå¯ä»¥åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­å®‰è£…å¤šæ¬¡ã€‚Chartå°±åƒæµæ°´çº¿ä¸­åˆå§‹åŒ–å¥½çš„æ¨¡æ¿ï¼ŒReleaseå°±æ˜¯è¿™ä¸ªâ€œæ¨¡æ¿â€æ‰€ç”Ÿäº§å‡ºæ¥çš„å„ä¸ªäº§å“ã€‚</p></li></ul><h5 id="ä¸‰ã€helmæ¶æ„"><a href="#ä¸‰ã€helmæ¶æ„" class="headerlink" title="ä¸‰ã€helmæ¶æ„"></a>ä¸‰ã€helmæ¶æ„</h5><pre><code class="hljs">v2ç‰ˆæœ¬çš„æ—¶å€™éœ€è¦åœ¨k8sé›†ç¾¤å½“ä¸­å®‰è£…ä¸€ä¸ªTilleræœåŠ¡ï¼Œåœ¨v3ç‰ˆæœ¬å½“ä¸­ï¼Œç›´æ¥ä½¿ç”¨kubeconfigä¸apiserverè¿›è¡Œå¯¹è¯ã€‚</code></pre><p><img src="https://www.t-ao.cn/usr/uploads/2024/06/754913602.png" alt="image-20220728135524226.png"></p><p>Helmå®¢æˆ·ç«¯ä½¿ç”¨<strong>REST+JSON</strong>çš„æ–¹å¼ä¸K8sä¸­çš„apiserverè¿›è¡Œäº¤äº’ï¼Œè¿›è€Œç®¡ç†deploymentã€serviceç­‰èµ„æºï¼Œå¹¶ä¸”å®¢æˆ·ç«¯æœ¬èº«å¹¶ä¸éœ€è¦æ•°æ®åº“ï¼Œå®ƒä¼šæŠŠç›¸å…³çš„ä¿¡æ¯å‚¨å­˜åœ¨K8sé›†ç¾¤å†…çš„Secretsä¸­ã€‚</p><p><img src="https://www.t-ao.cn/usr/uploads/2024/06/3728478168.png" alt="image-20220728140109073.png"></p><h5 id="å››ã€helméƒ¨ç½²"><a href="#å››ã€helméƒ¨ç½²" class="headerlink" title="å››ã€helméƒ¨ç½²"></a>å››ã€helméƒ¨ç½²</h5><p><img src="https://www.t-ao.cn/usr/uploads/2024/06/1773491326.png" alt="image-20220728140501620.png"><br><img src="https://www.t-ao.cn/usr/uploads/2024/06/1791632736.png" alt="image-20220728140538044.png"><br><img src="https://www.t-ao.cn/usr/uploads/2024/06/1791632736.png" alt="image-20220728140538044.png"><br><img src="https://www.t-ao.cn/usr/uploads/2024/06/2878045302.png" alt="image-20220728141000714.png"><br><img src="https://www.t-ao.cn/usr/uploads/2024/06/579956143.png" alt="image-20220728141101419.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># wget https://get.helm.sh/helm-v3.9.2-linux-amd64.tar.gz</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment">#  ls</span><br>helm<span class="hljs-literal">-v3</span>.<span class="hljs-number">9.2</span><span class="hljs-literal">-linux-amd64</span>.tar.gz<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># tar xf helm-v3.9.2-linux-amd64.tar.gz</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># ls</span><br>linux<span class="hljs-literal">-amd64</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># cd linux-amd64/</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">linux</span>-<span class="hljs-type">amd64</span>]<span class="hljs-comment"># ls</span><br>helm  LICENSE  README.md<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">linux</span>-<span class="hljs-type">amd64</span>]<span class="hljs-comment"># mv helm /usr/bin</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">linux</span>-<span class="hljs-type">amd64</span>]<span class="hljs-comment"># helm version</span><br>version.BuildInfo&#123;Version:<span class="hljs-string">&quot;v3.9.2&quot;</span>, GitCommit:<span class="hljs-string">&quot;1addefbfe665c350f4daf868a9adc5600cc064fd&quot;</span>, GitTreeState:<span class="hljs-string">&quot;clean&quot;</span>, GoVersion:<span class="hljs-string">&quot;go1.17.12&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h5 id="äº”ã€helmåŸºç¡€ä½¿ç”¨"><a href="#äº”ã€helmåŸºç¡€ä½¿ç”¨" class="headerlink" title="äº”ã€helmåŸºç¡€ä½¿ç”¨"></a>äº”ã€helmåŸºç¡€ä½¿ç”¨</h5><h6 id="5-1-æ·»åŠ åŠåˆ é™¤ä»“åº“"><a href="#5-1-æ·»åŠ åŠåˆ é™¤ä»“åº“" class="headerlink" title="5.1 æ·»åŠ åŠåˆ é™¤ä»“åº“"></a>5.1 æ·»åŠ åŠåˆ é™¤ä»“åº“</h6><h6 id="5-1-1-æŸ¥çœ‹ä»“åº“"><a href="#5-1-1-æŸ¥çœ‹ä»“åº“" class="headerlink" title="5.1.1 æŸ¥çœ‹ä»“åº“"></a>5.1.1 æŸ¥çœ‹ä»“åº“</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">master1</span> ~]<span class="hljs-comment"># helm repo list</span><br>Error: no repositories to show<br></code></pre></td></tr></table></figure><h6 id="5-1-2-æ·»åŠ æ–°çš„ä»“åº“åœ°å€"><a href="#5-1-2-æ·»åŠ æ–°çš„ä»“åº“åœ°å€" class="headerlink" title="5.1.2 æ·»åŠ æ–°çš„ä»“åº“åœ°å€"></a>5.1.2 æ·»åŠ æ–°çš„ä»“åº“åœ°å€</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">å¾®è½¯æº<br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm repo add stable http://mirror.azure.cn/kubernetes/charts/</span><br><br>bitnamiæº  <br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><br>prometheusæº<br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span><br></code></pre></td></tr></table></figure><h6 id="5-1-3-æŸ¥çœ‹å·²ç»æ·»åŠ çš„ä»“åº“"><a href="#5-1-3-æŸ¥çœ‹å·²ç»æ·»åŠ çš„ä»“åº“" class="headerlink" title="5.1.3 æŸ¥çœ‹å·²ç»æ·»åŠ çš„ä»“åº“"></a>5.1.3 æŸ¥çœ‹å·²ç»æ·»åŠ çš„ä»“åº“</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm repo list</span><br>NAME    URL<br>stable  http://mirror.azure.cn/kubernetes/charts/<br></code></pre></td></tr></table></figure><h6 id="5-1-4-æ›´æ–°ä»“åº“"><a href="#5-1-4-æ›´æ–°ä»“åº“" class="headerlink" title="5.1.4 æ›´æ–°ä»“åº“"></a>5.1.4 æ›´æ–°ä»“åº“</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm repo update</span><br>Hang tight <span class="hljs-keyword">while</span> we grab the latest from your chart repositories...<br>...Successfully got an update from the <span class="hljs-string">&quot;stable&quot;</span> chart repository<br>Update Complete. âˆHappy Helming!âˆ<br></code></pre></td></tr></table></figure><h6 id="5-2-æŸ¥çœ‹charts"><a href="#5-2-æŸ¥çœ‹charts" class="headerlink" title="5.2 æŸ¥çœ‹charts"></a>5.2 æŸ¥çœ‹charts</h6><p>ä½¿ç”¨<code>helm search repo å…³é”®å­—</code>å¯ä»¥æŸ¥çœ‹ç›¸å…³charts</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm search repo stable</span><br>NAME                                    CHART VERSION   APP VERSION             DESCRIPTION<br>stable/acs<span class="hljs-literal">-engine-autoscaler</span>            <span class="hljs-number">2.2</span>.<span class="hljs-number">2</span>           <span class="hljs-number">2.1</span>.<span class="hljs-number">1</span>                   DEPRECATED Scales worker nodes within agent pools<br>stable/aerospike                        <span class="hljs-number">0.3</span>.<span class="hljs-number">5</span>           v4.<span class="hljs-number">5.0</span>.<span class="hljs-number">5</span>                DEPRECATED A Helm chart <span class="hljs-keyword">for</span> Aerospike <span class="hljs-keyword">in</span> Kubern...<br>stable/airflow                          <span class="hljs-number">7.13</span>.<span class="hljs-number">3</span>          <span class="hljs-number">1.10</span>.<span class="hljs-number">12</span>                 DEPRECATED - please use: https://github.com/air...<br>stable/ambassador                       <span class="hljs-number">5.3</span>.<span class="hljs-number">2</span>           <span class="hljs-number">0.86</span>.<span class="hljs-number">1</span>                  DEPRECATED A Helm chart <span class="hljs-keyword">for</span> Datawire Ambassador<br>stable/anchore<span class="hljs-literal">-engine</span>                   <span class="hljs-number">1.7</span>.<span class="hljs-number">0</span>           <span class="hljs-number">0.7</span>.<span class="hljs-number">3</span>                   Anchore container analysis and policy evaluatio...<br>stable/apm<span class="hljs-literal">-server</span>                       <span class="hljs-number">2.1</span>.<span class="hljs-number">7</span>           <span class="hljs-number">7.0</span>.<span class="hljs-number">0</span>                   DEPRECATED The server receives <span class="hljs-keyword">data</span> from the El...<br>stable/ark                              <span class="hljs-number">4.2</span>.<span class="hljs-number">2</span>           <span class="hljs-number">0.10</span>.<span class="hljs-number">2</span>                  DEPRECATED A Helm chart <span class="hljs-keyword">for</span> ark<br>stable/artifactory                      <span class="hljs-number">7.3</span>.<span class="hljs-number">2</span>           <span class="hljs-number">6.1</span>.<span class="hljs-number">0</span>                   DEPRECATED Universal Repository Manager support...<br>stable/artifactory<span class="hljs-literal">-ha</span>                   <span class="hljs-number">0.4</span>.<span class="hljs-number">2</span>           <span class="hljs-number">6.2</span>.<span class="hljs-number">0</span>                   DEPRECATED Universal Repository Manager support...<br>stable/atlantis                         <span class="hljs-number">3.12</span>.<span class="hljs-number">4</span>          v0.<span class="hljs-number">14.0</span>                 DEPRECATED A Helm chart <span class="hljs-keyword">for</span> Atlantis https://ww...<br>stable/auditbeat                        <span class="hljs-number">1.1</span>.<span class="hljs-number">2</span>           <span class="hljs-number">6.7</span>.<span class="hljs-number">0</span>                   DEPRECATED A lightweight shipper to audit the a...<br>stable/aws<span class="hljs-literal">-cluster-autoscaler</span>           <span class="hljs-number">0.3</span>.<span class="hljs-number">4</span>                                   DEPRECATED Scales worker nodes within autoscali...<br>stable/aws<span class="hljs-literal">-iam-authenticator</span>            <span class="hljs-number">0.1</span>.<span class="hljs-number">5</span>           <span class="hljs-number">1.0</span>                     DEPRECATED A Helm chart <span class="hljs-keyword">for</span> aws<span class="hljs-literal">-iam-authenticator</span><br>stable/bitcoind                         <span class="hljs-number">1.0</span>.<span class="hljs-number">2</span>           <span class="hljs-number">0.17</span>.<span class="hljs-number">1</span>                  DEPRECATED Bitcoin is an innovative payment net...<br>stable/bookstack                        <span class="hljs-number">1.2</span>.<span class="hljs-number">4</span>           <span class="hljs-number">0.27</span>.<span class="hljs-number">5</span>                  DEPRECATED BookStack is a simple, self<span class="hljs-literal">-hosted</span>, ...<br>......<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm search repo nginx</span><br>NAME                            CHART VERSION   APP VERSION     DESCRIPTION<br>stable/nginx<span class="hljs-literal">-ingress</span>            <span class="hljs-number">1.41</span>.<span class="hljs-number">3</span>          v0.<span class="hljs-number">34.1</span>         DEPRECATED! An nginx Ingress controller that us...<br>stable/nginx<span class="hljs-literal">-ldapauth-proxy</span>     <span class="hljs-number">0.1</span>.<span class="hljs-number">6</span>           <span class="hljs-number">1.13</span>.<span class="hljs-number">5</span>          DEPRECATED - nginx proxy with ldapauth<br>stable/nginx<span class="hljs-literal">-lego</span>               <span class="hljs-number">0.3</span>.<span class="hljs-number">1</span>                           Chart <span class="hljs-keyword">for</span> nginx<span class="hljs-literal">-ingress-controller</span> and kube<span class="hljs-literal">-lego</span><br>stable/gcloud<span class="hljs-literal">-endpoints</span>         <span class="hljs-number">0.1</span>.<span class="hljs-number">2</span>           <span class="hljs-number">1</span>               DEPRECATED Develop, deploy, protect and monitor...<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm search repo tomcat</span><br>NAME            CHART VERSION   APP VERSION     DESCRIPTION<br>stable/tomcat   <span class="hljs-number">0.4</span>.<span class="hljs-number">3</span>           <span class="hljs-number">7.0</span>             DEPRECATED - Deploy a basic tomcat application ...<br></code></pre></td></tr></table></figure><h6 id="5-3-éƒ¨ç½²åº”ç”¨-MySQL"><a href="#5-3-éƒ¨ç½²åº”ç”¨-MySQL" class="headerlink" title="5.3 éƒ¨ç½²åº”ç”¨ MySQL"></a>5.3 éƒ¨ç½²åº”ç”¨ MySQL</h6><blockquote><p>ç¯å¢ƒè¯´æ˜ï¼šk8sé›†ç¾¤ä¸­å­˜åœ¨storageclass:nfs-client</p></blockquote><p>æˆ‘ä»¬ç°åœ¨å®‰è£…ä¸€ä¸ª <code>mysql</code> åº”ç”¨ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm search repo mysql</span><br>NAME                                    CHART VERSION   APP VERSION     DESCRIPTION<br>stable/mysql                            <span class="hljs-number">1.6</span>.<span class="hljs-number">9</span>           <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>          DEPRECATED - Fast, reliable, scalable, and easy...<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># --generate-name è‡ªåŠ¨ç”Ÿæˆéƒ¨ç½²çš„release</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm install stable/mysql --generate-name  --set persistence.storageClass=nfs-client --set mysqlRootPassword=test123</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs powershell">éƒ¨ç½²è¿‡ç¨‹è¾“å‡ºçš„ä¿¡æ¯ï¼š<br>NAME: mysql<span class="hljs-literal">-1658996042</span><br>LAST DEPLOYED: Thu Jul <span class="hljs-number">28</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03</span> <span class="hljs-number">2022</span><br>NAMESPACE: default<br>STATUS: deployed<br>REVISION: <span class="hljs-number">1</span><br>NOTES:<br>MySQL can be accessed via port <span class="hljs-number">3306</span> on the following DNS name from within your cluster:<br>mysql<span class="hljs-literal">-1658996042</span>.default.svc.cluster.local<br><br>To get your root password run:<br><br>    MYSQL_ROOT_PASSWORD=<span class="hljs-variable">$</span>(kubectl get secret <span class="hljs-literal">--namespace</span> default mysql<span class="hljs-literal">-1658996042</span> <span class="hljs-literal">-o</span> jsonpath=<span class="hljs-string">&quot;&#123;.data.mysql-root-password&#125;&quot;</span> | base64 <span class="hljs-literal">--decode</span>; <span class="hljs-built_in">echo</span>)<br><br>To connect to your database:<br><br><span class="hljs-number">1</span>. Run an Ubuntu pod that you can use as a client:<br><br>    kubectl run <span class="hljs-literal">-i</span> <span class="hljs-literal">--tty</span> ubuntu <span class="hljs-literal">--image</span>=ubuntu:<span class="hljs-number">16.04</span> <span class="hljs-literal">--restart</span>=Never <span class="hljs-literal">--</span> bash <span class="hljs-literal">-il</span><br><br><span class="hljs-number">2</span>. Install the mysql client:<br><br>    <span class="hljs-variable">$</span> apt<span class="hljs-literal">-get</span> update &amp;&amp; apt<span class="hljs-literal">-get</span> install mysql<span class="hljs-literal">-client</span> <span class="hljs-literal">-y</span><br><br><span class="hljs-number">3</span>. Connect <span class="hljs-keyword">using</span> the mysql cli, then provide your password:<br>    <span class="hljs-variable">$</span> mysql <span class="hljs-literal">-h</span> mysql<span class="hljs-literal">-1658996042</span> <span class="hljs-literal">-p</span><br><br>To connect to your database directly from outside the K8s cluster:<br>    MYSQL_HOST=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>    MYSQL_PORT=<span class="hljs-number">3306</span><br><br>    <span class="hljs-comment"># Execute the following command to route the connection:</span><br>    kubectl port<span class="hljs-literal">-forward</span> svc/mysql<span class="hljs-literal">-1658996042</span> <span class="hljs-number">3306</span><br><br>    mysql <span class="hljs-literal">-h</span> <span class="hljs-variable">$</span>&#123;MYSQL_HOST&#125; <span class="hljs-literal">-P</span><span class="hljs-variable">$</span>&#123;MYSQL_PORT&#125; <span class="hljs-literal">-u</span> root <span class="hljs-literal">-p</span><span class="hljs-variable">$</span>&#123;MYSQL_ROOT_PASSWORD&#125;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># æŸ¥çœ‹helmå·²ç»å®‰è£…çš„releaseï¼ˆè¿™ä¸ªreleaseæ˜¯éƒ¨ç½²æ—¶å€™çš„åº”ç”¨åç§°ï¼‰</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm list</span><br>NAME                    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION<br><br>mysql<span class="hljs-literal">-1658996042</span>        default         <span class="hljs-number">1</span>               <span class="hljs-number">2022</span><span class="hljs-literal">-07-28</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03.530489788</span> +<span class="hljs-number">0800</span> CST deployed        mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get pods</span><br>NAME                                     READY   STATUS    RESTARTS   AGE<br>mysql<span class="hljs-literal">-1658996042-755f5f64f6-j5s67</span>        <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">82</span>s<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get pvc</span><br>NAME               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br>mysql<span class="hljs-literal">-1658996042</span>   Bound    pvc<span class="hljs-literal">-7fcb894e-5b8c-4f3e-945d-21b60b9309e5</span>   <span class="hljs-number">8</span><span class="hljs-built_in">Gi</span>        RWO            nfs<span class="hljs-literal">-client</span>     <span class="hljs-number">93</span>s<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get pv</span><br>NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                      STORAGECLASS   REASON   AGE<br>pvc<span class="hljs-literal">-7fcb894e-5b8c-4f3e-945d-21b60b9309e5</span>   <span class="hljs-number">8</span><span class="hljs-built_in">Gi</span>        RWO            Delete           Bound    default/mysql<span class="hljs-literal">-1658996042</span>   nfs<span class="hljs-literal">-client</span>              <span class="hljs-number">97</span>s<br></code></pre></td></tr></table></figure><p><strong>ä¸€ä¸ª chart åŒ…æ˜¯å¯ä»¥å¤šæ¬¡å®‰è£…åˆ°åŒä¸€ä¸ªé›†ç¾¤ä¸­çš„ï¼Œæ¯æ¬¡å®‰è£…éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªrelease, æ¯ä¸ªreleaseéƒ½å¯ä»¥ç‹¬ç«‹ç®¡ç†å’Œå‡çº§ã€‚</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm install stable/mysql --generate-name  --set persistence.storageClass=nfs-client --set mysqlRootPassword=root</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm ls</span><br>NAME                    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION<br>mysql<span class="hljs-literal">-1658996042</span>        default         <span class="hljs-number">1</span>               <span class="hljs-number">2022</span><span class="hljs-literal">-07-28</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span>:<span class="hljs-number">03.530489788</span> +<span class="hljs-number">0800</span> CST deployed        mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br>mysql<span class="hljs-literal">-1658996297</span>        default         <span class="hljs-number">1</span>               <span class="hljs-number">2022</span><span class="hljs-literal">-07-28</span> <span class="hljs-number">16</span>:<span class="hljs-number">18</span>:<span class="hljs-number">19.282074215</span> +<span class="hljs-number">0800</span> CST deployed        mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get pods</span><br>NAME                                     READY   STATUS    RESTARTS   AGE<br>mysql<span class="hljs-literal">-1658996042-755f5f64f6-j5s67</span>        <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">45</span>m<br>mysql<span class="hljs-literal">-1658996297-75f6f86d84-5qd8r</span>        <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">41</span>m<br>nfs<span class="hljs-literal">-client-provisioner-9d46587b5-7n2vf</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">123</span>m<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl exec -it mysql-1658996042-755f5f64f6-j5s67 -- bash</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell">root@mysql<span class="hljs-literal">-1658996042-755f5f64f6-j5s67</span>:/<span class="hljs-comment"># mysql -uroot -ptest123</span><br>mysql: [<span class="hljs-type">Warning</span>] <span class="hljs-keyword">Using</span> a password on the <span class="hljs-keyword">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands <span class="hljs-keyword">end</span> with ; or \g.<br>Your MySQL connection id is <span class="hljs-number">547</span><br>Server version: <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span> MySQL Community Server (GPL)<br><br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2020</span>, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br><span class="hljs-built_in">Type</span> <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> help. <span class="hljs-built_in">Type</span> <span class="hljs-string">&#x27;\c&#x27;</span> to <span class="hljs-built_in">clear</span> the current input statement.<br><br>mysql&gt; show databases;<br>+<span class="hljs-literal">--------------------</span>+<br>| Database           |<br>+<span class="hljs-literal">--------------------</span>+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+<span class="hljs-literal">--------------------</span>+<br><span class="hljs-number">4</span> rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure><h6 id="5-4-æŸ¥çœ‹chartèµ„æº"><a href="#5-4-æŸ¥çœ‹chartèµ„æº" class="headerlink" title="5.4 æŸ¥çœ‹chartèµ„æº"></a>5.4 æŸ¥çœ‹chartèµ„æº</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get all -l release=mysql-1658996042</span><br>NAME                                    READY   STATUS    RESTARTS   AGE<br>pod/mysql<span class="hljs-literal">-1658996042-755f5f64f6-j5s67</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">72</span>m<br><br>NAME                       <span class="hljs-built_in">TYPE</span>        CLUSTER<span class="hljs-literal">-IP</span>    EXTERNAL<span class="hljs-literal">-IP</span>   PORT(S)    AGE<br>service/mysql<span class="hljs-literal">-1658996042</span>   ClusterIP   <span class="hljs-number">10.96</span>.<span class="hljs-number">2.136</span>   &lt;none&gt;        <span class="hljs-number">3306</span>/TCP   <span class="hljs-number">72</span>m<br><br>NAME                               READY   UP<span class="hljs-literal">-TO-DATE</span>   AVAILABLE   AGE<br>deployment.apps/mysql<span class="hljs-literal">-1658996042</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     <span class="hljs-number">1</span>            <span class="hljs-number">1</span>           <span class="hljs-number">72</span>m<br><br>NAME                                          DESIRED   CURRENT   READY   AGE<br>replicaset.apps/mysql<span class="hljs-literal">-1658996042-755f5f64f6</span>   <span class="hljs-number">1</span>         <span class="hljs-number">1</span>         <span class="hljs-number">1</span>       <span class="hljs-number">72</span>m<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ <code>helm show chart</code> å‘½ä»¤æ¥äº†è§£ MySQL è¿™ä¸ª chart åŒ…çš„ä¸€äº›ç‰¹æ€§ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm show chart stable/mysql</span><br>apiVersion: v1<br>appVersion: <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br>deprecated: true<br>description: DEPRECATED - Fast, reliable, scalable, and easy to use <span class="hljs-built_in">open-source</span> relational<br>  database system.<br>home: https://www.mysql.com/<br>icon: https://www.mysql.com/common/logos/logo<span class="hljs-literal">-mysql-170x115</span>.png<br>keywords:<br>- mysql<br>- database<br>- sql<br>name: mysql<br>sources:<br>- https://github.com/kubernetes/charts<br>- https://github.com/docker<span class="hljs-literal">-library</span>/mysql<br>version: <span class="hljs-number">1.6</span>.<span class="hljs-number">9</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ç”¨ <code>helm show all</code> å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm show all stable/mysql</span><br>......<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm show chart æ˜¯ Helm å‘½ä»¤è¡Œå·¥å…·ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºå±•ç¤º Chart çš„è¯¦ç»†ä¿¡æ¯ã€‚Chart æ˜¯ Helm ç”¨æ¥æ‰“åŒ… Kubernetes èµ„æºçš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒåŒ…å«äº†éƒ¨ç½²ä¸€ä¸ªåº”ç”¨åˆ° Kubernetes é›†ç¾¤æ‰€éœ€çš„æ‰€æœ‰å¿…è¦é…ç½®æ–‡ä»¶å’Œä¾èµ–ã€‚å½“ä½ è¿è¡Œ helm show chart [chart-name] å‘½ä»¤æ—¶ï¼ŒHelm ä¼šè¾“å‡ºæŒ‡å®š Chart åŒ…å«çš„å…ƒæ•°æ®å’Œç»“æ„ä¿¡æ¯ï¼Œè¿™å¯¹äºç†è§£å’ŒéªŒè¯ Chart çš„å†…å®¹ä»¥åŠå…¶è®¾è®¡æ–¹å¼éå¸¸æœ‰å¸®åŠ©ã€‚ä¸‹é¢æ˜¯è¯¥å‘½ä»¤æ˜¾ç¤ºå†…å®¹çš„ä¸€äº›å…³é”®éƒ¨åˆ†è§£æï¼š<br><br>Chart.yaml: è¿™æ˜¯ Chart çš„ä¸»è¦å…ƒæ•°æ®æ–‡ä»¶ï¼Œhelm show chart ä¼šæ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚å®ƒåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹ä¿¡æ¯ï¼š<br><br>name: Chart çš„åç§°ã€‚<br>version: Chart çš„ç‰ˆæœ¬ã€‚<br>description: Chart çš„ç®€çŸ­æè¿°ã€‚<br>keywords: ä¸ Chart ç›¸å…³çš„å…³é”®è¯åˆ—è¡¨ã€‚<br>home: Chart çš„é¡¹ç›®ä¸»é¡µ URLã€‚<br>sources: Chart æºä»£ç çš„ URL åˆ—è¡¨ã€‚<br>maintainers: ç»´æŠ¤è€…çš„ä¿¡æ¯åˆ—è¡¨ï¼ŒåŒ…æ‹¬åå­—ã€ç”µå­é‚®ä»¶å’Œè§’è‰²ã€‚<br>dependencies: æœ¬ Chart ä¾èµ–çš„å…¶ä»– Chart åˆ—è¡¨ã€‚<br>values.yamlï¼ˆéƒ¨åˆ†æ˜¾ç¤ºæˆ–å¼•ç”¨ï¼‰: è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº† Chart çš„é»˜è®¤é…ç½®å€¼ã€‚è™½ç„¶ helm show chart ä¸ä¼šç›´æ¥å®Œæ•´æ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä½†å®ƒå¯èƒ½ä¼šæåˆ°æˆ–å¼•ç”¨æŸäº›é»˜è®¤å€¼ï¼Œç‰¹åˆ«æ˜¯åœ¨æè¿°å¦‚ä½•ä½¿ç”¨æˆ–è‡ªå®šä¹‰ Chart æ—¶ã€‚values.yaml åŒ…å«äº†æ‰€æœ‰å¯é…ç½®é¡¹åŠå…¶é»˜è®¤å€¼ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ Helm çš„å€¼è¦†ç›–åŠŸèƒ½æ¥ä¿®æ”¹è¿™äº›å€¼ã€‚<br><br>Templates: è™½ç„¶ helm show chart ä¸ä¼šç›´æ¥å±•ç¤ºæ¨¡æ¿æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œå®ƒé€šå¸¸ä¼šæ¦‚è¿°æ¨¡æ¿ç›®å½•çš„å­˜åœ¨åŠå…¶é‡è¦æ€§ã€‚æ¨¡æ¿ç›®å½•åŒ…å«äº†ä¸€ç³»åˆ—çš„ YAML æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä½¿ç”¨ Go æ¨¡æ¿è¯­è¨€ç¼–å†™ï¼Œç”¨äºç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åˆ° Kubernetes çš„èµ„æºé…ç½®æ–‡ä»¶ã€‚æ¯ä¸ªæ¨¡æ¿æ–‡ä»¶å¯¹åº” Kubernetes ä¸­çš„ä¸€ç§èµ„æºç±»å‹ï¼Œå¦‚ Deploymentã€Serviceã€ConfigMap ç­‰ï¼Œå¹¶å¯ä»¥æ ¹æ® values.yaml ä¸­çš„å€¼åŠ¨æ€ç”Ÿæˆã€‚<br><br>Chart çš„ç›®å½•ç»“æ„: è¾“å‡ºå¯èƒ½è¿˜ä¼šç®€è¦ä»‹ç» Chart ç›®å½•çš„åŸºæœ¬ç»“æ„ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº templatesã€chartsï¼ˆå­˜æ”¾ä¾èµ– Chart çš„ç›®å½•ï¼‰ã€filesï¼ˆç”¨äºå­˜æ”¾é™æ€æ–‡ä»¶ï¼‰ç­‰ã€‚<br><br>è¯´æ˜å’Œæç¤º: åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœ Chart å¼€å‘è€…åœ¨ Chart.yaml æˆ– README æ–‡ä»¶ä¸­åŒ…å«äº†é¢å¤–çš„è¯´æ˜æˆ–å®‰è£…æç¤ºï¼Œhelm show chart è¾“å‡ºä¹Ÿå¯èƒ½åŒ…å«è¿™äº›ä¿¡æ¯ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£å¦‚ä½•ä½¿ç”¨æˆ–é…ç½®è¯¥ Chartã€‚<br></code></pre></td></tr></table></figure><h6 id="5-5-åˆ é™¤Release"><a href="#5-5-åˆ é™¤Release" class="headerlink" title="5.5 åˆ é™¤Release"></a>5.5 åˆ é™¤Release</h6><p>å¦‚æœéœ€è¦åˆ é™¤è¿™ä¸ª releaseï¼Œä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ <code>helm uninstall</code>æˆ–<code>helm delete</code> å‘½ä»¤å³å¯ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm uninstall mysql-1605195227</span><br>release <span class="hljs-string">&quot;mysql-1605195227&quot;</span> uninstalled<br></code></pre></td></tr></table></figure><p><code>uninstall</code> å‘½ä»¤ä¼šä» Kubernetes ä¸­åˆ é™¤ releaseï¼Œä¹Ÿä¼šåˆ é™¤ä¸ release ç›¸å…³çš„æ‰€æœ‰ Kubernetes èµ„æºä»¥åŠ release å†å²è®°å½•ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm ls</span><br>NAME              NAMESPACE     REVISION     UPDATED    STATUS        CHART           APP VERSION<br>mysql<span class="hljs-literal">-1605192239</span>     default     <span class="hljs-number">1</span>        .........     deployed      mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>       <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><p>åœ¨åˆ é™¤çš„æ—¶å€™ä½¿ç”¨ <code>--keep-history</code> å‚æ•°ï¼Œåˆ™ä¼šä¿ç•™ release çš„å†å²è®°å½•ï¼Œè¯¥ release çš„çŠ¶æ€å°±æ˜¯ <code>UNINSTALLED</code>ï¼Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm uninstall mysql-1605192239 --keep-history</span><br>release <span class="hljs-string">&quot;mysql-1605192239&quot;</span> uninstalled<br><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm ls -a</span><br>NAME                    NAMESPACE       REVISION        UPDATED     STATUS        CHART     APP VERSION<br>mysql<span class="hljs-literal">-1605192239</span>        default         <span class="hljs-number">1</span>              ........    uninstalled     mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br>çŠ¶æ€ä¸ºuninstalled<br></code></pre></td></tr></table></figure><p>å®¡æŸ¥å†å²æ—¶ç”šè‡³å¯ä»¥å–æ¶ˆåˆ é™¤<code>release</code>ã€‚</p><p><code>Usage:  helm rollback &lt;RELEASE&gt; [REVISION] [flags]</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm rollback mysql-1605192239 1</span><br>Rollback was a success! Happy Helming!<br><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm ls</span><br>NAME              NAMESPACE     REVISION     UPDATED    STATUS        CHART           APP VERSION<br>mysql<span class="hljs-literal">-1605192239</span>     default     <span class="hljs-number">2</span>        .........     deployed      mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>       <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br>rollbackåï¼Œåˆå›åˆ°deployedçŠ¶æ€<br></code></pre></td></tr></table></figure><h6 id="5-6-å®šåˆ¶å‚æ•°éƒ¨ç½²åº”ç”¨"><a href="#5-6-å®šåˆ¶å‚æ•°éƒ¨ç½²åº”ç”¨" class="headerlink" title="5.6 å®šåˆ¶å‚æ•°éƒ¨ç½²åº”ç”¨"></a>5.6 å®šåˆ¶å‚æ•°éƒ¨ç½²åº”ç”¨</h6><p>ä¸Šé¢æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨çš„ <code>helm install</code> å‘½ä»¤å®‰è£…çš„ chart åŒ…ï¼Œè¿™ç§æƒ…å†µä¸‹åªä¼šä½¿ç”¨ chart çš„é»˜è®¤é…ç½®é€‰é¡¹ï¼Œä½†æ˜¯æ›´å¤šçš„æ—¶å€™ï¼Œæ˜¯å„ç§å„æ ·çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®šåˆ¶ chart åŒ…çš„é…ç½®å‚æ•°ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>helm show values</code> å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸ª chart åŒ…çš„æ‰€æœ‰å¯é…ç½®çš„å‚æ•°é€‰é¡¹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm show values stable/mysql</span><br>......<br>......<br></code></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°çš„æ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯ä»¥ç”¨è‡ªå·±çš„æ•°æ®æ¥è¦†ç›–çš„ï¼Œå¯ä»¥åœ¨å®‰è£…çš„æ—¶å€™é€šè¿‡ YAML æ ¼å¼çš„æ–‡ä»¶æ¥ä¼ é€’è¿™äº›å‚æ•°</p><p>1ï¼Œå‡†å¤‡å‚æ•°æ–‡ä»¶</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># vim mysql-config.yml</span><br>mysqlDatabase: helm<br>persistence:<br>  enabled: true  <span class="hljs-comment"># æ²¡æœ‰å­˜å‚¨å·æƒ…å†µä¸‹ï¼Œæ”¹ä¸ºfalse</span><br>  storageClass: nfs<span class="hljs-literal">-client</span><br></code></pre></td></tr></table></figure><p>2, ä½¿ç”¨<code>-f mysql-config.yml</code>å®‰è£…åº”ç”¨å¹¶è¦†ç›–å‚æ•°</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm install mysql -f mysql-config.yml stable/mysql</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs powershell">è¾“å‡ºå†…å®¹ï¼š<br><br>NAME: mysql<br>LAST DEPLOYED: Fri Jul <span class="hljs-number">29</span> <span class="hljs-number">14</span>:<span class="hljs-number">07</span>:<span class="hljs-number">17</span> <span class="hljs-number">2022</span><br>NAMESPACE: default<br>STATUS: deployed<br>REVISION: <span class="hljs-number">1</span><br>NOTES:<br>MySQL can be accessed via port <span class="hljs-number">3306</span> on the following DNS name from within your cluster:<br>mysql.default.svc.cluster.local<br><br>To get your root password run:<br><br>    MYSQL_ROOT_PASSWORD=<span class="hljs-variable">$</span>(kubectl get secret <span class="hljs-literal">--namespace</span> default mysql <span class="hljs-literal">-o</span> jsonpath=<span class="hljs-string">&quot;&#123;.data.mysql-root-password&#125;&quot;</span> | base64 <span class="hljs-literal">--decode</span>; <span class="hljs-built_in">echo</span>)<br><br>To connect to your database:<br><br><span class="hljs-number">1</span>. Run an Ubuntu pod that you can use as a client:<br><br>    kubectl run <span class="hljs-literal">-i</span> <span class="hljs-literal">--tty</span> ubuntu <span class="hljs-literal">--image</span>=ubuntu:<span class="hljs-number">16.04</span> <span class="hljs-literal">--restart</span>=Never <span class="hljs-literal">--</span> bash <span class="hljs-literal">-il</span><br><br><span class="hljs-number">2</span>. Install the mysql client:<br><br>    <span class="hljs-variable">$</span> apt<span class="hljs-literal">-get</span> update &amp;&amp; apt<span class="hljs-literal">-get</span> install mysql<span class="hljs-literal">-client</span> <span class="hljs-literal">-y</span><br><br><span class="hljs-number">3</span>. Connect <span class="hljs-keyword">using</span> the mysql cli, then provide your password:<br>    <span class="hljs-variable">$</span> mysql <span class="hljs-literal">-h</span> mysql <span class="hljs-literal">-p</span><br><br>To connect to your database directly from outside the K8s cluster:<br>    MYSQL_HOST=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>    MYSQL_PORT=<span class="hljs-number">3306</span><br><br>    <span class="hljs-comment"># Execute the following command to route the connection:</span><br>    kubectl port<span class="hljs-literal">-forward</span> svc/mysql <span class="hljs-number">3306</span><br><br>    mysql <span class="hljs-literal">-h</span> <span class="hljs-variable">$</span>&#123;MYSQL_HOST&#125; <span class="hljs-literal">-P</span><span class="hljs-variable">$</span>&#123;MYSQL_PORT&#125; <span class="hljs-literal">-u</span> root <span class="hljs-literal">-p</span><span class="hljs-variable">$</span>&#123;MYSQL_ROOT_PASSWORD&#125;<br></code></pre></td></tr></table></figure><p>3, æŸ¥çœ‹è¦†ç›–çš„å‚æ•°</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># è¿™æ˜¯æŸ¥çœ‹é™¤äº†é»˜è®¤çš„é…ç½®ä¹‹å¤–è‡ªå·±é…ç½®çš„ï¼Œä½†æ˜¯éƒ¨ç½²mysqlçš„æ—¶å€™æ˜¯--setæŒ‡å®šçš„ï¼Œå¦‚æœæ˜¯ç›´æ¥éƒ¨ç½²ï¼Œæ²¡æœ‰ä»»ä½•çš„æŒ‡å®šï¼Œè·å–valuesçš„å€¼ä¸ºç©º</span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">master</span> ~]<span class="hljs-comment"># helm get values mysql</span><br>USER<span class="hljs-literal">-SUPPLIED</span> VALUES:<br>mysqlDatabase: helm<br>persistence:<br>  enabled: true<br>  storageClass: nfs<span class="hljs-literal">-client</span><br></code></pre></td></tr></table></figure><p>4, æŸ¥çœ‹éƒ¨ç½²çš„ç›¸å…³èµ„æº</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># kubectl get all -l release=mysql</span><br>NAME                         READY   STATUS    RESTARTS   AGE<br>pod/mysql<span class="hljs-literal">-855976764d-npvgm</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">40</span>m<br><br>NAME            <span class="hljs-built_in">TYPE</span>        CLUSTER<span class="hljs-literal">-IP</span>   EXTERNAL<span class="hljs-literal">-IP</span>   PORT(S)    AGE<br>service/mysql   ClusterIP   <span class="hljs-number">10.96</span>.<span class="hljs-number">0.84</span>   &lt;none&gt;        <span class="hljs-number">3306</span>/TCP   <span class="hljs-number">40</span>m<br><br>NAME                    READY   UP<span class="hljs-literal">-TO-DATE</span>   AVAILABLE   AGE<br>deployment.apps/mysql   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     <span class="hljs-number">1</span>            <span class="hljs-number">1</span>           <span class="hljs-number">40</span>m<br><br>NAME                               DESIRED   CURRENT   READY   AGE<br>replicaset.apps/mysql<span class="hljs-literal">-855976764d</span>   <span class="hljs-number">1</span>         <span class="hljs-number">1</span>         <span class="hljs-number">1</span>       <span class="hljs-number">40</span>m<br></code></pre></td></tr></table></figure><p>5, æŸ¥çœ‹podçš„IP</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># kubectl get pods -o wide -l release=mysql</span><br>NAME                     READY   STATUS    RESTARTS   AGE   IP              NODE           NOMINATED NODE   READINESS GATES<br>mysql<span class="hljs-literal">-855976764d-npvgm</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">41</span>m   <span class="hljs-number">100.119</span>.<span class="hljs-number">84.71</span>   k8s<span class="hljs-literal">-worker01</span>   &lt;none&gt;           &lt;none&gt;<br><br>å¾—åˆ°podçš„IPä¸º<span class="hljs-number">100.119</span>.<span class="hljs-number">84.71</span><br></code></pre></td></tr></table></figure><p>6, å®‰è£…mysqlå®¢æˆ·ç«¯å¹¶è¿æ¥æµ‹è¯•</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># yum install mariadb -y</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># è·å–helméƒ¨ç½²çš„mysqlçš„rootå¯†ç </span><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get secret --namespace default mysql -o jsonpath=&quot;&#123;.data.mysql-root-password&#125;&quot; | base64 --decode; echo</span><br>wL2SD0RCsT<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get svc</span><br>NAME         <span class="hljs-built_in">TYPE</span>        CLUSTER<span class="hljs-literal">-IP</span>   EXTERNAL<span class="hljs-literal">-IP</span>   PORT(S)    AGE<br>kubernetes   ClusterIP   <span class="hljs-number">10.96</span>.<span class="hljs-number">0.1</span>    &lt;none&gt;        <span class="hljs-number">443</span>/TCP    <span class="hljs-number">27</span><span class="hljs-built_in">h</span><br>mysql        ClusterIP   <span class="hljs-number">10.96</span>.<span class="hljs-number">0.84</span>   &lt;none&gt;        <span class="hljs-number">3306</span>/TCP   <span class="hljs-number">5</span>m21s<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># mysql -h 10.96.0.84 -uroot -pwL2SD0RCsT -e &quot;show databases;&quot;</span><br>+<span class="hljs-literal">--------------------</span>+<br>| Database           |<br>+<span class="hljs-literal">--------------------</span>+<br>| information_schema |<br>| helm               |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+<span class="hljs-literal">--------------------</span>+<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># kubectl get pods -o wide -l release=mysql</span><br>NAME                     READY   STATUS    RESTARTS   AGE   IP              NODE           NOMINATED NODE   READINESS GATES<br>mysql<span class="hljs-literal">-855976764d-npvgm</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">41</span>m   <span class="hljs-number">100.119</span>.<span class="hljs-number">84.71</span>   k8s<span class="hljs-literal">-worker01</span>   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># mysql -h 100.119.84.71 -uroot -pwL2SD0RCsT -e &quot;show databases;&quot;</span><br>+<span class="hljs-literal">--------------------</span>+<br>| Database           |<br>+<span class="hljs-literal">--------------------</span>+<br>| information_schema |<br>| helm               |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+<span class="hljs-literal">--------------------</span>+<br></code></pre></td></tr></table></figure><h6 id="5-7-å‡çº§å’Œå›æ»š"><a href="#5-7-å‡çº§å’Œå›æ»š" class="headerlink" title="5.7 å‡çº§å’Œå›æ»š"></a>5.7 å‡çº§å’Œå›æ»š</h6><p>å½“æ–°ç‰ˆæœ¬çš„ chart åŒ…å‘å¸ƒçš„æ—¶å€™ï¼Œæˆ–è€…å½“ä½ è¦æ›´æ”¹ release çš„é…ç½®çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>helm upgrade</code> å‘½ä»¤æ¥æ“ä½œã€‚å‡çº§éœ€è¦ä¸€ä¸ªç°æœ‰çš„ releaseï¼Œå¹¶æ ¹æ®æä¾›çš„ä¿¡æ¯å¯¹å…¶è¿›è¡Œå‡çº§ã€‚å› ä¸º Kubernetes charts å¯èƒ½å¾ˆå¤§è€Œä¸”å¾ˆå¤æ‚ï¼ŒHelm ä¼šå°è¯•ä»¥æœ€å°çš„ä¾µå…¥æ€§è¿›è¡Œå‡çº§ï¼Œå®ƒåªä¼šæ›´æ–°è‡ªä¸Šä¸€ç‰ˆæœ¬ä»¥æ¥å‘ç”Ÿçš„å˜åŒ–ï¼š</p><p>1, å‡çº§å‰æŸ¥çœ‹ç‰ˆæœ¬</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># mysql -h 10.96.0.84 -uroot -pwL2SD0RCsT -e &quot;select version()&quot;</span><br>+<span class="hljs-literal">-----------</span>+<br>| version() |<br>+<span class="hljs-literal">-----------</span>+<br>| <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>    |     ç‰ˆæœ¬ä¸º<span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br>+<span class="hljs-literal">-----------</span>+<br><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment">#  kubectl get deployment mysql -o wide</span><br>NAME    READY   UP<span class="hljs-literal">-TO-DATE</span>   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR<br>mysql   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     <span class="hljs-number">1</span>            <span class="hljs-number">1</span>           <span class="hljs-number">54</span>m   mysql        mysql:<span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>   app=mysql,release=mysql<br>imagesç‰ˆæœ¬ä¸º<span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><p>2ï¼Œä¿®æ”¹é…ç½®å¹¶å‡çº§</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># vim mysql-config.yml</span><br>mysqlDatabase: kubemsb<br>persistence:<br>  enabled: true<br>  storageClass: nfs<span class="hljs-literal">-client</span><br></code></pre></td></tr></table></figure><p>å‡çº§å¹¶ä¸”åŠ ä¸€ä¸ª<code>--set imageTag=5.7.31</code>å‚æ•°è®¾ç½®ä¸º5.7.31ç‰ˆæœ¬</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> ~]<span class="hljs-comment"># helm upgrade mysql -f mysql-config.yml --set imageTag=5.7.31 stable/mysql</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs powershell">å‡çº§è¿‡ç¨‹ä¸­çš„è¾“å‡ºï¼š<br><br>WARNING: This chart is deprecated<br>Release <span class="hljs-string">&quot;mysql&quot;</span> has been upgraded. Happy Helming!<br>NAME: mysql<br>LAST DEPLOYED: Fri Jul <span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">04</span>:<span class="hljs-number">20</span> <span class="hljs-number">2022</span><br>NAMESPACE: default<br>STATUS: deployed<br>REVISION: <span class="hljs-number">2</span><br>NOTES:<br>MySQL can be accessed via port <span class="hljs-number">3306</span> on the following DNS name from within your cluster:<br>mysql.default.svc.cluster.local<br><br>To get your root password run:<br><br>    MYSQL_ROOT_PASSWORD=<span class="hljs-variable">$</span>(kubectl get secret <span class="hljs-literal">--namespace</span> default mysql <span class="hljs-literal">-o</span> jsonpath=<span class="hljs-string">&quot;&#123;.data.mysql-root-password&#125;&quot;</span> | base64 <span class="hljs-literal">--decode</span>; <span class="hljs-built_in">echo</span>)<br><br>To connect to your database:<br><br><span class="hljs-number">1</span>. Run an Ubuntu pod that you can use as a client:<br><br>    kubectl run <span class="hljs-literal">-i</span> <span class="hljs-literal">--tty</span> ubuntu <span class="hljs-literal">--image</span>=ubuntu:<span class="hljs-number">16.04</span> <span class="hljs-literal">--restart</span>=Never <span class="hljs-literal">--</span> bash <span class="hljs-literal">-il</span><br><br><span class="hljs-number">2</span>. Install the mysql client:<br><br>    <span class="hljs-variable">$</span> apt<span class="hljs-literal">-get</span> update &amp;&amp; apt<span class="hljs-literal">-get</span> install mysql<span class="hljs-literal">-client</span> <span class="hljs-literal">-y</span><br><br><span class="hljs-number">3</span>. Connect <span class="hljs-keyword">using</span> the mysql cli, then provide your password:<br>    <span class="hljs-variable">$</span> mysql <span class="hljs-literal">-h</span> mysql <span class="hljs-literal">-p</span><br><br>To connect to your database directly from outside the K8s cluster:<br>    MYSQL_HOST=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>    MYSQL_PORT=<span class="hljs-number">3306</span><br><br>    <span class="hljs-comment"># Execute the following command to route the connection:</span><br>    kubectl port<span class="hljs-literal">-forward</span> svc/mysql <span class="hljs-number">3306</span><br><br>    mysql <span class="hljs-literal">-h</span> <span class="hljs-variable">$</span>&#123;MYSQL_HOST&#125; <span class="hljs-literal">-P</span><span class="hljs-variable">$</span>&#123;MYSQL_PORT&#125; <span class="hljs-literal">-u</span> root <span class="hljs-literal">-p</span><span class="hljs-variable">$</span>&#123;MYSQL_ROOT_PASSWORD&#125;<br>    <br> æ³¨æ„ï¼šæ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå¯†ç ä¼šè¢«æ›´æ–°ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­ï¼Œå¯†ç å¹¶æœªæ›´æ–°ã€‚<br></code></pre></td></tr></table></figure><p>3, å‡çº§åç¡®è®¤ç‰ˆæœ¬</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># kubectl get deployment mysql -o wide</span><br>NAME    READY   UP<span class="hljs-literal">-TO-DATE</span>   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR<br>mysql   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     <span class="hljs-number">1</span>            <span class="hljs-number">1</span>           <span class="hljs-number">58</span>m   mysql        mysql:<span class="hljs-number">5.7</span>.<span class="hljs-number">31</span>   app=mysql,release=mysql<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># kubectl get pods -o wide</span><br>NAME                                     READY   STATUS    RESTARTS       AGE     IP              NODE           NOMINATED NODE   READINESS GATES<br>mysql<span class="hljs-literal">-6f57f64c9d-sc72v</span>                   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>              <span class="hljs-number">2</span>m20s   <span class="hljs-number">100.119</span>.<span class="hljs-number">84.72</span>   k8s<span class="hljs-literal">-worker01</span>   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># mysql -h 100.119.84.72 -uroot -pwL2SD0RCsT -e &quot;select version()&quot;</span><br>+<span class="hljs-literal">-----------</span>+<br>| version() |<br>+<span class="hljs-literal">-----------</span>+<br>| <span class="hljs-number">5.7</span>.<span class="hljs-number">31</span>    |   ç‰ˆæœ¬å‡çº§ä¸º<span class="hljs-number">5.7</span>.<span class="hljs-number">31</span><br>+<span class="hljs-literal">-----------</span>+<br></code></pre></td></tr></table></figure><p>4, å›æ»š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># helm history mysql</span><br>REVISION        UPDATED                         STATUS          CHART           APP VERSION     DESCRIPTION<br><span class="hljs-number">1</span>               Fri Jul <span class="hljs-number">29</span> <span class="hljs-number">14</span>:<span class="hljs-number">07</span>:<span class="hljs-number">17</span> <span class="hljs-number">2022</span>        superseded      mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>          Install complete<br><span class="hljs-number">2</span>               Fri Jul <span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">04</span>:<span class="hljs-number">20</span> <span class="hljs-number">2022</span>        deployed        mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>          Upgrade complete<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># helm rollback mysql 1</span><br>Rollback was a success! Happy Helming!<br></code></pre></td></tr></table></figure><p>5, éªŒè¯</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># kubectl get deployment mysql -o wide</span><br>NAME    READY   UP<span class="hljs-literal">-TO-DATE</span>   AVAILABLE   AGE   CONTAINERS   IMAGES         SELECTOR<br>mysql   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     <span class="hljs-number">1</span>            <span class="hljs-number">1</span>           <span class="hljs-number">65</span>m   mysql        mysql:<span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>   app=mysql,release=mysql<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># helm history mysql</span><br>REVISION        UPDATED                         STATUS          CHART           APP VERSION     DESCRIPTION<br><span class="hljs-number">1</span>               Fri Jul <span class="hljs-number">29</span> <span class="hljs-number">14</span>:<span class="hljs-number">07</span>:<span class="hljs-number">17</span> <span class="hljs-number">2022</span>        superseded      mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>          Install complete<br><span class="hljs-number">2</span>               Fri Jul <span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">04</span>:<span class="hljs-number">20</span> <span class="hljs-number">2022</span>        superseded      mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>          Upgrade complete<br><span class="hljs-number">3</span>               Fri Jul <span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">24</span> <span class="hljs-number">2022</span>        deployed        mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>     <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span>          Rollback to <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h6 id="5-8-æ›´å¤šå®‰è£…æ–¹å¼"><a href="#5-8-æ›´å¤šå®‰è£…æ–¹å¼" class="headerlink" title="5.8 æ›´å¤šå®‰è£…æ–¹å¼"></a>5.8 æ›´å¤šå®‰è£…æ–¹å¼</h6><p>å’Œyumå‘½ä»¤ç±»ä¼¼</p><ul><li>chart ä»“åº“</li><li>æœ¬åœ° chart å‹ç¼©åŒ…</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">persistence.storageClass<br><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># helm pull stable/mysql</span><br><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># ls mysql-1.6.9.tgz</span><br>mysql<span class="hljs-literal">-1</span>.<span class="hljs-number">6.9</span>.tgz<br><br>[<span class="hljs-type">root</span>@<span class="hljs-type">k8s</span>-<span class="hljs-type">master01</span> <span class="hljs-type">helmdir</span>]<span class="hljs-comment"># helm install mysql2 mysql-1.6.9.tgz</span><br></code></pre></td></tr></table></figure><ul><li>åœ¨çº¿çš„ URLï¼ˆhelm install fool <a href="https://example.com/charts/foo-1.2.3.tgz%EF%BC%89">https://example.com/charts/foo-1.2.3.tgzï¼‰</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes-helm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>containerdé…ç½®æ–‡ä»¶å¤‡ä»½</title>
    <link href="/2025/03/19/containerd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD/"/>
    <url>/2025/03/19/containerd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD/</url>
    
    <content type="html"><![CDATA[<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># vim /etc/containerd/config.toml</span><br><br><span class="hljs-comment"># cat /etc/containerd/config.toml</span><br>root = <span class="hljs-string">&quot;/var/lib/containerd&quot;</span><br>state = <span class="hljs-string">&quot;/run/containerd&quot;</span><br>oom_score = <span class="hljs-literal">-999</span><br><br>[<span class="hljs-type">grpc</span>]<br>  address = <span class="hljs-string">&quot;/run/containerd/containerd.sock&quot;</span><br>  uid = <span class="hljs-number">0</span><br>  gid = <span class="hljs-number">0</span><br>  max_recv_message_size = <span class="hljs-number">16777216</span><br>  max_send_message_size = <span class="hljs-number">16777216</span><br><br>[<span class="hljs-type">debug</span>]<br>  address = <span class="hljs-string">&quot;&quot;</span><br>  uid = <span class="hljs-number">0</span><br>  gid = <span class="hljs-number">0</span><br>  level = <span class="hljs-string">&quot;&quot;</span><br><br>[<span class="hljs-type">metrics</span>]<br>  address = <span class="hljs-string">&quot;&quot;</span><br>  grpc_histogram = false<br><br>[<span class="hljs-type">cgroup</span>]<br>  path = <span class="hljs-string">&quot;&quot;</span><br><br>[<span class="hljs-type">plugins</span>]<br>  [<span class="hljs-type">plugins.cgroups</span>]<br>    no_prometheus = false<br>  [<span class="hljs-type">plugins.cri</span>]<br>    stream_server_address = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    stream_server_port = <span class="hljs-string">&quot;0&quot;</span><br>    enable_selinux = false<br>    <span class="hljs-comment"># sandbox_image = &quot;easzlab/pause-amd64:3.2&quot;</span><br>    sandbox_image = <span class="hljs-string">&quot;registry.aliyuncs.com/google_containers/pause:3.6&quot;</span><br>    stats_collect_period = <span class="hljs-number">10</span><br>    systemd_cgroup = true<br>    enable_tls_streaming = false<br>    max_container_log_line_size = <span class="hljs-number">16384</span><br>    [<span class="hljs-type">plugins.cri.containerd</span>]<br>      snapshotter = <span class="hljs-string">&quot;overlayfs&quot;</span><br>      no_pivot = false<br>      [<span class="hljs-type">plugins.cri.containerd.default_runtime</span>]<br>        runtime_type = <span class="hljs-string">&quot;io.containerd.runtime.v1.linux&quot;</span><br>        runtime_engine = <span class="hljs-string">&quot;&quot;</span><br>        runtime_root = <span class="hljs-string">&quot;&quot;</span><br>      [<span class="hljs-type">plugins.cri.containerd.untrusted_workload_runtime</span>]<br>        runtime_type = <span class="hljs-string">&quot;&quot;</span><br>        runtime_engine = <span class="hljs-string">&quot;&quot;</span><br>        runtime_root = <span class="hljs-string">&quot;&quot;</span><br>    [<span class="hljs-type">plugins.cri.cni</span>]<br>      bin_dir = <span class="hljs-string">&quot;/opt/kube/bin&quot;</span><br>      conf_dir = <span class="hljs-string">&quot;/etc/cni/net.d&quot;</span><br>      conf_template = <span class="hljs-string">&quot;/etc/cni/net.d/10-default.conf&quot;</span><br>    [<span class="hljs-type">plugins.cri.registry</span>]<br>      [<span class="hljs-type">plugins.cri.registry.mirrors</span>]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;docker.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,<br>            <span class="hljs-string">&quot;http://hub-mirror.c.163.com&quot;</span><br>          ]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;gcr.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://gcr.mirrors.ustc.edu.cn&quot;</span><br>          ]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;k8s.gcr.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://gcr.mirrors.ustc.edu.cn/google-containers/&quot;</span><br>          ]<br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;quay.io&quot;</span>]<br>          endpoint = [<br>            <span class="hljs-string">&quot;https://quay.mirrors.ustc.edu.cn&quot;</span><br>          ]<br><span class="hljs-comment"># Harboråšä¸ºæœ¬åœ°å®¹å™¨é•œåƒä»“åº“ã€‚</span><br>        [<span class="hljs-type">plugins.cri.registry.mirrors.</span><span class="hljs-string">&quot;harbor.localcluster.com&quot;</span>] <br>          endpoint = [<br>            <span class="hljs-string">&quot;http://harbor.localcluster.com&quot;</span><br>          ]<br>    [<span class="hljs-type">plugins.cri.x509_key_pair_streaming</span>]<br>      tls_cert_file = <span class="hljs-string">&quot;&quot;</span><br>      tls_key_file = <span class="hljs-string">&quot;&quot;</span><br>  [<span class="hljs-type">plugins.diff</span>-<span class="hljs-type">service</span>]<br>    default = [<span class="hljs-string">&quot;walking&quot;</span>]<br>  [<span class="hljs-type">plugins.linux</span>]<br>    shim = <span class="hljs-string">&quot;containerd-shim&quot;</span><br>    runtime = <span class="hljs-string">&quot;runc&quot;</span><br>    runtime_root = <span class="hljs-string">&quot;&quot;</span><br>    no_shim = false<br>    shim_debug = false<br>  [<span class="hljs-type">plugins.opt</span>]<br>    path = <span class="hljs-string">&quot;/opt/containerd&quot;</span><br>  [<span class="hljs-type">plugins.restart</span>]<br>    interval = <span class="hljs-string">&quot;10s&quot;</span><br>  [<span class="hljs-type">plugins.scheduler</span>]<br>    pause_threshold = <span class="hljs-number">0.02</span><br>    deletion_threshold = <span class="hljs-number">0</span><br>    mutation_threshold = <span class="hljs-number">100</span><br>    schedule_delay = <span class="hljs-string">&quot;0s&quot;</span><br>    startup_delay = <span class="hljs-string">&quot;100ms&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>containerd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Etcdæ¦‚å¿µåŠå®‰è£…</title>
    <link href="/2025/03/19/Etcd%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/"/>
    <url>/2025/03/19/Etcd%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h1 id="1-etcdæ¦‚å¿µ"><a href="#1-etcdæ¦‚å¿µ" class="headerlink" title="1. etcdæ¦‚å¿µ"></a>1. etcdæ¦‚å¿µ</h1><h2 id="1-1-etcdä»‹ç»"><a href="#1-1-etcdä»‹ç»" class="headerlink" title="1.1. etcdä»‹ç»"></a>1.1. etcdä»‹ç»</h2><p>etcdçš„åå­—æ¥æºäº<code>/etc</code>å’Œ<code>distibuted</code>ï¼Œå³Unixä¸‹é…ç½®æ–‡ä»¶ç›®å½•å’Œåˆ†å¸ƒå¼ä¸¤ä¸ªå…³é”®è¯ã€‚Etcdæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¯é çš„k-våˆ†å¸ƒå¼æ•°æ®åº“ï¼ŒåŒæ—¶è¿˜èƒ½æä¾›é…ç½®å…±äº«ã€æœåŠ¡å‘ç°ç­‰åŠŸèƒ½ï¼Œå¸¸å¸¸ç”¨åœ¨goè¯­è¨€çš„é¡¹ç›®ä¸­ã€‚etcdä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ç‰¹ç‚¹ï¼š</p><ul><li>éƒ¨ç½²ç®€å•ï¼šåªæœ‰ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥å¼€ç®±å³ç”¨</li><li>ä½¿ç”¨ç®€å•ï¼šetcdæœ‰ç€ä¸°å¯Œçš„client SDK</li><li>å®‰å…¨æ€§é«˜ï¼šæ”¯æŒSSLè¯ä¹¦è®¤è¯ï¼Œæ•°æ®åŠ å¯†ï¼ŒèŠ‚ç‚¹ä¹‹é—´ç›¸äº’éªŒè¯èº«ä»½</li><li>å¼ºä¸€è‡´æ€§ï¼šé€šè¿‡raftç®—æ³•å®ç°æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œå°‘äºäºŒåˆ†ä¹‹ä¸€èŠ‚ç‚¹å®•æœºä»ç„¶èƒ½æä¾›æœåŠ¡ï¼Œé€šå¸¸éƒ¨ç½²3ä¸ªæˆ–è€…5ä¸ªèŠ‚ç‚¹</li><li>æ•°æ®è½åœ°ï¼šetcdçš„æ•°æ®ä¼šé€šè¿‡walæ ¼å¼çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¹¶ä¸”æ”¯æŒsnapshotå¿«ç…§</li></ul><p>etcdçš„æ¶æ„ä¸»è¦ç”±ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>HTTP Serverï¼šè¯·æ±‚çš„å…¥å£ï¼Œç”¨æ¥å¤„ç†å„ç§APIè¯·æ±‚</li><li>Storeï¼šç”¨äºå¤„ç†etcdæ”¯æŒçš„å„ç±»åŠŸèƒ½çš„äº‹åŠ¡ï¼ŒåŒ…æ‹¬æ•°æ®ç´¢å¼•ã€èŠ‚ç‚¹çŠ¶æ€å˜æ›´ã€ç›‘æ§ä¸åé¦ˆã€äº‹ä»¶å¤„ç†ä¸æ‰§è¡Œç­‰ç­‰ï¼Œæ˜¯etcdå¯¹ç”¨æˆ·æä¾›çš„å¤§å¤šæ•°APIåŠŸèƒ½çš„å…·ä½“å®ç°</li><li>RaftçŠ¶æ€æœºï¼šå®ç°å¤šèŠ‚ç‚¹çš„etcdé›†ç¾¤ä¸­æ•°æ®ä¸€è‡´æ€§å’ŒèŠ‚ç‚¹é€‰ä¸»</li><li>WALï¼šWrite Ahead Logï¼ˆé¢„å†™å¼æ—¥å¿—ï¼‰ï¼Œæ˜¯etcdçš„æ•°æ®å­˜å‚¨æ–¹å¼ã€‚é™¤äº†åœ¨å†…å­˜ä¸­å­˜æœ‰æ‰€æœ‰æ•°æ®çš„çŠ¶æ€ä»¥åŠèŠ‚ç‚¹çš„ç´¢å¼•ä»¥å¤–ï¼Œetcdå°±é€šè¿‡WALè¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ã€‚WALä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®æäº¤å‰éƒ½ä¼šäº‹å…ˆè®°å½•æ—¥å¿—ã€‚Snapshotæ˜¯ä¸ºäº†é˜²æ­¢æ•°æ®è¿‡å¤šè€Œè¿›è¡Œçš„çŠ¶æ€å¿«ç…§ï¼›Entryè¡¨ç¤ºå­˜å‚¨çš„å…·ä½“æ—¥å¿—å†…å®¹ã€‚</li></ul><h2 id="1-2-Raft"><a href="#1-2-Raft" class="headerlink" title="1.2. Raft"></a>1.2. Raft</h2><p>Raft æ˜¯etcdä¿éšœåˆ†å¸ƒå¼èŠ‚ç‚¹ä¸­æ•°æ®ä¸€è‡´æ€§çš„å…³é”®ï¼Œè¯¥ç®—æ³•æœ¬èº«æœ‰ä¸€å®šçš„å¤æ‚åº¦ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šetcdçš„raftç®—æ³•çš„åšå®¢ï¼Œè¯¦ç»†ä»‹ç»äº†èŠ‚ç‚¹ç›´æ¥å¦‚ä½•é€‰ä¸»ã€å¦‚ä½•åŒæ­¥æ•°æ®ã€å¦‚ä½•è¡¥å¿æ•°æ®çš„ã€‚</p><ul><li><a href="https://www.jianshu.com/p/5aed73b288f7">ETCDèƒŒåçš„Raftä¸€è‡´æ€§ç®—æ³•åŸç†</a></li><li>[åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³• Raft å’Œ Etcd åŸç†è§£æ](<a href="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%9E%E8%B7%B5%E4%B9%8B%E8%B7%AF%EF%BC%88%E5%AE%8C%EF%BC%89/09">http://learn.lianglianglee.com/ä¸“æ /åˆ†å¸ƒå¼ä¸­é—´ä»¶å®è·µä¹‹è·¯ï¼ˆå®Œï¼‰/09</a> åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³• Raft å’Œ Etcd åŸç†è§£æ.md)</li><li><a href="https://www.cnblogs.com/xybaby/p/10124083.html">ä¸€æ–‡ææ‡‚Raftç®—æ³•</a></li></ul><hr><h1 id="2-etcdéƒ¨ç½²"><a href="#2-etcdéƒ¨ç½²" class="headerlink" title="2. etcdéƒ¨ç½²"></a>2. etcdéƒ¨ç½²</h1><h2 id="2-1-å‡†å¤‡å·¥ä½œ"><a href="#2-1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="2.1. å‡†å¤‡å·¥ä½œ"></a>2.1. å‡†å¤‡å·¥ä½œ</h2><h3 id="2-1-1-ç¡¬ä»¶éœ€æ±‚"><a href="#2-1-1-ç¡¬ä»¶éœ€æ±‚" class="headerlink" title="2.1.1. ç¡¬ä»¶éœ€æ±‚"></a>2.1.1. ç¡¬ä»¶éœ€æ±‚</h3><p>è¿™é‡Œç®€å•ä»‹ç»ä¸‹ectdå¯¹ç¡¬ä»¶çš„è¦æ±‚ï¼Œè¯¦æƒ…éœ€è¦å‚è€ƒ<a href="https://etcd.io/docs/v3.5/op-guide/hardware/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><ol><li>CPU</li></ol><p>etcdå¯¹CPUçš„æ¶ˆè€—ä¸æ˜¯å¾ˆå¤§ï¼Œé€šå¸¸éœ€è¦2-4ä¸ªæ ¸å¿ƒå³å¯ã€‚åœ¨é«˜è´Ÿè½½é›†ç¾¤ä¸‹ï¼Œå¦‚åŒæ—¶ç»™ä¸Šåƒä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œæˆ–è€…æ¯ç§’æœ‰ä¸Šä¸‡ä¸ªè¯·æ±‚çš„åœºæ™¯ï¼Œéœ€è¦8-16æ ¸å¿ƒã€‚ä¸€èˆ¬è§„æ¨¡ï¼Œå¯ä»¥å…ˆä½¿ç”¨2-4æ ¸å¿ƒçš„CPUï¼Œåç»­å¦‚æœCPUä½¿ç”¨ç‡è¾ƒé«˜ï¼Œå¯ä»¥é€ä¸ªèŠ‚ç‚¹å‡çº§é…ç½®ã€‚</p><ol><li>Memory</li></ol><p>etcdå¯¹å†…å­˜çš„éœ€æ±‚ä¸æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯ä¹Ÿä¼šç§¯æçš„ç¼“å­˜k-væ•°æ®åˆ°å†…å­˜ï¼Œå¹¶ç”¨å‰©ä½™çš„å†…å­˜è·Ÿè¸ªwatcherã€‚ä¸€èˆ¬è€Œè¨€ï¼Œ8Gå†…å­˜ä¹Ÿè¶³å¤Ÿäº†ã€‚</p><ol><li>Disk</li></ol><p>ç£ç›˜çš„å†™å…¥é€Ÿåº¦æ˜¯å½±å“etcdæ€§èƒ½çš„å…³é”®ï¼Œetcdçš„raftå…±è¯†åè®®ä¾èµ–äºå°†å…ƒæ•°æ®å†™å…¥åˆ°æ—¥å¿—ä¸­ï¼Œæ¯ä¸ªetcdèŠ‚ç‚¹éƒ½è¦å°†æ¯ä¸ªè¯·æ±‚å†™å…¥ç£ç›˜ã€‚å¹¶ä¸”ï¼Œetcdè¿˜éœ€è¦å°†å¢é‡çš„checkpointå†™å…¥ç£ç›˜ï¼Œç”¨æ¥æˆªæ–­æ—¥å¿—ã€‚å¦‚æœå†™å…¥æ—¶é—´è¿‡é•¿ï¼Œå¯èƒ½å› ä¸ºè¶…è¿‡å¿ƒè·³æ—¶é—´é€ æˆé›†ç¾¤é‡æ–°é€‰ä¸¾ï¼Œä»è€Œç ´åé›†ç¾¤çš„ç¨³å®šæ€§ã€‚åœ¨æ£€æŸ¥ç£ç›˜æ€§èƒ½çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ fio è¿›è¡Œæµ‹è¯•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.ibm.com/cloud/blog/using-fio-to-tell-whether-your-storage-is-fast-enough-for-etcd">IBMçš„è¿™ç¯‡æ–‡ç« </a>ã€‚</p><p>ç£ç›˜çš„æ€§èƒ½è¦ä»ä¸¤ä¸ªæ–¹é¢å»è¯„ä¼°ï¼Œç¬¬ä¸€ä¸ªæ˜¯IOPSèƒ½åŠ›ï¼šä¸€èˆ¬è€Œè¨€ï¼Œéœ€è¦50é¡ºåºIOPSçš„é€Ÿåº¦(æ¯”å¦‚7200RPMçš„æœºæ¢°ç›˜)ï¼Œé«˜è´Ÿè½½é›†ç¾¤éœ€è¦500é¡ºåºIOPSé€Ÿåº¦(é€šå¸¸æ˜¯å›ºæ€)ã€‚ç¬¬äºŒä¸ªæ˜¯ç£ç›˜å¸¦å®½ï¼Œè¿™ä¸ªå†³å®šäº†æ–°èŠ‚ç‚¹æˆ–è€…å¤±è´¥èŠ‚ç‚¹åŒæ­¥æ•°æ®çš„æ—¶é—´ï¼Œå…¸å‹çš„10MB&#x2F;sçš„ç£ç›˜é€šå¸¸åœ¨15ç§’å†…èƒ½æ¢å¤100MBæ•°æ®ï¼Œ100MB&#x2F;så¯ä»¥åœ¨15ç§’å†…æ¢å¤1GBçš„æ•°æ®ã€‚</p><p>etcdçš„æ•°æ®ä¼šç›¸äº’åŒæ­¥ï¼Œä¸è¦æ‹…å¿ƒèŠ‚ç‚¹åç›˜é—®é¢˜ï¼Œå› æ­¤æ²¡å¿…è¦åšRAID5è¿™ç§RAID10ï¼Œå¦‚æœéœ€è¦åšRAIDæå‡ç£ç›˜æ€§èƒ½ï¼Œè¯·è€ƒè™‘ä½¿ç”¨RAID0ã€‚</p><ol><li>Network</li></ol><p>etcdé›†ç¾¤éœ€è¦å¿«é€Ÿç½‘ç»œï¼Œå¹¶ä¸”ä¿éšœç½‘ç»œçš„ç¨³å®šæ€§ï¼Œé€šå¸¸1GbEçš„å†…éƒ¨ç½‘ç»œå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯çš„éœ€æ±‚ï¼Œé€šå¸¸å»ºè®®å°†etcdèŠ‚ç‚¹éƒ¨ç½²åˆ°ä¸€ä¸ªç½‘ç»œåŸŸå†…ï¼Œå‡å°‘è·¨ç½‘ç»œçš„å»¶è¿Ÿã€‚</p><p>etcdå®˜æ–¹æ–‡æ¡£è¿˜æä¾›äº†ï¼Œä¸åŒè§„æ¨¡ä¸‹çš„kubernetesçš„å¯¹etcdé›†ç¾¤é…ç½®çš„è¦æ±‚ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›é›†ç¾¤ä¸­etcdæ˜¯å•ç‹¬éƒ¨ç½²çš„ï¼Œå¹¶ä¸æ˜¯å’ŒmasterèŠ‚ç‚¹å…±ç”¨ã€‚</p><ol><li>å°é›†ç¾¤</li></ol><p>è¯·æ±‚å®¢æˆ·ç«¯å°‘äº100ä¸ªï¼Œæ¯ç§’è¯·æ±‚å°‘äº200ä¸ªï¼Œå¹¶ä¸”å­˜å‚¨æ•°æ®å°‘äº100MBã€‚å¦‚50ä¸ªnodeçš„kuberentesé›†ç¾¤ï¼š</p><table><thead><tr><th>Provider</th><th>Type</th><th>vCPUs</th><th>Memory (GB)</th><th>Max concurrent IOPS</th><th>Disk bandwidth (MB&#x2F;s)</th></tr></thead><tbody><tr><td>AWS</td><td>m4.large</td><td>2</td><td>8</td><td>3600</td><td>56.25</td></tr><tr><td>GCE</td><td>n1-standard-2 + 50GB PD SSD</td><td>2</td><td>7.5</td><td>1500</td><td>25</td></tr></tbody></table><ol><li>ä¸­ç­‰è§„æ¨¡é›†ç¾¤</li></ol><p>è¯·æ±‚å®¢æˆ·ç«¯å°‘äº500ä¸ªï¼Œæ¯ç§’è¯·æ±‚å°‘äº1000ä¸ªï¼Œå¹¶ä¸”å­˜å‚¨æ•°æ®å°‘äº500MBã€‚å¦‚250ä¸ªnodeçš„kuberentesé›†ç¾¤ï¼š</p><table><thead><tr><th>Provider</th><th>Type</th><th>vCPUs</th><th>Memory (GB)</th><th>Max concurrent IOPS</th><th>Disk bandwidth (MB&#x2F;s)</th></tr></thead><tbody><tr><td>AWS</td><td>m4.xlarge</td><td>4</td><td>16</td><td>6000</td><td>93.75</td></tr><tr><td>GCE</td><td>n1-standard-4 + 150GB PD SSD</td><td>4</td><td>15</td><td>4500</td><td>75</td></tr></tbody></table><ol><li>å¤§è§„æ¨¡é›†ç¾¤</li></ol><p>è¯·æ±‚å®¢æˆ·ç«¯å°‘äº1500ä¸ªï¼Œæ¯ç§’è¯·æ±‚å°‘äº10000ä¸ªï¼Œå¹¶ä¸”å­˜å‚¨æ•°æ®å°‘äº1000MBã€‚å¦‚1000ä¸ªnodeçš„kuberentesé›†ç¾¤</p><table><thead><tr><th>Provider</th><th>Type</th><th>vCPUs</th><th>Memory (GB)</th><th>Max concurrent IOPS</th><th>Disk bandwidth (MB&#x2F;s)</th></tr></thead><tbody><tr><td>AWS</td><td>m4.2xlarge</td><td>8</td><td>32</td><td>8000</td><td>125</td></tr><tr><td>GCE</td><td>n1-standard-8 + 250GB PD SSD</td><td>8</td><td>30</td><td>7500</td><td>125</td></tr></tbody></table><ol><li>è¶…å¤§è§„æ¨¡é›†ç¾¤</li></ol><p>è¯·æ±‚å®¢æˆ·ç«¯è¶…è¿‡1500ä¸ªï¼Œæ¯ç§’è¯·æ±‚è¶…è¿‡10000ä¸ªï¼Œå¹¶ä¸”å­˜å‚¨æ•°æ®å¤§äº1000MBã€‚å¦‚3000ä¸ªnodeçš„kuberentesé›†ç¾¤</p><table><thead><tr><th>Provider</th><th>Type</th><th>vCPUs</th><th>Memory (GB)</th><th>Max concurrent IOPS</th><th>Disk bandwidth (MB&#x2F;s)</th></tr></thead><tbody><tr><td>AWS</td><td>m4.4xlarge</td><td>16</td><td>64</td><td>16,000</td><td>250</td></tr><tr><td>GCE</td><td>n1-standard-16 + 500GB PD SSD</td><td>16</td><td>60</td><td>15,000</td><td>250</td></tr></tbody></table><h3 id="2-1-2-æœºå™¨è§„åˆ’"><a href="#2-1-2-æœºå™¨è§„åˆ’" class="headerlink" title="2.1.2. æœºå™¨è§„åˆ’"></a>2.1.2. æœºå™¨è§„åˆ’</h3><p>è§„åˆ’å°è§„æ¨¡æµ‹è¯•é›†ç¾¤ï¼Œé›†ç¾¤ä¸­èŠ‚å‡å…³é—­swapåˆ†åŒºï¼Œå®‰è£…chronydæ—¶é—´åŒæ­¥æœåŠ¡ã€‚</p><p>ç£ç›˜å†™å…¥æ€§èƒ½ç”± fio æµ‹è¯•å¾—å‡ºï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.ibm.com/cloud/blog/using-fio-to-tell-whether-your-storage-is-fast-enough-for-etcd">IBMçš„è¿™ç¯‡æ–‡ç« </a>ã€‚</p><table><thead><tr><th>èŠ‚ç‚¹</th><th>IP</th><th>ç³»ç»Ÿ</th><th>CPU&#x2F;Memory</th><th>Disk</th><th>write IOPS avg</th><th>write bandwidth avg(MB&#x2F;s)</th></tr></thead><tbody><tr><td>etcd-1</td><td>10.4.7.121</td><td>ubuntu 18.04.5</td><td>2C 4G</td><td>20G SSD</td><td>min&#x3D; 2706, max&#x3D; 2758, avg&#x3D;2727.14</td><td>min&#x3D; 6077, max&#x3D; 6194,avg&#x3D;6124.86</td></tr><tr><td>etcd-2</td><td>10.4.7.122</td><td>ubuntu 18.04.5</td><td>2C 4G</td><td>20G SSD</td><td></td><td></td></tr><tr><td>etcd-3</td><td>10.4.7.123</td><td>ubuntu 18.04.5</td><td>2C 4G</td><td>20G SSD</td><td></td><td></td></tr></tbody></table><h2 id="2-2-etcdé›†ç¾¤éƒ¨ç½²"><a href="#2-2-etcdé›†ç¾¤éƒ¨ç½²" class="headerlink" title="2.2. etcdé›†ç¾¤éƒ¨ç½²"></a>2.2. etcdé›†ç¾¤éƒ¨ç½²</h2><p>ectd ç‰ˆæœ¬ä¸‹è½½é¡µé¢ï¼š<a href="https://github.com/etcd-io/etcd/releases%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BB%A5">https://github.com/etcd-io/etcd/releasesï¼Œè¿™é‡Œä»¥</a> 3.5.1 ç‰ˆæœ¬ä¸ºä¾‹ï¼Œè¿›è¡Œå®‰è£…å’Œå­¦ä¹ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# wget https://github.com/etcd-io/etcd/releases/download/v3.5.1/etcd-v3.5.1-linux-amd64.tar.gz<br>[root@duduniao etcd]# tar -xf etcd-v3.5.1-linux-amd64.tar.gz<br>[root@duduniao etcd]# ls etcd-v3.5.1-linux-amd64/etcd* -l<br>-rwxr-xr-x 1 114762 114762 23568384 Oct 15 22:22 etcd-v3.5.1-linux-amd64/etcd<br>-rwxr-xr-x 1 114762 114762 17981440 Oct 15 22:22 etcd-v3.5.1-linux-amd64/etcdctl<br>-rwxr-xr-x 1 114762 114762 16056320 Oct 15 22:22 etcd-v3.5.1-linux-amd64/etcdutl<br><br># ä¸‹å‘etcdè½¯ä»¶åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Š<br>[root@duduniao etcd]# scan_host.sh push -h 10.4.7.121 10.4.7.122 10.4.7.123 etcd-v3.5.1-linux-amd64/etcd* /usr/local/bin/<br>10.4.7.123        etcd-v3.5.1-linux-amd64/etcd etcd-v3.5.1-linux-amd64/etcdctl etcd-v3.5.1-linux-amd64/etcdutl --&gt; /usr/local/bin/ Y<br>10.4.7.121        etcd-v3.5.1-linux-amd64/etcd etcd-v3.5.1-linux-amd64/etcdctl etcd-v3.5.1-linux-amd64/etcdutl --&gt; /usr/local/bin/ Y<br>10.4.7.122        etcd-v3.5.1-linux-amd64/etcd etcd-v3.5.1-linux-amd64/etcdctl etcd-v3.5.1-linux-amd64/etcdutl --&gt; /usr/local/bin/ Y<br><br># é…ç½®å¯åŠ¨çš„etcd.serviceæ–‡ä»¶<br>[root@duduniao etcd]# scp etcd-1.service 10.4.7.121:/lib/systemd/system/etcd.service<br>[root@duduniao etcd]# scp etcd-2.service 10.4.7.122:/lib/systemd/system/etcd.service<br>[root@duduniao etcd]# scp etcd-3.service 10.4.7.123:/lib/systemd/system/etcd.service<br><br># å¯åŠ¨etcd<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;mkdir /data/etcd ; systemctl daemon-reload&quot;<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;systemctl start etcd &amp;&amp; systemctl enable etcd&quot;<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;systemctl is-enabled etcd &amp;&amp; systemctl is-active etcd&quot;<br><br># æ£€æŸ¥é›†ç¾¤çŠ¶æ€<br>[root@duduniao etcd]# ./etcd-v3.5.1-linux-amd64/etcdctl --endpoints=10.4.7.121:2379 member list --write-out=table<br>+------------------+---------+--------+------------------------+------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS       |      CLIENT ADDRS      | IS LEARNER |<br>+------------------+---------+--------+------------------------+------------------------+------------+<br>| 4c45db44e1021917 | started | etcd-1 | http://10.4.7.121:2380 | http://10.4.7.121:2379 |      false |<br>| 721eef2714f1477a | started | etcd-2 | http://10.4.7.122:2380 | http://10.4.7.122:2379 |      false |<br>| f6d5f5c8eef4f092 | started | etcd-3 | http://10.4.7.123:2380 | http://10.4.7.123:2379 |      false |<br>+------------------+---------+--------+------------------------+------------------------+------------+<br><br># æµ‹è¯•è¯»å†™<br>[root@duduniao etcd]# ./etcd-v3.5.1-linux-amd64/etcdctl --endpoints=10.4.7.121:2379 put k1 test-value-1<br>[root@duduniao etcd]# ./etcd-v3.5.1-linux-amd64/etcdctl --endpoints=10.4.7.123:2379 get k1<br>k1<br>test-value-1<br># etcd-1.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>ExecStart=/usr/local/bin/etcd \<br>  --name etcd-1 \<br>  --initial-advertise-peer-urls http://10.4.7.121:2380 \<br>  --listen-peer-urls http://10.4.7.121:2380 \<br>  --listen-client-urls http://10.4.7.121:2379,http://127.0.0.1:2379 \<br>  --advertise-client-urls http://10.4.7.121:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --initial-cluster etcd-1=http://10.4.7.121:2380,etcd-2=http://10.4.7.122:2380,etcd-3=http://10.4.7.123:2380 \<br>  --initial-cluster-state new \<br>  --data-dir /data/etcd \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br><br># etcd-2.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>ExecStart=/usr/local/bin/etcd \<br>  --name etcd-2 \<br>  --initial-advertise-peer-urls http://10.4.7.122:2380 \<br>  --listen-peer-urls http://10.4.7.122:2380 \<br>  --listen-client-urls http://10.4.7.122:2379,http://127.0.0.1:2379 \<br>  --advertise-client-urls http://10.4.7.122:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --initial-cluster etcd-1=http://10.4.7.121:2380,etcd-2=http://10.4.7.122:2380,etcd-3=http://10.4.7.123:2380 \<br>  --initial-cluster-state new \<br>  --data-dir /data/etcd \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br><br># etcd-3.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>ExecStart=/usr/local/bin/etcd \<br>  --name etcd-3 \<br>  --initial-advertise-peer-urls http://10.4.7.123:2380 \<br>  --listen-peer-urls http://10.4.7.123:2380 \<br>  --listen-client-urls http://10.4.7.123:2379,http://127.0.0.1:2379 \<br>  --advertise-client-urls http://10.4.7.123:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --initial-cluster etcd-1=http://10.4.7.121:2380,etcd-2=http://10.4.7.122:2380,etcd-3=http://10.4.7.123:2380 \<br>  --initial-cluster-state new \<br>  --data-dir /data/etcd \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h2 id="2-3-TLSåŠ å¯†é€šä¿¡çš„etcdé›†ç¾¤éƒ¨ç½²"><a href="#2-3-TLSåŠ å¯†é€šä¿¡çš„etcdé›†ç¾¤éƒ¨ç½²" class="headerlink" title="2.3. TLSåŠ å¯†é€šä¿¡çš„etcdé›†ç¾¤éƒ¨ç½²"></a>2.3. TLSåŠ å¯†é€šä¿¡çš„etcdé›†ç¾¤éƒ¨ç½²</h2><p>etcdæœ‰ä¸¤ä¸ªå¯¹å¤–æš´éœ²çš„ç«¯å£ï¼š2379 å’Œ 2380ã€‚å…¶ä¸­2379æ˜¯çš„ç”¨æ¥æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„ï¼Œ2380ç”¨æ¥å’Œé›†ç¾¤å†…éƒ¨å…¶å®ƒèŠ‚ç‚¹é€šä¿¡å’Œæ•°æ®åŒæ­¥çš„ã€‚è¿™ä¸¤ç§é€šä¿¡éƒ½å¯ä»¥è¿›è¡ŒTLSåŠ å¯†ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨CAè¯ä¹¦è¿›è¡ŒéªŒè¯å¯¹æ–¹æ˜¯å¦åˆæ³•ã€‚etcdé»˜è®¤æ˜¯æ²¡ç”¨å¯åŠ¨RBACè®¤è¯çš„ï¼Œæ‰€æœ‰è¿æ¥ä¸Šçš„å®¢æˆ·ç«¯éƒ½æ˜¯å¯ä»¥æ“ä½œæ‰€æœ‰çš„keyã€‚åœ¨k8sé›†ç¾¤ä¸­ï¼ŒectdæœåŠ¡ç«¯æ˜¯é€šè¿‡å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯æ˜¯å¦åˆæ³•çš„ï¼Œåªæœ‰å®¢æˆ·ç«¯æ‹¿etcdè®¤å¯çš„CAç­¾å‘çš„è¯ä¹¦æ‰èƒ½é€šè¿‡è®¤è¯ã€‚æ ¸å¿ƒå‚æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain"># clientå’Œserverç›´æ¥é€šä¿¡<br>--trusted-ca-file=&lt;path&gt;å—ä¿¡ä»»çš„CAè¯ä¹¦<br>--cert-file=&lt;path&gt;etcd æœåŠ¡ç«¯è¯ä¹¦<br>--key-file=&lt;path&gt;etcd æœåŠ¡ç«¯è¯ä¹¦ç§é’¥<br>--client-cert-authæŒ‡å®šè¯¥å‚æ•°åï¼ŒæœåŠ¡ç«¯è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ä¹Ÿæ˜¯trusted-ca-fileç­¾å‘çš„è¯ä¹¦<br><br># etcdèŠ‚ç‚¹ä¹‹é—´é€šä¿¡(peer)<br>--peer-trusted-ca-file=&lt;path&gt;å—ä¿¡ä»»çš„CAè¯ä¹¦<br>--peer-cert-file=&lt;path&gt;etcd æœåŠ¡ç«¯è¯ä¹¦<br>--peer-key-file=&lt;path&gt;etcd æœåŠ¡ç«¯è¯ä¹¦ç§é’¥<br>--peer-client-cert-authæŒ‡å®šè¯¥å‚æ•°åï¼Œè¦æ±‚å¯¹ç«¯è¯ä¹¦ä¹Ÿæ˜¯peer-trusted-ca-fileç­¾å‘çš„è¯ä¹¦<br></code></pre></td></tr></table></figure><h3 id="2-3-1-ç­¾å‘è¯ä¹¦"><a href="#2-3-1-ç­¾å‘è¯ä¹¦" class="headerlink" title="2.3.1. ç­¾å‘è¯ä¹¦"></a>2.3.1. ç­¾å‘è¯ä¹¦</h3><p>é€šå¸¸æˆ‘ä»¬ä¼šåŒæ—¶åŠ å¯† client-server ä»¥åŠ peer èŠ‚ç‚¹è¯ä¹¦ï¼Œä¸ºäº†ç®€åŒ–ï¼Œclient-server å’Œ peer çš„caè¯ä¹¦é€šå¸¸æ˜¯ç›¸åŒçš„ï¼Œç”šè‡³peerè¯ä¹¦å’Œserverè¯ä¹¦éƒ½å¯ä»¥ç›¸åŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs plain"># ä¸‹è½½è¯ä¹¦ç­¾å‘å·¥å…·<br>[root@duduniao etcd]# wget -O /usr/local/bin/cfssl  https://pkg.cfssl.org/R1.2/cfssl_linux-amd64<br>[root@duduniao etcd]# wget -O /usr/local/bin/cfssljson https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64<br>[root@duduniao etcd]# chmod +x /usr/local/bin/cfssljson  /usr/local/bin/cfssl<br># ç­¾å‘caè¯ä¹¦ï¼Œè¿™é‡Œæœ‰ä¸ªå¾ˆå¤§çš„å‘ï¼š<br>#     etcdèŠ‚ç‚¹ä¼šä¸æ–­ä»¥å®¢æˆ·ç«¯èº«ä»½è®¿é—®è‡ªèº«çš„2379ç«¯å£ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯serverè¯ä¹¦ï¼Œå› æ­¤caçš„serveré…ç½®å¿…é¡»æ·»åŠ line:19 &quot;client auth&quot;ã€‚å¦åˆ™ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯:<br>#     WARNING: 2021/10/17 09:55:56 [core] grpc: addrConn.createTransport failed to connect to &#123;127.0.0.1:2379 127.0.0.1:2379 &lt;nil&gt; 0 &lt;nil&gt;&#125;. <br>#     Err: connection error: desc = &quot;transport: authentication handshake failed: remote error: tls: bad certificate&quot;. Reconnecting...<br>[root@duduniao etcd]# mkdir ssl/ &amp;&amp; cd ssl<br>[root@duduniao ssl]# cat ca-config.json<br>&#123;<br>    &quot;signing&quot;: &#123;<br>        &quot;default&quot;: &#123;<br>            &quot;expiry&quot;: &quot;43800h&quot;<br>        &#125;,<br>        &quot;profiles&quot;: &#123;<br>            &quot;server&quot;: &#123;<br>                &quot;expiry&quot;: &quot;43800h&quot;,<br>                &quot;usages&quot;: [<br>                    &quot;signing&quot;,<br>                    &quot;key encipherment&quot;,<br>                    &quot;server auth&quot;,<br>                    &quot;client auth&quot;<br>                ]<br>            &#125;,<br>            &quot;client&quot;: &#123;<br>                &quot;expiry&quot;: &quot;43800h&quot;,<br>                &quot;usages&quot;: [<br>                    &quot;signing&quot;,<br>                    &quot;key encipherment&quot;,<br>                    &quot;client auth&quot;<br>                ]<br>            &#125;,<br>            &quot;peer&quot;: &#123;<br>                &quot;expiry&quot;: &quot;43800h&quot;,<br>                &quot;usages&quot;: [<br>                    &quot;signing&quot;,<br>                    &quot;key encipherment&quot;,<br>                    &quot;server auth&quot;,<br>                    &quot;client auth&quot;<br>                ]<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br>[root@duduniao ssl]# cat ca-csr.json<br>&#123;<br>    &quot;CN&quot;: &quot;local-etcd-ca&quot;,<br>    &quot;key&quot;: &#123;<br>        &quot;algo&quot;: &quot;rsa&quot;,<br>        &quot;size&quot;: 2048<br>    &#125;,<br>    &quot;names&quot;: [<br>        &#123;<br>            &quot;C&quot;: &quot;CN&quot;,<br>            &quot;L&quot;: &quot;Shanghai&quot;,<br>            &quot;O&quot;: &quot;duduniao&quot;,<br>            &quot;ST&quot;: &quot;Shanghai&quot;,<br>            &quot;OU&quot;: &quot;devops&quot;<br>        &#125;<br>    ]<br>&#125;<br>[root@duduniao ssl]# cfssl gencert -initca ca-csr.json | cfssljson -bare ca -<br>[root@duduniao ssl]# ll<br>total 20<br>-rw-r--r-- 1 root root  832 2021-10-17 15:23:33 ca-config.json<br>-rw-r--r-- 1 root root  274 2021-10-17 15:26:46 ca-csr.json<br>-rw------- 1 root root 1679 2021-10-17 15:27:08 ca-key.pem<br>-rw-r--r-- 1 root root 1013 2021-10-17 15:27:08 ca.csr<br>-rw-r--r-- 1 root root 1387 2021-10-17 15:27:08 ca.pem<br># ç­¾å‘serverè¯ä¹¦ï¼Œ clientéªŒè¯serverä½¿ç”¨ï¼ŒåŒæ—¶serverè‡ªæ£€ä¹Ÿéœ€è¦<br>[root@duduniao ssl]# cat server.json<br>&#123;<br>    &quot;CN&quot;: &quot;local-etcd.duduniao.com&quot;,<br>    &quot;hosts&quot;: [<br>        &quot;10.4.7.121&quot;,<br>        &quot;10.4.7.122&quot;,<br>        &quot;10.4.7.123&quot;,<br>        &quot;127.0.0.1&quot;,<br>        &quot;etcd-1&quot;,<br>        &quot;etcd-2&quot;,<br>        &quot;etcd-3&quot;,<br>        &quot;localhost&quot;<br>    ],<br>    &quot;key&quot;: &#123;<br>        &quot;algo&quot;: &quot;ecdsa&quot;,<br>        &quot;size&quot;: 256<br>    &#125;,<br>    &quot;names&quot;: [<br>        &#123;<br>            &quot;C&quot;: &quot;CN&quot;,<br>            &quot;L&quot;: &quot;Shanghai&quot;,<br>            &quot;ST&quot;: &quot;Shanghai&quot;<br>        &#125;<br>    ]<br>&#125;<br>[root@duduniao ssl]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server server.json | cfssljson -bare server<br>[root@duduniao ssl]# ll server*<br>-rw------- 1 root root  227 2021-10-17 15:32:56 server-key.pem<br>-rw-r--r-- 1 root root  558 2021-10-17 15:32:56 server.csr<br>-rw-r--r-- 1 root root  391 2021-10-17 15:32:24 server.json<br>-rw-r--r-- 1 root root 1184 2021-10-17 15:32:56 server.pem<br># ç­¾å‘peerè¯ä¹¦ï¼Œæ¨èæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ª, ä»¥etcd-1ä¸ºä¾‹ï¼Œå…¶å®ƒèŠ‚ç‚¹ä¿®æ”¹IPã€åŸŸåå’Œä¸»æœºå<br>[root@duduniao ssl]# cat etcd-1.json<br>&#123;<br>    &quot;CN&quot;: &quot;local-etcd-1.duduniao.com&quot;,<br>    &quot;hosts&quot;: [<br>        &quot;10.4.7.121&quot;,<br>        &quot;etcd-1&quot;<br>    ],<br>    &quot;key&quot;: &#123;<br>        &quot;algo&quot;: &quot;ecdsa&quot;,<br>        &quot;size&quot;: 256<br>    &#125;,<br>    &quot;names&quot;: [<br>        &#123;<br>            &quot;C&quot;: &quot;CN&quot;,<br>            &quot;L&quot;: &quot;Shanghai&quot;,<br>            &quot;ST&quot;: &quot;Shanghai&quot;<br>        &#125;<br>    ]<br>&#125;<br>[root@duduniao ssl]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=peer etcd-1.json | cfssljson -bare etcd-1<br>[root@duduniao ssl]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=peer etcd-2.json | cfssljson -bare etcd-2<br>[root@duduniao ssl]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=peer etcd-3.json | cfssljson -bare etcd-3<br></code></pre></td></tr></table></figure><h3 id="2-3-2-éƒ¨ç½²etcdé›†ç¾¤"><a href="#2-3-2-éƒ¨ç½²etcdé›†ç¾¤" class="headerlink" title="2.3.2. éƒ¨ç½²etcdé›†ç¾¤"></a>2.3.2. éƒ¨ç½²etcdé›†ç¾¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs plain"># åœæ­¢æ‰éåŠ å¯†çš„etcdé›†ç¾¤ï¼Œæ¸…ç†etcdæ•°æ®<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;systemctl stop etcd&quot; <br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;rm -fr /data/etcd&quot;<br># ä¸‹å‘è¯ä¹¦<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;mkdir -p /data/etcd/data /data/etcd/ssl&quot;<br>[root@duduniao etcd]# scan_host.sh push -h 10.4.7.121 10.4.7.122 10.4.7.123 ssl/ca.pem ssl/server.pem ssl/server-key.pem  /data/etcd/ssl/<br>[root@duduniao etcd]# scp ssl/etcd-1-key.pem ssl/etcd-1.pem 10.4.7.121:/data/etcd/ssl/<br>[root@duduniao etcd]# scp ssl/etcd-2-key.pem ssl/etcd-2.pem 10.4.7.122:/data/etcd/ssl/<br>[root@duduniao etcd]# scp ssl/etcd-3-key.pem ssl/etcd-3.pem 10.4.7.123:/data/etcd/ssl/<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;ls -l /data/etcd/ssl&quot;<br>10.4.7.122<br>total 20<br>-rw-r--r-- 1 root root 1387 Oct 17 07:53 ca.pem<br>-rw------- 1 root root  227 Oct 17 07:54 etcd-2-key.pem<br>-rw-r--r-- 1 root root 1147 Oct 17 07:54 etcd-2.pem<br>-rw------- 1 root root  227 Oct 17 07:53 server-key.pem<br>-rw-r--r-- 1 root root 1184 Oct 17 07:53 server.pem<br>10.4.7.121<br>total 20<br>-rw-r--r-- 1 root root 1387 Oct 17 07:53 ca.pem<br>-rw------- 1 root root  227 Oct 17 07:54 etcd-1-key.pem<br>-rw-r--r-- 1 root root 1147 Oct 17 07:54 etcd-1.pem<br>-rw------- 1 root root  227 Oct 17 07:53 server-key.pem<br>-rw-r--r-- 1 root root 1184 Oct 17 07:53 server.pem<br>10.4.7.123<br>total 20<br>-rw-r--r-- 1 root root 1387 Oct 17 07:53 ca.pem<br>-rw------- 1 root root  227 Oct 17 07:55 etcd-3-key.pem<br>-rw-r--r-- 1 root root 1147 Oct 17 07:55 etcd-3.pem<br>-rw------- 1 root root  227 Oct 17 07:53 server-key.pem<br>-rw-r--r-- 1 root root 1184 Oct 17 07:53 server.pem<br># ä¿®æ”¹servcieæ–‡ä»¶<br># etcd-1.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>ExecStart=/usr/local/bin/etcd \<br>  --name etcd-1 \<br>  --initial-advertise-peer-urls https://10.4.7.121:2380 \<br>  --listen-peer-urls https://10.4.7.121:2380 \<br>  --listen-client-urls https://10.4.7.121:2379,https://127.0.0.1:2379 \<br>  --advertise-client-urls https://10.4.7.121:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --initial-cluster etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380,etcd-3=https://10.4.7.123:2380 \<br>  --initial-cluster-state new \<br>  --client-cert-auth \<br>  --cert-file ssl/server.pem \<br>  --key-file ssl/server-key.pem \<br>  --trusted-ca-file ssl/ca.pem \<br>  --peer-client-cert-auth \<br>  --peer-trusted-ca-file ssl/ca.pem \<br>  --peer-cert-file ssl/etcd-1.pem \<br>  --peer-key-file ssl/etcd-1-key.pem \<br>  --data-dir data \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br><br># etcd-2.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>ExecStart=/usr/local/bin/etcd \<br>  --name etcd-2 \<br>  --initial-advertise-peer-urls https://10.4.7.122:2380 \<br>  --listen-peer-urls https://10.4.7.122:2380 \<br>  --listen-client-urls https://10.4.7.122:2379,https://127.0.0.1:2379 \<br>  --advertise-client-urls https://10.4.7.122:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --initial-cluster etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380,etcd-3=https://10.4.7.123:2380 \<br>  --initial-cluster-state new \<br>  --client-cert-auth \<br>  --cert-file ssl/server.pem \<br>  --key-file ssl/server-key.pem \<br>  --trusted-ca-file ssl/ca.pem \<br>  --peer-client-cert-auth \<br>  --peer-trusted-ca-file ssl/ca.pem \<br>  --peer-cert-file ssl/etcd-2.pem \<br>  --peer-key-file ssl/etcd-2-key.pem \<br>  --data-dir data \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br><br># etcd-3.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>ExecStart=/usr/local/bin/etcd \<br>  --name etcd-3 \<br>  --initial-advertise-peer-urls https://10.4.7.123:2380 \<br>  --listen-peer-urls https://10.4.7.123:2380 \<br>  --listen-client-urls https://10.4.7.123:2379,https://127.0.0.1:2379 \<br>  --advertise-client-urls https://10.4.7.123:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --initial-cluster etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380,etcd-3=https://10.4.7.123:2380 \<br>  --initial-cluster-state new \<br>  --client-cert-auth \<br>  --cert-file ssl/server.pem \<br>  --key-file ssl/server-key.pem \<br>  --trusted-ca-file ssl/ca.pem \<br>  --peer-client-cert-auth \<br>  --peer-trusted-ca-file ssl/ca.pem \<br>  --peer-cert-file ssl/etcd-3.pem \<br>  --peer-key-file ssl/etcd-3-key.pem \<br>  --data-dir data \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br># å¯åŠ¨é›†ç¾¤<br>[root@duduniao etcd]# scp etcd-1.service 10.4.7.121:/lib/systemd/system/etcd.service<br>[root@duduniao etcd]# scp etcd-2.service 10.4.7.122:/lib/systemd/system/etcd.service<br>[root@duduniao etcd]# scp etcd-3.service 10.4.7.123:/lib/systemd/system/etcd.service<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;systemctl daemon-reload&quot;<br>10.4.7.122<br>10.4.7.123<br>10.4.7.121<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.123 &quot;systemctl restart etcd &amp;&amp; systemctl enable etcd&quot;<br></code></pre></td></tr></table></figure><h3 id="2-3-3-å®¢æˆ·ç«¯éªŒè¯"><a href="#2-3-3-å®¢æˆ·ç«¯éªŒè¯" class="headerlink" title="2.3.3. å®¢æˆ·ç«¯éªŒè¯"></a>2.3.3. å®¢æˆ·ç«¯éªŒè¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain"># ä¸åŠ è¯ä¹¦<br>root@ubuntu-1804-122:~# etcdctl --endpoints=10.4.7.121:2379 member list --write-out=table<br>&#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2021-10-17T10:26:16.722Z&quot;,&quot;logger&quot;:&quot;etcd-client&quot;,&quot;caller&quot;:&quot;v3/retry_interceptor.go:62&quot;,&quot;msg&quot;:&quot;retrying of unary invoker failed&quot;,&quot;target&quot;:&quot;etcd-endpoints://0xc000318380/10.4.7.121:2379&quot;,&quot;attempt&quot;:0,&quot;error&quot;:&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection closed&quot;&#125;<br>Error: context deadline exceeded<br><br># åŠ ä¸Šè¯ä¹¦<br>root@ubuntu-1804-122:~# cd /data/etcd/ssl/ &amp;&amp; etcdctl --cacert ca.pem --cert server.pem --key server-key.pem --endpoints https://10.4.7.121:2379 member list<br>4fe2b98ed7b794f7, started, etcd-3, https://10.4.7.123:2380, https://10.4.7.123:2379, false<br>bbd6739258f69625, started, etcd-1, https://10.4.7.121:2380, https://10.4.7.121:2379, false<br>c5542f3740ec56cd, started, etcd-2, https://10.4.7.122:2380, https://10.4.7.122:2379, false<br></code></pre></td></tr></table></figure><h2 id="2-4-etcdå‘½ä»¤è¡Œ"><a href="#2-4-etcdå‘½ä»¤è¡Œ" class="headerlink" title="2.4. etcdå‘½ä»¤è¡Œ"></a>2.4. etcdå‘½ä»¤è¡Œ</h2><h3 id="2-4-1-etcd"><a href="#2-4-1-etcd" class="headerlink" title="2.4.1. etcd"></a>2.4.1. etcd</h3><p>ectd å¯åŠ¨å‚æ•°éå¸¸å¤šï¼Œæ ¸å¿ƒçš„å¯åŠ¨å‚æ•°æœ‰ä»¥ä¸‹éƒ¨åˆ†ï¼Œå…¶å®ƒè¯·å‚è€ƒ<a href="https://etcd.io/docs/v3.5/op-guide/configuration/">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><ul><li>member flgas</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">-name èŠ‚ç‚¹åç§°,ç”¨äºç»„å»ºé›†ç¾¤ï¼Œé»˜è®¤ default<br>-data-dir æ•°æ®å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤å·¥ä½œç›®å½•ä¸‹ $&#123;name&#125;.etcd<br>-wal-dirwalæ—¥å¿—ç›®å½•ï¼Œé»˜è®¤ä¸ºdata-dir<br>-snapshot-countè§¦å‘snapshotçš„äº‹åŠ¡æäº¤æ¬¡æ•°ï¼Œé»˜è®¤å€¼ 100000<br>-listen-peer-urlsé›†ç¾¤èŠ‚ç‚¹ä¸­é—´å¯¹ç­‰ç½‘ç»œç›‘å¬URLï¼Œå¯ä»¥æ˜¯httpä¹Ÿå¯ä»¥æ˜¯https, 0.0.0.0è¡¨ç¤ºæ‰€æœ‰åœ°å€ã€‚é»˜è®¤ http://localhost:2380<br>-listen-peer-urls ç”¨äºæš´éœ²ç»™å®¢æˆ·ç«¯çš„URLåœ°å€ï¼Œå¯ä»¥æ˜¯httpä¹Ÿå¯ä»¥æ˜¯https, 0.0.0.0è¡¨ç¤ºæ‰€æœ‰åœ°å€ã€‚é»˜è®¤ http://localhost:2379<br><br>â€“max-request-byteså®¢æˆ·ç«¯æœ€å¤§è¯·æ±‚çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤1572864<br>-quota-backend-bytesåç«¯é…é¢å¤§å°ï¼Œé»˜è®¤ä¸º2G.æœ€å¤§ä¸º8Gï¼Œè¶…è¿‡ä¼šå¯¼è‡´æ•°æ®æ— æ³•å†™å…¥<br></code></pre></td></tr></table></figure><ul><li>cluster flags</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">â€“initial-clusterå¼•å¯¼å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°é›†ç¾¤ã€‚ä»…åœ¨å¯åŠ¨æ–°çš„é›†ç¾¤æˆå‘˜æ—¶ç”Ÿæ•ˆï¼Œåç»­è¿è¡Œä¸­ä¼šå¿½ç•¥è¯¥å‚æ•°<br>â€“initial-advertise-peer-urlså¯¹å¤–å‘å¸ƒpeerèŠ‚ç‚¹é€šä¿¡åœ°å€ã€‚ä»…åœ¨å¯åŠ¨æ–°çš„é›†ç¾¤æˆå‘˜æ—¶ç”Ÿæ•ˆï¼Œåç»­è¿è¡Œä¸­ä¼šå¿½ç•¥è¯¥å‚æ•°<br>-initial-cluster-stateé›†ç¾¤çŠ¶æ€ã€‚new:è¡¨ç¤ºæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨å¹¶ç»„å»ºé›†ç¾¤;existingè¡¨ç¤ºåŠ å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„é›†ç¾¤ã€‚ä»…åœ¨å¯åŠ¨æ–°çš„é›†ç¾¤æˆå‘˜æ—¶ç”Ÿæ•ˆï¼Œåç»­è¿è¡Œä¸­ä¼šå¿½ç•¥è¯¥å‚æ•°<br>-initial-cluster-tokené›†ç¾¤çš„tokenï¼Œæ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨æ—¶éœ€è¦æŒ‡å®šã€‚é»˜è®¤ä¸º etcd-clusterã€‚ä»…åœ¨å¯åŠ¨æ–°çš„é›†ç¾¤æˆå‘˜æ—¶ç”Ÿæ•ˆï¼Œåç»­è¿è¡Œä¸­ä¼šå¿½ç•¥è¯¥å‚æ•°<br>-advertise-client-urlså‘å¸ƒç»™å…¶å®ƒæˆå‘˜ï¼Œå‘ŠçŸ¥ä»–ä»¬å½“å‰èŠ‚ç‚¹æš´éœ²ç»™å®¢æˆ·ç«¯çš„åœ°å€ã€‚é»˜è®¤ä¸º http://localhost:2379<br></code></pre></td></tr></table></figure><ul><li>secirity flags</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">-trusted-ca-file# æœåŠ¡ç«¯ä¿¡ä»»çš„CAè¯ä¹¦ï¼Œç”¨æ¥éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•<br>-cert-file# æœåŠ¡ç«¯è¯ä¹¦ï¼Œç”±ä¿¡ä»»çš„CAç­¾å‘ï¼ŒåŠ å¯†ä¸å®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œå¹¶ä¸”è¢«å®¢æˆ·ç«¯éªŒè¯<br>-key-file# æœåŠ¡ç«¯è¯ä¹¦ç§é’¥<br>-client-cert-auth# å¯ç”¨è¯¥å‚æ•°è¡¨ç¤ºæœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦æ˜¯å¦ä¸ºå—ä¿¡ä»»çš„CAç­¾å‘<br><br>â€“peer-trusted-ca-file# peerèŠ‚ç‚¹é€šä¿¡ä¿¡ä»»çš„CAè¯ä¹¦ï¼Œç”¨æ¥éªŒè¯å…¶å®ƒèŠ‚ç‚¹æ˜¯å¦åˆæ³•<br>-peer-cert-file# peerèŠ‚ç‚¹è¯ä¹¦ï¼Œç”±ä¿¡ä»»çš„CAç­¾å‘ï¼ŒåŠ å¯†ä¸å®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œå¹¶ä¸”è¢«å…¶å®ƒèŠ‚ç‚¹éªŒè¯<br>-peer-key-file# peerèŠ‚ç‚¹è¯ä¹¦ç§é’¥<br>-peer-client-cert-auth# å¯ç”¨è¯¥å‚æ•°è¡¨ç¤ºéªŒè¯å¯¹ç«¯è¯ä¹¦æ˜¯å¦ä¸ºå—ä¿¡ä»»çš„CAç­¾å‘<br></code></pre></td></tr></table></figure><ul><li>logging flags</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">-log-levelæŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤info.å¯é€‰: debug, info, warn, error, panic, fatal<br></code></pre></td></tr></table></figure><h3 id="2-4-2-etcdctl"><a href="#2-4-2-etcdctl" class="headerlink" title="2.4.2. etcdctl"></a>2.4.2. etcdctl</h3><h4 id="2-4-2-1-å¸¸ç”¨å‚æ•°"><a href="#2-4-2-1-å¸¸ç”¨å‚æ•°" class="headerlink" title="2.4.2.1. å¸¸ç”¨å‚æ•°"></a>2.4.2.1. å¸¸ç”¨å‚æ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">--endpointsæŒ‡å®šæœåŠ¡ç«¯GRPCæ¥å£ï¼Œé»˜è®¤ 127.0.0.1:2379<br><br>--cacertæŒ‡å®šcaè¯ä¹¦ï¼Œç”¨æ¥éªŒè¯æœåŠ¡ç«¯æ˜¯å¦åˆæ³•<br>--certæŒ‡å®šå®¢æˆ·ç«¯è¯ä¹¦<br>--keyæŒ‡å®šå®¢æˆ·ç«¯è¯ä¹¦çš„ç§é’¥<br></code></pre></td></tr></table></figure><p>å¯¹äºéœ€è¦é€šè¿‡è¯ä¹¦è®¿é—®çš„åœºæ™¯ï¼Œå¯ä»¥é…ç½®å‘½ä»¤çš„åˆ«åï¼Œä»¥ä¸‹çš„æ¡ˆä¾‹å‡ä½¿ç”¨åˆ«åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">alias etc=&#x27;etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379&#x27;<br></code></pre></td></tr></table></figure><h4 id="2-4-2-2-å¸¸ç”¨æŒ‡ä»¤"><a href="#2-4-2-2-å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="2.4.2.2. å¸¸ç”¨æŒ‡ä»¤"></a>2.4.2.2. å¸¸ç”¨æŒ‡ä»¤</h4><p>etcdctl æ˜¯etcdçš„å®¢æˆ·ç«¯å·¥å…·ï¼Œé€šå¸¸ç”¨æ¥æŸ¥è¯¢é›†ç¾¤å’ŒèŠ‚ç‚¹çŠ¶æ€ï¼Œå¶å°”ç”¨æ¥æŸ¥è¯¢æŒ‡å®škeyçš„å€¼ã€‚</p><ol><li>æŒ‡å®šAPIç‰ˆæœ¬</li></ol><p>etcdçš„APIæœ‰v2å’Œv3ï¼Œetcdctl å‘½ä»¤åœ¨3.4ä¹‹å‰é»˜è®¤ä¸ºv2ï¼Œä¹‹åä¸ºv3ã€‚v2å’Œv3ç‰ˆæœ¬çš„APIæ•°æ®ä¸å…¼å®¹ï¼Œåœ¨æŸ¥è¯¢çš„æ—¶å€™éœ€è¦é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">export ETCDCTL_API=3  # æŒ‡å®šv3ç‰ˆæœ¬<br>export ETCDCTL_API=2# æŒ‡å®šv2ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><ol><li>å†™å…¥key</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etc put key-1 value-1<br>[root@duduniao etcd]# etc put key-2 value-2<br>[root@duduniao etcd]# etc put key-3 value-3<br></code></pre></td></tr></table></figure><ol><li>æŸ¥è¯¢key</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain"># ç²¾ç¡®æŸ¥è¯¢<br>[root@duduniao etcd]# etc get key-1<br># æ ¹æ®å‰ç¼€æŸ¥è¯¢<br>[root@duduniao etcd]# etc get --prefix key<br># åªæ˜¾ç¤ºvalue<br>[root@duduniao etcd]# etc get --prefix key --print-value-only<br># ç°åœ¨æŸ¥è¯¢ç»“æœçš„æ•°é‡<br>[root@duduniao etcd]# etc get --prefix key --limit 2<br></code></pre></td></tr></table></figure><ol><li>watch key</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etc watch key-1<br></code></pre></td></tr></table></figure><ol><li>åˆ é™¤key</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etc del key-watch<br></code></pre></td></tr></table></figure><ol><li>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etc member list --write-out=table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><ol><li>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etc endpoint status --write-out=table<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|        ENDPOINT         |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://10.4.7.121:2379 | bbd6739258f69625 |   3.5.1 |   20 kB |      true |      false |         2 |         23 |                 23 |        |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>[root@duduniao etcd]# etc endpoint health --write-out=table<br>+-------------------------+--------+----------+-------+<br>|        ENDPOINT         | HEALTH |   TOOK   | ERROR |<br>+-------------------------+--------+----------+-------+<br>| https://10.4.7.121:2379 |   true | 6.6739ms |       |<br>+-------------------------+--------+----------+-------+<br></code></pre></td></tr></table></figure><h3>åŸæ–‡æ¥è‡ªï¼šè¿ç»´æ¸¡æ¸¡é¸Ÿ</h3>-----------------]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‘åŸç”ŸEtcd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Etcdé›†ç¾¤ç»´æŠ¤</title>
    <link href="/2025/03/19/Etcd%E9%9B%86%E7%BE%A4%E7%BB%B4%E6%8A%A4/"/>
    <url>/2025/03/19/Etcd%E9%9B%86%E7%BE%A4%E7%BB%B4%E6%8A%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="1-é›†ç¾¤ç»´æŠ¤"><a href="#1-é›†ç¾¤ç»´æŠ¤" class="headerlink" title="1. é›†ç¾¤ç»´æŠ¤"></a>1. é›†ç¾¤ç»´æŠ¤</h1><p>etcdå¯åŠ¨å‚æ•°ä¸­<code>--initial-advertise-peer-urls</code> <code>--initial-cluster</code> <code>--initial-cluster-state</code> <code>--initial-cluster-token</code>ä»…åœ¨åˆ›å»ºæ–°çš„memberèŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼Œå¯¹äºå·²ç»æ·»åŠ åˆ°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹è€Œè¨€æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œå› æ­¤åœ¨å¤§éƒ¨åˆ†æƒ…å†µï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰etcdå¯åŠ¨å‘½ä»¤ä¸­çš„è¿™å‡ ä¸ªå‚æ•°çš„ï¼ŒåŒç†è¿™ä¸ªå‚æ•°ä¹Ÿä¸èƒ½ä»£è¡¨é›†ç¾¤ä¸­èŠ‚ç‚¹çš„çœŸå®çŠ¶æ€ã€‚é›†ç¾¤çš„ç»´æŠ¤æ“ä½œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>å¢åŠ é›†ç¾¤èŠ‚ç‚¹ï¼šæ¯”å¦‚ä»3ä¸ªèŠ‚ç‚¹å¢åŠ åˆ°5ä¸ªèŠ‚ç‚¹ï¼Œæå‡å®¢æˆ·ç«¯è¯»å–æ€§èƒ½</li><li>ç§»é™¤é›†ç¾¤èŠ‚ç‚¹ï¼šæ¯”å¦‚ä»5ä¸ªèŠ‚ç‚¹å‡å°‘åˆ°3ä¸ªèŠ‚ç‚¹ï¼Œæå‡å®¢æˆ·ç«¯å†™å…¥æ€§èƒ½</li><li>èŠ‚ç‚¹è¿ç§»ç»´æŠ¤ï¼šèŠ‚ç‚¹ç£ç›˜æ•…éšœã€èŠ‚ç‚¹é…ç½®å‡çº§ã€ç³»ç»Ÿå‡çº§éœ€è¦åœæœç»´æŠ¤</li><li>é›†ç¾¤ç¾éš¾æ¢å¤ï¼šå¤šæ•°èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œéœ€è¦ç”¨æ—§æ•°æ®é‡æ–°å»ºç«‹é›†ç¾¤</li><li>etcdç‰ˆæœ¬å‡çº§ï¼šéœ€è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œç¡®è®¤å„ä¸ªç‰ˆæœ¬åŒºåˆ«ï¼Œç„¶åé€ä¸ªå‡çº§</li><li>etcdè¯ä¹¦æ›¿æ¢ï¼šè¯ä¹¦åˆ°æœŸåæ›´æ¢è¯ä¹¦</li></ul><h2 id="1-1-å¢åŠ é›†ç¾¤èŠ‚ç‚¹"><a href="#1-1-å¢åŠ é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="1.1. å¢åŠ é›†ç¾¤èŠ‚ç‚¹"></a>1.1. å¢åŠ é›†ç¾¤èŠ‚ç‚¹</h2><p>å‘å½“å‰é›†ç¾¤æ·»åŠ  <code>etcd-4: https://10.4.7.123:2380</code>å’Œ <code>etcd-5: https://10.4.7.125:2380</code>ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ç¡®è®¤å½“å‰é›†ç¾¤æˆå‘˜ä¿¡æ¯ï¼Œç¡®ä¿å½“å‰é›†ç¾¤èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etc member list --write-out=table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><ol><li>ç­¾å‘æ–°èŠ‚ç‚¹çš„è¯ä¹¦</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs plain"># é‡æ–°ç­¾å‘serverè¯ä¹¦ï¼Œå› ä¸ºåŸæ¥çš„serverè¯ä¹¦ä¸åŒ…å«etcd-4å’Œetcd-5ã€‚<br># ä»v3.2.0å¼€å§‹ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯è¿æ¥ä¼šè‡ªåŠ¨åŠ è½½serverè¯ä¹¦å’Œpeerè¯ä¹¦ï¼Œå¯ä»¥åŠ¨æ€æ›¿æ¢æ—§è¯ä¹¦ã€‚<br>[root@duduniao ssl]# cat server.json<br>&#123;<br>    &quot;CN&quot;: &quot;local-etcd.duduniao.com&quot;,<br>    &quot;hosts&quot;: [<br>        &quot;10.4.7.121&quot;,<br>        &quot;10.4.7.122&quot;,<br>        &quot;10.4.7.123&quot;,<br>        &quot;10.4.7.124&quot;,<br>        &quot;10.4.7.125&quot;,<br>        &quot;127.0.0.1&quot;,<br>        &quot;etcd-1&quot;,<br>        &quot;etcd-2&quot;,<br>        &quot;etcd-3&quot;,<br>        &quot;etcd-4&quot;,<br>        &quot;etcd-5&quot;,<br>        &quot;localhost&quot;<br>    ],<br>    &quot;key&quot;: &#123;<br>        &quot;algo&quot;: &quot;ecdsa&quot;,<br>        &quot;size&quot;: 256<br>    &#125;,<br>    &quot;names&quot;: [<br>        &#123;<br>            &quot;C&quot;: &quot;CN&quot;,<br>            &quot;L&quot;: &quot;Shanghai&quot;,<br>            &quot;ST&quot;: &quot;Shanghai&quot;<br>        &#125;<br>    ]<br>&#125;<br>[root@duduniao ssl]# rm -f server.csr server*.pem<br>[root@duduniao ssl]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server server.json | cfssljson -bare server<br><br># ä»¥ etcd-4ä¸ºä¾‹ï¼Œç­¾å‘ peer è¯ä¹¦<br>[root@duduniao ssl]# cat etcd-4.json<br>&#123;<br>    &quot;CN&quot;: &quot;local-etcd-4.duduniao.com&quot;,<br>    &quot;hosts&quot;: [<br>        &quot;10.4.7.124&quot;,<br>        &quot;etcd-4&quot;<br>    ],<br>    &quot;key&quot;: &#123;<br>        &quot;algo&quot;: &quot;ecdsa&quot;,<br>        &quot;size&quot;: 256<br>    &#125;,<br>    &quot;names&quot;: [<br>        &#123;<br>            &quot;C&quot;: &quot;CN&quot;,<br>            &quot;L&quot;: &quot;Shanghai&quot;,<br>            &quot;ST&quot;: &quot;Shanghai&quot;<br>        &#125;<br>    ]<br>&#125;<br>[root@duduniao ssl]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=peer etcd-4.json | cfssljson -bare etcd-4<br>[root@duduniao ssl]# ll etcd-4*.pem etcd-5*.pem<br>-rw------- 1 root root  227 2021-10-19 23:06:14 etcd-4-key.pem<br>-rw-r--r-- 1 root root 1147 2021-10-19 23:06:14 etcd-4.pem<br>-rw------- 1 root root  227 2021-10-19 23:06:26 etcd-5-key.pem<br>-rw-r--r-- 1 root root 1147 2021-10-19 23:06:26 etcd-5.pem<br><br># ä¸‹å‘etcdè¯ä¹¦<br>[root@duduniao ssl]# ssh 10.4.7.124 &quot;mkdir -pv /data/etcd/&#123;ssl,data&#125;&quot;<br>mkdir: created directory &#x27;/data/etcd&#x27;<br>mkdir: created directory &#x27;/data/etcd/ssl&#x27;<br>mkdir: created directory &#x27;/data/etcd/data&#x27;<br>[root@duduniao ssl]# scp ca.pem etcd-4.pem etcd-4-key.pem 10.4.7.124:/data/etcd/ssl/<br># åŒæ­¥æ‰€æœ‰èŠ‚ç‚¹çš„serverè¯ä¹¦ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæ—§èŠ‚ç‚¹å¯ä»¥ä¸ç”¨æ›¿æ¢ã€‚<br>[root@duduniao ssl]# for i in 10.4.7.12&#123;1..5&#125;;do echo $i ; scp server.pem server-key.pem $i:/data/etcd/ssl/ ;done<br></code></pre></td></tr></table></figure><ol><li>æ·»åŠ æ–°èŠ‚ç‚¹</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member add etcd-4 --peer-urls https://10.4.7.124:2380<br>Member 79b3746506cf2fc1 added to cluster 23ce29301256c4ff<br><br>ETCD_NAME=&quot;etcd-4&quot;<br>ETCD_INITIAL_CLUSTER=&quot;etcd-3=https://10.4.7.123:2380,etcd-4=https://10.4.7.124:2380,etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380&quot;<br>ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://10.4.7.124:2380&quot;<br>ETCD_INITIAL_CLUSTER_STATE=&quot;existing&quot;<br><br>[root@duduniao etcd]# etc member list --write-out=table  # å½“å‰çŠ¶æ€æ˜¯æœªå¯åŠ¨<br>+------------------+-----------+--------+-------------------------+-------------------------+------------+<br>|        ID        |  STATUS   |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+-----------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 |   started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| 79b3746506cf2fc1 | unstarted |        | https://10.4.7.124:2380 |                         |      false |<br>| bbd6739258f69625 |   started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd |   started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+-----------+--------+-------------------------+-------------------------+------------+<br><br># æŸ¥çœ‹ä»»æ„ä¸€å°èŠ‚ç‚¹çš„etcdæ—¥å¿—ï¼š<br>Oct 19 15:17:05 ubuntu-1804-121 etcd[23741]: &#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2021-10-19T15:17:05.569Z&quot;,&quot;caller&quot;:&quot;rafthttp/probing_status.go:68&quot;,&quot;msg&quot;:&quot;prober detected unhealthy status&quot;,&quot;round-tripper-name&quot;:&quot;ROUND_TRIPPER_RAFT_MESSAGE&quot;,&quot;remote-peer-id&quot;:&quot;79b3746506cf2fc1&quot;,&quot;rtt&quot;:&quot;0s&quot;,&quot;error&quot;:&quot;dial tcp 10.4.7.124:2380: connect: connection refused&quot;&#125;<br>Oct 19 15:17:05 ubuntu-1804-121 etcd[23741]: &#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2021-10-19T15:17:05.569Z&quot;,&quot;caller&quot;:&quot;rafthttp/probing_status.go:68&quot;,&quot;msg&quot;:&quot;prober detected unhealthy status&quot;,&quot;round-tripper-name&quot;:&quot;ROUND_TRIPPER_SNAPSHOT&quot;,&quot;remote-peer-id&quot;:&quot;79b3746506cf2fc1&quot;,&quot;rtt&quot;:&quot;0s&quot;,&quot;error&quot;:&quot;dial tcp 10.4.7.124:2380: connect: connection refused&quot;&#125;<br></code></pre></td></tr></table></figure><ol><li>å¯åŠ¨æ–°èŠ‚ç‚¹(etcd-4)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# cat etcd-4.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>Environment=ETCD_NAME=&quot;etcd-4&quot;<br>Environment=ETCD_INITIAL_CLUSTER=&quot;etcd-3=https://10.4.7.123:2380,etcd-4=https://10.4.7.124:2380,etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380&quot;<br>Environment=ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://10.4.7.124:2380&quot;<br>Environment=ETCD_INITIAL_CLUSTER_STATE=&quot;existing&quot;<br><br>ExecStart=/usr/local/bin/etcd \<br>  --listen-peer-urls https://10.4.7.124:2380 \<br>  --listen-client-urls https://10.4.7.124:2379,https://127.0.0.1:2379 \<br>  --advertise-client-urls https://10.4.7.124:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --client-cert-auth \<br>  --cert-file ssl/server.pem \<br>  --key-file ssl/server-key.pem \<br>  --trusted-ca-file ssl/ca.pem \<br>  --peer-client-cert-auth \<br>  --peer-trusted-ca-file ssl/ca.pem \<br>  --peer-cert-file ssl/etcd-4.pem \<br>  --peer-key-file ssl/etcd-4-key.pem \<br>  --data-dir data \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br><br>[root@duduniao etcd]# scp etcd-4.service 10.4.7.124:/lib/systemd/system/etcd.service<br>[root@duduniao etcd]# scp etcd-v3.5.1-linux-amd64/etcd* 10.4.7.124:/usr/local/bin/<br>[root@duduniao etcd]# ssh 10.4.7.124 &quot;systemctl daemon-reload &amp;&amp; systemctl enable etcd &amp;&amp; systemctl start etcd&quot;<br><br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.124:2379 endpoint status --write-out table<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|        ENDPOINT         |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://10.4.7.124:2379 | 79b3746506cf2fc1 |   3.5.1 |   20 kB |     false |      false |         2 |         76 |                 76 |        |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.124:2379 member list  --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| 79b3746506cf2fc1 | started | etcd-4 | https://10.4.7.124:2380 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><ol><li>æ·»åŠ etcd-5</li></ol><p>é‡å¤æ“ä½œæ­¥éª¤3å’Œæ­¥éª¤4å³å¯.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.125:2379 endpoint status --write-out table<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|        ENDPOINT         |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://10.4.7.125:2379 | d0756e0778ff59b4 |   3.5.1 |   20 kB |     false |      false |         2 |         78 |                 78 |        |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.124:2379 member list  --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| 79b3746506cf2fc1 | started | etcd-4 | https://10.4.7.124:2380 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>| d0756e0778ff59b4 | started | etcd-5 | https://10.4.7.125:2380 | https://10.4.7.125:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><h2 id="1-2-ç§»é™¤é›†ç¾¤èŠ‚ç‚¹"><a href="#1-2-ç§»é™¤é›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="1.2. ç§»é™¤é›†ç¾¤èŠ‚ç‚¹"></a>1.2. ç§»é™¤é›†ç¾¤èŠ‚ç‚¹</h2><p>å½“é›†ç¾¤ä¸­ï¼Œéœ€è¦ç¼©å‡é›†ç¾¤è§„æ¨¡ï¼Œéœ€è¦ç§»é™¤ç°æœ‰çš„èŠ‚ç‚¹ã€‚å¦‚ä»5èŠ‚ç‚¹ç¼©å‡è‡³3èŠ‚ç‚¹ï¼Œæ“ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p><ol><li>æ£€æŸ¥é›†ç¾¤çŠ¶æ€</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list  --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| 79b3746506cf2fc1 | started | etcd-4 | https://10.4.7.124:2380 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>| d0756e0778ff59b4 | started | etcd-5 | https://10.4.7.125:2380 | https://10.4.7.125:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><ol><li>ç§»é™¤èŠ‚ç‚¹</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain"># ç§»é™¤etcd-5<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member remove d0756e0778ff59b4<br>Member d0756e0778ff59b4 removed from cluster 23ce29301256c4ff<br># ç§»é™¤etcd-4<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member remove 79b3746506cf2fc1<br>Member 79b3746506cf2fc1 removed from cluster 23ce29301256c4ff<br><br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list  --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><ol><li>åœæ­¢ç§»é™¤èŠ‚ç‚¹ä¸Šçš„etcdæœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ssh 10.4.7.124 &quot;systemctl stop etcd &amp;&amp; systemctl disable etcd&quot;<br>[root@duduniao etcd]# ssh 10.4.7.125 &quot;systemctl stop etcd &amp;&amp; systemctl disable etcd&quot;<br></code></pre></td></tr></table></figure><h2 id="1-3-èŠ‚ç‚¹è¿ç§»ç»´æŠ¤"><a href="#1-3-èŠ‚ç‚¹è¿ç§»ç»´æŠ¤" class="headerlink" title="1.3. èŠ‚ç‚¹è¿ç§»ç»´æŠ¤"></a>1.3. èŠ‚ç‚¹è¿ç§»ç»´æŠ¤</h2><p>å¦‚æœåªæ˜¯å½“å‰èŠ‚ç‚¹å‡çº§é…ç½®ã€æœåŠ¡å™¨é‡å¯ç­‰æ“ä½œï¼Œç›´æ¥åœæœåæ“ä½œå³å¯ï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†ã€‚é’ˆå¯¹èŠ‚ç‚¹æ•°æ®ç£ç›˜æ•…éšœã€æˆ–è€…å½“å‰èŠ‚ç‚¹æ•°æ®è¿ç§»åˆ°æ–°çš„èŠ‚ç‚¹ä¸Šçš„ä¸¤ç§åœºæ™¯ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>æŒ‰ç…§1.2 æ–¹å¼ç§»æ—§èŠ‚ç‚¹ï¼Œå†æŒ‰ç…§ 1.1 æ–¹å¼æ–°å¢èŠ‚ç‚¹ï¼Œå¦‚æœæ–°æ—§èŠ‚ç‚¹IPä¸å˜ï¼Œåˆ™ä¸éœ€è¦ç­¾å‘æ–°çš„è¯ä¹¦</li><li>å¦‚æœæ•°æ®è¾ƒå¤§(å¤§äº50MB)ä¸”æ—§èŠ‚ç‚¹æ•°æ®æœªæŸåï¼Œå¯ç”¨è¿ç§»èŠ‚ç‚¹æ–¹å¼</li></ul><p>è¿™é‡Œé’ˆå¯¹éœ€è¦è¿›è¡Œæ•°æ®è¿ç§»çš„åœºæ™¯è¿›è¡Œæ¼”ç¤ºï¼Œè¿ç§»etcd-3èŠ‚ç‚¹åˆ° 10.4.7.124ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.123:2380 | https://10.4.7.123:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><ol><li>æ¨¡æ‹Ÿetcd-3æ•…éšœ</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">root@ubuntu-1804-123:~# systemctl stop etcd<br></code></pre></td></tr></table></figure><ol><li>è¿ç§» 10.4.7.123 ä¸Šçš„etcdæ•°æ®åˆ° 10.4.7.124</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ssh 10.4.7.123 &quot;cd /data/etcd &amp;&amp; tar -zcf etcd-3.tar.gz data&quot;<br>[root@duduniao etcd]# scp 10.4.7.123 /data/etcd/etcd-3.tar.gz ./<br><br>[root@duduniao etcd]# scp etcd-3.tar.gz 10.4.7.124:/tmp/ <br>[root@duduniao etcd]# ssh 10.4.7.124 &quot;rm -fr /data/etcd/data ; mkdir -pv /data/etcd/ssl ; tar -xf /tmp/etcd-3.tar.gz -C /data/etcd &amp;&amp; rm -f /tmp/etcd-3.tar.gz &amp;&amp; ls -l /data/etcd&quot;<br></code></pre></td></tr></table></figure><ol><li>ç”Ÿæˆ 10.4.7.124 ä¸Šçš„etcd serverè¯ä¹¦å’Œpeerè¯ä¹¦</li></ol><p>å‚è€ƒ 1.1 æ·»åŠ æ–°èŠ‚ç‚¹ä¸­è¯ä¹¦ç­¾å‘æ­¥éª¤ï¼Œæœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ssh 10.4.7.124 &quot;ls -l /data/etcd/ssl&quot;<br>total 20<br>-rw-r--r-- 1 root root 1387 Oct 19 15:31 ca.pem<br>-rw------- 1 root root  227 Oct 19 15:31 etcd-3-key.pem<br>-rw-r--r-- 1 root root 1147 Oct 19 15:31 etcd-3.pem<br>-rw------- 1 root root  227 Oct 19 15:37 server-key.pem<br>-rw-r--r-- 1 root root 1245 Oct 19 15:37 server.pem<br></code></pre></td></tr></table></figure><ol><li>æ›´æ–°é›†ç¾¤ä¸­çš„memberæˆå‘˜ä¿¡æ¯</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member update 4fe2b98ed7b794f7 --peer-urls=&quot;https://10.4.7.124:2379&quot;<br>Member 4fe2b98ed7b794f7 updated in cluster 23ce29301256c4ff<br><br># client URLéœ€è¦å¯åŠ¨åetcdè¿›ç¨‹åæ‰èƒ½æ›´æ–°<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.124:2379 | https://10.4.7.123:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br></code></pre></td></tr></table></figure><ol><li>å¯åŠ¨æ–°èŠ‚ç‚¹çš„ etcd æœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs plain"># /lib/systemd/system/etcd.service<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br><br>[Service]<br>Type=notify<br>WorkingDirectory=/data/etcd<br>Environment=ETCD_NAME=&quot;etcd-3&quot;<br><br>ExecStart=/usr/local/bin/etcd \<br>  --listen-peer-urls https://10.4.7.124:2380 \<br>  --listen-client-urls https://10.4.7.124:2379,https://127.0.0.1:2379 \<br>  --advertise-client-urls https://10.4.7.124:2379 \<br>  --initial-cluster-token etcd-cluster-1 \<br>  --client-cert-auth \<br>  --cert-file ssl/server.pem \<br>  --key-file ssl/server-key.pem \<br>  --trusted-ca-file ssl/ca.pem \<br>  --peer-client-cert-auth \<br>  --peer-trusted-ca-file ssl/ca.pem \<br>  --peer-cert-file ssl/etcd-3.pem \<br>  --peer-key-file ssl/etcd-3-key.pem \<br>  --data-dir data \<br>  --snapshot-count 50000 \<br>  --auto-compaction-retention 1 \<br>  --auto-compaction-mode periodic \<br>  --max-request-bytes 10485760 \<br>  --quota-backend-bytes 8589934592<br>Restart=always<br>RestartSec=15<br>LimitNOFILE=65536<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br>[root@duduniao etcd]# ssh 10.4.7.124 &quot;systemctl start etcd &amp;&amp; systemctl enable etcd&quot;<br><br># æ­¤æ—¶é›†ç¾¤ä¸­çš„etcdèŠ‚ç‚¹ client URLå·²ç»å‘ç”Ÿäº†å˜åŒ–<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.124:2379 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br><br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.124:2379 endpoint status --write-out table<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|        ENDPOINT         |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://10.4.7.124:2379 | 4fe2b98ed7b794f7 |   3.5.1 |   20 kB |     false |      false |         2 |        135 |                135 |        |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br></code></pre></td></tr></table></figure><h2 id="1-4-é›†ç¾¤ç¾éš¾æ¢å¤"><a href="#1-4-é›†ç¾¤ç¾éš¾æ¢å¤" class="headerlink" title="1.4. é›†ç¾¤ç¾éš¾æ¢å¤"></a>1.4. é›†ç¾¤ç¾éš¾æ¢å¤</h2><p>etcdé›†ç¾¤é€‰æ‹©leaderæ—¶ï¼Œæ˜¯å°‘æ•°æœä»å¤šæ•°ï¼Œå› æ­¤ä¸ä¼šå‡ºç°è„‘è£‚é—®é¢˜ã€‚å½“é›†ç¾¤ä¸­çš„å¤§éƒ¨åˆ†èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œé›†ç¾¤æ— æ³•å¯¹å¤–æä¾›æ­£å¸¸çš„æœåŠ¡ï¼Œæ­¤æ—¶éœ€è¦å°½å¿«å¯åŠ¨ä¸å¯ç”¨èŠ‚ç‚¹ï¼Œåªè¦èŠ‚ç‚¹æ•°æ®è¶…è¿‡åŠæ•°ï¼Œé›†ç¾¤çŠ¶æ€ä¼šè‡ªåŠ¨æ¢å¤ï¼š</p><ol><li>å½“å°‘æ•°èŠ‚ç‚¹ä¸å¯ç”¨æ—¶</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.124:2379 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br><br># åœæ­¢etcd-3æ¨¡æ‹Ÿé›†ç¾¤ä¸­å°‘æ•°èŠ‚ç‚¹æ•…éšœ<br>[root@duduniao etcd]# ssh 10.4.7.124 &quot;systemctl stop etcd&quot;<br># èŠ‚ç‚¹çŠ¶æ€æ­£å¸¸<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.124:2379 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 endpoint health --write-out table<br>+-------------------------+--------+----------+-------+<br>|        ENDPOINT         | HEALTH |   TOOK   | ERROR |<br>+-------------------------+--------+----------+-------+<br>| https://10.4.7.121:2379 |   true | 6.6047ms |       |<br>+-------------------------+--------+----------+-------+<br><br># é›†ç¾¤è¯»å†™æ­£å¸¸<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 put k1 v1<br>OK<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 get k1<br>k1<br>v1<br></code></pre></td></tr></table></figure><ol><li>æ¨¡æ‹Ÿå¤šæ•°èŠ‚ç‚¹å®•æœº</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ssh 10.4.7.122 &quot;systemctl stop etcd&quot;<br><br># èŠ‚ç‚¹çŠ¶æ€å¼‚å¸¸ï¼Œé›†ç¾¤çŠ¶æ€å¼‚å¸¸<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 endpoint health --write-out table<br>&#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:1634910316.3861823,&quot;logger&quot;:&quot;client&quot;,&quot;caller&quot;:&quot;v3/retry_interceptor.go:62&quot;,&quot;msg&quot;:&quot;retrying of unary invoker failed&quot;,&quot;target&quot;:&quot;etcd-endpoints://0xc0004308c0/10.4.7.121:2379&quot;,&quot;attempt&quot;:0,&quot;error&quot;:&quot;rpc error: code = DeadlineExceeded desc = context deadline exceeded&quot;&#125;<br>+-------------------------+--------+-----------+---------------------------+<br>|        ENDPOINT         | HEALTH |   TOOK    |           ERROR           |<br>+-------------------------+--------+-----------+---------------------------+<br>| https://10.4.7.121:2379 |  false | 5.001016s | context deadline exceeded |<br>+-------------------------+--------+-----------+---------------------------+<br>Error: unhealthy cluster<br><br># èŠ‚ç‚¹è¯»å†™æŠ¥é”™<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 put k1 v1<br>&#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2021-10-22T21:46:29.288+0800&quot;,&quot;logger&quot;:&quot;etcd-client&quot;,&quot;caller&quot;:&quot;v3/retry_interceptor.go:62&quot;,&quot;msg&quot;:&quot;retrying of unary invoker failed&quot;,&quot;target&quot;:&quot;etcd-endpoints://0xc000622540/10.4.7.121:2379&quot;,&quot;attempt&quot;:0,&quot;error&quot;:&quot;rpc error: code = DeadlineExceeded desc = context deadline exceeded&quot;&#125;<br>Error: context deadline exceeded<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 get k1<br>&#123;&quot;level&quot;:&quot;warn&quot;,&quot;ts&quot;:&quot;2021-10-22T21:46:13.352+0800&quot;,&quot;logger&quot;:&quot;etcd-client&quot;,&quot;caller&quot;:&quot;v3/retry_interceptor.go:62&quot;,&quot;msg&quot;:&quot;retrying of unary invoker failed&quot;,&quot;target&quot;:&quot;etcd-endpoints://0xc0004348c0/10.4.7.121:2379&quot;,&quot;attempt&quot;:0,&quot;error&quot;:&quot;rpc error: code = DeadlineExceeded desc = context deadline exceeded&quot;&#125;<br>Error: context deadline exceeded<br></code></pre></td></tr></table></figure><ol><li>æ¨¡æ‹Ÿå¤šæ•°èŠ‚ç‚¹é¡ºåˆ©å¯åŠ¨</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ssh 10.4.7.124 &quot;systemctl start etcd&quot;<br><br># é›†ç¾¤çŠ¶æ€å’ŒèŠ‚ç‚¹çŠ¶æ€æ­£å¸¸<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 endpoint health --write-out table<br>+-------------------------+--------+----------+-------+<br>|        ENDPOINT         | HEALTH |   TOOK   | ERROR |<br>+-------------------------+--------+----------+-------+<br>| https://10.4.7.121:2379 |   true | 6.8057ms |       |<br>+-------------------------+--------+----------+-------+<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 4fe2b98ed7b794f7 | started | etcd-3 | https://10.4.7.124:2379 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 put k1 v1<br>OK<br></code></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°ä¸€ç§æç«¯æƒ…å†µï¼Œå½“å¤§éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•å¯åŠ¨etcdï¼Œéœ€è¦ä»å¿«ç…§æˆ–è€…å†å²å¤‡ä»½ä¸­æ¢å¤æ•°æ®ï¼Œå¹¶ç»„å»ºä¸€ä¸ªæ–°çš„é›†ç¾¤ï¼š</p><ol><li>åœæ­¢å¤§éƒ¨åˆ†èŠ‚ç‚¹ï¼Œä½¿å¾—é›†ç¾¤æ— æ³•å¯¹å¤–æä¾›æœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ssh 10.4.7.122 &quot;systemctl stop etcd&quot;<br>[root@duduniao etcd]# ssh 10.4.7.124 &quot;systemctl stop etcd&quot;<br></code></pre></td></tr></table></figure><ol><li>ä»å¯ç”¨èŠ‚ç‚¹ç”ŸæˆV3çš„å¿«ç…§ï¼Œå¦‚æœå…¨éƒ¨èŠ‚ç‚¹ä¸å¯ç”¨åˆ™ä»etcdçš„æ•°æ®ç›®å½•ä¸‹æ‰¾åˆ°<code>member/snap/db</code>è¿›è¡Œæ¢å¤ï¼Œæˆ–è€…ä»å†å²å¤‡ä»½æ¢å¤</li></ol><p>v2ç‰ˆæœ¬çš„æ¢å¤æ–¹å¼å’Œv3ä¸å¤ªä¸€æ ·ï¼Œå¯å‚è€ƒ<a href="https://etcd.io/docs/v2.3/admin_guide#disaster-recovery">å®˜æ–¹æ–‡æ¡£</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ETCDCTL_API=3 etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 snapshot save snapshot.db<br>[root@duduniao etcd]# ll -h snapshot.db<br>-rw------- 1 root root 21K 2021-10-22 22:08:43 snapshot.d<br></code></pre></td></tr></table></figure><ol><li>åœæ­¢èŠ‚ç‚¹ä¸Šetcdè¿›ç¨‹ï¼Œæ¸…ç†å†å²æ•°æ®ç›®å½•</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# ssh 10.4.7.121 &quot;systemctl stop etcd ; mv /data/etcd/data /data/etcd/data.20211022.bak&quot;<br>[root@duduniao etcd]# ssh 10.4.7.122 &quot;systemctl stop etcd ; mv /data/etcd/data /data/etcd/data.20211022.bak&quot;<br>[root@duduniao etcd]# ssh 10.4.7.124 &quot;systemctl stop etcd ; mv /data/etcd/data /data/etcd/data.20211022.bak&quot;<br><br>[root@duduniao etcd]# scp snapshot.db 10.4.7.121:/tmp/<br>[root@duduniao etcd]# scp snapshot.db 10.4.7.122:/tmp/<br>[root@duduniao etcd]# scp snapshot.db 10.4.7.124:/tmp/<br></code></pre></td></tr></table></figure><ol><li>é‡å»ºé›†ç¾¤</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plain">root@ubuntu-1804-121:~# ETCDCTL_API=3 etcdctl snapshot restore /tmp/snapshot.db --data-dir /data/etcd/data --initial-advertise-peer-urls https://10.4.7.121:2380 --initial-cluster etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380,etcd-3=https://10.4.7.124:2380 --initial-cluster-token etcd-cluster-1 --name etcd-1<br>root@ubuntu-1804-122:~# ETCDCTL_API=3 etcdctl snapshot restore /tmp/snapshot.db --data-dir /data/etcd/data --initial-advertise-peer-urls https://10.4.7.122:2380 --initial-cluster etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380,etcd-3=https://10.4.7.124:2380 --initial-cluster-token etcd-cluster-1 --name etcd-2<br>root@ubuntu-1804-124:~# ETCDCTL_API=3 etcdctl snapshot restore /tmp/snapshot.db --data-dir /data/etcd/data --initial-advertise-peer-urls https://10.4.7.124:2380 --initial-cluster etcd-1=https://10.4.7.121:2380,etcd-2=https://10.4.7.122:2380,etcd-3=https://10.4.7.124:2380 --initial-cluster-token etcd-cluster-1 --name etcd-3<br><br>root@ubuntu-1804-121:~# systemctl start etcd<br>root@ubuntu-1804-122:~# systemctl start etcd<br>root@ubuntu-1804-124:~# systemctl start etcd<br># éªŒè¯é›†ç¾¤<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 member list --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 8bb2a873a59fd89b | started | etcd-3 | https://10.4.7.124:2380 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>[root@duduniao etcd]# etcdctl --cacert ssl/ca.pem --cert ssl/client.pem --key ssl/client-key.pem --endpoints https://10.4.7.121:2379 get k1<br>k1<br>v1<br></code></pre></td></tr></table></figure><h2 id="1-5-etcdç‰ˆæœ¬å‡çº§"><a href="#1-5-etcdç‰ˆæœ¬å‡çº§" class="headerlink" title="1.5. etcdç‰ˆæœ¬å‡çº§"></a>1.5. etcdç‰ˆæœ¬å‡çº§</h2><p>åç»­æ¨å‡ºæ–°ç‰ˆæœ¬å‡çº§äº†å†è¡¥å……</p><h2 id="1-6-etcdè¯ä¹¦æ›¿æ¢"><a href="#1-6-etcdè¯ä¹¦æ›¿æ¢" class="headerlink" title="1.6. etcdè¯ä¹¦æ›¿æ¢"></a>1.6. etcdè¯ä¹¦æ›¿æ¢</h2><p>etcdçš„è¯ä¹¦æ›¿æ¢åˆ†ä¸ºå››ç§ç±»å‹ï¼š</p><ol><li>server è¯ä¹¦æ›´æ¢ï¼šä»v3.2.0å¼€å§‹ï¼Œæ¯ä¸ªè¯·æ±‚ä¼šé‡è½½è¯ä¹¦ï¼Œå› æ­¤è¯ä¹¦æ›¿æ¢ä¼šå˜å¾—éå¸¸æ–¹ä¾¿</li><li>peer è¯ä¹¦æ›´æ¢ï¼šä»v3.2.0å¼€å§‹ï¼Œæ¯ä¸ªè¯·æ±‚ä¼šé‡è½½è¯ä¹¦ï¼Œå› æ­¤è¯ä¹¦æ›¿æ¢ä¼šå˜å¾—éå¸¸æ–¹ä¾¿</li><li>ca è¯ä¹¦æ›´æ¢: caè¯ä¹¦çš„æ›¿æ¢ä¼šå˜å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦åœæœç»´æŠ¤ï¼Œåšå¥½å‰æœŸå‡†å¤‡å·¥ä½œï¼Œåœæœæ—¶é—´åœ¨1åˆ†é’Ÿä»¥å†…</li></ol><p>ä¸Šè¿°çš„ç¬¬ä¸€å’Œç¬¬äºŒç§æƒ…å†µå¾ˆå®¹æ˜“å¤„ç†ï¼Œç­¾å‘è¯ä¹¦ç›´æ¥ä¸‹å‘å³å¯ï¼Œè€ç‰ˆæœ¬çš„etcdå¯ç”¨é€ä¸ªé‡å¯æœåŠ¡ã€‚ä»¥ä¸‹é’ˆå¯¹ç¬¬ä¸‰ç§æƒ…å†µè¿›è¡Œæ“ä½œï¼š</p><ol><li><p>ç”Ÿæˆæ–°çš„è¯ä¹¦</p></li><li><p>ä¸‹å‘è¯ä¹¦ï¼Œå¹¶é‡å¯etcd</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.124 &quot;cp -r /data/etcd/ssl /data/etcd/ssl-20211021.bak&quot;<br>[root@duduniao ssl-new]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.124 &quot;mkdir /data/etcd/ssl-new&quot;<br>[root@duduniao ssl-new]# scp ca.pem server.pem server-key.pem etcd-1.pem etcd-1-key.pem 10.4.7.121:/data/etcd/ssl-new/<br>[root@duduniao ssl-new]# scp ca.pem server.pem server-key.pem etcd-2.pem etcd-2-key.pem 10.4.7.122:/data/etcd/ssl-new/<br>[root@duduniao ssl-new]# scp ca.pem server.pem server-key.pem etcd-3.pem etcd-3-key.pem 10.4.7.124:/data/etcd/ssl-new/<br><br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.124 &quot;systemctl stop etcd &quot;<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.124 &quot;rm -fr /data/etcd/ssl ; mv /data/etcd/ssl-new /data/etcd/ssl&quot;<br>[root@duduniao etcd]# scan_host.sh cmd -h 10.4.7.121 10.4.7.122 10.4.7.124 &quot;systemctl start etcd &quot;<br>[root@duduniao etcd]# etcdctl --cacert ssl-new/ca.pem --cert ssl-new/client.pem --key ssl-new/client-key.pem --endpoints https://10.4.7.121:2379 member list --write-out table<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>|        ID        | STATUS  |  NAME  |       PEER ADDRS        |      CLIENT ADDRS       | IS LEARNER |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>| 8bb2a873a59fd89b | started | etcd-3 | https://10.4.7.124:2380 | https://10.4.7.124:2379 |      false |<br>| bbd6739258f69625 | started | etcd-1 | https://10.4.7.121:2380 | https://10.4.7.121:2379 |      false |<br>| c5542f3740ec56cd | started | etcd-2 | https://10.4.7.122:2380 | https://10.4.7.122:2379 |      false |<br>+------------------+---------+--------+-------------------------+-------------------------+------------+<br>[root@duduniao etcd]# etcdctl --cacert ssl-new/ca.pem --cert ssl-new/client.pem --key ssl-new/client-key.pem --endpoints https://10.4.7.121:2379 endpoint status --write-out table<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|        ENDPOINT         |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://10.4.7.121:2379 | bbd6739258f69625 |   3.5.1 |   20 kB |     false |      false |         7 |         37 |                 37 |        |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>[root@duduniao etcd]# etcdctl --cacert ssl-new/ca.pem --cert ssl-new/client.pem --key ssl-new/client-key.pem --endpoints https://10.4.7.122:2379 endpoint status --write-out table<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|        ENDPOINT         |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://10.4.7.122:2379 | c5542f3740ec56cd |   3.5.1 |   20 kB |     false |      false |         7 |         37 |                 37 |        |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>[root@duduniao etcd]# etcdctl --cacert ssl-new/ca.pem --cert ssl-new/client.pem --key ssl-new/client-key.pem --endpoints https://10.4.7.124:2379 endpoint status --write-out table<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|        ENDPOINT         |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://10.4.7.124:2379 | 8bb2a873a59fd89b |   3.5.1 |   20 kB |      true |      false |         7 |         37 |                 37 |        |<br>+-------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br></code></pre></td></tr></table></figure><hr><h1 id="2-å¤‡ä»½å’Œæ¢å¤"><a href="#2-å¤‡ä»½å’Œæ¢å¤" class="headerlink" title="2. å¤‡ä»½å’Œæ¢å¤"></a>2. å¤‡ä»½å’Œæ¢å¤</h1><p>å¤§éƒ¨åˆ†etcdé›†ç¾¤çš„æ•°æ®éƒ½æ˜¯å¾ˆå°çš„ï¼Œå¯ä»¥è€ƒè™‘æ¯ä¸ªå°æ—¶å¤‡ä»½ä¸€æ¬¡ï¼Œåªéœ€è¦ä»ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤‡ä»½å³å¯ï¼Œä¸éœ€è¦æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œå¤‡ä»½ã€‚æ•°æ®æ¢å¤æ˜¯æŒ‡é€šè¿‡ç°æœ‰çš„å¿«ç…§æ•°æ®ï¼Œé‡æ–°å»ºç«‹é›†ç¾¤ï¼Œå¤‡ä»½å’Œæ¢å¤çš„æ–¹å¼å¯ä»¥å‚è€ƒ 1.4. é›†ç¾¤ç¾éš¾æ¢å¤ã€‚</p><h3>åŸæ–‡æ¥è‡ªï¼šè¿ç»´æ¸¡æ¸¡é¸Ÿ</h3>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‘åŸç”ŸEtcd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JenkinsåŸºäºk8så®¹å™¨åŒ–æ„å»ºPipline</title>
    <link href="/2025/03/19/Jenkins%E5%9F%BA%E4%BA%8Ek8s%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BAPipline/"/>
    <url>/2025/03/19/Jenkins%E5%9F%BA%E4%BA%8Ek8s%E5%AE%B9%E5%99%A8%E5%8C%96%E6%9E%84%E5%BB%BAPipline/</url>
    
    <content type="html"><![CDATA[<p>jenkinsä½¿ç”¨kubernetesæ’ä»¶å¯ä»¥å®ç°ï¼ŒåŠ¨æ€åˆ›å»ºæµæ°´çº¿ç›¸å…³çš„ä»»åŠ¡Podåœ¨æµæ°´çº¿æ‰§è¡Œç»“æŸåä¼šåˆ é™¤ç›¸åº”çš„ä»»åŠ¡Podä»¥è¾¾åˆ°èµ„æºçš„é‡Šæ”¾ã€‚</p><p><strong>å…·ä½“kubernetesçš„agentä½¿ç”¨è¯¦è§£</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs json">pipeline <span class="hljs-punctuation">&#123;</span><br>  agent <span class="hljs-punctuation">&#123;</span><br>    kubernetes <span class="hljs-punctuation">&#123;</span> <br>      cloud &#x27;kubernetes&#x27;  <span class="hljs-comment">//è¿™é‡Œéœ€è¦æŒ‡å®šç›¸å…³jenkinsä¸­åˆ›å»ºçš„kuberneteså¯¹æ¥ä¿¡æ¯çš„åç§°</span><br>      slaveConnectTimeout <span class="hljs-number">1200</span>  <span class="hljs-comment">//è¶…æ—¶é…ç½®</span><br>      workspaceVolume emptyDirWorkspaceVolume()  <span class="hljs-comment">//jenkinsçš„å·¥ä½œç›®å½•ï¼Œå¿…é¡»è®¾ç½®èµ·åˆ°ä¸€ä¸ªPodä¸­ä¸åŒcontainerçš„ç›®å½•å…±äº«jenkinså·¥ä½œç›®å½•</span><br>      yaml &#x27;&#x27;&#x27;  <span class="hljs-comment">//è¿™é‡Œä»¥ä¸‹éƒ½æ˜¯Podå®šä¹‰ä¿¡æ¯</span><br>kind<span class="hljs-punctuation">:</span> Pod<br>metadata<span class="hljs-punctuation">:</span><br>  name<span class="hljs-punctuation">:</span> jenkins-agent<br>  namespace<span class="hljs-punctuation">:</span> jenkins<br>spec<span class="hljs-punctuation">:</span><br>  containers<span class="hljs-punctuation">:</span> <br>  - args<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\&#x27;$(JENKINS_SECRET)\&#x27;<span class="hljs-punctuation">,</span> \&#x27;$(JENKINS_NAME)\&#x27;<span class="hljs-punctuation">]</span><br>    image<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.15</span>/kubernetes/jnlp<span class="hljs-punctuation">:</span>alpine&#x27;<br>    name<span class="hljs-punctuation">:</span> jnlp        <span class="hljs-comment">//jnlpå®¹å™¨æ˜¯å¿…é¡»çš„ä»–è´Ÿè´£è¿æ¥jenkinsï¼Œè¿™é‡Œä¿æŒé»˜è®¤ä½¿ç”¨å³å¯</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> IfNotPresent<br><span class="hljs-comment">//ä»¥ä¸‹å®¹å™¨ä¸ºå…·ä½“çš„å·¥ä½œå®¹å™¨ï¼Œæ‰€æœ‰æµæ°´çº¿ä¸­çš„ä»»ä½•é˜¶æ®µçš„ä»»åŠ¡éƒ½åœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªåœ¨æµæ°´çº¿ä¸­æŒ‡å®šä»»åŠ¡ä½¿ç”¨é‚£ä¸ªå®¹å™¨è¿›è¡Œæ‰§è¡Œ</span><br>  - command<span class="hljs-punctuation">:</span>   <span class="hljs-comment">//æ‰€æœ‰å®¹å™¨æ¨èä½¿ç”¨catå‘½ä»¤ä¿è¯å®¹å™¨åœ¨å¯åŠ¨åä¿æŒè¿è¡Œä¸é€€å‡º   </span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  <span class="hljs-comment">//ä¿æŒttyï¼Œèµ·åˆ°å®¹å™¨ä¸é€€å‡º</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/bash/alpine:latest&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo&quot;</span>  <span class="hljs-comment">//containerçš„åç§°</span><br>  restartPolicy<span class="hljs-punctuation">:</span> Never<br><span class="hljs-comment">// åœ¨k8sä¸Šçš„èŠ‚ç‚¹ä¸Šæ‰“ä¸Šlabelï¼Œè¿™é‡Œçš„nodeselectorå°±æ˜¯é€‰æ‹©æ‰“äº†å¯¹åº”æ ‡ç­¾çš„node</span><br>  nodeSelector<span class="hljs-punctuation">:</span>  <br>    build<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <br>&#x27;&#x27;&#x27;<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…·ä½“æµæ°´çº¿é…ç½®</span><br>  stages <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">//è¿™é‡Œä¸ºæµæ°´çº¿å®šä¹‰</span><br>    stage(&#x27;echo&#x27;) <span class="hljs-punctuation">&#123;</span>   <span class="hljs-comment">//stageåç§°</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;echo&#x27;) <span class="hljs-punctuation">&#123;</span>   <span class="hljs-comment">//è¿™é‡Œå®šä¹‰è¿™ä¸ªæ­¥éª¤ä½¿ç”¨é‚£ä¸ªcontainerè¿›è¡Œæ‰§è¡Œï¼ŒæŒ‡å®šcontainerçš„åç§°</span><br>          sh <span class="hljs-string">&quot;echo hello word&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>   <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="1-1-ç›¸å…³é•œåƒå‡†å¤‡"><a href="#1-1-ç›¸å…³é•œåƒå‡†å¤‡" class="headerlink" title="1.1 ç›¸å…³é•œåƒå‡†å¤‡"></a>1.1 ç›¸å…³é•œåƒå‡†å¤‡</h2><p>æœ‰äº›é•œåƒéœ€è‡ªå·±å‡†å¤‡ï¼Œå¦‚dockeré•œåƒç”¨äºæ„å»ºdockeré•œåƒï¼Œkubectlé•œåƒç”¨äºè¿æ¥k8sè¿›è¡ŒæœåŠ¡æ›´æ–°ã€‚å…¶ä½™é•œåƒä½¿ç”¨å®˜æ–¹é•œåƒå³å¯ï¼Œä½†æ˜¯å‰ææ˜¯å¿…é¡»è¦æœ‰ä¸€ä¸ªjnlpçš„é•œåƒï¼Œç”¨äºè¿æ¥jenkinsçš„masterã€‚</p><h3 id="1-dockeré•œåƒ"><a href="#1-dockeré•œåƒ" class="headerlink" title="1.dockeré•œåƒ"></a>1.dockeré•œåƒ</h3><p><strong>é•œåƒæ„å»º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#ç›´æ¥ä½¿ç”¨alpineé•œåƒæ‹·è´dockeräºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶åˆ°å®¹å™¨å³å¯</span><br>[17:38:58 root@nexus docker]#<span class="hljs-built_in">cat</span> Dockerfile <br>FROM 192.168.10.254:5000/bash/alpine:latest<br>COPY docker /usr/bin/<br><span class="hljs-comment">#æ„å»º</span><br>docker build -t 192.168.10.254:5000/kubernetes/docker:alpine .<br></code></pre></td></tr></table></figure><p><strong>jenkinsä¸­éªŒè¯</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs json">pipeline <span class="hljs-punctuation">&#123;</span><br>  agent <span class="hljs-punctuation">&#123;</span><br>    kubernetes <span class="hljs-punctuation">&#123;</span> <br>      cloud &#x27;kubernetes&#x27;  <br>      slaveConnectTimeout <span class="hljs-number">1200</span> <br>      workspaceVolume emptyDirWorkspaceVolume()   <span class="hljs-comment">//  ç›¸å½“äºk8så·å½“ä¸­çš„emptdir()</span><br>      yaml &#x27;&#x27;&#x27;<br>kind<span class="hljs-punctuation">:</span> Pod<br>metadata<span class="hljs-punctuation">:</span><br>  name<span class="hljs-punctuation">:</span> jenkins-agent<br>  namespace<span class="hljs-punctuation">:</span> jenkins<br>spec<span class="hljs-punctuation">:</span><br>  containers<span class="hljs-punctuation">:</span> <br>  - args<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\&#x27;$(JENKINS_SECRET)\&#x27;<span class="hljs-punctuation">,</span> \&#x27;$(JENKINS_NAME)\&#x27;<span class="hljs-punctuation">]</span><br>    image<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.15</span>/kubernetes/jnlp<span class="hljs-punctuation">:</span>alpine&#x27;<br>    name<span class="hljs-punctuation">:</span> jnlp  <br>    imagePullPolicy<span class="hljs-punctuation">:</span> IfNotPresent<br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.15/kubernetes/docker:alpine&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;docker&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-comment">// å°†æœ¬åœ°çš„docker.sockæ˜ å°„åˆ°å®¹å™¨å½“ä¸­ï¼Œå®¹å™¨å½“ä¸­å°±èƒ½ä½¿ç”¨dockerç›¸å…³çš„å‘½ä»¤ï¼Œç›¸å½“äºæ˜¯æ“ä½œå®¿ä¸»æœºæœ¬åœ°çš„dockerï¼Œæ„å»ºå¥½çš„é•œåƒä¹Ÿæ˜¯æœ¬åœ°çš„ã€‚</span><br>    volumeMounts<span class="hljs-punctuation">:</span><br>    - mountPath<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>      name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span><br>      readOnly<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  volumes<span class="hljs-punctuation">:</span>   <br>  #æ³¨æ„dockerå®¹å™¨å¿…é¡»è¢«è°ƒåº¦åˆ°å­˜åœ¨dockerçš„k8sèŠ‚ç‚¹ï¼Œå¹¶ä¸”æŒ‚è½½ä¸»æœºçš„docker.sockæ–‡ä»¶åˆ°å®¹å™¨<br>  - hostPath<span class="hljs-punctuation">:</span><br>      path<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span><br>  restartPolicy<span class="hljs-punctuation">:</span> Never <br>  nodeSelector<span class="hljs-punctuation">:</span>  <br>    build<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <br>&#x27;&#x27;&#x27;<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  stages <span class="hljs-punctuation">&#123;</span><br>    stage(&#x27;docker info&#x27;) <span class="hljs-punctuation">&#123;</span>   <br>      steps <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">// ä½¿ç”¨k8s å½“ä¸­çš„docker é•œåƒå®¹å™¨è¿›è¡Œæ“ä½œ</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;docker&#x27;) <span class="hljs-punctuation">&#123;</span>  <br>          sh <span class="hljs-string">&quot;docker info&quot;</span>    <span class="hljs-comment">//æ‰§è¡Œdocker infoæœ‰æ­£å¸¸è¾“å‡ºå³å¯</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="2-kubectlé•œåƒ"><a href="#2-kubectlé•œåƒ" class="headerlink" title="2.kubectlé•œåƒ"></a>2.kubectlé•œåƒ</h3><p><strong>é•œåƒæ„å»º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[17:46:21 root@nexus kubectl]#<span class="hljs-built_in">cat</span> Dockerfile <br>FROM 192.168.10.254:5000/bash/alpine:latest<br><span class="hljs-comment"># è¿™é‡Œå¤åˆ¶çš„æ˜¯ä¸€ä¸ªkubeletçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé…åˆkubeconfigè¿›è¡Œä½¿ç”¨</span><br>COPY kubectl /usr/bin/<br><span class="hljs-comment">#æ„å»º</span><br>[17:46:01 root@nexus kubectl]#docker build -t 192.168.10.254:5000/kubernetes/kubectl:alpine .<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨éªŒè¯</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs json">pipeline <span class="hljs-punctuation">&#123;</span><br>  agent <span class="hljs-punctuation">&#123;</span><br>    kubernetes <span class="hljs-punctuation">&#123;</span> <br>      cloud &#x27;kubernetes&#x27;  <span class="hljs-comment">//è¿™é‡Œéœ€è¦æŒ‡å®šç›¸å…³jenkinsä¸­åˆ›å»ºçš„kuberneteså¯¹æ¥ä¿¡æ¯çš„åç§°</span><br>      slaveConnectTimeout <span class="hljs-number">1200</span>  <span class="hljs-comment">//è¶…æ—¶é…ç½®</span><br>      workspaceVolume emptyDirWorkspaceVolume()  <span class="hljs-comment">//jenkinsçš„å·¥ä½œç›®å½•ï¼Œå¿…é¡»è®¾ç½®èµ·åˆ°ä¸€ä¸ªPodä¸­ä¸åŒcontainerçš„ç›®å½•å…±äº«jenkinså·¥ä½œç›®å½•</span><br>      yaml &#x27;&#x27;&#x27;<br>kind<span class="hljs-punctuation">:</span> Pod<br>metadata<span class="hljs-punctuation">:</span><br>  name<span class="hljs-punctuation">:</span> jenkins-agent<br>  namespace<span class="hljs-punctuation">:</span> jenkins<br>spec<span class="hljs-punctuation">:</span><br>  containers<span class="hljs-punctuation">:</span> <br>  - args<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\&#x27;$(JENKINS_SECRET)\&#x27;<span class="hljs-punctuation">,</span> \&#x27;$(JENKINS_NAME)\&#x27;<span class="hljs-punctuation">]</span><br>    image<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.15</span>/kubernetes/jnlp<span class="hljs-punctuation">:</span>alpine&#x27;<br>    name<span class="hljs-punctuation">:</span> jnlp  <br>    imagePullPolicy<span class="hljs-punctuation">:</span> IfNotPresent<br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/kubectl:alpine&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kubectl&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  restartPolicy<span class="hljs-punctuation">:</span> Never <br>  nodeSelector<span class="hljs-punctuation">:</span>  <br>    build<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <br>&#x27;&#x27;&#x27;<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…·ä½“æµæ°´çº¿é…ç½®</span><br>  stages <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">//è¿™é‡Œä¸ºæµæ°´çº¿å®šä¹‰</span><br>    stage(&#x27;kubectl get&#x27;) <span class="hljs-punctuation">&#123;</span>   <span class="hljs-comment">//stageåç§°</span><br>      <span class="hljs-comment">// ä½¿ç”¨credentialsåŠ è½½kubeconfigé…ç½®æ–‡ä»¶</span><br>      environment <span class="hljs-punctuation">&#123;</span><br>        MY_KUBECONFIG = credentials(&#x27;kubernetes-cluster&#x27;)<br>      <span class="hljs-punctuation">&#125;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;kubectl&#x27;) <span class="hljs-punctuation">&#123;</span>   <span class="hljs-comment">//è¿™é‡Œå®šä¹‰è¿™ä¸ªæ­¥éª¤ä½¿ç”¨é‚£ä¸ªcontainerè¿›è¡Œæ‰§è¡Œï¼ŒæŒ‡å®šcontainerçš„åç§°</span><br>          sh <span class="hljs-string">&quot;kubectl get pod -A --kubeconfig $MY_KUBECONFIG&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h1 id="äºŒã€è‡ªåŠ¨åŒ–æ„å»º-Java-åº”ç”¨"><a href="#äºŒã€è‡ªåŠ¨åŒ–æ„å»º-Java-åº”ç”¨" class="headerlink" title="äºŒã€è‡ªåŠ¨åŒ–æ„å»º Java åº”ç”¨"></a>äºŒã€è‡ªåŠ¨åŒ–æ„å»º Java åº”ç”¨</h1><h2 id="1-æµæ°´çº¿ç»“æ„"><a href="#1-æµæ°´çº¿ç»“æ„" class="headerlink" title="1.æµæ°´çº¿ç»“æ„"></a>1.æµæ°´çº¿ç»“æ„</h2><p><img src="https://www.t-ao.cn/usr/uploads/2024/07/460127944.png" alt="48616-wxdhj40oko.png"><br>æ³¨æ„è¿™é‡Œçš„Jenkinsfileä¸Dockerfileæ–‡ä»¶éƒ½å­˜æ”¾åœ¨gitä»“åº“ä¸­ã€‚javaåº”ç”¨ä¼šä½¿ç”¨mvnè¿›è¡Œæ‰“åŒ…ï¼Œmvnä¼šä¸‹è½½ä¸€ç³»åˆ—ä¾èµ–çš„åŒ…ï¼Œé»˜è®¤ä¼šä¸‹è½½åˆ°mvnå®¹å™¨çš„**&#x2F;root&#x2F;.m2**ç›®å½•æœ€å¥½ä½¿ç”¨volumeè¿›è¡ŒæŒä¹…åŒ–ã€‚</p><h2 id="2-éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“"><a href="#2-éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“" class="headerlink" title="2.éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“"></a>2.éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“</h2><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/AdlerED/bolo-solo">https://github.com/AdlerED/bolo-solo</a><br><img src="https://www.t-ao.cn/usr/uploads/2024/07/3433033418.png" alt="68302-21ztfgmuost.png"></p><h2 id="3-Jenkinsfileæ–‡ä»¶"><a href="#3-Jenkinsfileæ–‡ä»¶" class="headerlink" title="3.Jenkinsfileæ–‡ä»¶"></a>3.Jenkinsfileæ–‡ä»¶</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs json">pipeline <span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">//é¡¶å±‚ç¯å¢ƒå˜é‡è®¾ç½®</span><br>  environment <span class="hljs-punctuation">&#123;</span><br>    namespace = <span class="hljs-string">&quot;bolo&quot;</span>                     <span class="hljs-comment">//æœåŠ¡éƒ¨ç½²åœ¨é‚£ä¸ªnamespaceä¸­</span><br>    registries = <span class="hljs-string">&quot;192.168.10.15/bolo&quot;</span>      <span class="hljs-comment">//ç”Ÿæˆé•œåƒå­˜æ”¾é•œåƒçš„ä»“åº“åœ°å€</span><br>    GIT = <span class="hljs-string">&quot;git@192.168.10.14:kubernetes/bolo-solo.git&quot;</span>  <span class="hljs-comment">//ä»£ç ä»“åº“åœ°å€</span><br>    TAG = <span class="hljs-string">&quot;&quot;</span>                               <span class="hljs-comment">//é•œåƒtag,ä¼šåœ¨ä¸‹é¢ç”Ÿæˆ,è¿™é‡Œåªæ˜¯å®šä¹‰å…¨å±€å˜é‡</span><br>    NANE = <span class="hljs-string">&quot;&quot;</span>                              <span class="hljs-comment">//jenkinsé¡¹ç›®åç§°,ä¼šåœ¨ä¸‹é¢ç”Ÿæˆ,è¿™é‡Œåªæ˜¯å®šä¹‰å…¨å±€å˜é‡</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…¨å±€é…ç½®</span><br>  options <span class="hljs-punctuation">&#123;</span><br>    timestamps()                     <span class="hljs-comment">//æ‰€æœ‰è¾“å‡ºæ¯è¡Œéƒ½ä¼šæ‰“å°æ—¶é—´æˆ³</span><br>    buildDiscarder(logRotator(numToKeepStr<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">5</span>&#x27;))  <span class="hljs-comment">//ä¿ç•™5ä¸ªå†å²æ„å»ºç‰ˆæœ¬</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//æ‰‹åŠ¨æ„å»ºæ—¶é€‰æ‹©åˆ†æ”¯å‚æ•°</span><br>  parameters <span class="hljs-punctuation">&#123;</span> <br>    gitParameter(branch<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> branchFilter<span class="hljs-punctuation">:</span> &#x27;origin/(.*)&#x27;<span class="hljs-punctuation">,</span> defaultValue<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> description<span class="hljs-punctuation">:</span> &#x27;Branch for build and deploy&#x27;<span class="hljs-punctuation">,</span> name<span class="hljs-punctuation">:</span> &#x27;BRANCH&#x27;<span class="hljs-punctuation">,</span> quickFilterEnabled<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> selectedValue<span class="hljs-punctuation">:</span> &#x27;NONE&#x27;<span class="hljs-punctuation">,</span> sortMode<span class="hljs-punctuation">:</span> &#x27;NONE&#x27;<span class="hljs-punctuation">,</span>  tagFilter<span class="hljs-punctuation">:</span> &#x27;*&#x27;<span class="hljs-punctuation">,</span> type<span class="hljs-punctuation">:</span> &#x27;PT_BRANCH&#x27;)<br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//agenté…ç½®</span><br>  agent <span class="hljs-punctuation">&#123;</span><br>    kubernetes <span class="hljs-punctuation">&#123;</span><br>      cloud &#x27;kubernetes&#x27;<br>      slaveConnectTimeout <span class="hljs-number">1200</span><br>      workspaceVolume emptyDirWorkspaceVolume()   <span class="hljs-comment">//è¿™é‡Œä½¿ç”¨ä¸´æ—¶ç›®å½•å…±äº«jenkinsçš„å·¥ä½œç›®å½•é»˜è®¤è·¯å¾„ä¸º/home/jenkins/agent</span><br>      yaml &#x27;&#x27;&#x27;<br>kind<span class="hljs-punctuation">:</span> Pod<br>metadata<span class="hljs-punctuation">:</span><br>  name<span class="hljs-punctuation">:</span> jenkins-agent<br>  namespace<span class="hljs-punctuation">:</span> jenkins<br>spec<span class="hljs-punctuation">:</span><br>  containers<span class="hljs-punctuation">:</span><br>  - args<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\&#x27;$(JENKINS_SECRET)\&#x27;<span class="hljs-punctuation">,</span> \&#x27;$(JENKINS_NAME)\&#x27;<span class="hljs-punctuation">]</span><br>    image<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.254</span><span class="hljs-punctuation">:</span><span class="hljs-number">5000</span>/kubernetes/jnlp<span class="hljs-punctuation">:</span>alpine&#x27;<br>    name<span class="hljs-punctuation">:</span> jnlp    #è¿™ä¸ªå®¹å™¨å¿…é¡»æœ‰ï¼Œä¿æŒé»˜è®¤å³å¯<br>    imagePullPolicy<span class="hljs-punctuation">:</span> IfNotPresent<br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/maven:3.8.5-openjdk-8-slim&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;maven&quot;</span>  #mavenæ‰“åŒ…é•œåƒ<br>    volumeMounts<span class="hljs-punctuation">:</span>  #æŒä¹…åŒ–ä¾èµ–åŒ…ï¼Œé‡å¤æ„å»ºä¸ä¼šè¿›è¡Œé‡å¤ä¸‹è½½ <br>    - mountPath<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/root/.m2&quot;</span>  <br>      name<span class="hljs-punctuation">:</span> mvn-data<br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/docker:alpine&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;docker&quot;</span>  #dockerå®¹å™¨éœ€è¦æŒ‚è½½docker.sockæ–‡ä»¶ï¼Œéœ€è¦è°ƒåº¦åˆ°æœ‰dockerçš„nodeèŠ‚ç‚¹<br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    volumeMounts<span class="hljs-punctuation">:</span><br>    - mountPath<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>      name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span><br>      readOnly<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/kubectl:apline&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kubectl&quot;</span>  #kubectlé•œåƒ<br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  volumes<span class="hljs-punctuation">:</span>          <br>  - name<span class="hljs-punctuation">:</span> mvn-data<br>    # ç»‘å®šå·²æœ‰çš„pvcç”¨äºåŠ é€Ÿmavençš„æ–‡ä»¶ä¸‹è½½ï¼Œç›¸å½“äºæ˜¯mavençš„ç¼“å­˜<br>    persistentVolumeClaim<span class="hljs-punctuation">:</span>  <br>      claimName<span class="hljs-punctuation">:</span> mvn <br>  - hostPath<span class="hljs-punctuation">:</span><br>      path<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span>  <br>  restartPolicy<span class="hljs-punctuation">:</span> Never<br>  nodeSelector<span class="hljs-punctuation">:</span>   #è¿™é‡Œéœ€è¦ç»™æœ‰dockerçš„nodeèŠ‚ç‚¹æ‰“æ ‡ç­¾è°ƒåº¦Podåˆ°è¿™ä¸ªèŠ‚ç‚¹<br>    build<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <br>&#x27;&#x27;&#x27;<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…·ä½“æµæ°´çº¿é…ç½®</span><br>  stages <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">//å…‹éš†ä»£ç </span><br>    stage(&#x27;git clone&#x27;) <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-comment">//å¹¶è¡Œæ‰§è¡Œ</span><br>      failFast <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  <span class="hljs-comment">//å¹¶è¡Œæ‰§è¡Œçš„åˆ†æ”¯åªè¦æœ‰ä¸€ä¸ªå¤±è´¥ç«‹å³ç»“æŸæµæ°´çº¿</span><br>      parallel <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">//æ‰‹åŠ¨æ‰§è¡Œjenkinsæµæ°´çº¿</span><br>        stage(&#x27;git clone by Jenkins&#x27;) <span class="hljs-punctuation">&#123;</span><br>          when <span class="hljs-punctuation">&#123;</span><br>            expression <span class="hljs-punctuation">&#123;</span><br>             <span class="hljs-comment">// whenè¡¨è¾¾å¼ï¼Œå½“ä¸­ç¯å¢ƒå˜é‡å½“ä¸­çš„gitbranchä¸ºnullçš„æ—¶å€™æ‰§è¡Œä¸‹é¢çš„steps</span><br>              env.gitlabBranch == <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-comment">// åœ¨parameters å½“ä¸­æŒ‡å®šäº†å¯¹åº”çš„branchï¼Œä½¿ç”¨gitlab-keyçš„æ‹‰å–å‡­è¯ã€‚</span><br>            git branch<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;BRANCH&#125;&quot;</span><span class="hljs-punctuation">,</span> credentialsId<span class="hljs-punctuation">:</span> &#x27;gitlab-key&#x27;<span class="hljs-punctuation">,</span> url<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;GIT&#125;&quot;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-comment">// returnStdout è¿”å›æ ‡å‡†è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œç»“æœ echo -n è¡¨ç¤ºä¸æ¢è¡Œ</span><br>              TAG = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;BRANCH&#125;-$&#123;env.BUILD_ID&#125;&quot;</span>)<br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-comment">//gitlabè§¦å‘æ„å»º</span><br>        stage(&#x27;git clone trigger&#x27;) <span class="hljs-punctuation">&#123;</span><br>          when <span class="hljs-punctuation">&#123;</span><br>            expression <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-comment">// å¦‚æœåœ¨æ„å»ºçš„æ—¶å€™ç»™å®šäº†branchçš„æ„å»ºå‚æ•°</span><br>              env.gitlabBranch != <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            git branch<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;env.gitlabBranch&#125;&quot;</span><span class="hljs-punctuation">,</span> credentialsId<span class="hljs-punctuation">:</span> &#x27;gitlab-key&#x27;<span class="hljs-punctuation">,</span> url<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;GIT&#125;&quot;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>              TAG = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;env.gitlabBranch&#125;-$&#123;env.BUILD_ID&#125;&quot;</span>)<br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-comment">//åˆå§‹åŒ–é¡¹ç›®åç§°ï¼Œé¡¹ç›®åç§°ç”¨äºdockeré•œåƒåç§°,ä¸èƒ½æœ‰å¤§å†™å­—æ¯,è½¬ä¹‰</span><br>        stage(&#x27;init env&#x27;) <span class="hljs-punctuation">&#123;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-comment">// å¯¹ç¼–è¯‘çš„jobåç§°è¿›è¡Œå°å†™</span><br>              NAME = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;env.JOB_NAME&#125;&quot;</span>).toLowerCase()<br>            <span class="hljs-punctuation">&#125;</span><br>            sh <span class="hljs-string">&quot;echo $&#123;NAME&#125;&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-comment">//æ‰“åŒ…javaç¨‹åº</span><br>    stage(&#x27;mvn build&#x27;) <span class="hljs-punctuation">&#123;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;maven&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh <span class="hljs-string">&quot;mvn package -DskipTests -Pci&quot;</span><br>          sh <span class="hljs-string">&quot;ls -l&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-comment">//æ„å»ºé•œåƒå¹¶ä¸”æ¨é€é•œåƒä»“åº“</span><br>    stage(&#x27;docker build&#x27;) <span class="hljs-punctuation">&#123;</span><br>      environment <span class="hljs-punctuation">&#123;</span><br>        HARBOR_USER = credentials(&#x27;harbor-account&#x27;)  <span class="hljs-comment">//è·å–é•œåƒä»“åº“è®¤è¯ä¿¡æ¯</span><br>      <span class="hljs-punctuation">&#125;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">// æœ¬æ­¥æ˜¯ä½¿ç”¨äº†ä¸Šé¢agentå½“ä¸­åˆå§‹åŒ–å¥½çš„dockeré•œåƒ</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;docker&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh <span class="hljs-string">&quot;docker login -u $&#123;HARBOR_USER_USR&#125; -p $&#123;HARBOR_USER_PSW&#125; $&#123;registries&#125;&quot;</span><br>            <span class="hljs-comment">// è¿™é‡Œçš„build è¦åŸºäºä¸‹é¢çš„dockerfileè¿›è¡Œæ„å»º</span><br>          sh <span class="hljs-string">&quot;docker build -t $&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125; .&quot;</span><br>          sh <span class="hljs-string">&quot;docker push $&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125;&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>   <span class="hljs-comment">//æ›´æ–°k8sç›¸å…³åº”ç”¨</span><br>    stage(&#x27;update deploy&#x27;) <span class="hljs-punctuation">&#123;</span><br>      environment <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">// åŠ è½½kubeconfigåˆ°ç¯å¢ƒå˜é‡å½“ä¸­</span><br>        MY_KUBECONFIG = credentials(&#x27;kubernetes-cluster&#x27;)<br>      <span class="hljs-punctuation">&#125;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;kubectl&#x27;) <span class="hljs-punctuation">&#123;</span><br>           <span class="hljs-comment">// è¿™é‡Œçš„éƒ¨ç½²æ˜¯ä½¿ç”¨deployå…ˆéƒ¨ç½²å¥½çš„ï¼Œç„¶åè¿›è¡Œé•œåƒæ›´æ–°ï¼Œå®ç°è‡ªåŠ¨æ„å»ºéƒ¨ç½²ï¼Œdeploy æ–‡ä»¶å†…å®¹åœ¨ä¸‹é¢</span><br>          sh <span class="hljs-string">&quot;kubectl get deploy -n $&#123;namespace&#125; -l image=$&#123;NAME&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>          <span class="hljs-comment">// æŒ‡å®šä½¿ç”¨æ–°çš„é•œåƒè¿›è¡Œæ›´æ–°</span><br>          sh <span class="hljs-string">&quot;kubectl set image deploy -n $&#123;namespace&#125; -l image=$&#123;NAME&#125; $&#123;NAME&#125;=$&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>           <span class="hljs-comment">// é‡æ–°å¯åŠ¨deploymentï¼Œè®©deployæ§åˆ¶å™¨æ§åˆ¶çš„podåŠ è½½æ–°æ‰“åŒ…çš„é•œåƒã€‚</span><br>          sh <span class="hljs-string">&quot;kubectl rollout status deployment -n $&#123;namespace&#125; $&#123;NAME&#125; --timeout=60s --kubeconfig $MY_KUBECONFIG&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="4-Dockerfileæ–‡ä»¶"><a href="#4-Dockerfileæ–‡ä»¶" class="headerlink" title="4.Dockerfileæ–‡ä»¶"></a>4.Dockerfileæ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM 192.168.10.254:5000/kubernetes/openjdk:8-alpine<br>WORKDIR /opt/bolo/<br>COPY target/bolo /opt/bolo<br>COPY src/main/resources/docker /opt/bolo/WEB-INF/classes/<br>ENV TZ=Asia/Shanghai<br>EXPOSE 8080<br>ENTRYPOINT [ <span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-cp&quot;</span>, <span class="hljs-string">&quot;WEB-INF/lib/*:WEB-INF/classes&quot;</span>, <span class="hljs-string">&quot;org.b3log.solo.Starter&quot;</span> ]<br></code></pre></td></tr></table></figure><h2 id="5-åˆ›å»ºæµæ°´çº¿"><a href="#5-åˆ›å»ºæµæ°´çº¿" class="headerlink" title="5.åˆ›å»ºæµæ°´çº¿"></a>5.åˆ›å»ºæµæ°´çº¿</h2><p><strong>åˆ›å»ºæµæ°´çº¿</strong><br><img src="https://www.t-ao.cn/usr/uploads/2024/07/3840925103.png" alt="35816-khesyz80aa.png"><br>è¿›è¡Œé…ç½®<br><img src="https://www.t-ao.cn/usr/uploads/2024/07/1296180031.png" alt="05790-0xcztgh1phkq.png"><br><strong>ç¬¬ä¸€æ¬¡éœ€è¿›è¡Œæ„å»ºè¯»å–jenkinsfileæ–‡ä»¶ï¼Œä¼šæŠ¥é”™</strong></p><h2 id="6-éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•"><a href="#6-éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•" class="headerlink" title="6.éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•"></a>6.éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•</h2><p><strong>éƒ¨ç½²ç›¸å…³åº”ç”¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: apps/v1 <br>kind: Deployment    <br>metadata:           <br>  name: bolo      <br>  namespace: bolo<br>  labels:<br>    image: bolo   <span class="hljs-comment">#jenkinsfileä¸­æ›´æ–°æˆ‘ä½¿ç”¨lableè¿›è¡Œç­›é€‰ï¼Œè¿™é‡Œå¿…é¡»è®¾ç½®</span><br>spec:              <br>  replicas: 1  <br>  selector:<br>    matchLabels:     <br>      app: bolo   <br>  template:          <br>    metadata:<br>      creationTimestamp: null<br>      labels:<br>        app: bolo<br>    spec:<br>      containers:<br>      - name: bolo<br>        image: 192.168.10.15/bolo/bolo:jenkins-bolo-23 <br>        args:<br>        - --listen_port=8080 <br>        - --server_scheme=http <br>        - --server_host=192.168.10.13<br>        ports:  <br>        - name: http    <br>          containerPort: 8080    <br>          protocol: TCP <br>        <span class="hljs-built_in">env</span>:    <span class="hljs-comment">#è¿™é‡Œå¦‚æœè¦æ­£å¸¸ä½¿ç”¨éœ€éƒ¨ç½²mysqlæ•°æ®åº“</span><br>        - name: RUNTIME_DB     <br>          value: <span class="hljs-string">&quot;MYSQL&quot;</span><br>        - name: JDBC_DRIVER<br>          value: <span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><br>        - name: JDBC_URL<br>          value: <span class="hljs-string">&quot;jdbc:mysql://mysql:3306/bolo?useUnicode=yes&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true&quot;</span><br>        - name: JDBC_USERNAME<br>          value: <span class="hljs-string">&quot;bolo&quot;</span><br>        - name: JDBC_PASSWORD<br>          value: <span class="hljs-string">&quot;123456&quot;</span><br>---<br>apiVersion: v1     <br>kind: Service      <br>metadata:          <br>  name: bolo    <br>  namespace: bolo  <br>spec:              <br>  ports:           <br>  - name: mysql   <br>    port: 8080      <br>    protocol: TCP  <br>    targetPort: http <br>  selector:        <br>    app: bolo   <br>  <span class="hljs-built_in">type</span>: ClusterIP<br></code></pre></td></tr></table></figure><p><strong>æµ‹è¯•æ‰‹åŠ¨æ‰§è¡Œæµæ°´çº¿</strong><br><img src="https://www.t-ao.cn/usr/uploads/2024/07/3212630026.png" alt="05602-zftwmqilwed.png"></p><h1 id="ä¸‰ã€è‡ªåŠ¨åŒ–æ„å»º-Vue-H5-å‰ç«¯åº”ç”¨"><a href="#ä¸‰ã€è‡ªåŠ¨åŒ–æ„å»º-Vue-H5-å‰ç«¯åº”ç”¨" class="headerlink" title="ä¸‰ã€è‡ªåŠ¨åŒ–æ„å»º Vue&#x2F;H5 å‰ç«¯åº”ç”¨"></a>ä¸‰ã€è‡ªåŠ¨åŒ–æ„å»º Vue&#x2F;H5 å‰ç«¯åº”ç”¨</h1><h2 id="1-æµæ°´çº¿ç»“æ„-1"><a href="#1-æµæ°´çº¿ç»“æ„-1" class="headerlink" title="1.æµæ°´çº¿ç»“æ„"></a>1.æµæ°´çº¿ç»“æ„</h2><p><img src="https://www.t-ao.cn/usr/uploads/2024/07/2097081703.png" alt="42342-e9ltpyddna5.png"><br>æ³¨æ„è¿™é‡Œçš„Jenkinsfileä¸Dockerfileæ–‡ä»¶éƒ½å­˜æ”¾åœ¨gitä»“åº“ä¸­ã€‚Vueåº”ç”¨ä¼šä½¿ç”¨npmè¿›è¡Œæ‰“åŒ…ï¼Œnpmä¼šä¸‹è½½ä¸€ç³»åˆ—ä¾èµ–çš„åŒ…ï¼Œé»˜è®¤ä¼šä¸‹è½½åˆ°npmå®¹å™¨çš„è¿è¡Œnpmçš„ç›®å½•<strong>node_modules</strong>ä¸­æ‰€ä»¥ä¸ºäº†é‡å¤æ„å»ºä¸è¿›è¡Œé‡å¤ä¸‹è½½éœ€è¦æŒä¹…åŒ–ï¼Œè¿™é‡Œæ¨èç›´æ¥æŒä¹…åŒ–jenkinså·¥ä½œç›®å½•å³å¯ã€‚</p><h2 id="2-éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“-1"><a href="#2-éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“-1" class="headerlink" title="2.éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“"></a>2.éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“</h2><p>æºç ä»“åº“ï¼š<a href="https://github.com/SD-Gaming/Vue3-Todo-List-AddName">https://github.com/SD-Gaming/Vue3-Todo-List-AddName</a></p><h2 id="3-Jenkinsfileæ–‡ä»¶-1"><a href="#3-Jenkinsfileæ–‡ä»¶-1" class="headerlink" title="3.Jenkinsfileæ–‡ä»¶"></a>3.Jenkinsfileæ–‡ä»¶</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs json">pipeline <span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">//é¡¶å±‚ç¯å¢ƒå˜é‡è®¾ç½®</span><br>  environment <span class="hljs-punctuation">&#123;</span><br>    namespace = <span class="hljs-string">&quot;bolo&quot;</span>                      <span class="hljs-comment">//æœåŠ¡éƒ¨ç½²åœ¨é‚£ä¸ªnamespaceä¸­</span><br>    registries = <span class="hljs-string">&quot;192.168.10.15/vue&quot;</span>        <span class="hljs-comment">//é•œåƒä»“åº“åœ°å€</span><br>    GIT = <span class="hljs-string">&quot;git@192.168.10.14:root/Vue3-Todo-List-AddName.git&quot;</span>  <span class="hljs-comment">//ä»£ç ä»“åº“åœ°å€</span><br>    TAG = <span class="hljs-string">&quot;&quot;</span>                               <span class="hljs-comment">//é•œåƒtag,ä¼šåœ¨ä¸‹é¢ç”Ÿæˆ,è¿™é‡Œåªæ˜¯å®šä¹‰å…¨å±€å˜é‡</span><br>    NANE = <span class="hljs-string">&quot;&quot;</span>                              <span class="hljs-comment">//jenkinsé¡¹ç›®åç§°,ä¼šåœ¨ä¸‹é¢ç”Ÿæˆ,è¿™é‡Œåªæ˜¯å®šä¹‰å…¨å±€å˜é‡</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…¨å±€é…ç½®</span><br>  options <span class="hljs-punctuation">&#123;</span><br>    timestamps()                     <span class="hljs-comment">//æ‰€æœ‰è¾“å‡ºæ¯è¡Œéƒ½ä¼šæ‰“å°æ—¶é—´æˆ³</span><br>    buildDiscarder(logRotator(numToKeepStr<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">5</span>&#x27;))  <span class="hljs-comment">//ä¿ç•™5ä¸ªå†å²æ„å»ºç‰ˆæœ¬</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//æ‰‹åŠ¨æ„å»ºæ—¶é€‰æ‹©åˆ†æ”¯å‚æ•°</span><br>  parameters <span class="hljs-punctuation">&#123;</span> <br>    gitParameter(branch<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> branchFilter<span class="hljs-punctuation">:</span> &#x27;origin/(.*)&#x27;<span class="hljs-punctuation">,</span> defaultValue<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> description<span class="hljs-punctuation">:</span> &#x27;Branch for build and deploy&#x27;<span class="hljs-punctuation">,</span> name<span class="hljs-punctuation">:</span> &#x27;BRANCH&#x27;<span class="hljs-punctuation">,</span> quickFilterEnabled<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> selectedValue<span class="hljs-punctuation">:</span> &#x27;NONE&#x27;<span class="hljs-punctuation">,</span> sortMode<span class="hljs-punctuation">:</span> &#x27;NONE&#x27;<span class="hljs-punctuation">,</span>  tagFilter<span class="hljs-punctuation">:</span> &#x27;*&#x27;<span class="hljs-punctuation">,</span> type<span class="hljs-punctuation">:</span> &#x27;PT_BRANCH&#x27;)<br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//agenté…ç½®</span><br>  agent <span class="hljs-punctuation">&#123;</span><br>    kubernetes <span class="hljs-punctuation">&#123;</span><br>      cloud &#x27;kubernetes&#x27;<br>      slaveConnectTimeout <span class="hljs-number">1200</span><br>      workspaceVolume persistentVolumeClaimWorkspaceVolume(claimName<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npm-data&quot;</span><span class="hljs-punctuation">,</span> mountPath<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/&quot;</span><span class="hljs-punctuation">,</span> readOnly<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span>)<br>      yaml &#x27;&#x27;&#x27;<br>kind<span class="hljs-punctuation">:</span> Pod<br>metadata<span class="hljs-punctuation">:</span><br>  name<span class="hljs-punctuation">:</span> jenkins-agent<br>  namespace<span class="hljs-punctuation">:</span> jenkins<br>spec<span class="hljs-punctuation">:</span><br>  containers<span class="hljs-punctuation">:</span><br>  - args<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\&#x27;$(JENKINS_SECRET)\&#x27;<span class="hljs-punctuation">,</span> \&#x27;$(JENKINS_NAME)\&#x27;<span class="hljs-punctuation">]</span><br>    image<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.254</span><span class="hljs-punctuation">:</span><span class="hljs-number">5000</span>/kubernetes/jnlp<span class="hljs-punctuation">:</span>alpine&#x27;<br>    name<span class="hljs-punctuation">:</span> jnlp<br>    imagePullPolicy<span class="hljs-punctuation">:</span> IfNotPresent<br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/node:latest&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nodejs&quot;</span> <br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/docker:alpine&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;docker&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    volumeMounts<span class="hljs-punctuation">:</span><br>    - mountPath<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>      name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span><br>      readOnly<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/kubectl:apline&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kubectl&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  volumes<span class="hljs-punctuation">:</span>          <br>  - hostPath<span class="hljs-punctuation">:</span><br>      path<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span>  <br>  restartPolicy<span class="hljs-punctuation">:</span> Never<br>  nodeSelector<span class="hljs-punctuation">:</span>  <br>    build<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <br>&#x27;&#x27;&#x27;<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…·ä½“æµæ°´çº¿é…ç½®</span><br>  stages <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">//å…‹éš†ä»£ç </span><br>    stage(&#x27;git clone&#x27;) <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-comment">//å¹¶è¡Œæ‰§è¡Œ</span><br>      failFast <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  <span class="hljs-comment">//å¹¶è¡Œæ‰§è¡Œçš„åˆ†æ”¯åªè¦æœ‰ä¸€ä¸ªå¤±è´¥ç«‹å³ç»“æŸæµæ°´çº¿</span><br>      parallel <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">//æ‰‹åŠ¨æ‰§è¡Œjenkinsæµæ°´çº¿</span><br>        stage(&#x27;git clone by Jenkins&#x27;) <span class="hljs-punctuation">&#123;</span><br>          when <span class="hljs-punctuation">&#123;</span><br>            expression <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-comment">//  æ‰‹åŠ¨æ„å»ºçš„æ—¶å€™ï¼Œåœ¨ç¯å¢ƒå˜é‡å½“ä¸­ï¼Œbranchä¸ºç©ºï¼Œæ‰€ä»¥å°±èµ°æ‰‹åŠ¨æ„å»ºçš„éƒ¨åˆ†</span><br>              env.gitlabBranch == <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            git branch<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;BRANCH&#125;&quot;</span><span class="hljs-punctuation">,</span> credentialsId<span class="hljs-punctuation">:</span> &#x27;gitlab-key&#x27;<span class="hljs-punctuation">,</span> url<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;GIT&#125;&quot;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-comment">// æ ‡å‡†è¾“å‡ºæ„å»ºtagä¿¡æ¯</span><br>              TAG = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;BRANCH&#125;-$&#123;env.BUILD_ID&#125;&quot;</span>)<br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-comment">//gitlabè§¦å‘æ„å»º</span><br>        stage(&#x27;git clone trigger&#x27;) <span class="hljs-punctuation">&#123;</span><br>          when <span class="hljs-punctuation">&#123;</span><br>            expression <span class="hljs-punctuation">&#123;</span><br>              env.gitlabBranch != <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            git branch<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;env.gitlabBranch&#125;&quot;</span><span class="hljs-punctuation">,</span> credentialsId<span class="hljs-punctuation">:</span> &#x27;gitlab-key&#x27;<span class="hljs-punctuation">,</span> url<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;GIT&#125;&quot;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>              TAG = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;env.gitlabBranch&#125;-$&#123;env.BUILD_ID&#125;&quot;</span>)<br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-comment">//åˆå§‹åŒ–é¡¹ç›®åç§°ï¼Œé¡¹ç›®åç§°ç”¨äºdockeré•œåƒåç§°,ä¸èƒ½æœ‰å¤§å†™å­—æ¯,è½¬ä¹‰</span><br>        stage(&#x27;init env&#x27;) <span class="hljs-punctuation">&#123;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>              NAME = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;env.JOB_NAME&#125;&quot;</span>).toLowerCase()<br>            <span class="hljs-punctuation">&#125;</span><br>            sh <span class="hljs-string">&quot;echo $&#123;NAME&#125;&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    stage(&#x27;npm build&#x27;) <span class="hljs-punctuation">&#123;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">// åœ¨nodejs å®¹å™¨å†…</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;nodejs&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh <span class="hljs-string">&quot;npm install --registry=https://registry.npm.taobao.org&quot;</span><br>          sh <span class="hljs-string">&quot;npm run build&quot;</span><br>          sh <span class="hljs-string">&quot;ls -l&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>    stage(&#x27;docker build&#x27;) <span class="hljs-punctuation">&#123;</span><br>      environment <span class="hljs-punctuation">&#123;</span><br>        HARBOR_USER = credentials(&#x27;harbor-account&#x27;)<br>      <span class="hljs-punctuation">&#125;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;docker&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh <span class="hljs-string">&quot;docker login -u $&#123;HARBOR_USER_USR&#125; -p $&#123;HARBOR_USER_PSW&#125; $&#123;registries&#125;&quot;</span><br>          sh <span class="hljs-string">&quot;docker build -t $&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125; .&quot;</span><br>          sh <span class="hljs-string">&quot;docker push $&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125;&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>    stage(&#x27;update deploy&#x27;) <span class="hljs-punctuation">&#123;</span><br>      environment <span class="hljs-punctuation">&#123;</span><br>        MY_KUBECONFIG = credentials(&#x27;kubernetes-cluster&#x27;)<br>      <span class="hljs-punctuation">&#125;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;kubectl&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh  <span class="hljs-string">&quot;kubectl get deploy -n $&#123;namespace&#125; -l image=$&#123;NAME&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>          sh  <span class="hljs-string">&quot;kubectl set image deploy -n $&#123;namespace&#125; -l image=$&#123;NAME&#125; $&#123;NAME&#125;=$&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>          sh  <span class="hljs-string">&quot;kubectl rollout status deployment -n $&#123;namespace&#125; $&#123;NAME&#125; --timeout=60s --kubeconfig $MY_KUBECONFIG&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="4-Dockerfileæ–‡ä»¶-1"><a href="#4-Dockerfileæ–‡ä»¶-1" class="headerlink" title="4.Dockerfileæ–‡ä»¶"></a>4.Dockerfileæ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">FROM 192.168.10.254:5000/bash/nginx:latest<br>WORKDIR /usr/share/nginx/html/<br>COPY dist/ /usr/share/nginx/html/<br>ENV TZ=Asia/Shanghai<br>EXPOSE 80<br></code></pre></td></tr></table></figure><h2 id="5-åˆ›å»ºæµæ°´çº¿-1"><a href="#5-åˆ›å»ºæµæ°´çº¿-1" class="headerlink" title="5.åˆ›å»ºæµæ°´çº¿"></a>5.åˆ›å»ºæµæ°´çº¿</h2><p><img src="https://www.t-ao.cn/usr/uploads/2024/07/1051577822.png" alt="57168-zkvjh6cmzl.png"></p><h2 id="6-éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•-1"><a href="#6-éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•-1" class="headerlink" title="6.éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•"></a>6.éƒ¨ç½²åº”ç”¨è¿›è¡Œæµ‹è¯•</h2><p><strong>éƒ¨ç½²åº”ç”¨</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span> <br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>    <br><span class="hljs-attr">metadata:</span>           <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">vue</span>      <br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">bolo</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">vue</span>  <span class="hljs-comment">#è¿™é‡Œå¿…é¡»å®šä¹‰ä¸ºé•œåƒåç§°</span><br><span class="hljs-attr">spec:</span>              <br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>        <br>  <span class="hljs-attr">selector:</span>         <br>    <span class="hljs-attr">matchLabels:</span>    <br>      <span class="hljs-attr">app:</span> <span class="hljs-string">vue</span> <br>  <span class="hljs-attr">template:</span>          <br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">vue</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">vue</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.15</span><span class="hljs-string">/vue/vuevue3-addname:main-6</span><br>        <span class="hljs-attr">ports:</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span>    <br>          <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span>    <br>          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span> <br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>     <br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>     <br><span class="hljs-attr">metadata:</span>         <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">vue</span>   <br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">bolo</span>  <br><span class="hljs-attr">spec:</span>              <br>  <span class="hljs-attr">ports:</span>          <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">vue</span>    <br>    <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>       <br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>  <br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">selector:</span>     <br>    <span class="hljs-attr">app:</span> <span class="hljs-string">vue</span>   <br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br></code></pre></td></tr></table></figure><p><strong>æµ‹è¯•æµæ°´çº¿</strong><br><img src="https://www.t-ao.cn/usr/uploads/2024/07/3834379080.png" alt="61641-b97abzj01ir.png"></p><h1 id="å››ã€è‡ªåŠ¨åŒ–æ„å»º-Golang-é¡¹ç›®"><a href="#å››ã€è‡ªåŠ¨åŒ–æ„å»º-Golang-é¡¹ç›®" class="headerlink" title="å››ã€è‡ªåŠ¨åŒ–æ„å»º Golang é¡¹ç›®"></a>å››ã€è‡ªåŠ¨åŒ–æ„å»º Golang é¡¹ç›®</h1><h2 id="1-æµæ°´çº¿ç»“æ„-2"><a href="#1-æµæ°´çº¿ç»“æ„-2" class="headerlink" title="1.æµæ°´çº¿ç»“æ„"></a>1.æµæ°´çº¿ç»“æ„</h2><p><img src="https://www.t-ao.cn/usr/uploads/2024/07/949935775.png" alt="48032-5u3ropw0if.png"><br>æ³¨æ„è¿™é‡Œçš„Jenkinsfileä¸Dockerfileæ–‡ä»¶éƒ½å­˜æ”¾åœ¨gitä»“åº“ä¸­ã€‚goåº”ç”¨ä¼šä½¿ç”¨<code>go build</code>è¿›è¡Œç¼–è¯‘ï¼Œä¼šä¸‹è½½ä¸€ç³»åˆ—ä¾èµ–çš„åŒ…ï¼Œé»˜è®¤ä¼šä¸‹è½½åˆ°å®¹å™¨çš„**&#x2F;opt&#x2F;pkg**ç›®å½•ä¸­æ‰€ä»¥ä¸ºäº†é‡å¤æ„å»ºä¸è¿›è¡Œé‡å¤ä¸‹è½½éœ€è¦æŒä¹…åŒ–ã€‚</p><h2 id="2-éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“-2"><a href="#2-éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“-2" class="headerlink" title="2.éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“"></a>2.éœ€è¦å…‹éš†å¼€æºä»£ç åˆ°è‡ªå·±gitlabä»“åº“</h2><p>æºç ä»“åº“ï¼š<a href="https://gitee.com/dukuan/go-project.git">https://gitee.com/dukuan/go-project.git</a></p><h2 id="3-Jenkinsfileæ–‡ä»¶-2"><a href="#3-Jenkinsfileæ–‡ä»¶-2" class="headerlink" title="3.Jenkinsfileæ–‡ä»¶"></a>3.Jenkinsfileæ–‡ä»¶</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs json">pipeline <span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">//é¡¶å±‚ç¯å¢ƒå˜é‡è®¾ç½®</span><br>  environment <span class="hljs-punctuation">&#123;</span><br>    namespace = <span class="hljs-string">&quot;bolo&quot;</span>                      <span class="hljs-comment">//æœåŠ¡éƒ¨ç½²åœ¨é‚£ä¸ªnamespaceä¸­</span><br>    registries = <span class="hljs-string">&quot;192.168.10.15/go&quot;</span>         <span class="hljs-comment">//é•œåƒä»“åº“åœ°å€</span><br>    GIT = <span class="hljs-string">&quot;git@192.168.10.14:root/go-project.git&quot;</span>  <span class="hljs-comment">//ä»£ç ä»“åº“åœ°å€</span><br>    TAG = <span class="hljs-string">&quot;&quot;</span>                               <span class="hljs-comment">//é•œåƒtag,ä¼šåœ¨ä¸‹é¢ç”Ÿæˆ,è¿™é‡Œåªæ˜¯å®šä¹‰å…¨å±€å˜é‡</span><br>    NANE = <span class="hljs-string">&quot;&quot;</span>                              <span class="hljs-comment">//jenkinsé¡¹ç›®åç§°,ä¼šåœ¨ä¸‹é¢ç”Ÿæˆ,è¿™é‡Œåªæ˜¯å®šä¹‰å…¨å±€å˜é‡</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…¨å±€é…ç½®</span><br>  options <span class="hljs-punctuation">&#123;</span><br>    timestamps()                     <span class="hljs-comment">//æ‰€æœ‰è¾“å‡ºæ¯è¡Œéƒ½ä¼šæ‰“å°æ—¶é—´æˆ³</span><br>    buildDiscarder(logRotator(numToKeepStr<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">5</span>&#x27;))  <span class="hljs-comment">//ä¿ç•™5ä¸ªå†å²æ„å»ºç‰ˆæœ¬</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//æ‰‹åŠ¨æ„å»ºæ—¶é€‰æ‹©åˆ†æ”¯å‚æ•°</span><br>  parameters <span class="hljs-punctuation">&#123;</span> <br>    gitParameter(branch<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> branchFilter<span class="hljs-punctuation">:</span> &#x27;origin/(.*)&#x27;<span class="hljs-punctuation">,</span> defaultValue<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> description<span class="hljs-punctuation">:</span> &#x27;Branch for build and deploy&#x27;<span class="hljs-punctuation">,</span> name<span class="hljs-punctuation">:</span> &#x27;BRANCH&#x27;<span class="hljs-punctuation">,</span> quickFilterEnabled<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span> selectedValue<span class="hljs-punctuation">:</span> &#x27;NONE&#x27;<span class="hljs-punctuation">,</span> sortMode<span class="hljs-punctuation">:</span> &#x27;NONE&#x27;<span class="hljs-punctuation">,</span>  tagFilter<span class="hljs-punctuation">:</span> &#x27;*&#x27;<span class="hljs-punctuation">,</span> type<span class="hljs-punctuation">:</span> &#x27;PT_BRANCH&#x27;)<br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//agenté…ç½®</span><br>  agent <span class="hljs-punctuation">&#123;</span><br>    kubernetes <span class="hljs-punctuation">&#123;</span><br>      cloud &#x27;kubernetes&#x27;<br>      slaveConnectTimeout <span class="hljs-number">1200</span><br>      workspaceVolume emptyDirWorkspaceVolume()<br>      yaml &#x27;&#x27;&#x27;<br>kind<span class="hljs-punctuation">:</span> Pod<br>metadata<span class="hljs-punctuation">:</span><br>  name<span class="hljs-punctuation">:</span> jenkins-agent<br>  namespace<span class="hljs-punctuation">:</span> jenkins<br>spec<span class="hljs-punctuation">:</span><br>  containers<span class="hljs-punctuation">:</span><br>  - args<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\&#x27;$(JENKINS_SECRET)\&#x27;<span class="hljs-punctuation">,</span> \&#x27;$(JENKINS_NAME)\&#x27;<span class="hljs-punctuation">]</span><br>    image<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.254</span><span class="hljs-punctuation">:</span><span class="hljs-number">5000</span>/kubernetes/jnlp<span class="hljs-punctuation">:</span>alpine&#x27;<br>    name<span class="hljs-punctuation">:</span> jnlp<br>    imagePullPolicy<span class="hljs-punctuation">:</span> IfNotPresent<br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/golang:1.18.3&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;go&quot;</span><br>    # å¯¹åº”goçš„ä¾èµ–<br>    volumeMounts<span class="hljs-punctuation">:</span> <br>     # go å®¹å™¨å†…çš„è·¯å¾„<br>    - mountPath<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/go/pkg&quot;</span><br>      name<span class="hljs-punctuation">:</span> go-pkg-data<br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/docker:alpine&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;docker&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    volumeMounts<span class="hljs-punctuation">:</span><br>    - mountPath<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>      name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span><br>      readOnly<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/kubectl:apline&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kubectl&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  volumes<span class="hljs-punctuation">:</span>          <br>  - name<span class="hljs-punctuation">:</span> go-pkg-data    <br>    persistentVolumeClaim<span class="hljs-punctuation">:</span>  <br>      claimName<span class="hljs-punctuation">:</span> go <br>  - hostPath<span class="hljs-punctuation">:</span><br>      path<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/run/docker.sock&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dockersock&quot;</span>  <br>  restartPolicy<span class="hljs-punctuation">:</span> Never<br> # æŠŠåˆ›å»ºçš„å®¹å™¨è°ƒåº¦åˆ°æœ‰æ ‡ç­¾build<span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span>çš„èŠ‚ç‚¹ä¸Š<br>  nodeSelector<span class="hljs-punctuation">:</span>  <br>    build<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <br>&#x27;&#x27;&#x27;<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-comment">//å…·ä½“æµæ°´çº¿é…ç½®</span><br>  stages <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">//å…‹éš†ä»£ç </span><br>    stage(&#x27;git clone&#x27;) <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-comment">//å¹¶è¡Œæ‰§è¡Œ</span><br>      failFast <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  <span class="hljs-comment">//å¹¶è¡Œæ‰§è¡Œçš„åˆ†æ”¯åªè¦æœ‰ä¸€ä¸ªå¤±è´¥ç«‹å³ç»“æŸæµæ°´çº¿</span><br>      parallel <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">//æ‰‹åŠ¨æ‰§è¡Œjenkinsæµæ°´çº¿</span><br>        stage(&#x27;git clone by Jenkins&#x27;) <span class="hljs-punctuation">&#123;</span><br>          when <span class="hljs-punctuation">&#123;</span><br>            expression <span class="hljs-punctuation">&#123;</span><br>              env.gitlabBranch == <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            git branch<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;BRANCH&#125;&quot;</span><span class="hljs-punctuation">,</span> credentialsId<span class="hljs-punctuation">:</span> &#x27;gitlab-key&#x27;<span class="hljs-punctuation">,</span> url<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;GIT&#125;&quot;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>              TAG = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;BRANCH&#125;-$&#123;env.BUILD_ID&#125;&quot;</span>)<br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-comment">//gitlabè§¦å‘æ„å»º</span><br>        stage(&#x27;git clone trigger&#x27;) <span class="hljs-punctuation">&#123;</span><br>          when <span class="hljs-punctuation">&#123;</span><br>            expression <span class="hljs-punctuation">&#123;</span><br>              env.gitlabBranch != <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            git branch<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;env.gitlabBranch&#125;&quot;</span><span class="hljs-punctuation">,</span> credentialsId<span class="hljs-punctuation">:</span> &#x27;gitlab-key&#x27;<span class="hljs-punctuation">,</span> url<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;GIT&#125;&quot;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>              TAG = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;env.gitlabBranch&#125;-$&#123;env.BUILD_ID&#125;&quot;</span>)<br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-comment">//åˆå§‹åŒ–é¡¹ç›®åç§°ï¼Œé¡¹ç›®åç§°ç”¨äºdockeré•œåƒåç§°,ä¸èƒ½æœ‰å¤§å†™å­—æ¯,è½¬ä¹‰</span><br>        stage(&#x27;init env&#x27;) <span class="hljs-punctuation">&#123;</span><br>          steps <span class="hljs-punctuation">&#123;</span><br>            script <span class="hljs-punctuation">&#123;</span><br>              NAME = sh(returnStdout<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> script<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo -n $&#123;env.JOB_NAME&#125;&quot;</span>).toLowerCase()<br>            <span class="hljs-punctuation">&#125;</span><br>            sh <span class="hljs-string">&quot;echo $&#123;NAME&#125;&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>    stage(&#x27;build&#x27;) <span class="hljs-punctuation">&#123;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;go&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh <span class="hljs-string">&quot;export GO111MODULE=on&quot;</span><br>          sh <span class="hljs-string">&quot;go env -w GOPROXY=https://goproxy.cn,direct&quot;</span><br>          sh <span class="hljs-string">&quot;go mod tidy&quot;</span><br>          sh <span class="hljs-string">&quot;go build&quot;</span><br>          sh <span class="hljs-string">&quot;ls -l&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>    stage(&#x27;docker build&#x27;) <span class="hljs-punctuation">&#123;</span><br>      environment <span class="hljs-punctuation">&#123;</span><br>        HARBOR_USER = credentials(&#x27;harbor-account&#x27;)<br>      <span class="hljs-punctuation">&#125;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;docker&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh <span class="hljs-string">&quot;docker login -u $&#123;HARBOR_USER_USR&#125; -p $&#123;HARBOR_USER_PSW&#125; $&#123;registries&#125;&quot;</span><br>          sh <span class="hljs-string">&quot;docker build -t $&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125; .&quot;</span><br>          sh <span class="hljs-string">&quot;docker push $&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125;&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>    stage(&#x27;update deploy&#x27;) <span class="hljs-punctuation">&#123;</span><br>      environment <span class="hljs-punctuation">&#123;</span><br>        MY_KUBECONFIG = credentials(&#x27;kubernetes-cluster&#x27;)<br>      <span class="hljs-punctuation">&#125;</span><br>      steps <span class="hljs-punctuation">&#123;</span><br>        container(name<span class="hljs-punctuation">:</span> &#x27;kubectl&#x27;) <span class="hljs-punctuation">&#123;</span><br>          sh  <span class="hljs-string">&quot;kubectl get deploy -n $&#123;namespace&#125; -l image=$&#123;NAME&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>          sh  <span class="hljs-string">&quot;kubectl set image deploy -n $&#123;namespace&#125; -l image=$&#123;NAME&#125; $&#123;NAME&#125;=$&#123;registries&#125;/$&#123;NAME&#125;:$&#123;TAG&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>          sh  <span class="hljs-string">&quot;kubectl rollout status deployment -n $&#123;namespace&#125; $&#123;NAME&#125; --timeout=60s --kubeconfig $MY_KUBECONFIG&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="4-Dockerfileæ–‡ä»¶-2"><a href="#4-Dockerfileæ–‡ä»¶-2" class="headerlink" title="4.Dockerfileæ–‡ä»¶"></a>4.Dockerfileæ–‡ä»¶</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">10.254</span>:<span class="hljs-number">5000</span>/bash/alpine-glibc:glibc-<span class="hljs-number">2.35</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /opt/workdir/</span><br><span class="hljs-comment"># go-projectæ˜¯jenkinsçš„workspaceçš„åç§°</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> go-project /opt/workdir/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> conf/ /opt/workdir/conf/</span><br><span class="hljs-keyword">ENV</span> TZ=Asia/Shanghai<br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [ <span class="hljs-string">&quot;./go-project&quot;</span>]</span><br></code></pre></td></tr></table></figure><h2 id="5-åˆ›å»ºæµæ°´çº¿-2"><a href="#5-åˆ›å»ºæµæ°´çº¿-2" class="headerlink" title="5.åˆ›å»ºæµæ°´çº¿"></a>5.åˆ›å»ºæµæ°´çº¿</h2><p><img src="https://www.t-ao.cn/usr/uploads/2024/07/137688574.png" alt="30345-r0khvp1vc9s.png"></p><h2 id="6-éƒ¨ç½²åº”ç”¨æµ‹è¯•"><a href="#6-éƒ¨ç½²åº”ç”¨æµ‹è¯•" class="headerlink" title="6.éƒ¨ç½²åº”ç”¨æµ‹è¯•"></a>6.éƒ¨ç½²åº”ç”¨æµ‹è¯•</h2><p><strong>éƒ¨ç½²åº”ç”¨</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span> <br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>    <br><span class="hljs-attr">metadata:</span>           <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">go-project</span>      <br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">bolo</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">go-project</span>  <span class="hljs-comment">#è¿™é‡Œä½¿ç”¨lableåŒ¹é…æ›´æ–°ï¼Œå¿…é¡»è®¾ç½®è¿™ä¸ªï¼Œå› ä¸ºåœ¨jenkinsfileå½“ä¸­å†™äº†è¿‡å»æŒ‡å®šæ ‡ç­¾çš„pod</span><br><span class="hljs-attr">spec:</span>              <br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>        <br>  <span class="hljs-attr">selector:</span>          <br>    <span class="hljs-attr">matchLabels:</span>     <br>      <span class="hljs-attr">app:</span> <span class="hljs-string">go-project</span>   <br>  <span class="hljs-attr">template:</span>         <br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">go-project</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">go-project</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.15</span><span class="hljs-string">/vue/vuevue3-addname:main-6</span><br>        <span class="hljs-attr">ports:</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span>    <br>          <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>     <br>          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span> <br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>    <br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>    <br><span class="hljs-attr">metadata:</span>         <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">go-project</span>   <br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">bolo</span> <br><span class="hljs-attr">spec:</span>              <br>  <span class="hljs-attr">ports:</span>           <br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">go-project</span>    <br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>     <br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span> <br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-string">http</span> <br>  <span class="hljs-attr">selector:</span>       <br>    <span class="hljs-attr">app:</span> <span class="hljs-string">go-project</span>  <br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br></code></pre></td></tr></table></figure><p><strong>æµ‹è¯•æµæ°´çº¿</strong><br><img src="https://www.t-ao.cn/usr/uploads/2024/07/2773957435.png" alt="81806-cokov9c86p.png"></p><h1 id="äº”ã€é…ç½®è‡ªåŠ¨è§¦å‘æ„å»º"><a href="#äº”ã€é…ç½®è‡ªåŠ¨è§¦å‘æ„å»º" class="headerlink" title="äº”ã€é…ç½®è‡ªåŠ¨è§¦å‘æ„å»º"></a>äº”ã€é…ç½®è‡ªåŠ¨è§¦å‘æ„å»º</h1><p>ä¹‹å‰çš„æ„å»ºéƒ½æ˜¯é‡‡ç”¨æ‰‹åŠ¨é€‰æ‹©åˆ†æ”¯è¿›è¡Œæ„å»ºçš„ï¼Œå®é™…ä½¿ç”¨æ—¶ï¼Œé¡¹ç›®å¯èƒ½æœ‰å¾ˆå¤šï¼Œå¦‚æœéƒ½æ˜¯æ‰‹åŠ¨è§¦å‘å¯èƒ½æ¯”è¾ƒæ¶ˆè€—äººåŠ›ã€‚æ‰€ä»¥æ¨èå¯ä»¥æŒ‰éœ€é…ç½®è‡ªåŠ¨è§¦å‘ï¼Œå³æäº¤ä»£ç åè‡ªåŠ¨è§¦å‘Jenkinsè¿›è¡Œæ„å»ºä»»åŠ¡ã€‚</p><h2 id="5-1-é…ç½®jenkins"><a href="#5-1-é…ç½®jenkins" class="headerlink" title="5.1 é…ç½®jenkins"></a>5.1 é…ç½®jenkins</h2><p>æœ¬æ¬¡ç”¨ Java é¡¹ç›®è¿›è¡Œæ¼”ç¤ºã€‚é¦–å…ˆæ‰¾åˆ° Java é¡¹ç›®çš„ Jobï¼Œç‚¹å‡» Configure</p><p>ä¹‹åé€‰æ‹© Build Triggersï¼Œå‹¾é€‰ Build when a changeâ€¦ï¼Œè®°å½• webhook URLï¼ˆæ–°ç‰ˆæœ¬[Version 2.452.2]çš„jenkinsæ±‰åŒ–åçš„é€‰é¡¹æ˜¯[<strong>è§¦å‘è¿œç¨‹æ„å»º (ä¾‹å¦‚,ä½¿ç”¨è„šæœ¬)</strong>]ï¼‰</p><p><img src="https://www.t-ao.cn/usr/uploads/2024/07/2041871866.png" alt="32956-sahjntuh73j.png"><br>é€‰æ‹© Allow all branchesï¼Œå¦‚æœä¸æƒ³ä»»ä½•åˆ†æ”¯éƒ½å¯ä»¥è§¦å‘è¯¥æµæ°´çº¿ï¼Œå¯ä»¥é€‰æ‹© Filter è¿›è¡Œæ¡ä»¶åŒ¹é…ã€‚ä¹‹åç‚¹å‡» Generate ç”Ÿæˆ Secret tokenï¼Œ æœ€åç‚¹å‡» Save å³å¯ã€‚<br><img src="https://www.t-ao.cn/usr/uploads/2024/07/3812530265.png" alt="64313-z8clhrevg1k.png"></p><h2 id="5-2-é…ç½®gitlab"><a href="#5-2-é…ç½®gitlab" class="headerlink" title="5.2 é…ç½®gitlab"></a>5.2 é…ç½®gitlab</h2><p>æ¥ä¸‹æ¥é…ç½® GitLabï¼Œé¦–å…ˆç‚¹å‡» Menuâ†’Admin(è¿™ä¸ªè®¾ç½®æ˜¯åœ¨æ€»ä½“è®¾ç½®é‡Œé¢ï¼Œä¸æ˜¯åœ¨å•ç‹¬çš„é¡¹ç›®å†…)<br><img src="https://www.t-ao.cn/usr/uploads/2024/07/3476341503.png" alt="81636-mc5o7vwrnpp.png"><br>ä¿å­˜åï¼Œæ‰¾åˆ° <strong>Java é¡¹ç›®ï¼ˆåœ¨é¡¹ç›®å†…è¿›è¡Œè®¾ç½®ï¼‰</strong>ï¼Œç‚¹å‡» Settingsâ†’WebHooksï¼ˆJENKINS_URL<code>/job/docker-pipline/build?token=</code>TOKEN_NAMEç²˜è´´åœ¨urlå†…ï¼Œä¸‹é¢çš„secret tokenå°±ä¸ç”¨å¡«å†™ï¼‰<br><img src="https://www.t-ao.cn/usr/uploads/2024/07/988653632.png" alt="70363-0mlvz2an5q2c.png"><br>ç¡®è®¤æ— è¯¯åï¼Œç‚¹å‡» Add webhook</p><p>ä¿å­˜åæ²¡æœ‰é—®é¢˜å¯ä»¥è¿›è¡Œæµ‹è¯•</p><p><img src="https://www.t-ao.cn/usr/uploads/2024/07/2849705660.png" alt="38054-vf8gly9k2el.png"><br>éªŒè¯æµæ°´çº¿æ˜¯å¦è§¦å‘æ‰§è¡Œ<br><img src="https://www.t-ao.cn/usr/uploads/2024/07/832594147.png" alt="36937-t4zeinnzjup.png"></p><h1 id="å…­ã€ä¸€æ¬¡æ„å»ºå¤šæ¬¡éƒ¨ç½²"><a href="#å…­ã€ä¸€æ¬¡æ„å»ºå¤šæ¬¡éƒ¨ç½²" class="headerlink" title="å…­ã€ä¸€æ¬¡æ„å»ºå¤šæ¬¡éƒ¨ç½²"></a>å…­ã€ä¸€æ¬¡æ„å»ºå¤šæ¬¡éƒ¨ç½²</h1><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ Jobï¼Œåå­—ä¸º go-project-uatï¼Œç±»å‹ Pipeline</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs json">pipeline <span class="hljs-punctuation">&#123;</span><br>  environment <span class="hljs-punctuation">&#123;</span><br>    HARBOR_ADDRESS = <span class="hljs-string">&quot;192.168.10.15&quot;</span>  <span class="hljs-comment">//é•œåƒä»“åº“åœ°å€</span><br>    NAMESPACE = <span class="hljs-string">&quot;bolo&quot;</span>                <span class="hljs-comment">//éƒ¨ç½²åº”ç”¨çš„å‘½åç©ºé—´</span><br>    IMAGE_NAME = <span class="hljs-string">&quot;go-project&quot;</span>         <span class="hljs-comment">//é•œåƒåç§°</span><br>  <span class="hljs-punctuation">&#125;</span><br>  parameters <span class="hljs-punctuation">&#123;</span> <br>    imageTag(name<span class="hljs-punctuation">:</span> &#x27;DOCKER_IMAGE&#x27;<span class="hljs-punctuation">,</span> description<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> image<span class="hljs-punctuation">:</span> &#x27;go/go-project&#x27;<span class="hljs-punctuation">,</span> filter<span class="hljs-punctuation">:</span> &#x27;.*&#x27;<span class="hljs-punctuation">,</span> defaultTag<span class="hljs-punctuation">:</span> &#x27;&#x27;<span class="hljs-punctuation">,</span> registry<span class="hljs-punctuation">:</span> &#x27;http<span class="hljs-punctuation">:</span><span class="hljs-comment">//192.168.10.15&#x27;, credentialId: &#x27;harbor-account&#x27;, tagOrder: &#x27;NATURAL&#x27;)   //è·å–é•œåƒåç§°ä¸tagï¼Œç›¸å…³å‚æ•°æ ¹æ®å®é™…æƒ…å†µå¡«å†™</span><br>  <span class="hljs-punctuation">&#125;</span>  <br>  <span class="hljs-comment">//å…¨å±€é…ç½®</span><br>  options <span class="hljs-punctuation">&#123;</span><br>    timestamps()                     <span class="hljs-comment">//æ‰€æœ‰è¾“å‡ºæ¯è¡Œéƒ½ä¼šæ‰“å°æ—¶é—´æˆ³</span><br>    buildDiscarder(logRotator(numToKeepStr<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">5</span>&#x27;))  <span class="hljs-comment">//ä¿ç•™5ä¸ªå†å²æ„å»ºç‰ˆæœ¬</span><br>  <span class="hljs-punctuation">&#125;</span><br>  agent <span class="hljs-punctuation">&#123;</span><br>    kubernetes <span class="hljs-punctuation">&#123;</span><br>      cloud &#x27;kubernetes&#x27;<br>      slaveConnectTimeout <span class="hljs-number">1200</span><br>      workspaceVolume emptyDirWorkspaceVolume()<br>      yaml &#x27;&#x27;&#x27;<br>apiVersion<span class="hljs-punctuation">:</span> v1<br>kind<span class="hljs-punctuation">:</span> Pod<br>metadata<span class="hljs-punctuation">:</span><br>  name<span class="hljs-punctuation">:</span> jenkins-agent<br>  namespace<span class="hljs-punctuation">:</span> jenkins<br>spec<span class="hljs-punctuation">:</span><br>  containers<span class="hljs-punctuation">:</span><br>  - args<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>\&#x27;$(JENKINS_SECRET)\&#x27;<span class="hljs-punctuation">,</span> \&#x27;$(JENKINS_NAME)\&#x27;<span class="hljs-punctuation">]</span><br>    image<span class="hljs-punctuation">:</span> &#x27;<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.254</span><span class="hljs-punctuation">:</span><span class="hljs-number">5000</span>/kubernetes/jnlp<span class="hljs-punctuation">:</span>alpine&#x27;<br>    name<span class="hljs-punctuation">:</span> jnlp<br>    imagePullPolicy<span class="hljs-punctuation">:</span> IfNotPresent<br>  - command<span class="hljs-punctuation">:</span><br>      - <span class="hljs-string">&quot;cat&quot;</span><br>    image<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.10.254:5000/kubernetes/kubectl:apline&quot;</span><br>    imagePullPolicy<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IfNotPresent&quot;</span><br>    name<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;kubectl&quot;</span><br>    tty<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>&#x27;&#x27;&#x27;<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br> stages <span class="hljs-punctuation">&#123;</span><br>   stage(&#x27;Deploy&#x27;) <span class="hljs-punctuation">&#123;</span><br>     environment <span class="hljs-punctuation">&#123;</span><br>       MY_KUBECONFIG = credentials(&#x27;kubernetes-cluster&#x27;)<br>     <span class="hljs-punctuation">&#125;</span><br>     steps <span class="hljs-punctuation">&#123;</span><br>       container(name<span class="hljs-punctuation">:</span> &#x27;kubectl&#x27;)<span class="hljs-punctuation">&#123;</span><br>         sh <span class="hljs-string">&quot;echo $&#123;DOCKER_IMAGE&#125;&quot;</span><br>         sh  <span class="hljs-string">&quot;kubectl get deploy -n $&#123;NAMESPACE&#125; -l image=$&#123;IMAGE_NAME&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>         sh  <span class="hljs-string">&quot;kubectl set image deploy -n $&#123;NAMESPACE&#125; -l image=$&#123;IMAGE_NAME&#125; $&#123;IMAGE_NAME&#125;=$&#123;HARBOR_ADDRESS&#125;/$&#123;DOCKER_IMAGE&#125; --kubeconfig $MY_KUBECONFIG&quot;</span><br>         sh  <span class="hljs-string">&quot;kubectl rollout status deployment -n $&#123;NAMESPACE&#125; $&#123;IMAGE_NAME&#125; --timeout=60s --kubeconfig $MY_KUBECONFIG&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæµæ°´çº¿<br><img src="https://www.t-ao.cn/usr/uploads/2024/07/3494418146.png" alt="33052-cgm561oyaqf.png"></p><p><strong>åŸæ–‡æ¥è‡ªï¼š<a href="https://zhangzhuo.ltd/articles/2022/06/05/1654424805227.html">zhangzhuo</a></strong></p>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‘åŸç”ŸJenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes1.24/1.25é›†ç¾¤ä½¿ç”¨dockerä½œä¸ºå®¹å™¨</title>
    <link href="/2025/03/19/Kubernetes1-24_1-25%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8docker%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8/"/>
    <url>/2025/03/19/Kubernetes1-24_1-25%E9%9B%86%E7%BE%A4%E4%BD%BF%E7%94%A8docker%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨æ–°ç‰ˆæœ¬Kubernetesç¯å¢ƒï¼ˆ1.24ä»¥åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ä¸‹å®˜æ–¹ä¸åœ¨æ”¯æŒdockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶äº†ï¼Œè‹¥è¦ç»§ç»­ä½¿ç”¨docker éœ€è¦å¯¹dockerè¿›è¡Œé…ç½®ä¸€ç•ªã€‚éœ€è¦å®‰è£…cri-dockerä½œä¸ºKuberneteså®¹å™¨</p><h3 id="æŸ¥çœ‹å½“å‰å®¹å™¨è¿è¡Œæ—¶"><a href="#æŸ¥çœ‹å½“å‰å®¹å™¨è¿è¡Œæ—¶" class="headerlink" title="æŸ¥çœ‹å½“å‰å®¹å™¨è¿è¡Œæ—¶"></a>æŸ¥çœ‹å½“å‰å®¹å™¨è¿è¡Œæ—¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹å®¹å™¨è¿è¡Œæ—¶</span><br>kubectl  describe node k8s-node05  | grep Container<br>  Container Runtime Version:  containerd://1.6.8<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹å®¹å™¨è¿è¡Œæ—¶</span><br>kubectl  describe node  | grep Container<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ›´æ–°æºä¿¡æ¯</span><br>yum update<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…å¿…è¦è½¯ä»¶</span><br>yum install -y yum-utils   device-mapper-persistent-data   lvm2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å†™å…¥dockeræºä¿¡æ¯</span><br>sudo yum-config-manager \<br>    --add-repo \<br>    https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ›´æ–°æºä¿¡æ¯å¹¶è¿›è¡Œå®‰è£…</span><br>yum update<br>yum install docker-ce docker-ce-cli containerd.io<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é…ç½®åŠ é€Ÿå™¨</span><br>sudo mkdir -p /etc/docker<br>sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;<br>&#123;<br>  &quot;registry-mirrors&quot;: [&quot;https://hub-mirror.c.163.com&quot;],<br>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…cri-docker"><a href="#å®‰è£…cri-docker" class="headerlink" title="å®‰è£…cri-docker"></a>å®‰è£…cri-docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ç”±äº1.24ä»¥åŠæ›´é«˜ç‰ˆæœ¬ä¸æ”¯æŒdockeræ‰€ä»¥å®‰è£…cri-docker</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸‹è½½cri-docker</span> <br>wget  https://mirrors.chenby.cn/https://github.com/Mirantis/cri-dockerd/releases/download/v0.2.5/cri-dockerd-0.2.5.amd64.tgz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹cri-docker</span><br>tar xvf cri-dockerd-0.2.5.amd64.tgz <br>cp cri-dockerd/cri-dockerd  /usr/bin/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å†™å…¥å¯åŠ¨é…ç½®æ–‡ä»¶</span><br>cat &gt;  /usr/lib/systemd/system/cri-docker.service &lt;&lt;EOF<br>[Unit]<br>Description=CRI Interface for Docker Application Container Engine<br>Documentation=https://docs.mirantis.com<br>After=network-online.target firewalld.service docker.service<br>Wants=network-online.target<br>Requires=cri-docker.socket<br><br>[Service]<br>Type=notify<br>ExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.7<br>ExecReload=/bin/kill -s HUP $MAINPID<br>TimeoutSec=0<br>RestartSec=2<br>Restart=always<br><br>StartLimitBurst=3<br><br>StartLimitInterval=60s<br><br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>LimitCORE=infinity<br><br>TasksMax=infinity<br>Delegate=yes<br>KillMode=process<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å†™å…¥socketé…ç½®æ–‡ä»¶</span><br>cat &gt; /usr/lib/systemd/system/cri-docker.socket &lt;&lt;EOF<br>[Unit]<br>Description=CRI Docker Socket for the API<br>PartOf=cri-docker.service<br><br>[Socket]<br>ListenStream=%t/cri-dockerd.sock<br>SocketMode=0660<br>SocketUser=root<br>SocketGroup=docker<br><br>[Install]<br>WantedBy=sockets.target<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›è¡Œå¯åŠ¨cri-docker</span><br>systemctl daemon-reload ; systemctl enable cri-docker --now<br></code></pre></td></tr></table></figure><h3 id="ä¸ºkubeleté…ç½®å®¹å™¨è¿è¡Œæ—¶"><a href="#ä¸ºkubeleté…ç½®å®¹å™¨è¿è¡Œæ—¶" class="headerlink" title="ä¸ºkubeleté…ç½®å®¹å™¨è¿è¡Œæ—¶"></a>ä¸ºkubeleté…ç½®å®¹å™¨è¿è¡Œæ—¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">1.25 ç‰ˆæœ¬ä¸‹ æ‰€æœ‰k8sèŠ‚ç‚¹é…ç½®kubelet service</span><br>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF<br><br>[Unit]<br>Description=Kubernetes Kubelet<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=containerd.service<br>Requires=containerd.service<br><br>[Service]<br>ExecStart=/usr/local/bin/kubelet \\<br>    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \\<br>    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\<br>    --config=/etc/kubernetes/kubelet-conf.yml \\<br>    --container-runtime-endpoint=unix:///run/cri-dockerd.sock  \\<br>    --node-labels=node.kubernetes.io/node=<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">1.24 ç‰ˆæœ¬ä¸‹ æ‰€æœ‰k8sèŠ‚ç‚¹é…ç½®kubelet service</span><br>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF<br><br>[Unit]<br>Description=Kubernetes Kubelet<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=containerd.service<br>Requires=containerd.service<br><br>[Service]<br>ExecStart=/usr/local/bin/kubelet \\<br>    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \\<br>    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\<br>    --config=/etc/kubernetes/kubelet-conf.yml \\<br>    --container-runtime=remote  \\<br>    --runtime-request-timeout=15m  \\<br>    --container-runtime-endpoint=unix:///run/cri-dockerd.sock  \\<br>    --cgroup-driver=systemd \\<br>    --node-labels=node.kubernetes.io/node= \\<br>    --feature-gates=IPv6DualStack=true<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å¯</span><br>systemctl daemon-reload<br>systemctl restart kubelet<br>systemctl enable --now kubelet<br></code></pre></td></tr></table></figure><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹å®¹å™¨è¿è¡Œæ—¶</span><br>kubectl  describe node k8s-node05  | grep Container<br>  Container Runtime Version:  docker://20.10.17<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹å®¹å™¨è¿è¡Œæ—¶</span><br>kubectl  describe node  | grep Container<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  containerd://1.6.8<br>  Container Runtime Version:  docker://20.10.17<br></code></pre></td></tr></table></figure><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.oiox.cn/">https://www.oiox.cn/</a></p>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‘åŸç”ŸKubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenELBéƒ¨ç½²åŠåº”ç”¨(åˆ†é…LoadBalanceråœ°å€è¯·æ±‚)</title>
    <link href="/2025/03/19/OpenELB%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%BA%94%E7%94%A8-%E5%88%86%E9%85%8DLoadBalancer%E5%9C%B0%E5%9D%80%E8%AF%B7%E6%B1%82/"/>
    <url>/2025/03/19/OpenELB%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%BA%94%E7%94%A8-%E5%88%86%E9%85%8DLoadBalancer%E5%9C%B0%E5%9D%80%E8%AF%B7%E6%B1%82/</url>
    
    <content type="html"><![CDATA[<hr><h2 id="ä¸€ã€OpenELBä»‹ç»"><a href="#ä¸€ã€OpenELBä»‹ç»" class="headerlink" title="ä¸€ã€OpenELBä»‹ç»"></a>ä¸€ã€OpenELBä»‹ç»</h2><blockquote><p>ç½‘å€ï¼š openelb.io</p></blockquote><p>OpenELB æ˜¯ä¸€ä¸ªå¼€æºçš„<a href="https://so.csdn.net/so/search?q=%E4%BA%91%E5%8E%9F%E7%94%9F&spm=1001.2101.3001.7020">äº‘åŸç”Ÿ</a>è´Ÿè½½å‡è¡¡å™¨å®ç°ï¼Œå¯ä»¥åœ¨åŸºäºè£¸é‡‘å±æœåŠ¡å™¨ã€è¾¹ç¼˜ä»¥åŠè™šæ‹ŸåŒ–çš„ Kubernetes ç¯å¢ƒä¸­ä½¿ç”¨ LoadBalancer ç±»å‹çš„ Service å¯¹å¤–æš´éœ²æœåŠ¡ã€‚OpenELB é¡¹ç›®æœ€åˆç”± KubeSphere ç¤¾åŒºå‘èµ·ï¼Œç›®å‰å·²ä½œä¸º CNCF æ²™ç®±é¡¹ç›®åŠ å…¥ CNCF åŸºé‡‘ä¼šï¼Œç”± OpenELB å¼€æºç¤¾åŒºç»´æŠ¤ä¸æ”¯æŒã€‚</p><p>ä¸ MetalLB ç±»ä¼¼ï¼ŒOpenELB ä¹Ÿæ‹¥æœ‰ä¸¤ç§ä¸»è¦å·¥ä½œæ¨¡å¼ï¼šLayer2 æ¨¡å¼å’Œ BGP æ¨¡å¼ã€‚OpenELB çš„ BGP æ¨¡å¼ç›®å‰æš‚ä¸æ”¯æŒ IPv6ã€‚<br>æ— è®ºæ˜¯ Layer2 æ¨¡å¼è¿˜æ˜¯ BGP æ¨¡å¼ï¼Œæ ¸å¿ƒæ€è·¯éƒ½æ˜¯é€šè¿‡æŸç§æ–¹å¼å°†ç‰¹å®š VIP çš„æµé‡å¼•åˆ° k8s é›†ç¾¤ä¸­ï¼Œç„¶åå†é€šè¿‡ kube-proxy å°†æµé‡è½¬å‘åˆ°åé¢çš„ç‰¹å®šæœåŠ¡ã€‚</p><h3 id="1-1-Layer2-æ¨¡å¼"><a href="#1-1-Layer2-æ¨¡å¼" class="headerlink" title="1.1 Layer2 æ¨¡å¼"></a>1.1 Layer2 æ¨¡å¼</h3><blockquote><p>Layer2 æ¨¡å¼éœ€è¦æˆ‘ä»¬çš„ k8s é›†ç¾¤åŸºç¡€ç¯å¢ƒæ”¯æŒå‘é€ anonymous ARP&#x2F;NDP packetsã€‚å› ä¸º OpenELB æ˜¯é’ˆå¯¹è£¸é‡‘å±æœåŠ¡å™¨è®¾è®¡çš„ï¼Œå› æ­¤å¦‚æœæ˜¯åœ¨äº‘ç¯å¢ƒä¸­éƒ¨ç½²ï¼Œéœ€è¦æ³¨æ„æ˜¯å¦æ»¡è¶³æ¡ä»¶ã€‚</p></blockquote><h3 id="1-2-BGP-æ¨¡å¼"><a href="#1-2-BGP-æ¨¡å¼" class="headerlink" title="1.2 BGP æ¨¡å¼"></a>1.2 BGP æ¨¡å¼</h3><p>OpenELB çš„ BGP æ¨¡å¼ä½¿ç”¨çš„æ˜¯gobgpå®ç°çš„ BGP åè®®ï¼Œé€šè¿‡ä½¿ç”¨ BGP åè®®å’Œè·¯ç”±å™¨å»ºç«‹ BGP è¿æ¥å¹¶å®ç° ECMP è´Ÿè½½å‡è¡¡ï¼Œä»è€Œå®ç°é«˜å¯ç”¨çš„ LoadBalancerã€‚</p><h3 id="1-3-æ³¨æ„äº‹é¡¹"><a href="#1-3-æ³¨æ„äº‹é¡¹" class="headerlink" title="1.3 æ³¨æ„äº‹é¡¹"></a>1.3 æ³¨æ„äº‹é¡¹</h3><blockquote><p>é…ç½® ARP å‚æ•°</p></blockquote><p>éƒ¨ç½² Layer2 æ¨¡å¼éœ€è¦æŠŠ k8s é›†ç¾¤ä¸­çš„ ipvs é…ç½®æ‰“å¼€strictARPï¼Œ<strong>å¼€å¯ä¹‹å k8s é›†ç¾¤ä¸­çš„ <code>kube-proxy</code> ä¼šåœæ­¢å“åº” <code>kube-ipvs0</code> ç½‘å¡ä¹‹å¤–çš„å…¶ä»–ç½‘å¡çš„ arp è¯·æ±‚ï¼Œè€Œç”± OpenELB æ¥æ‰‹å¤„ç†ï¼ˆOpenELBå’ŒMetalLBå¤„ç†æ–¹æ³•ç±»ä¼¼ï¼‰ã€‚</strong></p><p><code>strict ARP</code> å¼€å¯ä¹‹åç›¸å½“äºæŠŠ å°† <code>arp_ignore</code> è®¾ç½®ä¸º 1 å¹¶å°† <code>arp_announce</code> è®¾ç½®ä¸º 2 å¯ç”¨ä¸¥æ ¼çš„ ARPï¼Œè¿™ä¸ªåŸç†å’Œ LVS ä¸­çš„ DR æ¨¡å¼å¯¹ RS çš„é…ç½®ä¸€æ ·ã€‚</p><h2 id="äºŒã€OpenELBå®‰è£…åŠé…ç½®"><a href="#äºŒã€OpenELBå®‰è£…åŠé…ç½®" class="headerlink" title="äºŒã€OpenELBå®‰è£…åŠé…ç½®"></a>äºŒã€OpenELBå®‰è£…åŠé…ç½®</h2><h3 id="2-1-éœ€æ±‚"><a href="#2-1-éœ€æ±‚" class="headerlink" title="2.1 éœ€æ±‚"></a>2.1 éœ€æ±‚</h3><ul><li><p>You need to prepare a Kubernetes cluster, and ensure that the Kubernetes version is 1.15 or later. OpenELB requires CustomResourceDefinition (CRD) v1, which is only supported by Kubernetes 1.15 or later. You can use the following methods to deploy a Kubernetes clusterï¼ˆ1.15ä¹‹åçš„k8sé›†ç¾¤ï¼‰:</p></li><li><p>Use <a href="https://kubesphere.io/docs/installing-on-linux/">KubeKey</a> (recommended). You can use KubeKey to deploy a Kubernetes cluster with or without <a href="https://so.csdn.net/so/search?q=KubeSphere&spm=1001.2101.3001.7020">KubeSphere</a>ï¼ˆkubesphereéƒ¨ç½²çš„é›†ç¾¤ï¼‰.</p></li><li><p>Follow <a href="https://kubernetes.io/docs/home/">official Kubernetes guides</a>.</p></li></ul><p>OpenELB is designed to be used in bare-metal Kubernetes environments. However, you can also use a cloud-based Kubernetes cluster for learning and testingï¼ˆé™¤äº†è£¸é‡‘å±æœåŠ¡å™¨ä¹‹å¤–è¿˜å¯ä»¥æ˜¯äº‘æœåŠ¡å™¨æ­å»ºçš„k8sèŠ‚ç‚¹ï¼‰.</p><h3 id="2-2-Install-OpenELB-Using-kubectl"><a href="#2-2-Install-OpenELB-Using-kubectl" class="headerlink" title="2.2 Install OpenELB Using kubectl"></a>2.2 Install OpenELB Using kubectl</h3><p>å¯å‚ç…§å®˜ç½‘çš„å®‰è£…æ–¹å¼æ¥è¿›è¡Œå®‰è£…ï¼ˆé€‰æ‹©ä¸åŒçš„é›†ç¾¤ï¼‰ï¼š<a href="https://openelb.io/docs/getting-started/installation/">https://openelb.io/docs/getting-started/installation/</a></p><p>1.Log in to the Kubernetes cluster over SSH and run the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ—§ç‰ˆæœ¬</span><br>kubectl apply -f https://raw.githubusercontent.com/openelb/openelb/master/deploy/openelb.yaml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–°ç‰ˆæœ¬2024-08-27</span><br>wget https://raw.githubusercontent.com/openelb/openelb/release-0.6/deploy/openelb.yaml<br>kubectl apply -f openelb.yaml<br></code></pre></td></tr></table></figure><p>2.Run the following command to check whether the status of <code>openelb-manager</code> is <strong>READY</strong>: <strong>1&#x2F;1</strong> and <strong>STATUS</strong>: <strong>Running</strong>. If yes, OpenELB has been installed successfully.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># æ‰“å¼€https://raw.githubusercontent.com/openelb/openelb/release-0.6/deploy/openelb.yaml å¯ä»¥çœ‹åˆ°åˆ›å»ºçš„èµ„æºéƒ½åœ¨openelb-systemåç§°ç©ºé—´å†…ï¼Œæ‰€ä»¥é€šè¿‡ä¸‹é¢çš„è¯­å¥æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</span><br><span class="hljs-comment"># kubectl get pods -n openelb-system</span><br></code></pre></td></tr></table></figure><h3 id="2-2-OpenELBé…ç½®"><a href="#2-2-OpenELBé…ç½®" class="headerlink" title="2.2 OpenELBé…ç½®"></a>2.2 OpenELBé…ç½®</h3><blockquote><p>Use OpenELB in Layer 2 Modeï¼ˆäºŒå±‚æ¨¡å¼çš„ä½¿ç”¨ï¼‰</p></blockquote><h4 id="2-2-1-éœ€æ±‚"><a href="#2-2-1-éœ€æ±‚" class="headerlink" title="2.2.1 éœ€æ±‚"></a>2.2.1 éœ€æ±‚</h4><ul><li>You need to <a href="https://openelb.io/docs/getting-started/installation/">prepare a Kubernetes cluster where OpenELB has been installed</a>. All Kubernetes cluster nodes must be on the same Layer 2 network (under the same router).</li><li>You need to prepare a client machine, which is used to verify whether OpenELB functions properly in Layer 2 mode. The client machine needs to be on the same network as the Kubernetes cluster nodes.</li><li>The Layer 2 mode requires your infrastructure environment to allow anonymous ARP&#x2F;NDP packets. If OpenELB is installed in a cloud-based Kubernetes cluster for testing, you need to confirm with your cloud vendor whether anonymous ARP&#x2F;NDP packets are allowed. If not, the Layer 2 mode cannot be used.</li></ul><h4 id="2-2-2-é…ç½®æ­¥éª¤"><a href="#2-2-2-é…ç½®æ­¥éª¤" class="headerlink" title="2.2.2 é…ç½®æ­¥éª¤"></a>2.2.2 é…ç½®æ­¥éª¤</h4><p><strong>Step 1: Enable strictARP for kube-proxy</strong></p><p>In Layer 2 mode, you need to enable strictARP for kube-proxy so that all NICs in the Kubernetes cluster stop answering ARP requests from other NICs and OpenELB handles ARP requests instead.</p><p>1.Log in to the Kubernetes cluster and run the following command to edit the kube-proxy ConfigMap:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl edit configmap kube-proxy -n kube-system</span><br></code></pre></td></tr></table></figure><p>2.In the kube-proxy ConfigMap YAML configuration, set <code>data.config.conf.ipvs.strictARP</code> to <code>true</code>.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ipvs:<br>  strictARP: true<br></code></pre></td></tr></table></figure><p>3.Run the following command to restart kube-proxyï¼ˆé‡å¯kube-systemåç§°ç©ºé—´å½“ä¸­çš„daemonsetèµ„æºï¼Œè®©é…ç½®ä¸¥æ ¼arpæ¨¡å¼ç”Ÿæ•ˆï¼‰:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl rollout restart daemonset kube-proxy -n kube-system</span><br></code></pre></td></tr></table></figure><p><strong>Step 2: Specify the NIC Used for OpenELBï¼ˆå¦‚æœæ˜¯å¤šç½‘å¡ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‡å®šå‡ºå£ï¼‰</strong></p><p>If the node where OpenELB is installed has multiple NICs, you need to specify the NIC used for OpenELB in Layer 2 mode. You can skip this step if the node has only one NIC.</p><p>In this example, the master1 node where OpenELB is installed has two NICs (eth0 192.168.0.2 and eth1 192.168.1.2), and eth0 192.168.0.2 will be used for OpenELB.</p><p>Run the following command to annotate master1 to specify the NIC:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl annotate nodes k8s-master01 layer2.openelb.kubesphere.io/v1alpha1=&quot;192.168.10.141&quot;</span><br></code></pre></td></tr></table></figure><p><strong>Step 3: Create an Eip Objectï¼ˆåˆ›å»ºEIPåœ°å€æ± ï¼Œç”¨äºåˆ†é…LoadBalancerè¯·æ±‚æ—¶åˆ†é…IPåœ°å€ï¼‰</strong></p><p>The Eip object functions as an IP address pool for OpenELB.</p><p>1.Run the following command to create a YAML file for the Eip object:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># vim layer2-eip.yaml</span><br></code></pre></td></tr></table></figure><p>2.Add the following information to the YAML file:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># æ—§ç‰ˆæœ¬</span><br>apiVersion: network.kubesphere.io/v1alpha2<br>kind: Eip<br>metadata:<br>  name: layer2<span class="hljs-literal">-eip</span><br>spec:<br>  address: <span class="hljs-number">192.168</span>.<span class="hljs-number">10.70</span><span class="hljs-literal">-192</span>.<span class="hljs-number">168.10</span>.<span class="hljs-number">99</span><br>  interface: ens33<br>  protocol: layer2<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">2024-08-27 åŸºäºå®˜ç½‘æœ€æ–°çš„åœ°å€æ± é…ç½®ï¼Œç®€è¦ç‰ˆæœ¬çš„å¾€ä¸‹æ‹‰ä¸€ç‚¹å°±æ˜¯</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®˜æ–¹é…ç½®åœ°å€ï¼š https://openelb.io/docs/getting-started/configuration/configure-ip-address-pools-using-eip/</span><br>apiVersion: network.kubesphere.io/v1alpha2<br>kind: Eip<br>metadata:<br>    name: eip-sample-pool<br>    annotations:<br>      eip.openelb.kubesphere.io/is-default-eip: &quot;true&quot;<br>spec:<br>    address: 192.168.0.91-192.168.0.100<br>    # åœ°å€æ± çš„ä¼˜å…ˆçº§<br>    priority: 100<br>    # namespace ä¹Ÿå¯ä»¥çœ‹éœ€æ±‚æŒ‡å®šï¼Œè¿™ä¸ªåœ°å€æ± åœ¨ä»€ä¹ˆåç§°ç©ºé—´å½“ä¸­ä½¿ç”¨<br>    namespaces:<br>      - test<br>      - default<br>    namespaceSelector:<br>      kubesphere.io/workspace: workspace<br>    disable: false<br>    protocol: layer2<br>    interface: eth0<br>    # interface: can_reach:192.168.0.1<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸‹é¢è¿™ä¸ªä¸è¦ï¼Œå› ä¸ºstatusæ˜¯åœ¨åˆ›å»ºèµ„æºåæŸ¥çœ‹æ˜¯å¦è¾¾åˆ°ä½ è¦æ±‚çš„èµ„æºï¼Œæ‰€ä»¥åœ¨é…ç½®çš„æ—¶å€™å¯ä»¥ä¸è¦</span><br>status:<br>    occupied: false<br>    usage: 1<br>    poolSize: 10<br>    used: <br>      &quot;192.168.0.91&quot;: &quot;default/test-svc&quot;<br>    firstIP: 192.168.0.91<br>    lastIP: 192.168.0.100<br>    ready: true<br>    v4: true<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">2024-08-27 ç®€è¦ç‰ˆ</span><br>apiVersion: network.kubesphere.io/v1alpha2<br>kind: Eip<br>metadata:<br>  name: layer2-eip<br>spec:<br>  address: 172.31.73.130-172.31.73.132<br>  namespaces: <br>  - project<br>  interface: eth0<br>  protocol: layer2<br><br></code></pre></td></tr></table></figure><blockquote><ul><li>The IP addresses specified in <code>spec:address</code> must be on the same network segment as the Kubernetes cluster nodes.</li><li>For details about the fields in the Eip YAML configuration, see <a href="https://openelb.io/docs/getting-started/configuration/configure-ip-address-pools-using-eip/">Configure IP Address Pools Using Eip</a>.</li></ul></blockquote><p>3.Run the following command to create the Eip object:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl apply -f layer2-eip.yaml</span><br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€OpenELBä½¿ç”¨"><a href="#ä¸‰ã€OpenELBä½¿ç”¨" class="headerlink" title="ä¸‰ã€OpenELBä½¿ç”¨"></a>ä¸‰ã€OpenELBä½¿ç”¨</h2><h3 id="3-1-åœ¨k8så‘½ä»¤è¡Œä¸­ä½¿ç”¨"><a href="#3-1-åœ¨k8så‘½ä»¤è¡Œä¸­ä½¿ç”¨" class="headerlink" title="3.1 åœ¨k8så‘½ä»¤è¡Œä¸­ä½¿ç”¨"></a>3.1 åœ¨k8så‘½ä»¤è¡Œä¸­ä½¿ç”¨</h3><h4 id="3-1-1-Create-a-Deployment"><a href="#3-1-1-Create-a-Deployment" class="headerlink" title="3.1.1 Create a Deployment"></a>3.1.1 Create a Deployment</h4><p>The following creates a Deployment of two Pods using the luksa&#x2F;kubia image. Each Pod returns its own Pod name to external requests.</p><p>1.Run the following command to create a YAML file for the Deployment:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># vim layer2-openelb.yaml</span><br></code></pre></td></tr></table></figure><p>2.Add the following information to the YAML file:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># åˆ›å»ºæ™®é€šçš„dpèµ„æºï¼Œéœ€è¦æ³¨æ„ä½ ä¸Šé¢åˆ›å»ºçš„EIPåœ¨å“ªä¸ªåç§°ç©ºé—´å½“ä¸­ã€‚</span><br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: layer2<span class="hljs-literal">-openelb</span><br>spec:<br>  replicas: <span class="hljs-number">2</span><br>  selector:<br>    matchLabels:<br>      app: layer2<span class="hljs-literal">-openelb</span><br>  template:<br>    metadata:<br>      labels:<br>        app: layer2<span class="hljs-literal">-openelb</span><br>    spec:<br>      containers:<br>        - image: luksa/kubia<br>          name: kubia<br>          ports:<br>            - containerPort: <span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure><p>3.Run the following command to create the Deployment:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl apply -f layer2-openelb.yaml</span><br></code></pre></td></tr></table></figure><h4 id="3-1-2-Create-a-Service"><a href="#3-1-2-Create-a-Service" class="headerlink" title="3.1.2 Create a Service"></a>3.1.2 Create a Service</h4><p>1.Run the following command to create a YAML file for the Service:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># vim layer2-svc.yaml</span><br></code></pre></td></tr></table></figure><p>2.Add the following information to the YAML file:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kind: Service<br>apiVersion: v1<br>metadata:<br>  name: layer2<span class="hljs-literal">-svc</span><br>  annotations:<br>    lb.kubesphere.io/v1alpha1: openelb<br>    protocol.openelb.kubesphere.io/v1alpha1: layer2<br>    eip.openelb.kubesphere.io/v1alpha2: layer2<span class="hljs-literal">-eip</span><br>spec:<br>  selector:<br>    app: layer2<span class="hljs-literal">-openelb</span><br>  <span class="hljs-built_in">type</span>: LoadBalancer<br>  ports:<br>    - name: http<br>      port: <span class="hljs-number">80</span><br>      targetPort: <span class="hljs-number">8080</span><br>  externalTrafficPolicy: Cluster<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">2024-08-27  åŒ…å«EIPåœ°å€æ± çš„ä½¿ç”¨æ–¹æ³•</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿™é‡Œä½¿ç”¨çš„æ˜¯ç®€è¦ç‰ˆçš„EIPåœ°å€æ± </span><br><br>kind: Service<br>apiVersion: v1<br>metadata:<br>  name: nginx<br>  namespace: project-test<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">EIPçš„ä½¿ç”¨ä¸»è¦æ˜¯æ ¹æ®æ³¨è§£ï¼Œå¦‚æœæ˜¯åœ¨å…¶ä»–çš„äº‘å¹³å°ä¸Šä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ æ³¨è§£æ¥è¾¾åˆ°ä½¿ç”¨openELBåˆ†é…çš„IPåœ°å€</span><br>  annotations:<br>    lb.kubesphere.io/v1alpha1: openelb<br>    eip.openelb.kubesphere.io/v1alpha2: layer2-eip<br>spec:<br>  selector:<br>    app: nginx<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">é€‰æ‹©åˆ†é…LoadBalancer</span><br>  type: LoadBalancer<br>  ports:<br>    - name: http<br>      port: 80<br>      targetPort: 80<br>  externalTrafficPolicy: Cluster<br></code></pre></td></tr></table></figure><blockquote><ul><li>You must set <code>spec:type</code> to <code>LoadBalancer</code>.</li><li>The <code>lb.kubesphere.io/v1alpha1: openelb</code> annotation specifies that the Service uses OpenELB.</li><li>The <code>protocol.openelb.kubesphere.io/v1alpha1: layer2</code> annotation specifies that OpenELB is used in Layer 2 mode.</li><li>The <code>eip.openelb.kubesphere.io/v1alpha2: layer2-eip</code> annotation specifies the Eip object used by OpenELB. If this annotation is not configured, OpenELB automatically uses the first available Eip object that matches the protocol. You can also delete this annotation and add the <code>spec:loadBalancerIP</code> field (for example, <code>spec:loadBalancerIP: 192.168.0.91</code>) to assign a specific IP address to the Service.</li><li>If <code>spec:externalTrafficPolicy</code> is set to <code>Cluster</code> (default value), OpenELB randomly selects a node from all Kubernetes cluster nodes to handle Service requests. Pods on other nodes can also be reached over kube-proxy.</li><li>If <code>spec:externalTrafficPolicy</code> is set to <code>Local</code>, OpenELB randomly selects a node that contains a Pod in the Kubernetes cluster to handle Service requests. Only Pods on the selected node can be reached.</li></ul></blockquote><p>3.Run the following command to create the Service:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kubectl apply <span class="hljs-operator">-f</span> layer2<span class="hljs-literal">-svc</span>.yaml<br></code></pre></td></tr></table></figure><h4 id="3-1-3-Verify-OpenELB-in-Layer-2-Mode"><a href="#3-1-3-Verify-OpenELB-in-Layer-2-Mode" class="headerlink" title="3.1.3 Verify OpenELB in Layer 2 Mode"></a>3.1.3 Verify OpenELB in Layer 2 Mode</h4><p>In the Kubernetes cluster, run the following command to obtain the external IP address of the Service:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># kubectl get svc</span><br></code></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‘åŸç”ŸOpenELB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PrometheusåŸºäºé›†ç¾¤æ¨¡å¼Consulè‡ªåŠ¨å‘ç°ï¼ˆconsul_sd_configsï¼‰</title>
    <link href="/2025/03/19/Prometheus%E5%9F%BA%E4%BA%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8FConsul%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0%EF%BC%88consul-sd-configs%EF%BC%89/"/>
    <url>/2025/03/19/Prometheus%E5%9F%BA%E4%BA%8E%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8FConsul%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0%EF%BC%88consul-sd-configs%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="1-å®‰è£…é…ç½®-Consul-é›†ç¾¤æ¨¡å¼"><a href="#1-å®‰è£…é…ç½®-Consul-é›†ç¾¤æ¨¡å¼" class="headerlink" title="1. å®‰è£…é…ç½® Consul é›†ç¾¤æ¨¡å¼"></a>1. å®‰è£…é…ç½® Consul é›†ç¾¤æ¨¡å¼</h2><p>Consul é›†ç¾¤æ¨¡å¼æ”¯æŒé«˜å¯ç”¨æ€§ï¼Œå¤šä¸ªèŠ‚ç‚¹ååŒå·¥ä½œã€‚ä»¥ä¸‹æ˜¯å®‰è£…å’Œé…ç½®æ­¥éª¤ï¼š</p><h3 id="1-1-å®‰è£…-Consulé›†ç¾¤"><a href="#1-1-å®‰è£…-Consulé›†ç¾¤" class="headerlink" title="1.1 å®‰è£… Consulé›†ç¾¤"></a>1.1 å®‰è£… Consulé›†ç¾¤</h3><ol><li><p>ä¸‹è½½å¹¶è§£å‹ Consul äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://releases.hashicorp.com/consul/1.15.2/consul_1.15.2_linux_amd64.zip<br>unzip consul_1.15.2_linux_amd64.zip<br>sudo mv consul /usr/local/bin/<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»º Consul æ•°æ®ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mkdir -p /opt/consul/data<br></code></pre></td></tr></table></figure></li></ol><h3 id="1-2-é…ç½®-Consul-æœåŠ¡å™¨èŠ‚ç‚¹"><a href="#1-2-é…ç½®-Consul-æœåŠ¡å™¨èŠ‚ç‚¹" class="headerlink" title="1.2 é…ç½® Consul æœåŠ¡å™¨èŠ‚ç‚¹"></a>1.2 é…ç½® Consul æœåŠ¡å™¨èŠ‚ç‚¹</h3><p>åœ¨æ¯ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šåˆ›å»º Consul é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>/etc/consul.d/consul.json</code>ï¼‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># æ¯ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹çš„é…ç½®ç›¸ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ node_name å’Œ bind_addr çš„ IP åœ°å€ï¼Œè¿˜æœ‰retry_joinçš„ipåœ°å€éœ€è¦æ ¹æ®bind_addrå»æŒ‡å®šã€‚</span><br>&#123;<br>  <span class="hljs-attr">&quot;datacenter&quot;:</span> <span class="hljs-string">&quot;dc1&quot;</span>,<br>  <span class="hljs-attr">&quot;node_name&quot;:</span> <span class="hljs-string">&quot;consul-server-1&quot;</span>,<br>  <span class="hljs-attr">&quot;server&quot;:</span> <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">&quot;bootstrap_expect&quot;:</span> <span class="hljs-number">3</span>,<br>  <span class="hljs-attr">&quot;bind_addr&quot;:</span> <span class="hljs-string">&quot;192.168.1.101&quot;</span>,<br>  <span class="hljs-attr">&quot;client_addr&quot;:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span>,<br>  <span class="hljs-attr">&quot;retry_join&quot;:</span> [<span class="hljs-string">&quot;192.168.1.102&quot;</span>, <span class="hljs-string">&quot;192.168.1.103&quot;</span>],<br>  <span class="hljs-attr">&quot;data_dir&quot;:</span> <span class="hljs-string">&quot;/opt/consul/data&quot;</span>,<br>  <span class="hljs-attr">&quot;log_level&quot;:</span> <span class="hljs-string">&quot;INFO&quot;</span>,<br>  <span class="hljs-attr">&quot;ui&quot;:</span> <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é…ç½®è¯´æ˜ï¼š"><a href="#é…ç½®è¯´æ˜ï¼š" class="headerlink" title="é…ç½®è¯´æ˜ï¼š"></a>é…ç½®è¯´æ˜ï¼š</h4><ul><li><strong>bootstrap_expect</strong>ï¼šæœŸæœ›çš„ Consul æœåŠ¡å™¨èŠ‚ç‚¹æ•°é‡ï¼ˆå¦‚ä¸Šé¢é…ç½®å½“ä¸­çš„3ï¼Œè¡¨ç¤ºä¼šæœ‰3ä¸ªèŠ‚ç‚¹ï¼‰ã€‚</li><li><strong>retry_join</strong>ï¼šåŠ å…¥é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ IPã€‚</li><li><strong>bind_addr</strong>ï¼šå½“å‰èŠ‚ç‚¹çš„ IP åœ°å€ã€‚</li></ul><p>å¯åŠ¨ Consul æœåŠ¡å™¨èŠ‚ç‚¹(é›†ç¾¤æ¨¡å¼éœ€è¦åœ¨ä¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šè¿›è¡Œå¯åŠ¨)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">consul agent -server -config-file=/etc/consul.d/consul.json<br></code></pre></td></tr></table></figure><h3 id="1-3-é…ç½®-Consul-å®¢æˆ·ç«¯èŠ‚ç‚¹"><a href="#1-3-é…ç½®-Consul-å®¢æˆ·ç«¯èŠ‚ç‚¹" class="headerlink" title="1.3 é…ç½® Consul å®¢æˆ·ç«¯èŠ‚ç‚¹"></a>1.3 é…ç½® Consul å®¢æˆ·ç«¯èŠ‚ç‚¹</h3><p>å®¢æˆ·ç«¯èŠ‚ç‚¹é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆä½äº <code>/etc/consul.d/consul.json</code>ï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"># å®¢æˆ·ç«¯åœ°å€ä¹Ÿæœ‰ä¸€ä¸ªbind_addrç›‘å¬å®¢æˆ·ç«¯åœ°å€<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;datacenter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dc1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;node_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;consul-client-1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;bind_addr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;192.168.1.104&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;client_addr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;retry_join&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;192.168.1.101&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;192.168.1.102&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;192.168.1.103&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data_dir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/opt/consul/data&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;log_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;INFO&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ui&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">consul agent -config-file=/etc/consul.d/consul.json<br></code></pre></td></tr></table></figure><h3 id="1-4-éªŒè¯-Consul-é›†ç¾¤"><a href="#1-4-éªŒè¯-Consul-é›†ç¾¤" class="headerlink" title="1.4 éªŒè¯ Consul é›†ç¾¤"></a>1.4 éªŒè¯ Consul é›†ç¾¤</h3><p>é€šè¿‡ Web UI éªŒè¯é›†ç¾¤çŠ¶æ€ï¼Œè®¿é—® <code>http://&lt;ä»»æ„æœåŠ¡å™¨IP&gt;:8500/ui</code>ã€‚</p><hr><h2 id="2-å°†åº”ç”¨æ³¨å†Œåˆ°-Consul-é›†ç¾¤"><a href="#2-å°†åº”ç”¨æ³¨å†Œåˆ°-Consul-é›†ç¾¤" class="headerlink" title="2. å°†åº”ç”¨æ³¨å†Œåˆ° Consul é›†ç¾¤"></a>2. å°†åº”ç”¨æ³¨å†Œåˆ° Consul é›†ç¾¤</h2><p>Consul æ”¯æŒ <strong>æ‰‹åŠ¨æœåŠ¡æ³¨å†Œ</strong> å’Œ <strong>è‡ªåŠ¨æœåŠ¡æ³¨å†Œ</strong>ã€‚</p><h3 id="2-1-æ‰‹åŠ¨æ³¨å†ŒæœåŠ¡"><a href="#2-1-æ‰‹åŠ¨æ³¨å†ŒæœåŠ¡" class="headerlink" title="2.1 æ‰‹åŠ¨æ³¨å†ŒæœåŠ¡"></a>2.1 æ‰‹åŠ¨æ³¨å†ŒæœåŠ¡</h3><p>å¯ä»¥åˆ›å»ºæœåŠ¡å®šä¹‰æ–‡ä»¶ï¼Œå¦‚ <code>/etc/consul.d/my-web-app.json</code>ï¼Œæ³¨å†ŒæœåŠ¡ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;service&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;my-web-app&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;web&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;v1&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8080</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;check&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;my-web-app-health&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HTTP Health Check&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;http&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost:8080/health&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;interval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10s&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;timeout&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1s&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ä»¥ä¸‹å‘½ä»¤é‡æ–°åŠ è½½ Consul é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">consul reload<br></code></pre></td></tr></table></figure><h3 id="2-2-è‡ªåŠ¨æ³¨å†ŒæœåŠ¡"><a href="#2-2-è‡ªåŠ¨æ³¨å†ŒæœåŠ¡" class="headerlink" title="2.2 è‡ªåŠ¨æ³¨å†ŒæœåŠ¡"></a>2.2 è‡ªåŠ¨æ³¨å†ŒæœåŠ¡</h3><p>æœåŠ¡å¯ä»¥é€šè¿‡è°ƒç”¨ Consul API è‡ªåŠ¨æ³¨å†Œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>curl</code> å‘½ä»¤è¿›è¡Œæ³¨å†Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --request PUT --data \<br>&#x27;&#123;<br>  &quot;ID&quot;: &quot;my-web-app&quot;,<br>  &quot;Name&quot;: &quot;my-web-app&quot;,<br>  &quot;Tags&quot;: [&quot;web&quot;, &quot;v1&quot;],<br>  &quot;Address&quot;: &quot;localhost&quot;,<br>  &quot;Port&quot;: 8080,<br>  &quot;Check&quot;: &#123;<br>    &quot;HTTP&quot;: &quot;http://localhost:8080/health&quot;,<br>    &quot;Interval&quot;: &quot;10s&quot;<br>  &#125;<br>&#125;&#x27; http://localhost:8500/v1/agent/service/register<br></code></pre></td></tr></table></figure><hr><h2 id="3-é…ç½®-Prometheus-åŠ¨æ€å‘ç°-Consul-æ³¨å†Œçš„æœåŠ¡"><a href="#3-é…ç½®-Prometheus-åŠ¨æ€å‘ç°-Consul-æ³¨å†Œçš„æœåŠ¡" class="headerlink" title="3. é…ç½® Prometheus åŠ¨æ€å‘ç° Consul æ³¨å†Œçš„æœåŠ¡"></a>3. é…ç½® Prometheus åŠ¨æ€å‘ç° Consul æ³¨å†Œçš„æœåŠ¡</h2><h3 id="3-1-ä¿®æ”¹-Prometheus-é…ç½®æ–‡ä»¶"><a href="#3-1-ä¿®æ”¹-Prometheus-é…ç½®æ–‡ä»¶" class="headerlink" title="3.1 ä¿®æ”¹ Prometheus é…ç½®æ–‡ä»¶"></a>3.1 ä¿®æ”¹ Prometheus é…ç½®æ–‡ä»¶</h3><p>åœ¨ Prometheus é…ç½®æ–‡ä»¶ <code>prometheus.yml</code> ä¸­æ·»åŠ  <strong>Consul æœåŠ¡å‘ç°é…ç½®</strong>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">scrape_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;consul-services&#x27;</span><br>    <span class="hljs-attr">consul_sd_configs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">server:</span> <span class="hljs-string">&#x27;localhost:8500&#x27;</span><br>        <span class="hljs-attr">services:</span> <br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;my-web-app&#x27;</span><br>    <span class="hljs-attr">relabel_configs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__meta_consul_service</span>]<br>        <span class="hljs-attr">regex:</span> <span class="hljs-string">&#x27;my-web-app&#x27;</span><br>        <span class="hljs-attr">action:</span> <span class="hljs-string">keep</span><br></code></pre></td></tr></table></figure><h3 id="3-2-é‡æ–°å¯åŠ¨-Prometheus"><a href="#3-2-é‡æ–°å¯åŠ¨-Prometheus" class="headerlink" title="3.2 é‡æ–°å¯åŠ¨ Prometheus"></a>3.2 é‡æ–°å¯åŠ¨ Prometheus</h3><p>æ›´æ–°é…ç½®åï¼Œé‡æ–°å¯åŠ¨ Prometheusï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./prometheus --config.file=prometheus.yml<br></code></pre></td></tr></table></figure><h3 id="3-3-éªŒè¯æœåŠ¡å‘ç°"><a href="#3-3-éªŒè¯æœåŠ¡å‘ç°" class="headerlink" title="3.3 éªŒè¯æœåŠ¡å‘ç°"></a>3.3 éªŒè¯æœåŠ¡å‘ç°</h3><p>è®¿é—® Prometheus Web UI (<code>http://localhost:9090</code>)ï¼Œè¿›å…¥ <strong>Targets</strong> é¡µé¢ï¼Œæ£€æŸ¥ <code>my-web-app</code> æ˜¯å¦å·²è¢«åŠ¨æ€å‘ç°å¹¶æŠ“å–ã€‚</p><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>Consul é›†ç¾¤æ¨¡å¼</strong> æä¾›é«˜å¯ç”¨æœåŠ¡å‘ç°ã€‚</li><li>åº”ç”¨å¯ä»¥é€šè¿‡æ‰‹åŠ¨æˆ–è‡ªåŠ¨æ–¹å¼æ³¨å†Œåˆ° Consulã€‚</li><li><strong>Prometheus</strong> å¯ä»¥é€šè¿‡ <strong>Consul æœåŠ¡å‘ç°</strong> åŠ¨æ€æŠ“å–å·²æ³¨å†Œçš„æœåŠ¡æŒ‡æ ‡ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‘åŸç”ŸPrometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PrometheusåŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°é…ç½®ï¼ˆfile_sd_configsï¼‰</title>
    <link href="/2025/03/19/Prometheus%E5%9F%BA%E4%BA%8E%E6%96%87%E4%BB%B6%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E9%85%8D%E7%BD%AE%EF%BC%88file-sd-configs%EF%BC%89/"/>
    <url>/2025/03/19/Prometheus%E5%9F%BA%E4%BA%8E%E6%96%87%E4%BB%B6%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E9%85%8D%E7%BD%AE%EF%BC%88file-sd-configs%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="è§£å†³çš„é—®é¢˜"><a href="#è§£å†³çš„é—®é¢˜" class="headerlink" title="è§£å†³çš„é—®é¢˜"></a>è§£å†³çš„é—®é¢˜</h1><ul><li>ä¹‹å‰æ‰‹åŠ¨é…ç½®äº†å¾ˆå¤šä¸ªtraget<ul><li>redis</li><li>mysql</li><li>blackbox</li><li>pushgateway</li></ul></li><li>æ‰‹åŠ¨é…ç½®ç»´æŠ¤æˆæœ¬é«˜ï¼Œè¿˜å®¹æ˜“å‡ºé”™</li></ul><h1 id="åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°é…ç½®"><a href="#åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°é…ç½®" class="headerlink" title="åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°é…ç½®"></a>åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°é…ç½®</h1><ul><li><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#file_sd_config">æ–‡æ¡£åœ°å€</a></li><li>å°†é…ç½®å†™åœ¨yaml&#x2F;jsonçš„æ–‡ä»¶å½“ä¸­ï¼Œé€šè¿‡Prometheusçš„ä¸»é…ç½®æ–‡ä»¶å¼•å…¥ï¼Œå®ç°åœ¨Prometheusä¸»é…ç½®æ–‡ä»¶ä¹‹å¤–çš„æ–‡ä»¶å½“ä¸­åŠ¨æ€çš„æ·»åŠ æˆ–åˆ é™¤å¯¹åº”çš„ç›‘æ§é¡¹</li></ul><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><ul><li>åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°æä¾›äº†ä¸€ç§<strong>é…ç½®é™æ€ç›®æ ‡</strong>çš„æ›´é€šç”¨çš„æ–¹æ³•</li><li>å¹¶å……å½“äº†æ’å…¥è‡ªå®šä¹‰æœåŠ¡å‘ç°æœºåˆ¶çš„æ¥å£ã€‚</li><li>æ‘†è„±å¯¹ç‰¹å®šæœåŠ¡å‘ç°æºçš„ä¾èµ–</li><li>åªè¦èƒ½æ­£ç¡®ç»™å‡º json&#x2F;yamlæ–‡ä»¶å³å¯</li><li>å’ŒæœåŠ¡æ ‘çš„æœ€å¥½åŒ¹é…æ–¹æ¡ˆ</li></ul><h2 id="yamlæ–‡ä»¶ç±»å‹"><a href="#yamlæ–‡ä»¶ç±»å‹" class="headerlink" title="yamlæ–‡ä»¶ç±»å‹"></a>yamlæ–‡ä»¶ç±»å‹</h2><ul><li>yaml</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">YAML yaml - targets: [ - &#x27;&lt;host&gt;&#x27; ] labels: [ &lt;labelname&gt;: &lt;labelvalue&gt; ... ]<br><br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span>  <br>  <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.222</span><span class="hljs-string">:9100</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.223</span><span class="hljs-string">:9100</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">account:</span> <span class="hljs-string">&quot;aliyun-01&quot;</span>   <br>    <span class="hljs-attr">region:</span> <span class="hljs-string">&quot;ap-south-1&quot;</span><br></code></pre></td></tr></table></figure><h2 id="jsonæ–‡ä»¶ç±»å‹"><a href="#jsonæ–‡ä»¶ç±»å‹" class="headerlink" title="jsonæ–‡ä»¶ç±»å‹"></a>jsonæ–‡ä»¶ç±»å‹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">json [ &#123; &quot;targets&quot;: [ &quot;&lt;host&gt;&quot;, ... ], &quot;labels&quot;: &#123; &quot;&lt;labelname&gt;&quot;: &quot;&lt;labelvalue&gt;&quot;, ... &#125; &#125;, ... ]<br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;targets&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;192.168.101.222:9100&quot;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;labels&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;account&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aliyun-01&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;region&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ap-south-1&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;prod&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inf&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;project&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;monitor&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;stree_gpa&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inf.monitor.prometheus&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;targets&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;192.168.101.223:9100&quot;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;labels&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;account&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aliyun-02&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;region&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ap-south-2&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;prod&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;group&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inf&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;project&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;middleware&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;stree_gpa&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inf.middleware.kafka&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><h3 id="ä¸‹é¢æ¥è§£è¯»ä¸€ä¸‹"><a href="#ä¸‹é¢æ¥è§£è¯»ä¸€ä¸‹" class="headerlink" title="ä¸‹é¢æ¥è§£è¯»ä¸€ä¸‹"></a>ä¸‹é¢æ¥è§£è¯»ä¸€ä¸‹</h3><ul><li><strong>targets æ˜¯ä¸€ç»„å®ä¾‹åœ°å€çš„åˆ—è¡¨</strong></li><li><strong>labels æ˜¯è¿™ç»„å®ä¾‹çš„æ ‡ç­¾ï¼Œåº”ç”¨åˆ°åˆ—è¡¨ä¸­æ‰€æœ‰å®ä¾‹</strong></li><li>å¦‚æœæƒ³æ¯ä¸ªå®ä¾‹ä¸åŒçš„æ ‡ç­¾ï¼Œå¯ä»¥å°†targetsåˆ—è¡¨ä¿ç•™ä¸€ä¸ªå®ä¾‹å³å¯</li><li>æ ‡ç­¾å¯ä»¥è‡ªå®šä¹‰ï¼Œä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­<ul><li>account ä»£è¡¨å…¬æœ‰äº‘è´¦æˆ·ï¼Œå¤šè´¦æˆ·æƒ…å†µ</li><li>region ä»£è¡¨åŒºåŸŸ</li><li>env ä»£è¡¨æ‰€å±ç¯å¢ƒ prodä»£è¡¨ç”Ÿäº§ï¼Œpreä»£è¡¨é¢„å‘ï¼Œtestä»£è¡¨æµ‹è¯•</li><li>groupä»£è¡¨ä¸šåŠ¡å¤§ç»„</li><li>project ä»£è¡¨é¡¹ç›®</li><li>stree_gpa ä»£è¡¨æœåŠ¡æ ‘ä¸‰çº§æ ‡ç­¾</li></ul></li><li>é‚£ä¹ˆprometheusåœ¨é‡‡é›†å¯¹åº”targetæ—¶å°±ä¼šå°†å¯¹åº”æ ‡ç­¾æ‰“å…¥å…¶metricsä¸­</li><li>ä¸ºåç»­æˆ‘ä»¬æŒ‰ç…§æ ‡ç­¾è¿‡æ»¤æä¾›æ–¹ä¾¿</li></ul><h2 id="é…ç½®ä¸¾ä¾‹"><a href="#é…ç½®ä¸¾ä¾‹" class="headerlink" title="é…ç½®ä¸¾ä¾‹"></a>é…ç½®ä¸¾ä¾‹</h2><ul><li>files ä»£è¡¨ æ–‡ä»¶è·¯å¾„ æ”¯æŒé€šé…ç¬¦</li><li>refresh_interval ä»£è¡¨ æ–‡ä»¶åˆ·æ–°é—´éš”</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;node_exporter&#x27;</span><br>  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">30s</span><br>  <span class="hljs-attr">scrape_timeout:</span> <span class="hljs-string">10s</span><br>  <span class="hljs-attr">metrics_path:</span> <span class="hljs-string">/metrics</span><br>  <span class="hljs-attr">scheme:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">honor_timestamps:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-comment"># é…ç½®æ–‡ä»¶å‘ç°é…ç½®</span><br>  <span class="hljs-attr">file_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/app/prometheus/sd/node_exporter.json</span><br>    <span class="hljs-comment"># åˆ·æ–°çš„é¢‘ç‡</span><br>    <span class="hljs-attr">refresh_interval:</span> <span class="hljs-string">5m</span><br></code></pre></td></tr></table></figure><h2 id="æ”¹é€ ä¸ºæœåŠ¡å‘ç°ç±»å‹"><a href="#æ”¹é€ ä¸ºæœåŠ¡å‘ç°ç±»å‹" class="headerlink" title="æ”¹é€ ä¸ºæœåŠ¡å‘ç°ç±»å‹"></a>æ”¹é€ ä¸ºæœåŠ¡å‘ç°ç±»å‹</h2><ul><li>å°† blackbox-http å’Œ node_exporter æ”¹ä¸ºæ–‡ä»¶å‘ç°</li><li>prometheus é…ç½®</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;blackbox-http&#x27;</span><br>  <span class="hljs-attr">metrics_path:</span> <span class="hljs-string">/probe</span><br>  <span class="hljs-comment"># ä¼ å…¥çš„å‚æ•°</span><br>  <span class="hljs-attr">params:</span><br>    <span class="hljs-attr">module:</span> [<span class="hljs-string">http_2xx</span>]  <span class="hljs-comment"># Look for a HTTP 200 response. æŸ¥çœ‹http_2xxçš„å“åº”</span><br>  <span class="hljs-comment"># æŠ“å–é—´éš”</span><br>  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span><br>  <span class="hljs-comment"># æŠ“å–è¶…æ—¶</span><br>  <span class="hljs-attr">scrape_timeout:</span> <span class="hljs-string">10s</span><br>  <span class="hljs-attr">scheme:</span> <span class="hljs-string">http</span><br>  <span class="hljs-comment"># æ˜¯å¦é‡‡ç”¨æ•°æ®æºæä¾›çš„æ—¶é—´æˆ³ä½œä¸ºæ—¶é—´æˆ³</span><br>  <span class="hljs-attr">honor_timestamps:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-comment"># åŸæ¥æ˜¯static_config,æ”¹ä¸ºæ–‡ä»¶å‘ç°</span><br>  <span class="hljs-attr">file_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/app/prometheus/sd/blackbox_http.json</span><br>    <span class="hljs-attr">refresh_interval:</span> <span class="hljs-string">2m</span><br>  <span class="hljs-attr">relabel_configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__address__</span>]<br>      <span class="hljs-attr">target_label:</span> <span class="hljs-string">__param_target</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__param_target</span>]<br>      <span class="hljs-attr">target_label:</span> <span class="hljs-string">instance</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">target_label:</span> <span class="hljs-string">__address__</span><br>      <span class="hljs-attr">replacement:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.222</span><span class="hljs-string">:9115</span> <br><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">&#x27;node_exporter&#x27;</span><br>  <span class="hljs-comment"># metricsçš„pathï¼ˆmetrics_pathé…ç½®é¡¹ï¼‰ æ³¨æ„ä¸éƒ½æ˜¯/metrics</span><br>  <span class="hljs-comment"># ä¼ å…¥çš„å‚æ•°</span><br>  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">30s</span><br>  <span class="hljs-attr">scrape_timeout:</span> <span class="hljs-string">10s</span><br>  <span class="hljs-attr">scheme:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">honor_timestamps:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">file_sd_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/app/prometheus/sd/node_exporter.json</span><br>    <span class="hljs-attr">refresh_interval:</span> <span class="hljs-string">2m</span><br><br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºsdç›®å½•</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -pv /opt/app/prometheus/sd/<br></code></pre></td></tr></table></figure><ul><li>å†™å…¥jsonæ–‡ä»¶</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &lt;&lt;EOF &gt; /opt/app/prometheus/sd/node_exporter.json<br>[<br>  &#123;<br>    &quot;targets&quot;: [<br>      &quot;192.168.101.222:9100&quot;<br>    ],<br>    &quot;labels&quot;: &#123;<br>      &quot;name&quot;: &quot;prome-master01&quot;,<br>      &quot;account&quot;: &quot;aliyun-01&quot;,<br>      &quot;region&quot;: &quot;ap-south-1&quot;,<br>      &quot;env&quot;: &quot;prod&quot;,<br>      &quot;group&quot;: &quot;inf&quot;,<br>      &quot;project&quot;: &quot;monitor&quot;,<br>      &quot;stree_gpa&quot;: &quot;inf.monitor.prometheus&quot;<br>    &#125;<br>  &#125;,<br>  &#123;<br>    &quot;targets&quot;: [<br>      &quot;192.168.101.223:9100&quot;<br>    ],<br>    &quot;labels&quot;: &#123;<br>      &quot;name&quot;: &quot;prome-node01&quot;,<br>      &quot;account&quot;: &quot;aliyun-02&quot;,<br>      &quot;region&quot;: &quot;ap-south-2&quot;,<br>      &quot;env&quot;: &quot;prod&quot;,<br>      &quot;group&quot;: &quot;inf&quot;,<br>      &quot;project&quot;: &quot;middleware&quot;,<br>      &quot;stree_gpa&quot;: &quot;inf.middleware.kafka&quot;<br>    &#125;<br>  &#125;<br>]<br>EOF<br><br>cat &lt;&lt;EOF &gt; /opt/app/prometheus/sd/blackbox_http.json<br>[<br>  &#123;<br>    &quot;targets&quot;: [<br>      &quot;192.168.101.222:9115&quot;,<br>      &quot;http://prometheus.io&quot;,<br>      &quot;http://www.baidu.com&quot;,<br>      &quot;https://www.baidu.com&quot;<br>    ]<br>  &#125;<br>]<br>EOF<br><br></code></pre></td></tr></table></figure><ul><li>reload prometheus</li><li>è§‚å¯Ÿtargeté¡µé¢ å’Œ sdç»“æœé¡µé¢</li><li>ä¿®æ”¹æ–‡ä»¶ blackbox_http.json æ–°å¢ <a href="https://github.com/">https://github.com/</a> çš„æ¢æµ‹ï¼Œé‡æ–°è§‚å¯Ÿtargeté¡µé¢ å’Œ sdç»“æœé¡µé¢ï¼Œä¼šå‘ç°æ–°æ·»åŠ çš„æ£€æµ‹ç«™ç‚¹ä¹Ÿæ·»åŠ åˆ°äº†é¡µé¢ä¸Šã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &lt;&lt;EOF &gt; /opt/app/prometheus/sd/blackbox_http.json<br>[<br>  &#123;<br>    &quot;targets&quot;: [<br>      &quot;192.168.101.222:9115&quot;,<br>      &quot;http://prometheus.io&quot;,<br>      &quot;http://www.baidu.com&quot;,<br>      &quot;https://www.baidu.com&quot;,<br>      &quot;https://github.com/&quot;<br>    ]<br>  &#125;<br>]<br>EOF<br><br><br>curl -X POST http://localhost:9090/-/reload<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>äº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‘åŸç”ŸPrometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åº”ç”¨ç¨‹åºå·²è¢«JAVAå®‰å…¨é˜»æ­¢javaè¢«å®‰å…¨é˜»æ­¢è§£å†³åŠæ³•</title>
    <link href="/2025/03/19/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%B7%B2%E8%A2%ABJAVA%E5%AE%89%E5%85%A8%E9%98%BB%E6%AD%A2java%E8%A2%AB%E5%AE%89%E5%85%A8%E9%98%BB%E6%AD%A2%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <url>/2025/03/19/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%B7%B2%E8%A2%ABJAVA%E5%AE%89%E5%85%A8%E9%98%BB%E6%AD%A2java%E8%A2%AB%E5%AE%89%E5%85%A8%E9%98%BB%E6%AD%A2%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>å¦‚æœåœ¨windows çš„æ§åˆ¶é¢æ¿å½“ä¸­å¯ä»¥æ‰¾åˆ°<code>javaçš„å›¾æ ‡</code>ï¼ŒæŒ‰ç…§è¿™ä¸ªåœ°å€æ–¹æ³•æ“ä½œï¼ˆ<a href="https://blog.51cto.com/u_16099271/11623668%EF%BC%89%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%89%BE%E5%88%B0java%E7%9A%84%E5%9B%BE%E6%A0%87%EF%BC%8C%E6%8C%89%E7%85%A7%E4%B8%8B%E6%96%B9%E7%9A%84%E6%95%99%E7%A8%8B%E6%93%8D%E4%BD%9C%EF%BC%9A">https://blog.51cto.com/u_16099271/11623668ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°javaçš„å›¾æ ‡ï¼ŒæŒ‰ç…§ä¸‹æ–¹çš„æ•™ç¨‹æ“ä½œï¼š</a></p><ol><li><p>æ‰¾åˆ° Java å®‰è£…ç›®å½•ä¸­çš„ <strong><code>deployment.properties</code></strong> æ–‡ä»¶ï¼Œé€šå¸¸ä½äºï¼š</p><ul><li>Windows: <code>C:\Users\&lt;username&gt;\AppData\LocalLow\Sun\Java\Deployment\security\</code></li><li>Linux&#x2F;Mac: <code>~/.java/deployment/security/</code></li></ul></li><li><p>æ‰“å¼€ <strong><code>deployment.properties</code></strong> æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ ä¾‹å¤–ç«™ç‚¹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">deployment.<span class="hljs-keyword">user</span>.<span class="hljs-keyword">security</span>.<span class="hljs-keyword">exception</span>.sites=&lt;URL&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">deployment<span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.exception</span>.sites=http:<span class="hljs-comment">//example.com</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿å­˜æ–‡ä»¶ï¼Œé‡å¯æµè§ˆå™¨æˆ–ç›¸å…³ Java åº”ç”¨ç¨‹åºã€‚</p></li></ol><p>è¿™æ ·å¯ä»¥å°†æŒ‡å®šçš„ç½‘ç«™åŠ å…¥ Java åº”ç”¨ç¨‹åºçš„ä¿¡ä»»åˆ—è¡¨ã€‚</p><p><strong>å¦‚æœæ²¡æœ‰ä¸Šé¢çš„ <code>deployment.properties</code> ï¼Œå¯ä»¥åœ¨è·¯å¾„ã€C:\Users&lt;username&gt;\AppData\LocalLow\Sun\Java\Deployment\security\ã€‘ä¸‹æ‰¾åˆ°exception.sitesæ–‡ä»¶ï¼Œåœ¨é‡Œé¢æ·»åŠ ç«™ç‚¹çš„urlåœ°å€ï¼ˆ<a href="http://192.68.101.1)è¿™ç§å½¢å¼çš„åœ°å€ä¹Ÿæ˜¯å¯ä»¥çš„/">http://192.68.101.1ï¼‰è¿™ç§å½¢å¼çš„åœ°å€ä¹Ÿæ˜¯å¯ä»¥çš„</a></strong></p>]]></content>
    
    
    <categories>
      
      <category>windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windowsã€JAVA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos7 å¿«é€Ÿéƒ¨ç½²k8s 1.27ç‰ˆæœ¬ï¼ˆä¸€å®šè¦å‡çº§å†…æ ¸ï¼Œå› ä¸ºciliuméœ€è¦ï¼‰</title>
    <link href="/2025/03/19/Centos7%20%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2k8s%201.27%E7%89%88%E6%9C%AC/"/>
    <url>/2025/03/19/Centos7%20%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2k8s%201.27%E7%89%88%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<h4 id="å…³é—­selinux-ä¸€å®šè¦åš"><a href="#å…³é—­selinux-ä¸€å®šè¦åš" class="headerlink" title="å…³é—­selinux(ä¸€å®šè¦åš)"></a>å…³é—­selinux(ä¸€å®šè¦åš)</h4><h4 id="å…³é—­é˜²ç«å¢™-æ¨èå…³é—­"><a href="#å…³é—­é˜²ç«å¢™-æ¨èå…³é—­" class="headerlink" title="å…³é—­é˜²ç«å¢™(æ¨èå…³é—­)"></a>å…³é—­é˜²ç«å¢™(æ¨èå…³é—­)</h4><h4 id="å®‰è£…å†…æ ¸"><a href="#å®‰è£…å†…æ ¸" class="headerlink" title="å®‰è£…å†…æ ¸"></a>å®‰è£…å†…æ ¸</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://dl.lamp.sh/kernel/el7/kernel-ml-5.10.222-1.el7.x86_64.rpm<br>wget https://dl.lamp.sh/kernel/el7/kernel-ml-devel-5.10.222-1.el7.x86_64.rpm<br><br>yum localinstall -y kernel-ml-5.10.222-1.el7.x86_64.rpm kernel-ml-devel-5.10.222-1.el7.x86_64.rpm<br><span class="hljs-comment">#å®‰è£…å®Œæ¯•åæŸ¥çœ‹ç³»ç»Ÿå¯ç”¨å¯åŠ¨å†…æ ¸</span><br>awk -F\&#x27; <span class="hljs-string">&#x27;$1==&quot;menuentry &quot; &#123;print  $2&#125;&#x27;</span> /etc/grub2.cfg<br></code></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å½“å‰å†…æ ¸"><a href="#æŸ¥çœ‹å½“å‰å†…æ ¸" class="headerlink" title="æŸ¥çœ‹å½“å‰å†…æ ¸"></a>æŸ¥çœ‹å½“å‰å†…æ ¸</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">grub2-editenv list<br><span class="hljs-comment">#ä¿®æ”¹é»˜è®¤å†…æ ¸CentOS Linux (5.10.222-1.el7.x86_64) 7 (Core)æ˜¯awkæŸ¥è¯¢å‡ºæ¥çš„å†…æ ¸åç§°</span><br>grub2-set-default <span class="hljs-string">&#x27;CentOS Linux (5.10.222-1.el7.x86_64) 7 (Core)&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="é‡æ–°å¯åŠ¨"><a href="#é‡æ–°å¯åŠ¨" class="headerlink" title="é‡æ–°å¯åŠ¨"></a>é‡æ–°å¯åŠ¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">reboot<br></code></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å†…æ ¸"><a href="#æŸ¥çœ‹å†…æ ¸" class="headerlink" title="æŸ¥çœ‹å†…æ ¸"></a>æŸ¥çœ‹å†…æ ¸</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">uname</span> -r<br></code></pre></td></tr></table></figure><h4 id="æŒ‡å®šsealosç‰ˆæœ¬ä¸‹è½½sealos"><a href="#æŒ‡å®šsealosç‰ˆæœ¬ä¸‹è½½sealos" class="headerlink" title="æŒ‡å®šsealosç‰ˆæœ¬ä¸‹è½½sealos"></a>æŒ‡å®šsealosç‰ˆæœ¬ä¸‹è½½sealos</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">VERSION=v4.3.7<br><span class="hljs-built_in">export</span> VERSION<br>wget https://mirror.ghproxy.com/https://github.com/labring/sealos/releases/download/<span class="hljs-variable">$&#123;VERSION&#125;</span>/sealos_<span class="hljs-variable">$&#123;VERSION#v&#125;</span>_linux_amd64.tar.gz<br></code></pre></td></tr></table></figure><h4 id="å®‰è£…k8s-1-27"><a href="#å®‰è£…k8s-1-27" class="headerlink" title="å®‰è£…k8s 1.27"></a>å®‰è£…k8s 1.27</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sealos run registry.cn-shanghai.aliyuncs.com/labring/kubernetes:v1.27.7 registry.cn-shanghai.aliyuncs.com/labring/helm:v3.9.4 \<br>     registry.cn-shanghai.aliyuncs.com/labring/cilium:v1.13.4 \<br>     --masters 192.168.101.73 \<br>     --nodes 192.168.101.74,192.168.101.75 -p [ä½ ä¸»æœºçš„å¯†ç ,æœ€å¥½å…¨éƒ¨ç»Ÿä¸€]<br></code></pre></td></tr></table></figure><h4 id="å®‰è£…å‘½ä»¤è¡¥å…¨"><a href="#å®‰è£…å‘½ä»¤è¡¥å…¨" class="headerlink" title="å®‰è£…å‘½ä»¤è¡¥å…¨"></a>å®‰è£…å‘½ä»¤è¡¥å…¨</h4><p><a href="https://www.t-ao.cn/archives/224/">https://www.t-ao.cn/archives/224/</a></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafkaçš„zookeeperã€kraftã€controller</title>
    <link href="/2025/03/19/Kafka%E7%9A%84zookeeper%E3%80%81kraft%E3%80%81controller/"/>
    <url>/2025/03/19/Kafka%E7%9A%84zookeeper%E3%80%81kraft%E3%80%81controller/</url>
    
    <content type="html"><![CDATA[<p><strong>Kafka ä¸­ ZooKeeper å’Œ Kraft æ¨¡å¼çš„åŒºåˆ«ï¼š</strong></p><p>åœ¨æ—©æœŸçš„ Kafka ç‰ˆæœ¬ä¸­ï¼ŒKafka é›†ç¾¤ä¾èµ–äº ZooKeeper æ¥è¿›è¡Œå…ƒæ•°æ®ç®¡ç†ã€åè°ƒå’Œé›†ç¾¤ç®¡ç†ã€‚ è€Œåœ¨ Kafka 3.x ç‰ˆæœ¬ä¹‹åï¼Œå¼•å…¥äº† Kraft æ¨¡å¼ï¼Œå¯ä»¥æ›¿ä»£ ZooKeeperï¼Œå®ç°æ—  ZooKeeper çš„éƒ¨ç½²ã€‚</p><p><strong>1. ZooKeeper æ¨¡å¼ï¼š</strong></p><ul><li><strong>ä¾èµ– ZooKeeperï¼š</strong> Kafka Broker éœ€è¦è¿æ¥åˆ° ZooKeeper é›†ç¾¤ï¼Œè·å–é›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</li><li><strong>å…ƒæ•°æ®å­˜å‚¨ï¼š</strong> Kafka é›†ç¾¤çš„å…ƒæ•°æ® (ä¾‹å¦‚ Topic ä¿¡æ¯ã€åˆ†åŒºä¿¡æ¯ã€Broker ä¿¡æ¯ç­‰) å­˜å‚¨åœ¨ ZooKeeper ä¸­ã€‚</li><li><strong>Controller é€‰ä¸¾ï¼š</strong> Kafka Controller çš„é€‰ä¸¾ç”± ZooKeeper å®Œæˆã€‚</li><li><strong>å¤æ‚æ€§ï¼š</strong> å¢åŠ äº†éƒ¨ç½²å’Œç®¡ç†çš„å¤æ‚æ€§ï¼Œéœ€è¦ç»´æŠ¤é¢å¤–çš„ ZooKeeper é›†ç¾¤ã€‚</li><li><strong>æ€§èƒ½ç“¶é¢ˆï¼š</strong> ZooKeeper çš„æ€§èƒ½å¯èƒ½æˆä¸º Kafka é›†ç¾¤çš„ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­ã€‚</li><li><strong>å¤–éƒ¨ä¾èµ–ï¼š</strong> å¯¹å¤–éƒ¨ç³»ç»Ÿ ZooKeeper æœ‰ä¾èµ–ï¼Œå¢åŠ äº†ç»´æŠ¤çš„æˆæœ¬ã€‚</li></ul><p><strong>2. Kraft æ¨¡å¼ï¼š</strong></p><ul><li><strong>æ—  ZooKeeper ä¾èµ–ï¼š</strong> Kafka é›†ç¾¤ä¸å†éœ€è¦è¿æ¥åˆ° ZooKeeperï¼Œè€Œæ˜¯ä½¿ç”¨ Kafka å†…éƒ¨çš„ Kraft æœºåˆ¶è¿›è¡Œå…ƒæ•°æ®ç®¡ç†ã€‚</li><li><strong>å…ƒæ•°æ®å­˜å‚¨ï¼š</strong> Kafka é›†ç¾¤çš„å…ƒæ•°æ®å­˜å‚¨åœ¨ Controller èŠ‚ç‚¹çš„å†…éƒ¨å­˜å‚¨ä¸­ï¼Œè€Œä¸æ˜¯ ZooKeeperã€‚</li><li><strong>Controller é€‰ä¸¾ï¼š</strong> Kafka Controller çš„é€‰ä¸¾ç”± Kafka é›†ç¾¤å†…éƒ¨çš„ Kraft æœºåˆ¶å®Œæˆã€‚</li><li><strong>ç®€åŒ–éƒ¨ç½²ï¼š</strong> ç®€åŒ–äº†éƒ¨ç½²å’Œç®¡ç†ï¼Œä¸éœ€è¦ç»´æŠ¤é¢å¤–çš„ ZooKeeper é›†ç¾¤ã€‚</li><li><strong>æ€§èƒ½æå‡ï¼š</strong> æé«˜äº†æ€§èƒ½ï¼Œå‡å°‘äº†å¯¹å¤–éƒ¨ç³»ç»Ÿçš„ä¾èµ–ã€‚</li><li><strong>å†…éƒ¨ç®¡ç†ï¼š</strong> å…ƒæ•°æ®ç®¡ç†å’Œé›†ç¾¤åè°ƒæ›´åŠ ç´§å¯†åœ°é›†æˆåœ¨ Kafka å†…éƒ¨ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong></p><table><thead><tr><th align="center">ç‰¹æ€§</th><th align="center">ZooKeeper æ¨¡å¼</th><th align="center">Kraft æ¨¡å¼</th></tr></thead><tbody><tr><td align="center">ä¾èµ–</td><td align="center">ä¾èµ– ZooKeeper é›†ç¾¤</td><td align="center">ä¸ä¾èµ– ZooKeeperï¼Œä½¿ç”¨å†…éƒ¨ Kraft æœºåˆ¶</td></tr><tr><td align="center">å…ƒæ•°æ®å­˜å‚¨</td><td align="center">å­˜å‚¨åœ¨ ZooKeeper ä¸­</td><td align="center">å­˜å‚¨åœ¨ Controller èŠ‚ç‚¹å†…éƒ¨</td></tr><tr><td align="center">Controller é€‰ä¸¾</td><td align="center">ç”± ZooKeeper å®Œæˆ</td><td align="center">ç”± Kraft æœºåˆ¶å®Œæˆ</td></tr><tr><td align="center">éƒ¨ç½²å’Œç®¡ç†</td><td align="center">å¤æ‚ï¼Œéœ€è¦ç»´æŠ¤ ZooKeeper é›†ç¾¤</td><td align="center">ç®€åŒ–ï¼Œæ— éœ€ç»´æŠ¤ ZooKeeper é›†ç¾¤</td></tr><tr><td align="center">æ€§èƒ½</td><td align="center">æ€§èƒ½å¯èƒ½å— ZooKeeper é™åˆ¶</td><td align="center">æ€§èƒ½æ›´é«˜ï¼Œå‡å°‘å¤–éƒ¨ä¾èµ–</td></tr><tr><td align="center">ç»´æŠ¤æˆæœ¬</td><td align="center">ç»´æŠ¤æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦ç»´æŠ¤ ZooKeeper é›†ç¾¤</td><td align="center">ç»´æŠ¤æˆæœ¬è¾ƒä½ï¼Œæ— éœ€ç»´æŠ¤ ZooKeeper é›†ç¾¤</td></tr></tbody></table><p><strong>ä»€ä¹ˆæ˜¯ Controllerï¼Ÿ</strong></p><p>åœ¨ Kafka é›†ç¾¤ä¸­ï¼Œ<strong>Controller</strong> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Brokerï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤çš„å…ƒæ•°æ®å’Œæ‰§è¡Œä¸€äº›å…³é”®çš„ç®¡ç†ä»»åŠ¡ã€‚Controller æ˜¯ Kafka é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒè´Ÿè´£åè°ƒå’Œæ§åˆ¶æ•´ä¸ªé›†ç¾¤çš„è¿è¡Œã€‚</p><p><strong>Controller çš„ä½œç”¨ï¼š</strong></p><ol><li><strong>åˆ†åŒºç®¡ç†ï¼š</strong><ul><li>ç»´æŠ¤ Topic åˆ†åŒºçš„å‰¯æœ¬ä¿¡æ¯ã€‚</li><li>å†³å®šæ¯ä¸ªåˆ†åŒºçš„ Leader å’Œ Followerã€‚</li><li>å½“ Leader Broker å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¿›è¡Œ Leader çš„é‡æ–°é€‰ä¸¾ã€‚</li></ul></li><li><strong>å‰¯æœ¬ç®¡ç†ï¼š</strong><ul><li>ç»´æŠ¤ Topic åˆ†åŒºçš„å‰¯æœ¬åˆ—è¡¨ã€‚</li><li>ç›‘æ§å‰¯æœ¬çš„çŠ¶æ€ï¼Œç¡®ä¿å‰¯æœ¬çš„åŒæ­¥ã€‚</li><li>å½“å‰¯æœ¬å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¿›è¡Œå‰¯æœ¬çš„é‡æ–°åˆ†é…ã€‚</li></ul></li><li><strong>Broker ç®¡ç†ï¼š</strong><ul><li>ç›‘æ§ Broker çš„çŠ¶æ€ï¼Œä¾‹å¦‚ Broker æ˜¯å¦åœ¨çº¿ã€æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</li><li>å½“ Broker åŠ å…¥æˆ–ç¦»å¼€é›†ç¾¤æ—¶ï¼Œæ›´æ–°é›†ç¾¤çš„å…ƒæ•°æ®ã€‚</li></ul></li><li><strong>Topic ç®¡ç†ï¼š</strong><ul><li>åˆ›å»ºã€åˆ é™¤å’Œä¿®æ”¹ Topicã€‚</li><li>ç®¡ç† Topic çš„åˆ†åŒºå’Œå‰¯æœ¬ã€‚</li></ul></li><li><strong>å…ƒæ•°æ®ç®¡ç†ï¼š</strong><ul><li>ç»´æŠ¤æ•´ä¸ªé›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</li><li>å°†å…ƒæ•°æ®ä¿¡æ¯åŒæ­¥åˆ°æ‰€æœ‰ Brokerã€‚</li></ul></li><li><strong>é›†ç¾¤åè°ƒï¼š</strong><ul><li>åè°ƒ Kafka é›†ç¾¤çš„å„é¡¹æ“ä½œï¼Œä¾‹å¦‚åˆ†åŒºé‡åˆ†é…ã€Broker æ‰©å®¹ç­‰ã€‚</li></ul></li></ol><p><strong>Controller çš„ä½ç½®ï¼š</strong></p><ul><li><strong>ZooKeeper æ¨¡å¼ï¼š</strong> åœ¨ ZooKeeper æ¨¡å¼ä¸‹ï¼ŒController æ˜¯ç”± ZooKeeper é€‰ä¸¾äº§ç”Ÿçš„ã€‚Kafka é›†ç¾¤ä¸­çš„æ‰€æœ‰ Broker éƒ½ä¼šç«äº‰æˆä¸º Controllerï¼Œæœ€ç»ˆåªæœ‰ä¸€ä¸ª Broker ä¼šè¢«é€‰ä¸¾ä¸º Controllerã€‚</li><li><strong>Kraft æ¨¡å¼ï¼š</strong> åœ¨ Kraft æ¨¡å¼ä¸‹ï¼ŒController æ˜¯ç”± Kafka é›†ç¾¤å†…éƒ¨çš„ Kraft æœºåˆ¶é€‰ä¸¾äº§ç”Ÿçš„ã€‚ Controller æ˜¯é›†ç¾¤ä¸­å…·æœ‰ç‰¹æ®Šè§’è‰²çš„ Brokerï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤çš„å…ƒæ•°æ®å’Œæ‰§è¡Œç®¡ç†ä»»åŠ¡ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong></p><ul><li><strong>ZooKeeper æ¨¡å¼ï¼š</strong> Kafka ä¾èµ– ZooKeeper è¿›è¡Œå…ƒæ•°æ®ç®¡ç†å’Œåè°ƒï¼Œéœ€è¦ç»´æŠ¤é¢å¤–çš„ ZooKeeper é›†ç¾¤ã€‚</li><li><strong>Kraft æ¨¡å¼ï¼š</strong> Kafka ä¸ä¾èµ– ZooKeeperï¼Œä½¿ç”¨å†…éƒ¨çš„ Kraft æœºåˆ¶è¿›è¡Œå…ƒæ•°æ®ç®¡ç†ï¼Œç®€åŒ–äº†éƒ¨ç½²å’Œç®¡ç†ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li><li><strong>Controllerï¼š</strong> æ˜¯ Kafka é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤çš„å…ƒæ•°æ®ã€åˆ†åŒºã€å‰¯æœ¬å’Œ Brokerã€‚</li><li><strong>Controller çš„ä½ç½®ï¼š</strong> åœ¨ ZooKeeper æ¨¡å¼ä¸‹ï¼ŒController ç”± ZooKeeper é€‰ä¸¾äº§ç”Ÿï¼›åœ¨ Kraft æ¨¡å¼ä¸‹ï¼ŒController ç”± Kafka é›†ç¾¤å†…éƒ¨çš„ Kraft æœºåˆ¶é€‰ä¸¾äº§ç”Ÿã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>arthasç›‘æ§ElasticsearchæŠ¥é”™</title>
    <link href="/2025/03/19/arthas%E7%9B%91%E6%8E%A7Elasticsearch%E6%8A%A5%E9%94%99/"/>
    <url>/2025/03/19/arthas%E7%9B%91%E6%8E%A7Elasticsearch%E6%8A%A5%E9%94%99/</url>
    
    <content type="html"><![CDATA[<h2 id="arthasä»‹ç»"><a href="#arthasä»‹ç»" class="headerlink" title="arthasä»‹ç»"></a>arthasä»‹ç»</h2><ul><li>arthasæ˜¯Alibabaæ¨å‡ºçš„javaè¯Šæ–­å·¥å…·</li><li><a href="https://arthas.aliyun.com/doc/install-detail.html">å®˜æ–¹æ–‡æ¡£</a></li></ul><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ul><li>å‡†å¤‡dockerç¯å¢ƒ(ä½¿ç”¨dockerå®¹å™¨çš„æ–¹æ³•éƒ¨ç½²arthaså’ŒES)</li></ul><table><thead><tr><th>name</th><th>portï¼ˆarthaså¯åŠ¨é»˜è®¤ç›‘å¬çš„ç«¯å£ï¼Œå¯ä»¥åœ¨webç«¯è¿›è¡Œè®¿é—®ï¼‰</th></tr></thead><tbody><tr><td>centos_arthas</td><td>3658:3658</td></tr></tbody></table><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -tid --name centos_arthas -p 3658:3658 <span class="hljs-attribute">--privileged</span>=<span class="hljs-literal">true</span> centos:latest /sbin/init<br></code></pre></td></tr></table></figure><ul><li>å¯ä»¥æŒ‰ç…§ä»¥ä¸‹å®‰è£…elasticsearch<br><a href="https://www.cnblogs.com/liwangcai/p/14011981.html">elasticsearché›†ç¾¤å®‰è£…</a><br><a href="https://www.cnblogs.com/liwangcai/p/14010028.html">elasticsearchå•æœºå¿«é€Ÿå®‰è£…</a></li><li>è¿›å…¥åˆ°å®¹å™¨ä¸­</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it centos_arthas /bin/bash<br></code></pre></td></tr></table></figure><h2 id="é…ç½®ä¿®æ”¹"><a href="#é…ç½®ä¿®æ”¹" class="headerlink" title="é…ç½®ä¿®æ”¹"></a>é…ç½®ä¿®æ”¹</h2><ul><li>æ­¤å¤„çš„é…ç½®ä¿®æ”¹æŒ‰ç…§æœ¬ç«™ä¹‹å‰åšå®¢è·¯å¾„è¿›è¡Œä¿®æ”¹</li><li>åˆ›å»ºï¼Œä¿®æ”¹java.policyæ–‡ä»¶</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># è¿™ä¸ªpolicyæ–‡ä»¶çš„åå­—å«ä»€ä¹ˆéƒ½å¯ä»¥ï¼Œä½†æ˜¯éœ€è¦æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰è¡Œï¼Œæ¨èå«elasticsearch.policy è¿™æ ·æ–¹ä¾¿åŒºåˆ«è¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯å¹²å•¥ç”¨çš„ï¼ŒåŸæ–‡çš„è§£å†³è¿æ¥æ¥è‡ªgithubçš„issueï¼šhttps://github.com/alibaba/arthas/issues/156  @ralf0131å¤§ä½¬æä¾›çš„è§£å†³åŠæ³•</span><br><span class="hljs-string">vi</span> <span class="hljs-string">/opt/es/config/elasticsearch.policy</span>  <br><br><span class="hljs-comment"># å…·ä½“æ–‡ä»¶å†…çš„å†…å®¹</span><br><span class="hljs-string">grant</span> <span class="hljs-string">codeBase</span> <span class="hljs-string">&quot;file:$&#123;user.home&#125;/.arthas/lib/-&quot;</span> &#123;<br>    <span class="hljs-string">//</span> <span class="hljs-string">å…è®¸</span> <span class="hljs-string">Arthas</span> <span class="hljs-string">è¯»å†™è‡ªèº«ç›®å½•åŠæ—¥å¿—</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.io.FilePermission</span> <span class="hljs-string">&quot;$&#123;user.home&#125;/.arthas/-&quot;</span>, <span class="hljs-string">&quot;read,write&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.io.FilePermission</span> <span class="hljs-string">&quot;$&#123;user.home&#125;/logs/arthas/-&quot;</span>, <span class="hljs-string">&quot;read,write,delete&quot;</span><span class="hljs-string">;</span><br>    <br>    <span class="hljs-string">//</span> <span class="hljs-string">æ ¸å¿ƒè¿è¡Œæ—¶æƒé™</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;createClassLoader&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;getClassLoader&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;modifyThreadGroup&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;modifyThread&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;shutdownHooks&quot;</span><span class="hljs-string">;</span><br>    <br>    <span class="hljs-string">//</span> <span class="hljs-string">åå°„ç›¸å…³æƒé™</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;accessClassInPackage.sun.reflect&quot;</span><span class="hljs-string">;</span><br>    <br>    <span class="hljs-string">//</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">åè®®è®¿é—®æƒé™</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;accessClassInPackage.sun.net.www.protocol.http&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;accessClassInPackage.sun.net.www.http&quot;</span><span class="hljs-string">;</span><br>    <br>    <span class="hljs-string">//</span> <span class="hljs-string">ç½‘ç»œç«¯å£æƒé™ï¼ˆArthas</span> <span class="hljs-string">é»˜è®¤ä½¿ç”¨</span> <span class="hljs-number">3658</span> <span class="hljs-string">å’Œ</span> <span class="hljs-number">8563</span><span class="hljs-string">ï¼‰</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.net.SocketPermission</span> <span class="hljs-string">&quot;127.0.0.1:3658&quot;</span>, <span class="hljs-string">&quot;listen,resolve&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.net.SocketPermission</span> <span class="hljs-string">&quot;127.0.0.1:8563&quot;</span>, <span class="hljs-string">&quot;listen,resolve&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.net.SocketPermission</span> <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-string">&quot;accept&quot;</span><span class="hljs-string">;</span><br>&#125;<span class="hljs-string">;</span><br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹&#x2F;opt&#x2F;es&#x2F;jdk&#x2F;conf&#x2F;security&#x2F;java.policyé…ç½®</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">grant</span> &#123;<br>    <span class="hljs-string">permission</span> <span class="hljs-string">org.elasticsearch.ThreadPermission</span> <span class="hljs-string">&quot;modifyArbitraryThreadGroup&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">org.elasticsearch.ThreadPermission</span> <span class="hljs-string">&quot;modifyArbitraryThread&quot;</span><span class="hljs-string">;</span><br>&#125;<span class="hljs-string">;</span><br><br><br><span class="hljs-string">grant</span> &#123;<br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.io.FilePermission</span> <span class="hljs-string">&quot;&lt;&lt;ALL FILES&gt;&gt;&quot;</span>, <span class="hljs-string">&quot;read,write&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.util.PropertyPermission</span> <span class="hljs-string">&quot;JM.LOG.PATH&quot;</span>, <span class="hljs-string">&quot;write&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.RuntimePermission</span> <span class="hljs-string">&quot;*&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.lang.reflect.ReflectPermission</span> <span class="hljs-string">&quot;*&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">java.net.SocketPermission</span> <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-string">&quot;connect,listen,resolve,accept&quot;</span><span class="hljs-string">;</span><br>    <span class="hljs-string">permission</span> <span class="hljs-string">ognl.OgnlInvokePermission</span> <span class="hljs-string">&quot;*&quot;</span><span class="hljs-string">;</span><br>&#125;<span class="hljs-string">;</span><br><br></code></pre></td></tr></table></figure><ul><li>å¯åŠ¨elasticsearch</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/opt/es/bin/elasticsearch -d<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…arthas"><a href="#å®‰è£…arthas" class="headerlink" title="å®‰è£…arthas"></a>å®‰è£…arthas</h2><ul><li><h4 id="é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè¿™é‡Œä½¿ç”¨esè‡ªå¸¦çš„jdkï¼‰"><a href="#é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè¿™é‡Œä½¿ç”¨esè‡ªå¸¦çš„jdkï¼‰" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè¿™é‡Œä½¿ç”¨esè‡ªå¸¦çš„jdkï¼‰"></a>é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè¿™é‡Œä½¿ç”¨esè‡ªå¸¦çš„jdkï¼‰</h4></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœæ˜¯å®‰è£…è¿‡JDKç¯å¢ƒï¼Œeså¯åŠ¨çš„æ—¶å€™ä¹Ÿæ˜¯ç”¨çš„å®‰è£…è¿‡çš„JDKï¼Œé‚£è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥ä¸ç”¨é…ç½®ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰é…ç½®jdkçš„ç¯å¢ƒï¼Œå»ºè®®è¿˜æ˜¯é…ç½®ä¸€ä¸‹ï¼Œæ–¹ä¾¿å¯åŠ¨çš„æ—¶å€™å¯ä»¥æ‰§è¡Œjava -jar è¿™æ ·çš„å‘½ä»¤</span><br>echo &#x27;export JAVA_HOME=/opt/es/jdk&#x27; &gt;&gt;  ~/.bashrc<br>echo &#x27;export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar&#x27; &gt;&gt; ~/.bashrc<br>echo &#x27;export PATH=$JAVA_HOME/bin:$PATH&#x27; &gt;&gt; ~/.bashrc<br>chmod +x ~/.bashrc<br>source ~/.bashrc<br></code></pre></td></tr></table></figure><ul><li><h4 id="å®‰è£…arthas-1"><a href="#å®‰è£…arthas-1" class="headerlink" title="å®‰è£…arthas"></a>å®‰è£…arthas</h4></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell">[elastic@3f24eb371050 opt]$ curl -O https://arthas.aliyun.com/arthas-boot.jar<br><span class="hljs-meta prompt_">  % </span><span class="language-bash">Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100  135k  100  135k    0     0   217k      0 --:--:-- --:--:-- --:--:--  217k<br>[elastic@3f24eb371050 opt]$ java -jar arthas-boot.jar --repo-mirror aliyun --use-http<br>[INFO] arthas-boot version: 3.4.4<br>[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.<br>* [1]: 513 org.elasticsearch.bootstrap.Elasticsearch<br>1<br>[INFO] Start download arthas from remote server: http://arthas.aliyun.com/download/3.4.4?mirror=aliyun<br>[INFO] File size: 11.94 MB, downloaded size: 4.32 MB, downloading ...<br>[INFO] File size: 11.94 MB, downloaded size: 7.45 MB, downloading ...<br>[INFO] File size: 11.94 MB, downloaded size: 9.85 MB, downloading ...<br>[INFO] Download arthas success.<br>[INFO] arthas home: /home/elastic/.arthas/lib/3.4.4/arthas<br>[INFO] Try to attach process 513<br>[INFO] Attach process 513 success.<br>[INFO] arthas-client connect 127.0.0.1 3658<br>  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.<br> /  O  \ |  .--. &#x27;&#x27;--.  .--&#x27;|  &#x27;--&#x27;  | /  O  \ &#x27;   .-&#x27;<br>|  .-.  ||  &#x27;--&#x27;.&#x27;   |  |   |  .--.  ||  .-.  |`.  `-.<br>|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-&#x27;    |<br>`--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27;   `--&#x27;   `--&#x27;  `--&#x27;`--&#x27; `--&#x27;`-----&#x27;<br><br><br>wiki      https://arthas.aliyun.com/doc<br>tutorials https://arthas.aliyun.com/doc/arthas-tutorials.html<br>version   3.4.4<br>pid       513<br>time      2020-11-30 05:37:25<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">[arthas@513]$ </span><span class="language-bash">shutdown        <span class="hljs-comment">##å®‰è£…å®Œæˆåå…ˆé€€å‡ºå¢åŠ --target-ipå‚æ•°å¯åŠ¨</span></span><br><br></code></pre></td></tr></table></figure><ul><li><h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">[elastic@3f24eb371050 opt]$ java -jar arthas-boot.jar  --target-ip 0.0.0.0<br>[INFO] arthas-boot version: 3.4.4<br>[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.<br>* [1]: 513 org.elasticsearch.bootstrap.Elasticsearch<br>1<br>[INFO] arthas home: /home/elastic/.arthas/lib/3.4.4/arthas<br>[INFO] Try to attach process 513<br>[INFO] Attach process 513 success.<br>[INFO] arthas-client connect 0.0.0.0 3658<br>  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.<br> /  O  \ |  .--. &#x27;&#x27;--.  .--&#x27;|  &#x27;--&#x27;  | /  O  \ &#x27;   .-&#x27;<br>|  .-.  ||  &#x27;--&#x27;.&#x27;   |  |   |  .--.  ||  .-.  |`.  `-.<br>|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-&#x27;    |<br>`--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27;   `--&#x27;   `--&#x27;  `--&#x27;`--&#x27; `--&#x27;`-----&#x27;<br><br><br>wiki      https://arthas.aliyun.com/doc<br>tutorials https://arthas.aliyun.com/doc/arthas-tutorials.html<br>version   3.4.4<br>pid       513<br>time      2020-11-30 05:39:45<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">[arthas@513]$ </span><span class="language-bash">dashboard</span><br><br></code></pre></td></tr></table></figure><ul><li><h4 id="ç›‘æ§æ•°æ®ï¼ŒæˆåŠŸå¯åŠ¨"><a href="#ç›‘æ§æ•°æ®ï¼ŒæˆåŠŸå¯åŠ¨" class="headerlink" title="ç›‘æ§æ•°æ®ï¼ŒæˆåŠŸå¯åŠ¨"></a>ç›‘æ§æ•°æ®ï¼ŒæˆåŠŸå¯åŠ¨</h4></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell">ID   NAME                          GROUP          PRIORITY  STATE     %CPU      DELTA_TIM TIME      INTERRUPT DAEMON<br>-1   C1 CompilerThread0            -              -1        -         0.23      0.011     0:2.577   false     true<br>-1   C2 CompilerThread0            -              -1        -         0.13      0.006     0:9.784   false     true<br>153  Timer-for-arthas-dashboard-02 system         5         RUNNABLE  0.08      0.004     0:0.055   false     true<br>151  arthas-NettyHttpTelnetBootstr system         5         RUNNABLE  0.06      0.003     0:0.086   false     true<br>19   elasticsearch[3f24eb371050][s main           5         TIMED_WAI 0.06      0.003     0:0.599   false     true<br>43   elasticsearch[3f24eb371050][m main           5         TIMED_WAI 0.05      0.002     0:0.032   false     true<br>45   elasticsearch[3f24eb371050][m main           5         TIMED_WAI 0.04      0.002     0:0.023   false     true<br>-1   VM Periodic Task Thread       -              -1        -         0.04      0.002     0:0.391   false     true<br>-1   VM Thread                     -              -1        -         0.01      0.000     0:0.225   false     true<br>18   elasticsearch[3f24eb371050][[ main           5         TIMED_WAI 0.01      0.000     0:0.101   false     true<br>-1   Sweeper thread                -              -1        -         0.0       0.000     0:0.159   false     true<br>Memory                    used    total    max     usage    GC<br>heap                      264M    989M     989M    26.73%   gc.parnew.count               8<br>par_eden_space            190M    273M     273M    69.70%   gc.parnew.time(ms)            138<br>par_survivor_space        26M     34M      34M     77.56%   gc.concurrentmarksweep.count  2<br>cms_old_gen               47M     682M     682M    7.00%    gc.concurrentmarksweep.time(m 39<br>nonheap                   126M    137M     -1      92.30%   s)<br>codeheap_&#x27;non-nmethods&#x27;   1M      2M       5M      27.30%<br>metaspace                 97M     104M     -1      93.26%<br><br>Runtime<br>os.name                                                     Linux<br>os.version                                                  4.19.76-linuxkit<br>java.version                                                13.0.2<br>java.home                                                   /opt/es/jdk<br>systemload.average                                          0.00<br>processors                                                  6<br>uptime<br><br></code></pre></td></tr></table></figure><ul><li><p>arthaså‘½ä»¤(å®˜æ–¹æ–‡æ¡£é‡Œæœ‰ï¼š<a href="https://arthas.aliyun.com/doc/commands.html">https://arthas.aliyun.com/doc/commands.html</a>)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs shell">jvm ç›¸å…³<br>    dashboard - å½“å‰ç³»ç»Ÿçš„å®æ—¶æ•°æ®é¢æ¿<br>    getstatic - æŸ¥çœ‹ç±»çš„é™æ€å±æ€§<br>    heapdump - dump java heap, ç±»ä¼¼ jmap å‘½ä»¤çš„ heap dump åŠŸèƒ½<br>    jvm - æŸ¥çœ‹å½“å‰ JVM çš„ä¿¡æ¯<br>    logger - æŸ¥çœ‹å’Œä¿®æ”¹ logger<br>    mbean - æŸ¥çœ‹ Mbean çš„ä¿¡æ¯<br>    memory - æŸ¥çœ‹ JVM çš„å†…å­˜ä¿¡æ¯<br>    ognl - æ‰§è¡Œ ognl è¡¨è¾¾å¼<br>    perfcounter - æŸ¥çœ‹å½“å‰ JVM çš„ Perf Counter ä¿¡æ¯<br>    sysenv - æŸ¥çœ‹ JVM çš„ç¯å¢ƒå˜é‡<br>    sysprop - æŸ¥çœ‹å’Œä¿®æ”¹ JVM çš„ç³»ç»Ÿå±æ€§<br>    thread - æŸ¥çœ‹å½“å‰ JVM çš„çº¿ç¨‹å †æ ˆä¿¡æ¯<br>    vmoption - æŸ¥çœ‹å’Œä¿®æ”¹ JVM é‡Œè¯Šæ–­ç›¸å…³çš„ option<br>    vmtool - ä» jvm é‡ŒæŸ¥è¯¢å¯¹è±¡ï¼Œæ‰§è¡Œ forceGc<br>    class/classloader ç›¸å…³<br>    classloader - æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯ï¼Œä½¿ç”¨ classloader å» getResource<br>    dump - dump å·²åŠ è½½ç±»çš„ byte code åˆ°ç‰¹å®šç›®å½•<br>    jad - åç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç <br>    mc - å†…å­˜ç¼–è¯‘å™¨ï¼Œå†…å­˜ç¼–è¯‘.javaæ–‡ä»¶ä¸º.classæ–‡ä»¶<br>    redefine - åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œredefine åˆ° JVM é‡Œ<br>    retransform - åŠ è½½å¤–éƒ¨çš„.classæ–‡ä»¶ï¼Œretransform åˆ° JVM é‡Œ<br>    sc - æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯<br>    sm - æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯<br><br>monitor/watch/trace ç›¸å…³<br>    æ³¨æ„ï¼šè¯·æ³¨æ„ï¼Œè¿™äº›å‘½ä»¤ï¼Œéƒ½é€šè¿‡å­—èŠ‚ç å¢å¼ºæŠ€æœ¯æ¥å®ç°çš„ï¼Œä¼šåœ¨æŒ‡å®šç±»çš„æ–¹æ³•ä¸­æ’å…¥ä¸€äº›åˆ‡é¢æ¥å®ç°æ•°æ®ç»Ÿè®¡å’Œè§‚æµ‹ï¼Œå› æ­¤åœ¨çº¿ä¸Šã€é¢„å‘ä½¿ç”¨æ—¶ï¼Œè¯·å°½é‡æ˜ç¡®éœ€è¦è§‚æµ‹çš„ç±»ã€æ–¹æ³•ä»¥åŠæ¡ä»¶ï¼Œè¯Šæ–­ç»“æŸè¦æ‰§è¡Œ stop æˆ–å°†å¢å¼ºè¿‡çš„ç±»æ‰§è¡Œ reset å‘½ä»¤ã€‚<br><br>    monitor - æ–¹æ³•æ‰§è¡Œç›‘æ§<br>    stack - è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„<br>    trace - æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶<br>    tt - æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹<br>    watch - æ–¹æ³•æ‰§è¡Œæ•°æ®è§‚æµ‹<br>    profiler/ç«ç„°å›¾<br>    profiler - ä½¿ç”¨async-profilerå¯¹åº”ç”¨é‡‡æ ·ï¼Œç”Ÿæˆç«ç„°å›¾<br>    jfr - åŠ¨æ€å¼€å¯å…³é—­ JFR è®°å½•<br><br>é‰´æƒ<br>    auth - é‰´æƒ<br>    options<br>    options - æŸ¥çœ‹æˆ–è®¾ç½® Arthas å…¨å±€å¼€å…³<br><br>ç®¡é“<br>    Arthas æ”¯æŒä½¿ç”¨ç®¡é“å¯¹ä¸Šè¿°å‘½ä»¤çš„ç»“æœè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œå¦‚sm java.lang.String * | grep &#x27;index&#x27;<br>    grep - æœç´¢æ»¡è¶³æ¡ä»¶çš„ç»“æœ<br>    plaintext - å°†å‘½ä»¤çš„ç»“æœå»é™¤ ANSI é¢œè‰²<br>    wc - æŒ‰è¡Œç»Ÿè®¡è¾“å‡ºç»“æœ<br><br>åå°å¼‚æ­¥ä»»åŠ¡<br>å½“çº¿ä¸Šå‡ºç°å¶å‘çš„é—®é¢˜ï¼Œæ¯”å¦‚éœ€è¦ watch æŸä¸ªæ¡ä»¶ï¼Œè€Œè¿™ä¸ªæ¡ä»¶ä¸€å¤©å¯èƒ½æ‰ä¼šå‡ºç°ä¸€æ¬¡æ—¶ï¼Œå¼‚æ­¥åå°ä»»åŠ¡å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œè¯¦æƒ…è¯·å‚è€ƒè¿™é‡Œ<br><br>    ä½¿ç”¨ &gt; å°†ç»“æœé‡å†™å‘åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œä½¿ç”¨ &amp; æŒ‡å®šå‘½ä»¤æ˜¯åå°è¿è¡Œï¼Œsession æ–­å¼€ä¸å½±å“ä»»åŠ¡æ‰§è¡Œï¼ˆç”Ÿå‘½å‘¨æœŸé»˜è®¤ä¸º 1 å¤©ï¼‰<br>    jobs - åˆ—å‡ºæ‰€æœ‰ job<br>    kill - å¼ºåˆ¶ç»ˆæ­¢ä»»åŠ¡<br>    fg - å°†æš‚åœçš„ä»»åŠ¡æ‹‰åˆ°å‰å°æ‰§è¡Œ<br>    bg - å°†æš‚åœçš„ä»»åŠ¡æ”¾åˆ°åå°æ‰§è¡Œ<br><br>åŸºç¡€å‘½ä»¤<br>    base64 - base64 ç¼–ç è½¬æ¢ï¼Œå’Œ linux é‡Œçš„ base64 å‘½ä»¤ç±»ä¼¼<br>    cat - æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œå’Œ linux é‡Œçš„ cat å‘½ä»¤ç±»ä¼¼<br>    cls - æ¸…ç©ºå½“å‰å±å¹•åŒºåŸŸ<br>    echo - æ‰“å°å‚æ•°ï¼Œå’Œ linux é‡Œçš„ echo å‘½ä»¤ç±»ä¼¼<br>    grep - åŒ¹é…æŸ¥æ‰¾ï¼Œå’Œ linux é‡Œçš„ grep å‘½ä»¤ç±»ä¼¼<br>    help - æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¿¡æ¯<br>    history - æ‰“å°å‘½ä»¤å†å²<br>    keymap - Arthas å¿«æ·é”®åˆ—è¡¨åŠè‡ªå®šä¹‰å¿«æ·é”®<br>    pwd - è¿”å›å½“å‰çš„å·¥ä½œç›®å½•ï¼Œå’Œ linux å‘½ä»¤ç±»ä¼¼<br>    quit - é€€å‡ºå½“å‰ Arthas å®¢æˆ·ç«¯ï¼Œå…¶ä»– Arthas å®¢æˆ·ç«¯ä¸å—å½±å“<br>    reset - é‡ç½®å¢å¼ºç±»ï¼Œå°†è¢« Arthas å¢å¼ºè¿‡çš„ç±»å…¨éƒ¨è¿˜åŸï¼ŒArthas æœåŠ¡ç«¯å…³é—­æ—¶ä¼šé‡ç½®æ‰€æœ‰å¢å¼ºè¿‡çš„ç±»<br>    session - æŸ¥çœ‹å½“å‰ä¼šè¯çš„ä¿¡æ¯<br>    stop - å…³é—­ Arthas æœåŠ¡ç«¯ï¼Œæ‰€æœ‰ Arthas å®¢æˆ·ç«¯å…¨éƒ¨é€€å‡º<br>    tee - å¤åˆ¶æ ‡å‡†è¾“å…¥åˆ°æ ‡å‡†è¾“å‡ºå’ŒæŒ‡å®šçš„æ–‡ä»¶ï¼Œå’Œ linux é‡Œçš„ tee å‘½ä»¤ç±»ä¼¼<br>    version - è¾“å‡ºå½“å‰ç›®æ ‡ Java è¿›ç¨‹æ‰€åŠ è½½çš„ Arthas ç‰ˆæœ¬å·<br></code></pre></td></tr></table></figure></li></ul><h2 id="é€šè¿‡webè®¿é—®arthas"><a href="#é€šè¿‡webè®¿é—®arthas" class="headerlink" title="é€šè¿‡webè®¿é—®arthas"></a>é€šè¿‡webè®¿é—®arthas</h2><ul><li>å¢åŠ â€“target-ipå‚æ•°ï¼ˆä¸Šé¢çš„æ“ä½œæ­¥éª¤ä¸­å·²ç»åŠ è¿‡äº†ï¼‰</li><li>é€šè¿‡å®¿ä¸»æœºæµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼ˆ<a href="http://localhost:3658/">http://localhost:3658</a>ï¼‰<br><img src="https://pic.yt/i/2025/02/28/67c1293bb983c.png"></li></ul><p>åŸæ–‡è¿æ¥ï¼Œåœ¨ä½œè€…çš„åŸºç¡€ä¸Šæ·»åŠ ä¿®æ”¹äº†éƒ¨åˆ†å†…å®¹ï¼š <a href="https://www.cnblogs.com/liwangcai/p/14060875.html">https://www.cnblogs.com/liwangcai/p/14060875.html</a></p>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ARTHAS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVMåƒåœ¾å›æ”¶å™¨å¸¸è§çš„ç»„åˆå’Œå„è‡ªçš„ç‰¹ç‚¹</title>
    <link href="/2025/03/19/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BB%84%E5%90%88%E5%92%8C%E5%90%84%E8%87%AA%E7%9A%84%E7%89%B9%E7%82%B9/"/>
    <url>/2025/03/19/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BB%84%E5%90%88%E5%92%8C%E5%90%84%E8%87%AA%E7%9A%84%E7%89%B9%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€æ–°ç”Ÿä»£ä¸è€å¹´ä»£åƒåœ¾å›æ”¶å™¨çš„ç»„åˆ"><a href="#ä¸€ã€æ–°ç”Ÿä»£ä¸è€å¹´ä»£åƒåœ¾å›æ”¶å™¨çš„ç»„åˆ" class="headerlink" title="ä¸€ã€æ–°ç”Ÿä»£ä¸è€å¹´ä»£åƒåœ¾å›æ”¶å™¨çš„ç»„åˆ"></a><strong>ä¸€ã€æ–°ç”Ÿä»£ä¸è€å¹´ä»£åƒåœ¾å›æ”¶å™¨çš„ç»„åˆ</strong></h3><table><thead><tr><th><strong>æ–°ç”Ÿä»£å›æ”¶å™¨</strong></th><th><strong>è€å¹´ä»£å›æ”¶å™¨</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th><th><strong>JDK é»˜è®¤ç‰ˆæœ¬</strong></th></tr></thead><tbody><tr><td><strong>Serial</strong></td><td><strong>Serial Old</strong></td><td>å•çº¿ç¨‹å®¢æˆ·ç«¯åº”ç”¨ã€ä½èµ„æºç¯å¢ƒ</td><td>JDK 1.3~8ï¼ˆå®¢æˆ·ç«¯æ¨¡å¼ï¼‰</td></tr><tr><td><strong>ParNew</strong></td><td><strong>CMS</strong></td><td>ä½å»¶è¿Ÿ Web æœåŠ¡ã€å“åº”ä¼˜å…ˆç³»ç»Ÿ</td><td>JDK 5~8ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ï¼‰</td></tr><tr><td><strong>Parallel Scavenge</strong></td><td><strong>Parallel Old</strong></td><td>é«˜ååé‡åå°ä»»åŠ¡ï¼ˆè®¡ç®—å¯†é›†å‹ï¼‰</td><td>JDK 7~8ï¼ˆæœåŠ¡ç«¯æ¨¡å¼é»˜è®¤ï¼‰</td></tr><tr><td><strong>G1</strong></td><td><strong>G1 è‡ªèº«ç®¡ç†åˆ†ä»£</strong></td><td>å¤§å †å†…å­˜ã€ä½å»¶è¿Ÿã€åŠ¨æ€åˆ†ä»£</td><td>JDK 9+ï¼ˆæœåŠ¡ç«¯æ¨¡å¼é»˜è®¤ï¼‰</td></tr></tbody></table><h3 id="äºŒã€å„ç»„åˆæ ¸å¿ƒç‰¹ç‚¹"><a href="#äºŒã€å„ç»„åˆæ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="äºŒã€å„ç»„åˆæ ¸å¿ƒç‰¹ç‚¹"></a><strong>äºŒã€å„ç»„åˆæ ¸å¿ƒç‰¹ç‚¹</strong></h3><h4 id="1-Serial-Serial-Old"><a href="#1-Serial-Serial-Old" class="headerlink" title="1. Serial + Serial Old"></a><strong>1. Serial + Serial Old</strong></h4><ul><li>æ–°ç”Ÿä»£ï¼ˆSerialï¼‰ï¼š<ul><li>å•çº¿ç¨‹å¤åˆ¶ç®—æ³•ï¼ˆStop-The-Worldï¼ŒSTWï¼‰ã€‚</li><li>ç®€å•é«˜æ•ˆï¼Œæ— çº¿ç¨‹äº¤äº’å¼€é”€ã€‚</li></ul></li><li>è€å¹´ä»£ï¼ˆSerial Oldï¼‰ï¼š<ul><li>å•çº¿ç¨‹æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆSTWï¼‰ã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>å®¢æˆ·ç«¯åº”ç”¨ï¼ˆå¦‚ Swing æ¡Œé¢ç¨‹åºï¼‰ã€åµŒå…¥å¼è®¾å¤‡ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šSTW æ—¶é—´é•¿ï¼Œä¸é€‚ç”¨äºæœåŠ¡ç«¯å¤§å †å†…å­˜ã€‚</li></ul></li></ul><h4 id="2-ParNew-CMS"><a href="#2-ParNew-CMS" class="headerlink" title="2. ParNew + CMS"></a><strong>2. ParNew + CMS</strong></h4><ul><li>æ–°ç”Ÿä»£ï¼ˆParNewï¼‰ï¼š<ul><li>å¤šçº¿ç¨‹å¤åˆ¶ç®—æ³•ï¼ˆSTWï¼‰ï¼Œä¸ Serial å…¼å®¹ã€‚</li></ul></li><li>è€å¹´ä»£ï¼ˆCMSï¼‰ï¼š<ul><li>å¤šçº¿ç¨‹å¹¶å‘æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆConcurrent Mark Sweepï¼‰ã€‚</li><li><strong>å››é˜¶æ®µ</strong>ï¼šåˆå§‹æ ‡è®°ï¼ˆSTWï¼‰â†’ å¹¶å‘æ ‡è®°â†’ é‡æ–°æ ‡è®°ï¼ˆSTWï¼‰â†’ å¹¶å‘æ¸…é™¤ã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>Web æœåŠ¡ã€API æœåŠ¡å™¨ï¼ˆè¿½æ±‚ä½å»¶è¿Ÿï¼Œå®¹å¿å†…å­˜ç¢ç‰‡ï¼‰ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šCPU æ•æ„Ÿï¼Œå†…å­˜ç¢ç‰‡å¯èƒ½å¯¼è‡´ Full GC é€€åŒ–ï¼ˆéœ€å‹ç¼©ï¼‰ã€‚</li></ul></li></ul><h4 id="3-Parallel-Scavenge-Parallel-Old"><a href="#3-Parallel-Scavenge-Parallel-Old" class="headerlink" title="3. Parallel Scavenge + Parallel Old"></a><strong>3. Parallel Scavenge + Parallel Old</strong></h4><ul><li>æ–°ç”Ÿä»£ï¼ˆParallel Scavengeï¼‰ï¼š<ul><li>å¤šçº¿ç¨‹å¤åˆ¶ç®—æ³•ï¼ˆSTWï¼‰ï¼Œ<strong>ååé‡ä¼˜å…ˆ</strong>ã€‚</li></ul></li><li>è€å¹´ä»£ï¼ˆParallel Oldï¼‰ï¼š<ul><li>å¤šçº¿ç¨‹æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆSTWï¼‰ã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>æ‰¹å¤„ç†ã€ç§‘å­¦è®¡ç®—ï¼ˆå¦‚ Hadoop ç¦»çº¿ä»»åŠ¡ï¼‰ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šSTW æ—¶é—´ä¸å¯æ§ï¼Œä¸é€‚åˆä½å»¶è¿Ÿåœºæ™¯ã€‚</li></ul></li></ul><h4 id="4-G1ï¼ˆGarbage-Firstï¼‰"><a href="#4-G1ï¼ˆGarbage-Firstï¼‰" class="headerlink" title="4. G1ï¼ˆGarbage-Firstï¼‰"></a><strong>4. G1ï¼ˆGarbage-Firstï¼‰</strong></h4><ul><li>åˆ†ä»£ç®¡ç†ï¼š<ul><li><strong>é€»è¾‘åˆ†ä»£</strong>ï¼šä»ä¿ç•™æ–°ç”Ÿä»£ï¼ˆEden&#x2F;Survivorï¼‰å’Œè€å¹´ä»£ï¼ˆOldï¼‰ã€‚</li><li><strong>ç‰©ç†åˆ’åˆ†</strong>ï¼šå°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°å›ºå®šçš„ Regionï¼ˆ1MB~32MBï¼‰ï¼ŒåŠ¨æ€åˆ†é…ä¸º Eden&#x2F;Survivor&#x2F;Old&#x2F;Humongousï¼ˆå¤§å¯¹è±¡åŒºï¼‰ã€‚</li></ul></li><li>å›æ”¶æœºåˆ¶ï¼š<ul><li><strong>Young GC</strong>ï¼šå›æ”¶æ–°ç”Ÿä»£ Regionï¼ˆSTWï¼‰ã€‚</li><li><strong>Mixed GC</strong>ï¼šåŒæ—¶å›æ”¶æ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£ Regionï¼ˆSTWï¼‰ï¼ŒåŸºäºåœé¡¿é¢„æµ‹æ¨¡å‹ã€‚</li><li><strong>Full GC</strong>ï¼šé€€åŒ–æ—¶è§¦å‘ï¼ˆå•çº¿ç¨‹æ•´ç†ï¼Œç±»ä¼¼ Serial Oldï¼‰ã€‚</li></ul></li><li>ç‰¹ç‚¹ï¼š<ul><li><strong>ä½å»¶è¿Ÿ</strong>ï¼šé€šè¿‡ Region å›æ”¶å’Œåœé¡¿é¢„æµ‹æ§åˆ¶ STW æ—¶é—´ï¼ˆé»˜è®¤ 200msï¼‰ã€‚</li><li><strong>å¤§å †å‹å¥½</strong>ï¼šé€‚åˆ 4GB ä»¥ä¸Šå †å†…å­˜ã€‚</li><li><strong>å†…å­˜æ•´ç†</strong>ï¼šMixed GC é˜¶æ®µå¹¶è¡Œæ•´ç†ï¼Œå‡å°‘ç¢ç‰‡ã€‚</li></ul></li><li>é€‚ç”¨åœºæ™¯ï¼š<ul><li>ç°ä»£æœåŠ¡ç«¯åº”ç”¨ï¼ˆå¦‚å¾®æœåŠ¡ã€äº‘åŸç”Ÿç¯å¢ƒï¼‰ã€‚</li></ul></li></ul><h3 id="ä¸‰ã€å…³äº-G1-çš„ç–‘é—®è§£ç­”"><a href="#ä¸‰ã€å…³äº-G1-çš„ç–‘é—®è§£ç­”" class="headerlink" title="ä¸‰ã€å…³äº G1 çš„ç–‘é—®è§£ç­”"></a><strong>ä¸‰ã€å…³äº G1 çš„ç–‘é—®è§£ç­”</strong></h3><p><strong>Q: G1 æ²¡æœ‰è€å¹´ä»£äº†å—ï¼Ÿ</strong><br><strong>A</strong>: ä¸æ˜¯ã€‚G1 <strong>ä»ç„¶æœ‰è€å¹´ä»£</strong>ï¼Œä½†åˆ†ä»£æ–¹å¼ä¸ä¼ ç»Ÿå›æ”¶å™¨ä¸åŒï¼š</p><ol><li><strong>é€»è¾‘åˆ†ä»£ä¿ç•™</strong>ï¼šå¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰è¾¾åˆ°é˜ˆå€¼åæ™‹å‡åˆ°è€å¹´ä»£ã€‚</li><li><strong>ç‰©ç† Region åŠ¨æ€åˆ†é…</strong>ï¼šè€å¹´ä»£ç”±å¤šä¸ª Region ç»„æˆï¼Œä¸è¦æ±‚è¿ç»­å†…å­˜ã€‚</li><li><strong>æ··åˆå›æ”¶ï¼ˆMixed GCï¼‰</strong> ï¼šé€‰æ‹©æ€§å›æ”¶é«˜åƒåœ¾æ¯”ä¾‹çš„è€å¹´ä»£ Regionï¼Œé¿å…å…¨å †æ‰«æã€‚</li></ol><h3 id="å››ã€å¯¹æ¯”æ€»ç»“"><a href="#å››ã€å¯¹æ¯”æ€»ç»“" class="headerlink" title="å››ã€å¯¹æ¯”æ€»ç»“"></a><strong>å››ã€å¯¹æ¯”æ€»ç»“</strong></h3><table><thead><tr><th><strong>å›æ”¶å™¨ç»„åˆ</strong></th><th><strong>ååé‡</strong></th><th><strong>å»¶è¿Ÿ</strong></th><th><strong>å†…å­˜ç¢ç‰‡</strong></th><th><strong>é€‚ç”¨å †å¤§å°</strong></th></tr></thead><tbody><tr><td>Serial + Serial Old</td><td>ä½</td><td>é«˜</td><td>ä½</td><td>&lt;100MB</td></tr><tr><td>ParNew + CMS</td><td>ä¸­</td><td>ä½</td><td>é«˜</td><td>2~4GB</td></tr><tr><td>Parallel Scavenge</td><td>é«˜</td><td>ä¸­</td><td>ä½</td><td>2~8GB</td></tr><tr><td>G1</td><td>ä¸­é«˜</td><td>ä½</td><td>ä½</td><td>&gt;4GB</td></tr></tbody></table><h3 id="äº”ã€é€‰æ‹©å»ºè®®"><a href="#äº”ã€é€‰æ‹©å»ºè®®" class="headerlink" title="äº”ã€é€‰æ‹©å»ºè®®"></a><strong>äº”ã€é€‰æ‹©å»ºè®®</strong></h3><ol><li><strong>å°å † &amp; å®¢æˆ·ç«¯</strong>ï¼šSerial + Serial Oldã€‚</li><li><strong>ä¸­ç­‰å † &amp; ä½å»¶è¿Ÿ</strong>ï¼šParNew + CMSï¼ˆJDK 8 åŠä¹‹å‰ï¼‰ã€‚</li><li><strong>å¤§å † &amp; é«˜åå</strong>ï¼šParallel Scavenge + Parallel Oldï¼ˆè®¡ç®—å¯†é›†å‹ï¼‰ã€‚</li><li><strong>å¤§å † &amp; ä½å»¶è¿Ÿ</strong>ï¼šG1ï¼ˆJDK 9+ é¦–é€‰ï¼‰æˆ– ZGC&#x2F;Shenandoahï¼ˆè¶…å¤§å †+æä½å»¶è¿Ÿï¼‰ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>JAVA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
